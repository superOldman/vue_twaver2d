!function(e,t){function i(e){var t=[],i=!0,r=[];return e.forEach(function(e){e instanceof Array?(i=!0,t.push(e)):(i&&(i=!1,r=[],t.push(r)),r.push(e))}),t}function r(e,t){function i(t){var i,r,a=s?new se.BufferNode:new se.Entity,n=t.buffers,l=n.index,h=n.position.data,c=n.normal&&n.normal.data,u=n.color&&n.color.data,f=n.uv&&n.uv.data,p=[],d=[],m=[],g={};if(g["m.specular"]=new se.Color(11513775),g["m.type"]="phong",g["m.normalType"]=oe.NormalTypeSmooth,g["m.anisotropy"]=16,s)t.mode&&(a.mode=t.mode),l&&a.addAttribute("index",{array:l}),Object.keys(n).forEach(function(e){if("index"!==e){var t=n[e],i=e;"weight"===e?i="skinWeight":"joint"===e?i="skinIndex":"position0"===e?i="morphTarget0":"position1"===e?i="morphTarget1":"normal0"===e?i="morphNormal0":"normal1"===e&&(i="morphNormal1"),a.addAttribute(i,{array:t.data,stride:t.stride,type:t.type})}});else{for(i=0,r=h.length;i<r;i+=3)a.vertices.push(new se.Vec3(h[i],h[i+1],h[i+2]));if(c)for(i=0,r=c.length;i<r;i+=3)d.push(new se.Vec3(c[i],c[i+1],c[i+2]));if(f)for(i=0,r=f.length;i<r;i+=2)p.push(new se.Vec2(f[i],f[i+1]));for(i=0,r=l.length;i<r;i+=3){var v=l[i],y=l[i+1],A=l[i+2],x=c?[d[v],d[y],d[A]]:null,_=u?[m[v],m[y],m[A]]:null,w=new se.Face3(v,y,A,x,_);a.faces.push(w),f&&a.uvs.push([p[v],p[y],p[A]])}a.onSizeChanged()}var b={};if(null!=t.material){var M=e.materials[t.material];if(M.extensions&&M.extensions.KHR_materials_common){var S=M.extensions.KHR_materials_common.values;S.ambient&&S.ambient.length&&0!==S.ambient[0]&&0!==S.ambient[1]&&0!==S.ambient[2]&&(g["m.ambient"]=(new se.Color).setRGB(S.ambient)),S.diffuse.length?g["m.color"]=(new se.Color).setRGB(S.diffuse):g["m.texture.image"]=o[S.diffuse.index].url,S.transparent&&(g["m.transparent"]=!0,g["m.opacity"]=S.transparency*S.diffuse[3]),S.specular.length&&(g["m.specular"]=(new se.Color).setRGB(S.specular))}else{"BLEND"===M.alphaMode&&(g["m.transparent"]=!0);var P=M.pbrMetallicRoughness;if(P){if(P.baseColorFactor){_=(new se.Color).setRGB(P.baseColorFactor);g["m.ambient"]=_,g["m.color"]=_}var C=P.baseColorTexture;C&&(g["m.texture.image"]=o[C.index].url)}var T=M.normalTexture;T&&(g["m.normalmap.image"]=o[T.index].url,b.normalScale=T.scale||1)}}else{_=(new se.Color).setRGB([.5,.5,.5,1]);g["m.color"]=_,g["m.ambient"]=_}return a.s(g),a}function r(t,i){var a=n[t],o=e.nodes[t];i?a.setParent(i):a.setParent(l),o.children&&o.children.forEach(function(e){r(e,a)})}var a=[],n=[],o=e.textures,s=t&&t.bufferNode,l=s?new se.BufferNode:new se.Entity;return e.meshes.forEach(function(e){var t;e.primitives.length>1?(t=s?new se.BufferNode:new se.Entity,e.primitives.forEach(function(e){t.addChild(i(e))})):t=i(e.primitives[0]),a.push(t)}),e.nodes.forEach(function(e){var t,i=(t=null!=e.mesh?a[e.mesh]:s?new se.BufferNode:new se.Entity)._info={};e.rotation&&(i.rotation=new se.Quat(e.rotation)),e.translation&&(i.translation=new se.Vec3(e.translation)),e.scale&&(i.scale=new se.Vec3(e.scale)),e.weights&&(i.weights=e.weights,t.setStyle("m.morphTargets",!0)),e.matrix&&t.setMatrix(e.matrix),e.skin&&(t._skin=e.skin,t.setStyle("m.skinning",!0),t.setStyle("m.maxBones",t._skin.joints.length)),n.push(t)}),e.scenes.forEach(function(e){e.nodes.forEach(function(e){r(e)})}),n.forEach(function(e){if(e._skin){var t=e._skin;t.node=e;t.inverseBindMatrices;for(var i=t.joints=t.joints.map(function(e){return n[e]}),r=t.jointMatrixs=new Array(i.length),a=t.jointMatrix=new Float32Array(16*i.length),o=0;o<i.length;o++)r[o]=new Float32Array(a.buffer,16*o*4,16);t._jointMat=new se.Mat4,t._inverseBindMat=new se.Mat4,t.update=function(){var e=this;e.joints.forEach(function(i,r){t._jointMat.elements=e.jointMatrixs[r],t._inverseBindMat.elements=e.inverseBindMatrices[r],t._jointMat.multiplyMatrices(i.worldMatrix,t._inverseBindMat)})},t.update()}}),e.animations.forEach(function(e){e.channels.forEach(function(t){t.node=n[t.node],t.node._animation=e})}),l.boundingBox=new oe.BoundingBox,l.getChildren().forEach(function(e){e.boundingBox&&l.boundingBox.union(e.boundingBox)}),l}function a(){function t(t,a,n){var o=Date.now(),s=new i.DecoderBuffer;s.Init(a,a.length);var l,h,c=new i.Decoder,u=c.GetEncodedGeometryType(s);if(u===i.TRIANGULAR_MESH?(l=new i.Mesh,h=c.DecodeBufferToMesh(s,l)):(l=new i.PointCloud,h=c.DecodeBufferToPointCloud(s,l)),!h.ok()||0===h.ptr)return i.destroy(s),i.destroy(c),i.destroy(l),void e.postMessage({error:"Draco decode error: "+h.error_msg()});i.destroy(s);var f=0;u===i.TRIANGULAR_MESH&&(f=l.num_faces());var p,d,m=l.num_points(),g={},v=[];if(Object.keys(t).forEach(function(e){var r=c.GetAttributeByUniqueId(l,t[e]);"POSITION"===e&&(p=r);var a=r.num_components(),n=m*a,o=g[e]=new Float32Array(n);v.push(o.buffer);var s=new i.DracoFloat32Array;c.GetAttributeFloatForAllPoints(l,r,s);for(var h=0;h<n;h++)o[h]=s.GetValue(h);i.destroy(s)}),u===i.TRIANGULAR_MESH){var y=new i.DracoInt32Array;if("TRIANGLE_STRIP"===n){d=new((A=c.GetTriangleStripsFromMesh(l,y))<=256?Uint8Array:A<=65536?Uint16Array:Uint32Array)(A),v.push(d.buffer);for(x=0;x<A;++x)d[x]=y.GetValue(x)}else{var A=3*f;d=new(A<=256?Uint8Array:A<=65536?Uint16Array:Uint32Array)(A),v.push(d.buffer);for(var x=0;x<f;++x){c.GetFaceFromMesh(l,x,y);var _=3*x;d[_]=y.GetValue(0),d[_+1]=y.GetValue(1),d[_+2]=y.GetValue(2)}}i.destroy(y)}var w=new i.AttributeQuantizationTransform;w.InitFromAttribute(p)&&console.log("AttributeQuantizationTransform",w.range(),w.quantization_bits(),w.min_value(0),w.min_value(1),w.min_value(2)),i.destroy(w),i.destroy(c),i.destroy(l),e.postMessage({time:Date.now()-o,initTime:r,datas:g,indices:d},v)}var i,r,a={onModuleLoaded:function(){r=Date.now()-r,e.postMessage("init")}};e.onmessage=function(n){var o=n.data;switch(o.type){case"init":"object"==typeof WebAssembly?(r=Date.now(),e.importScripts(o.path+"draco_wasm_wrapper_gltf.js"),fetch(o.path+"draco_decoder_gltf.wasm").then(function(e){return e.arrayBuffer()}).then(function(t){a.wasmBinary=t,i=e.DracoDecoderModule(a)})):(e.importScripts(o.path+"draco_decoder_gltf.js"),e.postMessage("init"));break;case"decode":t(o.attributes,o.encodedData,o.mode)}}}function n(e){var t,i,r,a=e.indexOf(",");for(e=e.substr(a+1),i=(e=atob(e)).length,r=new Uint8Array(i),t=0;t<i;t++)r[t]=e.charCodeAt(t);return r.buffer}function o(e){var t=new Blob(["("+e.toString()+")()"],{type:"application/javascript"});return URL.createObjectURL(t)}function s(e,t,i){var r=new XMLHttpRequest;r.onreadystatechange=function(e){4===this.readyState&&(200===this.status?i("string"==typeof r.response&&"json"===t?JSON.parse(r.response):r.response):i(null,this.responseURL+" "+this.statusText))},r.open("get",e),t&&(r.responseType=t),r.send()}function l(e,t,i,r,a,n){var o=a.realSize?a.realSize:a;t=t||"",t=String(t),e.font=i,e.fillStyle=r,e.strokeStyle="gray",e.textBaseline="middle",e.textAlign="center";for(var s=t.split("\n"),l=s.length,h=o.height/l,c=(a.height-o.height)/2,u=0;u<l;u++){var f=ge.getTextSize(i,s[u]).width,p=(a.height,f/2);"right"==n?(p=a.width-f/2,e.textAlign="center"):"left"==n?(p=f/2,e.textAlign="center",e.textBaseline="middle"):"center"==n&&(p=a.width/2),e.strokeText(s[u],p,h/2+u*h+c),e.fillText(s[u],p,h/2+u*h+c)}}function h(e,t){var i=0;if(e.shadowMatrix)for(var r=0,a=t.size();r<a;r++)t.get(r).refreshShadowUniforms(e,i)&&i++}function c(e,t){var i=0;if(e.pShadowMap)for(var r=0,a=t.size();r<a;r++)t.get(r).refreshUniformsPointShadow(e,i)&&i++}function u(e,t,i,r){if(t._modelViewMatrix||(t._modelViewMatrix=new ue),i.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&i.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements),e.modelViewProjectionMatrix){t._modelViewProjectionMatrix=new ue;var a=r._currentCamera.projectionMatrix;t._modelViewProjectionMatrix.multiply(a,t._modelViewMatrix),i.uniformMatrix4fv(e.modelViewProjectionMatrix,!1,t._modelViewProjectionMatrix.elements)}}function f(e,t,i){var r;return"fragment"===e?r=i.createShader(i.FRAGMENT_SHADER):"vertex"===e&&(r=i.createShader(i.VERTEX_SHADER)),i.shaderSource(r,t),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)||i.isContextLost()?r:(console.log(i.getShaderInfoLog(r)),console.error(t),null)}function p(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function d(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function m(e,t,i,r){e[t]=i.r*i.r*r,e[t+1]=i.g*i.g*r,e[t+2]=i.b*i.b*r}function g(e){var t=e,i=t._canvas;Oe.isNaN(t._renderInterval)&&(t._renderInterval=10),t.__timeOutFunc||(t.__timeOutFunc=function(e){var r=t._vrDisplay;if(t._animateId=(r&&r.isPresenting?r:window).requestAnimationFrame(t.__timeOutFunc),t._isPresenting){var a=t._camera;a.updateProjectionMatrix(),a.worldMatrix=a.leftVm,a.worldMatrixInverse=a.leftVmInverse,a.projectionMatrix=a.leftPm,t._gl.viewport(0,0,.5*i.width,i.height),t._dirty=!0,We.clear(!0,t.autoClearDepth,t.autoClearStencil,t),t.render(e),a.worldMatrix=a.rightVm,a.worldMatrixInverse=a.rightVmInverse,a.projectionMatrix=a.rightPm,t._gl.viewport(.5*i.width,0,.5*i.width,i.height),We.clear(!1,t.autoClearDepth,t.autoClearStencil,t),t.innerRender(a,!0),t.extendRender(a),r.submitFrame(),t._dirty=!0,a.projectionMatrix.makePerspective(t._oldCamera.fov,i.width/i.height,a.near,a.far),t._gl.viewport(0,0,i.width,i.height),We.clear(!0,t.autoClearDepth,t.autoClearStencil,t),t.innerRender(a,!0),t.extendRender(a)}else t.render(e)}),setTimeout(t.__timeOutFunc,t._renderInterval)}function v(e,t,i){null!=e&&("number"==typeof e?this.fromNumber(e,t,i):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function y(){return new v(null)}function A(e){return rt.charAt(e)}function x(e,t){var i=at[e.charCodeAt(t)];return null==i?-1:i}function _(e){var t=y();return t.fromInt(e),t}function w(e){var t,i=1;return 0!=(t=e>>>16)&&(e=t,i+=16),0!=(t=e>>8)&&(e=t,i+=8),0!=(t=e>>4)&&(e=t,i+=4),0!=(t=e>>2)&&(e=t,i+=2),0!=(t=e>>1)&&(e=t,i+=1),i}function b(e){this.m=e}function M(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function S(e,t){return e&t}function P(e,t){return e|t}function C(e,t){return e^t}function T(e,t){return e&~t}function E(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function z(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function D(){}function L(e){return e}function R(e){this.r2=y(),this.q3=y(),v.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function N(){this.i=0,this.j=0,this.S=new Array}function B(){return new N}function I(e){lt[ht++]^=255&e,lt[ht++]^=e>>8&255,lt[ht++]^=e>>16&255,lt[ht++]^=e>>24&255,ht>=ct&&(ht-=ct)}function F(){I((new Date).getTime())}function V(){if(null==st){for(F(),(st=B()).init(lt),ht=0;ht<lt.length;++ht)lt[ht]=0;ht=0}return st.next()}function U(){}function k(e,t){return new v(e,t)}function O(e,t){if(t<e.length+11)return null;for(var i=new Array,r=e.length-1;r>=0&&t>0;){var a=e.charCodeAt(r--);a<128?i[--t]=a:a>127&&a<2048?(i[--t]=63&a|128,i[--t]=a>>6|192):(i[--t]=63&a|128,i[--t]=a>>6&63|128,i[--t]=a>>12|224)}i[--t]=0;for(var n=new U,o=new Array;t>2;){for(o[0]=0;0==o[0];)n.nextBytes(o);i[--t]=o[0]}return i[--t]=2,i[--t]=0,new v(i)}function X(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function G(e,t){for(var i=e.toByteArray(),r=0;r<i.length&&0==i[r];)++r;if(i.length-r!=t-1||2!=i[r])return null;for(++r;0!=i[r];)if(++r>=i.length)return null;for(var a="";++r<i.length;){var n=255&i[r];n<128?a+=String.fromCharCode(n):n>191&&n<224?(a+=String.fromCharCode((31&n)<<6|63&i[r+1]),++r):(a+=String.fromCharCode((15&n)<<12|(63&i[r+1])<<6|63&i[r+2]),r+=2)}return a}function W(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.skyY.value=t.skyY,e.horizonY.value=t.horizonY,e.earthY.value=t.earthY,e.skyColor.value=t.skyColor,e.horizonColor.value=t.horizonColor,e.earthColor.value=t.earthColor}function Y(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function j(e,t){e&&e.skyY&&(e.skyY.value=t.skyY,e.horizonY.value=t.horizonY,e.earthY.value=t.earthY,e.skyColor.value=t.skyColor,e.horizonColor.value=t.horizonColor,e.earthColor.value=t.earthColor)}function H(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=t.scale||1,e.map.value=t.map}function q(e,t){return e.distance-t.distance}function Z(e,t,i,r,a){(e instanceof oe.Node||e instanceof oe.Billboard)&&K(e,t,i,r,a)}function Q(e,i,r,a,n){if(e!==t)for(var o=e.getDescendants(),s=0,l=o.length;s<l;s++)Z(o[s],i,r,a,n)}function K(e,i,r,a,n){if(a||0!=n.isVisible(e)){if(e instanceof oe.Billboard){var o=i.matrixPosition;o.setFromMatrixPosition(e.worldMatrix);var s=i.ray.distanceToPoint(o),l=e.material.alignment,h=new oe.Plane(1,1);(l.x||l.y)&&(h.setPosition(l.x,l.y,0),h=oe.Utils.transformElement(h,!0)),h.setPosition(o);var c=(new he).getScaleFromMatrix(e.worldMatrix);h.setScale(c.x,c.y,1);var u=i.direction.clone(),f=h.getPosition().clone(),p=e.material;p&&p.vertical&&(u.y=0),f.sub(u),h.lookAt(f),h.updateWorldMatrix(!0);var d=[];return K(h,i,d,!0,n),0===d.length?r:(r.push({distance:d[0].distance,point:e._position,face:null,object:e,element:e}),r)}if(e instanceof oe.Line){var m=1;m-=1;var g=(D=Math.sqrt(i.linePrecision+m))*D;if(null==(P=e).boundingSphere&&P.computeBoundingSphere(),Tt.copy(P.boundingSphere),Tt.applyMatrix4(e.worldMatrix),!1===i.ray.isIntersectionSphere(Tt))return r;St.getInverse(e.worldMatrix),Mt.copy(i.ray).transform(St);for(var v=(C=P.vertices).length,y=new he,A=new he,x=e.type===oe.LineStrip?1:2,_=0;_<v-1;_+=x)Mt.distanceSqToSegment(C[_],C[_+1],A,y)>g||(s=Mt.origin.distanceTo(A))<i.near||s>i.far||r.push({distance:s,point:y.clone().applyMatrix4(e.worldMatrix),face:null,faceIndex:null,element:e,object:e});return r}if(null===e.boundingSphere&&e.computeBoundingSphere(),Tt.set(e.worldMatrix.getPosition(),e.boundingSphere.radius*e.worldMatrix.getMaxScaleOnAxis()),!i.ray.isIntersectionSphere(Tt))return r;var w,b,M,S,P=e,C=P.vertices,T=e.material instanceof oe.ArrayMaterial,E=!0===T?e.material.materials:null,z=e.material.side,D=i.precision;e.rotationWorldMatrix.extractRotation(e.worldMatrix),St.getInverse(e.worldMatrix),Mt.copy(i.ray).transform(St);for(var L=0,R=P.faces.length;L<R;L++){var N=P.faces[L],B=!0===T?E[N.materialIndex]:e.material,I=n.getOverLoadMaterial(e,B);if(I&&(B=I),B!==t&&!1!==B.visible&&(!1!==P.visible||a)&&(!B.transparent||0!=B.opacity)){Pt.setFromNormalAndCoplanarPoint(N.normal,C[N.a]);var F=Mt.distanceToPlane(Pt);if(!(Math.abs(F)<D||F<0)){z=B.side;var V=Mt.direction.dot(Pt.normal);if((z===oe.DoubleSide||(z===oe.FrontSide?V<0:V>0))&&!(F<i.near||F>i.far)){Ct=Mt.at(F,Ct);var U,k=new he,O=(N.materialIndex,!1);if(n&&n._selectTransparencyThreshold>0&&(O=1==B.transparent||B.alphaTest>0),N instanceof oe.Face3){if(w=C[N.a],b=C[N.b],M=C[N.c],!oe.Triangle.containsPoint(Ct,w,b,M))continue;k=oe.Triangle.barycoordFromPoint(Ct,w,b,M)}else{if(!(N instanceof oe.Face4))throw Error("face type not supported");w=C[N.a],b=C[N.b],M=C[N.c],S=C[N.d];var X=oe.Triangle.containsPoint(Ct,w,b,S),G=oe.Triangle.containsPoint(Ct,b,M,S);if(!X&&!G)continue;X?k=oe.Triangle.barycoordFromPoint(Ct,w,b,S):(k=oe.Triangle.barycoordFromPoint(Ct,b,M,S),U=!0)}var W=new le,Y=k.z,j=k.x,H=k.y;if(P.uvs&&P.uvs[L]){var q=P.uvs[L];N instanceof oe.Face3?(W.x=q[0].x*j+q[1].x*H+q[2].x*Y,W.y=q[0].y*j+q[1].y*H+q[2].y*Y):U?(W.x=q[1].x*j+q[2].x*H+q[3].x*Y,W.y=q[1].y*j+q[2].y*H+q[3].y*Y):(W.x=q[0].x*j+q[1].x*H+q[3].x*Y,W.y=q[0].y*j+q[1].y*H+q[3].y*Y)}var Z,Q=1;if(W=n.debugUV||W,O){if(B.opacity<n._selectTransparencyThreshold)continue;null==B.map?Q=B.opacity:n._pickingTexturePixel&&(Z=B.map._image,Q=Oe.getPixelFromImage(Z,W.x,W.y)[3]/255*(null==B.opacity?1:B.opacity)),Q<B.alphaTest?Q=0:0==B.transparent&&(Q=1)}Q<n._selectTransparencyThreshold||r.push({distance:F,point:i.ray.at(F),face:N,uv:W,faceIndex:L,element:e,object:e,side:V>0?1:-1})}}}}}}function J(e){if(!Rt[e.id]){if(Bt=!0,Rt[e.id]=e,e.finish=null==e.finish?e.delay+e.dur+e.interval:e.finish,null==e.from&&e.attr&&e.source){var t;(t=e.attr.match(/^S[:@](.*)/i))?e.from=e.source.getStyle(t[1]):(t=e.attr.match(/^C[:@](.*)/i))?e.from=e.source.getClient(t[1]):e.from=se.getValue(e.source,e.attr)}$(e),ee(e)}return e}function $(e){var t=e.type,i=e.from,r=e.to;"number"===t?(e.from=i||0,e.to=r||0):"point"===t?(i?i.length&&(e.from={x:i[0],y:i[1]}):e.from="scale"===e.attr?{x:1,y:1}:{x:0,y:0},r?r.length&&(e.to={x:r[0],y:r[1]}):e.to="scale"===e.attr?{x:1,y:1}:{x:0,y:0}):"rect"===t&&(i?i.length&&(e.from={x:i[0],y:i[1],w:i[2],h:i[3]}):e.from={x:0,y:0,w:0,h:0},r?r.length&&(e.to={x:r[0],y:r[1],w:r[2],h:r[3]}):e.to={x:0,y:0,w:0,h:0}),e.current=e.from}function ee(e){var t=e.type,i=e.from,r=e.to;"number"===t?e.delta=r-i:"point"===t?e.delta={x:r.x-i.x,y:r.y-i.y}:"rect"===t?e.delta={x:r.x-i.x,y:r.y-i.y,w:r.w-i.w,h:r.h-i.h}:"color"===t&&(e.delta={r:r.r-i.r,g:r.g-i.g,b:r.b-i.b,a:r.a-i.a})}function te(e,t){return Rt[e.id]&&(null==t&&(t=!0),t&&ne(e,e.to),e.onStop&&e.onStop(),e.time=0,e.total=0,e.start=null,e.count=0,e.started=!1,e.stopped=!1,delete Rt[e.id]),e}function ie(e){null==e&&(e=!0),Object.keys(Rt).forEach(function(t){var i=Rt[t];e&&ne(i,i.to),i.onStop&&i.onStop()}),Rt={}}function re(e){Object.keys(Rt).forEach(function(t){var i=Rt[t];if(i){if(null==i.start&&(i.start=e),i.total=e-i.start,i.total>i.delay){i.time=i.total-i.delay;var r=!1;if(i.time>=i.dur&&(i.time=i.dur,r=!0),!i.stopped&&ne(i,ae(i)),i.stopped=r,i.total>=i.finish)if(++i.count>=i.repeat)te(i,!1),i.onDone&&i.onDone();else if(i.time=0,i.total=0,i.start=null,i.stopped=!1,i.reverse){var a=i.from;i.from=i.to,i.to=a,ee(i)}}!Bt&&(Bt=!0)}})}function ae(e,t){var i=e.type,r=e.delta,a=e.from,n=e.time,o=e.dur,s=xe[e.easing||"easeNone"];return s||(s=xe.easeNone),"number"===i?t=s(n,a,r,o):"point"===i?t={x:s(n,a.x,r.x,o),y:s(n,a.y,r.y,o)}:"rect"===i?t={x:s(n,a.x,r.x,o),y:s(n,a.y,r.y,o),w:s(n,a.w,r.w,o),h:s(n,a.h,r.h,o)}:"color"===i?t="rgba("+Math.floor(s(n,a.r,r.r,o))+","+Math.floor(s(n,a.g,r.g,o))+","+Math.floor(s(n,a.b,r.b,o))+","+Math.floor(s(n,a.a,r.a,o))+")":"set"===i?e.time&&(t=e.to):"group_set"===i&&(t=e.to[e.groupIndex]),e.current=t,t}function ne(e,t){if(e.started||(e.started=!0,e.onPlay&&e.onPlay()),e.filter&&(t=e.filter(t)),e.attr&&e.source){var i;(i=e.attr.match(/^S[:@](.*)/i))?e.source.setStyle(i[1],t):(i=e.attr.match(/^C[:@](.*)/i))?e.source.setClient(i[1],t):se.setValue(e.source,e.attr,t)}e.onUpdate&&e.onUpdate(t)}e.Int32Array=e.Int32Array||Array,e.Float32Array=e.Float32Array||Array,e.Uint8Array=e.Uint8Array||Array,e.Uint16Array=e.Uint16Array||Array,e.Uint32Array=e.Uint32Array||Array,Number.isNaN||(Number.isNaN=function(e){return"number"==typeof e&&isNaN(e)}),Object.create=Object.create||function(e){var t=function(){};return t.prototype=e,new t},String.prototype.includes||(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)});var oe={version:"2.6.13",_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(e){e=null==e?"":e;for(var t=[],i=0;i<32;i++)t[i]=this._id[Math.floor(16*Math.random())];return t[12]="4",t[16]=this._id[3&t[16]|8],e+t.join("")},ip:function(e,t,i,r){var a=i+t;e[oe.getter(t,r)]=function(){return this[a]},e[oe.setter(t)]=function(e){var i=this[a];i!==e&&(this.setPropertyValue?this.setPropertyValue(a,e)&&(this.onPropertyChange(t,i,e),this.firePropertyChange(t,i,e)):(this[a]=e,this.onPropertyChange(t,i,e),this.firePropertyChange(t,i,e)))}},getter:function(e,t){var i=e.charAt(0).toUpperCase()+e.slice(1),r=/ble$/.test(e)||/ed$/.test(e)?"is":"get";return t&&-1!=t.indexOf(e)&&(r="is"),r+i},setter:function(e){return"set"+(e.charAt(0).toUpperCase()+e.slice(1))},getValue:function(e,t,i){var r=t.charAt(0).toUpperCase()+t.slice(1),a="get"+r,n="is"+r;return i?"boolean"===i?e[n]():(null==e[a]&&console.log("get Function "+a+" not exist"),e[a]()):e[a]?e[a]():e[n]?e[n]():e[t]},setValue:function(e,t,i){e["set"+t.charAt(0).toUpperCase()+t.slice(1)](i)},clone:function(e){if(!e)return null;var t={};for(var i in e)t[i]=e[i];return t},addMethod:function(e,t){var i=e.prototype;for(var r in t)i[r]=t[r]},classCache:{},getClass:function(e){var t=oe.classCache[e];if(!t){var i=e.split("."),r=i.length;t=window;for(var a=0;a<r;a++)t=t[i[a]];oe.classCache[e]=t}return t},newInstance:function(e){"string"==typeof e&&(e=(e=oe.getClass(e)).prototype);var t=e.constructor;if(!t)return null;var i=arguments.length,r=arguments;if(1===i)return new t;if(2===i)return new t(r[1]);if(3===i)return new t(r[1],r[2]);if(4===i)return new t(r[1],r[2],r[3]);if(5===i)return new t(r[1],r[2],r[3],r[4]);if(6===i)return new t(r[1],r[2],r[3],r[4],r[5]);if(7===i)return new t(r[1],r[2],r[3],r[4],r[5],r[6]);if(8===i)return new t(r[1],r[2],r[3],r[4],r[5],r[6],r[7]);throw"don't support args more than 7"},xml:function(e){return(new DOMParser).parseFromString(e,"text/xml")}},se=oe;"function"==typeof e.define?e.define(function(){return oe}):"object"==typeof exports&&(module.exports=oe),window&&(window.TGL=window.mono=oe);oe.extend=function(e,t,i){if(t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.superClass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}var a=e.prototype;if(i){a.getClassName=function(){return i.className};for(var n in i){if("__accessor"===n)for(var o=i.__accessor,s=i.__bool,l=0;l<o.length;l++){h=o[l];oe.ip(a,h,"",s)}else if("___accessor"===n)for(var o=i.___accessor,l=0;l<o.length;l++){var h=o[l];oe.ip(a,h,"_",s)}a[n]=i[n]}i.constructor&&(a.newInstance=function(){return oe.newInstance(this)})}},oe.defaultEulerOrder="XYZ",String.prototype.startsWith=String.prototype.startsWith||function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=String.prototype.endsWith||function(e){var t=String(e),i=this.lastIndexOf(t);return(-1<i&&i)===this.length-t.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){for(var e=0,i=["ms","moz","webkit","o"],r=0;r<i.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[i[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[r]+"CancelAnimationFrame"]||window[i[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame===t&&(window.requestAnimationFrame=function(t,i){var r=Date.now(),a=Math.max(0,16-(r-e)),n=window.setTimeout(function(){t(r+a)},a);return e=r+a,n}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),oe.CullFaceNone=0,oe.CullFaceBack=1,oe.CullFaceFront=2,oe.CullFaceFrontBack=3,oe.FrontFaceDirectionCW=0,oe.FrontFaceDirectionCCW=1,oe.BasicShadowMap=0,oe.PCFShadowMap=1,oe.PCFSoftShadowMap=2,oe.FrontSide="front",oe.BackSide="back",oe.DoubleSide="both",oe.BothSide="both",oe.NoShading=0,oe.FlatShading=1,oe.SmoothShading=2,oe.NormalTypeFlat="flat",oe.NormalTypeSmooth="smooth",oe.NoColors=0,oe.FaceColors=1,oe.VertexColors=2,oe.GradientColors=3,oe.NoBlending=0,oe.NormalBlending=1,oe.AdditiveBlending=2,oe.SubtractiveBlending=3,oe.MultiplyBlending=4,oe.CustomBlending=5,oe.NormalBlendingAlpha=6,oe.AddEquation=100,oe.SubtractEquation=101,oe.ReverseSubtractEquation=102,oe.ZeroFactor=200,oe.OneFactor=201,oe.SrcColorFactor=202,oe.OneMinusSrcColorFactor=203,oe.SrcAlphaFactor=204,oe.OneMinusSrcAlphaFactor=205,oe.DstAlphaFactor=206,oe.OneMinusDstAlphaFactor=207,oe.DstColorFactor=208,oe.OneMinusDstColorFactor=209,oe.SrcAlphaSaturateFactor=210,oe.MultiplyOperation=0,oe.MixOperation=1,oe.AddOperation=2,oe.UVMapping=function(){},oe.CubeReflectionMapping=function(){},oe.CubeRefractionMapping=function(){},oe.SphericalReflectionMapping=function(){},oe.SphericalRefractionMapping=function(){},oe.RepeatWrapping="repeat",oe.ClampToEdgeWrapping="clamp",oe.MirroredRepeatWrapping="mirrored",oe.NearestFilter=1003,oe.NearestMipMapNearestFilter=1004,oe.NearestMipMapLinearFilter=1005,oe.LinearFilter=1006,oe.LinearMipMapNearestFilter=1007,oe.LinearMipMapLinearFilter=1008,oe.UnsignedByteType=1009,oe.ByteType=1010,oe.ShortType=1011,oe.UnsignedShortType=1012,oe.IntType=1013,oe.UnsignedIntType=1014,oe.FloatType=1015,oe.UnsignedShort4444Type=1016,oe.UnsignedShort5551Type=1017,oe.UnsignedShort565Type=1018,oe.AlphaFormat=1019,oe.RGBFormat=1020,oe.RGBAFormat=1021,oe.LuminanceFormat=1022,oe.LuminanceAlphaFormat=1023,oe.RGB_S3TC_DXT1_Format=2001,oe.RGBA_S3TC_DXT1_Format=2002,oe.RGBA_S3TC_DXT3_Format=2003,oe.RGBA_S3TC_DXT5_Format=2004,oe.Gradient_Linear_U=1,oe.Gradient_Linear_V=2,oe.Gradient_Linear_UV=3,oe.Gradient_Linear_NUV=4,oe.Gradient_Radial=5,oe.Gradient_Sweep=6,oe.Math={clamp:function(e,t,i){return e<t?t:e>i?i:e},isConcave:function(e,t,i){var r=i?1:-1;return(e.x*t.y-t.x*e.y)*r<0},area:function(e,i,r,a){var n=a?1:-1;return e&&i&&r?(-e.x*i.y-i.x*r.y-r.x*e.y+r.x*i.y+i.x*e.y+e.x*r.y)*n:t},isClockwise:function(e,t,i){t=t||"x",i=i||"y";for(var r=0,a=e.length,n=0;n<a;n++){var o=e[n],s=e[n+1===a?0:n+1];r+=(s[t]-o[t])*(s[i]+o[i])}return r<0},isClockwise3:function(e,t,i){(new he).crossVectors(e,t),(new he).subVectors(t,e),(new he).subVectors(t,e)},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,r,a){return r+(e-t)*(a-r)/(i-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(e){return e*oe.Math.__d2r},radToDeg:function(e){return e*oe.Math.__r2d},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},PI2:2*Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var a=0;a<36;a++)8==a||13==a||18==a||23==a?i[a]="-":14==a?i[a]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[a]=t[19==a?3&e|8:e]);return i.join("")}}()},oe.Math.__d2r=Math.PI/180,oe.Math.__r2d=180/Math.PI,oe.Quat=function(e,i,r,a){1===arguments.length&&(a=e[3],r=e[2],i=e[1],e=e[0]),this.x=e||0,this.y=i||0,this.z=r||0,this.w=a!==t?a:1},oe.Quat.prototype={constructor:oe.Quat,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,i){var r=Math.cos(e.x/2),a=Math.cos(e.y/2),n=Math.cos(e.z/2),o=Math.sin(e.x/2),s=Math.sin(e.y/2),l=Math.sin(e.z/2);return i===t||"XYZ"===i?(this.x=o*a*n+r*s*l,this.y=r*s*n-o*a*l,this.z=r*a*l+o*s*n,this.w=r*a*n-o*s*l):"YXZ"===i?(this.x=o*a*n+r*s*l,this.y=r*s*n-o*a*l,this.z=r*a*l-o*s*n,this.w=r*a*n+o*s*l):"ZXY"===i?(this.x=o*a*n-r*s*l,this.y=r*s*n+o*a*l,this.z=r*a*l+o*s*n,this.w=r*a*n-o*s*l):"ZYX"===i?(this.x=o*a*n-r*s*l,this.y=r*s*n+o*a*l,this.z=r*a*l-o*s*n,this.w=r*a*n+o*s*l):"YZX"===i?(this.x=o*a*n+r*s*l,this.y=r*s*n+o*a*l,this.z=r*a*l-o*s*n,this.w=r*a*n-o*s*l):"XZY"===i&&(this.x=o*a*n-r*s*l,this.y=r*s*n-o*a*l,this.z=r*a*l+o*s*n,this.w=r*a*n+o*s*l),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],a=i[4],n=i[8],o=i[1],s=i[5],l=i[9],h=i[2],c=i[6],u=i[10],f=r+s+u;return f>0?(t=.5/Math.sqrt(f+1),this.w=.25/t,this.x=(c-l)*t,this.y=(n-h)*t,this.z=(o-a)*t):r>s&&r>u?(t=2*Math.sqrt(1+r-s-u),this.w=(c-l)/t,this.x=.25*t,this.y=(a+o)/t,this.z=(n+h)/t):s>u?(t=2*Math.sqrt(1+s-r-u),this.w=(n-h)/t,this.x=(a+o)/t,this.y=.25*t,this.z=(l+c)/t):(t=2*Math.sqrt(1+u-r-s),this.w=(o-a)/t,this.x=(n+h)/t,this.y=(l+c)/t,this.z=.25*t),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,r=e.y,a=e.z,n=e.w,o=t.x,s=t.y,l=t.z,h=t.w;return this.x=i*h+n*o+r*l-a*s,this.y=r*h+n*s+a*o-i*l,this.z=a*h+n*l+i*s-r*o,this.w=n*h-i*o-r*s-a*l,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quat's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( Quat ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this.x,r=this.y,a=this.z,n=this.w,o=n*e.w+i*e.x+r*e.y+a*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=n,this.x=i,this.y=r,this.z=a,this;var s=Math.acos(o),l=Math.sqrt(1-o*o);if(Math.abs(l)<.001)return this.w=.5*(n+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(a+this.z),this;var h=Math.sin((1-t)*s)/l,c=Math.sin(t*s)/l;return this.w=n*h+this.w*c,this.x=i*h+this.x*c,this.y=r*h+this.y*c,this.z=a*h+this.z*c,this},toEuler:function(){var e=this.w*this.w,t=this.x*this.x,i=this.y*this.y,r=this.z*this.z;return[180/Math.PI*Math.atan2(2*(this.y*this.z+this.x*this.w),-t-i+r+e),180/Math.PI*Math.asin(-2*(this.x*this.z-this.y*this.w)),180/Math.PI*Math.atan2(2*(this.x*this.y+this.z*this.w),t-i-r+e)]},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new oe.Quat(this.x,this.y,this.z,this.w)}},oe.Quat.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)};var le=function(e,t){this.x=e||0,this.y=t||0};le.prototype={constructor:le,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return null!=e&&(e.x===this.x&&e.y===this.y)},clone:function(){return new le(this.x,this.y)}},oe.Vec2=le;var he=function(e,t,i){1===arguments.length&&(i=e[2],t=e[1],e=e[0]),this.x=parseFloat(e)||0,this.y=parseFloat(t)||0,this.z=parseFloat(i)||0};oe.Vec3=he,he.prototype={set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},center:function(e,t){return this.x=(e.x+t.x)/2,this.y=(e.y+t.y)/2,this.z=(e.z+t.z)/2,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*i+a[6]*r,this.y=a[1]*t+a[4]*i+a[7]*r,this.z=a[2]*t+a[5]*i+a[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements,n=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*i+a[8]*r+a[12])*n,this.y=(a[1]*t+a[5]*i+a[9]*r+a[13])*n,this.z=(a[2]*t+a[6]*i+a[10]*r+a[14])*n,this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements,n=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*i+a[8]*r+a[12])*n,this.y=(a[1]*t+a[5]*i+a[9]*r+a[13])*n,this.z=(a[2]*t+a[6]*i+a[10]*r+a[14])*n,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,a=e.x,n=e.y,o=e.z,s=e.w,l=s*t+n*r-o*i,h=s*i+o*t-a*r,c=s*r+a*i-n*t,u=-a*t-n*i-o*r;return this.x=l*s+u*-a+h*-o-c*-n,this.y=h*s+u*-n+c*-a-l*-o,this.z=c*s+u*-o+l*-n-h*-a,this},applyEuler:function(e,t){var i=he.__q1.setFromEuler(e,t);return this.applyQuaternion(i),this},applyAxisAngle:function(e,t){var i=he.__q1.setFromAxisAngle(e,t);return this.applyQuaternion(i),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this},cross:function(e){var t=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-i*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(e){return Math.acos(this.dot(e)/this.length()/e.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,i){function r(e){return Math.min(Math.max(e,-1),1)}var a=e.elements,n=a[0],o=a[4],s=a[8],l=a[1],h=a[5],c=a[9],u=a[2],f=a[6],p=a[10];return i===t||"XYZ"===i?(this.y=Math.asin(r(s)),Math.abs(s)<.99999?(this.x=Math.atan2(-c,p),this.z=Math.atan2(-o,n)):(this.x=Math.atan2(f,h),this.z=0)):"YXZ"===i?(this.x=Math.asin(-r(c)),Math.abs(c)<.99999?(this.y=Math.atan2(s,p),this.z=Math.atan2(l,h)):(this.y=Math.atan2(-u,n),this.z=0)):"ZXY"===i?(this.x=Math.asin(r(f)),Math.abs(f)<.99999?(this.y=Math.atan2(-u,p),this.z=Math.atan2(-o,h)):(this.y=0,this.z=Math.atan2(l,n))):"ZYX"===i?(this.y=Math.asin(-r(u)),Math.abs(u)<.99999?(this.x=Math.atan2(f,p),this.z=Math.atan2(l,n)):(this.x=0,this.z=Math.atan2(-o,h))):"YZX"===i?(this.z=Math.asin(r(l)),Math.abs(l)<.99999?(this.x=Math.atan2(-c,h),this.y=Math.atan2(-u,n)):(this.x=0,this.y=Math.atan2(s,p))):"XZY"===i&&(this.z=Math.asin(-r(o)),Math.abs(o)<.99999?(this.x=Math.atan2(f,h),this.y=Math.atan2(s,n)):(this.x=Math.atan2(-c,p),this.y=0)),this},setEulerFromQuaternion:function(e,i){function r(e){return Math.min(Math.max(e,-1),1)}var a=e.x*e.x,n=e.y*e.y,o=e.z*e.z,s=e.w*e.w;return i===t||"XYZ"===i?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-a-n+o),this.y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+a-n-o)):"YXZ"===i?(this.x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-a-n+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-a+n-o)):"ZXY"===i?(this.x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-a-n+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-a+n-o)):"ZYX"===i?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-a-n+o),this.y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+a-n-o)):"YZX"===i?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-a+n-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+a-n-o),this.z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):"XZY"===i&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-a+n-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+a-n-o),this.z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},toString:function(){return this.x+"_"+this.y+"_"+this.z},equals:function(e){return null!=e&&(e.x===this.x&&e.y===this.y&&e.z===this.z)},clone:function(){return new he(this.x,this.y,this.z)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},rotateFromAxisAndCenter:function(e,t,i){var r=(new oe.Mat4).makeRotationAxisAndCenter(e,t,i);return this.applyMatrix4(r),this},rotationTowards:function(e,t){var i=(new oe.Mat4).rotationTowards(e,t);return this.setEulerFromRotationMatrix(i),this},constructor:oe.Vec3},he.__q1=new oe.Quat,oe.Vec4=function(e,i,r,a){this.x=e||0,this.y=i||0,this.z=r||0,this.w=a!==t?a:1},oe.Vec4.prototype={constructor:oe.Vec4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==t?e.w:1,this},add:function(e,i){return i!==t?(console.warn("DEPRECATED: Vec4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,i)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,i){return i!==t?(console.warn("DEPRECATED: Vec4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,i)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,a=this.w,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12]*a,this.y=n[1]*t+n[5]*i+n[9]*r+n[13]*a,this.z=n[2]*t+n[6]*i+n[10]*r+n[14]*a,this.w=n[3]*t+n[7]*i+n[11]*r+n[15]*a,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.x=0,this.y=0,this.z=0,this.w=1),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new oe.Vec4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,a,n=e.elements,o=n[0],s=n[4],l=n[8],h=n[1],c=n[5],u=n[9],f=n[2],p=n[6],d=n[10];if(Math.abs(s-h)<.01&&Math.abs(l-f)<.01&&Math.abs(u-p)<.01){if(Math.abs(s+h)<.1&&Math.abs(l+f)<.1&&Math.abs(u+p)<.1&&Math.abs(o+c+d-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,g=(c+1)/2,v=(d+1)/2,y=(s+h)/4,A=(l+f)/4,x=(u+p)/4;return m>g&&m>v?m<.01?(i=0,r=.707106781,a=.707106781):(r=y/(i=Math.sqrt(m)),a=A/i):g>v?g<.01?(i=.707106781,r=0,a=.707106781):(i=y/(r=Math.sqrt(g)),a=x/r):v<.01?(i=.707106781,r=.707106781,a=0):(i=A/(a=Math.sqrt(v)),r=x/a),this.set(i,r,a,t),this}var _=Math.sqrt((p-u)*(p-u)+(l-f)*(l-f)+(h-s)*(h-s));return Math.abs(_)<.001&&(_=1),this.x=(p-u)/_,this.y=(l-f)/_,this.z=(h-s)/_,this.w=Math.acos((o+c+d-1)/2),this},toString:function(){return this.x+"_"+this.y+"_"+this.z+"_"+this.w}};var ce=function(e,i,r,a,n,o,s,l,h){this.elements=new Float32Array(9),this.set(e!==t?e:1,i||0,r||0,a||0,n!==t?n:1,o||0,s||0,l||0,h!==t?h:1)};ce.prototype={constructor:ce,set:function(e,t,i,r,a,n,o,s,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=r,h[4]=a,h[7]=n,h[2]=o,h[5]=s,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Mat3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new he;return function(t){for(var i=0,r=t.length;i<r;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyMatrix3(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],a=e[3],n=e[4],o=e[5],s=e[6],l=e[7],h=e[8];return t*n*h-t*o*l-i*a*h+i*o*s+r*a*l-r*n*s},getInverse:function(e,t){var i=e.elements,r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9],r[1]=-i[10]*i[1]+i[2]*i[9],r[2]=i[6]*i[1]-i[2]*i[5],r[3]=-i[10]*i[4]+i[6]*i[8],r[4]=i[10]*i[0]-i[2]*i[8],r[5]=-i[6]*i[0]+i[2]*i[4],r[6]=i[9]*i[4]-i[5]*i[8],r[7]=-i[9]*i[0]+i[1]*i[8],r[8]=i[5]*i[0]-i[1]*i[4];var a=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(0===a){var n="Mat3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(n);return console.warn(n),this.identity(),this}return this.multiplyScalar(1/a),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new ce(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},projectToPlane:function(e){var t=e.normalize(),i=this.elements;return i[0]=1-t.x*t.x,i[3]=-t.x*t.y,i[6]=-t.x*t.z,i[1]=-t.x*t.y,i[4]=1-t.y*t.y,i[7]=-t.y*t.z,i[2]=-t.x*t.z,i[5]=-t.z*t.y,i[8]=1-t.z*t.z,this}},oe.Mat3=ce;var ue=function(e,i,r,a,n,o,s,l,h,c,u,f,p,d,m,g){this.elements=new Float32Array(16),this.set(e!==t?e:1,i||0,r||0,a||0,n||0,o!==t?o:1,s||0,l||0,h||0,c||0,u!==t?u:1,f||0,p||0,d||0,m||0,g!==t?g:1)};ue.prototype={constructor:ue,set:function(e,t,i,r,a,n,o,s,l,h,c,u,f,p,d,m){var g=this.elements;if(e.length)for(var v=0;v<e.length;v++)g[v]=e[v];else g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=a,g[5]=n,g[9]=o,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=f,g[7]=p,g[11]=d,g[15]=m;return this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},setRotationFromEuler:function(e,i){var r=this.elements,a=e.x,n=e.y,o=e.z,s=Math.cos(a),l=Math.sin(a),h=Math.cos(n),c=Math.sin(n),u=Math.cos(o),f=Math.sin(o);if(i===t||"XYZ"===i){var p=s*u,d=s*f,m=l*u,g=l*f;r[0]=h*u,r[4]=-h*f,r[8]=c,r[1]=d+m*c,r[5]=p-g*c,r[9]=-l*h,r[2]=g-p*c,r[6]=m+d*c,r[10]=s*h}else if("YXZ"===i){var v=h*u,y=h*f,A=c*u,x=c*f;r[0]=v+x*l,r[4]=A*l-y,r[8]=s*c,r[1]=s*f,r[5]=s*u,r[9]=-l,r[2]=y*l-A,r[6]=x+v*l,r[10]=s*h}else if("ZXY"===i){var v=h*u,y=h*f,A=c*u,x=c*f;r[0]=v-x*l,r[4]=-s*f,r[8]=A+y*l,r[1]=y+A*l,r[5]=s*u,r[9]=x-v*l,r[2]=-s*c,r[6]=l,r[10]=s*h}else if("ZYX"===i){var p=s*u,d=s*f,m=l*u,g=l*f;r[0]=h*u,r[4]=m*c-d,r[8]=p*c+g,r[1]=h*f,r[5]=g*c+p,r[9]=d*c-m,r[2]=-c,r[6]=l*h,r[10]=s*h}else if("YZX"===i){var _=s*h,w=s*c,b=l*h,M=l*c;r[0]=h*u,r[4]=M-_*f,r[8]=b*f+w,r[1]=f,r[5]=s*u,r[9]=-l*u,r[2]=-c*u,r[6]=w*f+b,r[10]=_-M*f}else if("XZY"===i){var _=s*h,w=s*c,b=l*h,M=l*c;r[0]=h*u,r[4]=-f,r[8]=c*u,r[1]=_*f+M,r[5]=s*u,r[9]=w*f-b,r[2]=b*f-w,r[6]=l*u,r[10]=M*f+_}return this},setRotationFromQuaternion:function(e){var t=this.elements,i=4===e.length,r=i?e[0]:e.x,a=i?e[1]:e.y,n=i?e[2]:e.z,o=i?e[3]:e.w,s=r+r,l=a+a,h=n+n,c=r*s,u=r*l,f=r*h,p=a*l,d=a*h,m=n*h,g=o*s,v=o*l,y=o*h;return t[0]=1-(p+m),t[4]=u-y,t[8]=f+v,t[1]=u+y,t[5]=1-(c+m),t[9]=d-g,t[2]=f-v,t[6]=d+g,t[10]=1-(c+p),this},lookAt:function(e,t,i){var r=this.elements,a=ue.__v1,n=ue.__v2,o=ue.__v3;return o.subVectors(e,t).normalize(),0===o.length()&&(o.z=1),a.crossVectors(i,o).normalize(),0===a.length()&&(o.x+=1e-4,a.crossVectors(i,o).normalize()),n.crossVectors(o,a),r[0]=a.x,r[1]=a.y,r[2]=a.z,r[4]=n.x,r[5]=n.y,r[6]=n.z,r[8]=o.x,r[9]=o.y,r[10]=o.z,this},multiply:function(e,i){return i!==t?this.multiplyMatrices(e,i):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,a=this.elements,n=i[0],o=i[4],s=i[8],l=i[12],h=i[1],c=i[5],u=i[9],f=i[13],p=i[2],d=i[6],m=i[10],g=i[14],v=i[3],y=i[7],A=i[11],x=i[15],_=r[0],w=r[4],b=r[8],M=r[12],S=r[1],P=r[5],C=r[9],T=r[13],E=r[2],z=r[6],D=r[10],L=r[14],R=r[3],N=r[7],B=r[11],I=r[15];return a[0]=n*_+o*S+s*E+l*R,a[4]=n*w+o*P+s*z+l*N,a[8]=n*b+o*C+s*D+l*B,a[12]=n*M+o*T+s*L+l*I,a[1]=h*_+c*S+u*E+f*R,a[5]=h*w+c*P+u*z+f*N,a[9]=h*b+c*C+u*D+f*B,a[13]=h*M+c*T+u*L+f*I,a[2]=p*_+d*S+m*E+g*R,a[6]=p*w+d*P+m*z+g*N,a[10]=p*b+d*C+m*D+g*B,a[14]=p*M+d*T+m*L+g*I,a[3]=v*_+y*S+A*E+x*R,a[7]=v*w+y*P+A*z+x*N,a[11]=v*b+y*C+A*D+x*B,a[15]=v*M+y*T+A*L+x*I,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return e.applyProjection(this)},multiplyVector4:function(e){return e.applyMatrix4(this)},multiplyVector3Array:function(e){for(var t=ue.__v1,i=0,r=e.length;i<r;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyProjection(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e},rotateAxis:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z;return e.x=i*t[0]+r*t[4]+a*t[8],e.y=i*t[1]+r*t[5]+a*t[9],e.z=i*t[2]+r*t[6]+a*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,i=new oe.Vector4;return i.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,i.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,i.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,i.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,i},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],a=e[12],n=e[1],o=e[5],s=e[9],l=e[13],h=e[2],c=e[6],u=e[10],f=e[14];return e[3]*(+a*s*c-r*l*c-a*o*u+i*l*u+r*o*f-i*s*f)+e[7]*(+t*s*f-t*l*u+a*n*u-r*n*f+r*l*h-a*s*h)+e[11]*(+t*l*c-t*o*f-a*n*c+i*n*f+a*o*h-i*l*h)+e[15]*(-r*o*h-t*s*c+t*o*u+r*n*c-i*n*u+i*s*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(e){var t=this.elements;return(e||new he).set(t[12],t[13],t[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return ue.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return ue.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return ue.__v1.set(e[8],e[9],e[10])},getInverse:function(e,t){var i=this.elements,r=e.elements,a=r[0],n=r[4],o=r[8],s=r[12],l=r[1],h=r[5],c=r[9],u=r[13],f=r[2],p=r[6],d=r[10],m=r[14],g=r[3],v=r[7],y=r[11],A=r[15];i[0]=c*m*v-u*d*v+u*p*y-h*m*y-c*p*A+h*d*A,i[4]=s*d*v-o*m*v-s*p*y+n*m*y+o*p*A-n*d*A,i[8]=o*u*v-s*c*v+s*h*y-n*u*y-o*h*A+n*c*A,i[12]=s*c*p-o*u*p-s*h*d+n*u*d+o*h*m-n*c*m,i[1]=u*d*g-c*m*g-u*f*y+l*m*y+c*f*A-l*d*A,i[5]=o*m*g-s*d*g+s*f*y-a*m*y-o*f*A+a*d*A,i[9]=s*c*g-o*u*g-s*l*y+a*u*y+o*l*A-a*c*A,i[13]=o*u*f-s*c*f+s*l*d-a*u*d-o*l*m+a*c*m,i[2]=h*m*g-u*p*g+u*f*v-l*m*v-h*f*A+l*p*A,i[6]=s*p*g-n*m*g-s*f*v+a*m*v+n*f*A-a*p*A,i[10]=n*u*g-s*h*g+s*l*v-a*u*v-n*l*A+a*h*A,i[14]=s*h*f-n*u*f-s*l*p+a*u*p+n*l*m-a*h*m,i[3]=c*p*g-h*d*g-c*f*v+l*d*v+h*f*y-l*p*y,i[7]=n*d*g-o*p*g+o*f*v-a*d*v-n*f*y+a*p*y,i[11]=o*h*g-n*c*g-o*l*v+a*c*v+n*l*y-a*h*y,i[15]=n*c*f-o*h*f+o*l*p-a*c*p-n*l*d+a*h*d;var x=r[0]*i[0]+r[1]*i[4]+r[2]*i[8]+r[3]*i[12];if(0==x){if(t)throw new Error("Mat4.getInverse(): can't invert matrix, determinant is 0");return this.identity(),this}return this.multiplyScalar(1/x),this},compose:function(e,t,i){var r=this.elements,a=ue.__m1,n=ue.__m2;return a.identity(),a.setRotationFromQuaternion(t),n.makeScale(i.x,i.y,i.z),this.multiplyMatrices(a,n),r[12]=e.x,r[13]=e.y,r[14]=e.z,this},decompose:function(e,t,i){var r=this.elements,a=ue.__v1,n=ue.__v2,o=ue.__v3;a.set(r[0],r[1],r[2]),n.set(r[4],r[5],r[6]),o.set(r[8],r[9],r[10]),e=e instanceof he?e:new he,t=t instanceof oe.Quat?t:new oe.Quat,(i=i instanceof he?i:new he).x=a.length(),i.y=n.length(),i.z=o.length(),e.x=r[12],e.y=r[13],e.z=r[14];var s=ue.__m1;return s.copy(this),s.elements[0]/=i.x,s.elements[1]/=i.x,s.elements[2]/=i.x,s.elements[4]/=i.y,s.elements[5]/=i.y,s.elements[6]/=i.y,s.elements[8]/=i.z,s.elements[9]/=i.z,s.elements[10]/=i.z,t.setFromRotationMatrix(s),[e,t,i]},extractPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractRotation:function(e){var t=this.elements,i=e.elements,r=ue.__v1,a=1/r.set(i[0],i[1],i[2]).length(),n=1/r.set(i[4],i[5],i[6]).length(),o=1/r.set(i[8],i[9],i[10]).length();return t[0]=i[0]*a,t[1]=i[1]*a,t[2]=i[2]*a,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,this},translate:function(e){var t,i,r,a=this.elements;return 3===e.length?(t=e[0],i=e[1],r=e[2]):(t=e.x,i=e.y,r=e.z),a[12]=a[0]*t+a[4]*i+a[8]*r+a[12],a[13]=a[1]*t+a[5]*i+a[9]*r+a[13],a[14]=a[2]*t+a[6]*i+a[10]*r+a[14],a[15]=a[3]*t+a[7]*i+a[11]*r+a[15],this},rotateX:function(e){var t=this.elements,i=t[4],r=t[5],a=t[6],n=t[7],o=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),u=Math.sin(e);return t[4]=c*i+u*o,t[5]=c*r+u*s,t[6]=c*a+u*l,t[7]=c*n+u*h,t[8]=c*o-u*i,t[9]=c*s-u*r,t[10]=c*l-u*a,t[11]=c*h-u*n,this},rotateY:function(e){var t=this.elements,i=t[0],r=t[1],a=t[2],n=t[3],o=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),u=Math.sin(e);return t[0]=c*i-u*o,t[1]=c*r-u*s,t[2]=c*a-u*l,t[3]=c*n-u*h,t[8]=c*o+u*i,t[9]=c*s+u*r,t[10]=c*l+u*a,t[11]=c*h+u*n,this},rotateZ:function(e){var t=this.elements,i=t[0],r=t[1],a=t[2],n=t[3],o=t[4],s=t[5],l=t[6],h=t[7],c=Math.cos(e),u=Math.sin(e);return t[0]=c*i+u*o,t[1]=c*r+u*s,t[2]=c*a+u*l,t[3]=c*n+u*h,t[4]=c*o-u*i,t[5]=c*s-u*r,t[6]=c*l-u*a,t[7]=c*h-u*n,this},rotateByAxis:function(e,t){var i=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var r=e.x,a=e.y,n=e.z,o=Math.sqrt(r*r+a*a+n*n),s=(r/=o)*r,l=(a/=o)*a,h=(n/=o)*n,c=Math.cos(t),u=Math.sin(t),f=1-c,p=r*a*f,d=r*n*f,m=a*n*f,g=r*u,v=a*u,y=n*u,A=s+(1-s)*c,x=p+y,_=d-v,w=p-y,b=l+(1-l)*c,M=m+g,S=d+v,P=m-g,C=h+(1-h)*c,T=i[0],E=i[1],z=i[2],D=i[3],L=i[4],R=i[5],N=i[6],B=i[7],I=i[8],F=i[9],V=i[10],U=i[11];i[12],i[13],i[14],i[15];return i[0]=A*T+x*L+_*I,i[1]=A*E+x*R+_*F,i[2]=A*z+x*N+_*V,i[3]=A*D+x*B+_*U,i[4]=w*T+b*L+M*I,i[5]=w*E+b*R+M*F,i[6]=w*z+b*N+M*V,i[7]=w*D+b*B+M*U,i[8]=S*T+P*L+C*I,i[9]=S*E+P*R+C*F,i[10]=S*z+P*N+C*V,i[11]=S*D+P*B+C*U,this},scale:function(e){var t=this.elements,i=3===e.length,r=i?e[0]:e.x,a=i?e[1]:e.y,n=i?e[2]:e.z;return t[0]*=r,t[4]*=a,t[8]*=n,t[1]*=r,t[5]*=a,t[9]*=n,t[2]*=r,t[6]*=a,t[10]*=n,t[3]*=r,t[7]*=a,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),a=1-i,n=e.x,o=e.y,s=e.z,l=a*n,h=a*o;return this.set(l*n+i,l*o-r*s,l*s+r*o,0,l*o+r*s,h*o+i,h*s-r*n,0,l*s-r*o,h*s+r*n,a*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeFrustum:function(e,t,i,r,a,n){var o=this.elements,s=2*a/(t-e),l=2*a/(r-i),h=(t+e)/(t-e),c=(r+i)/(r-i),u=-(n+a)/(n-a),f=-2*n*a/(n-a);return o[0]=s,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,i,r){var a=i*Math.tan(oe.Math.degToRad(.5*e)),n=-a,o=n*t,s=a*t;return this.makeFrustum(o,s,n,a,i,r)},perspectiveFromFieldOfView:function(e,t,i){var r=this,a=r.elements,n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),l=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+l),c=2/(n+o);return a[0]=h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=c,a[6]=0,a[7]=0,a[8]=-(s-l)*h*.5,a[9]=(n-o)*c*.5,a[10]=i/(t-i),a[11]=-1,a[12]=0,a[13]=0,a[14]=i*t/(t-i),a[15]=0,r},makeOrthographic:function(e,t,i,r,a,n){var o=this.elements,s=t-e,l=i-r,h=n-a,c=(t+e)/s,u=(i+r)/l,f=(n+a)/h;return o[0]=2/s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2/l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2/h,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var e=this.elements;return new ue(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},makeRotationFromQuaternion:function(e){var t=this.elements,i=4===e.length,r=i?e[0]:e.x,a=i?e[1]:e.y,n=i?e[2]:e.z,o=i?e[3]:e.w,s=r+r,l=a+a,h=n+n,c=r*s,u=r*l,f=r*h,p=a*l,d=a*h,m=n*h,g=o*s,v=o*l,y=o*h;return t[0]=1-(p+m),t[4]=u-y,t[8]=f+v,t[1]=u+y,t[5]=1-(c+m),t[9]=d-g,t[2]=f-v,t[6]=d+g,t[10]=1-(c+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},getEulerAngles:function(){var e=(new ue).extractRotation(this).elements,t=e[0],i=e[1],r=e[2],a=e[5],n=e[6],o=e[10],s=Math.atan2(n,o),l=Math.atan2(-r,Math.sqrt(t*t+i*i)),h=Math.sin(s),c=Math.cos(s),u=Math.atan2(h*e[8]-c*e[4],c*a-h*e[9]);return new he(s,l,u)},makeRotationAxisAndCenter:function(e,t,i){var r=Math.cos(t),a=Math.sin(t),n=1-r,o=e.x,s=e.y,l=e.z,h=n*o,c=n*s,u=i.x,f=i.y,p=i.z,d=this,m=new Float32Array(16);return m[0]=h*o+r,m[4]=h*s-a*l,m[8]=h*l+a*s,m[12]=u-u*(h*o+r)-f*(h*s-a*l)-p*(h*l+a*s),m[1]=h*s+a*l,m[5]=c*s+r,m[9]=c*l-a*o,m[13]=f-u*(h*s+a*l)-f*(c*s+r)-p*(c*l-a*o),m[2]=h*l-a*s,m[6]=c*l+a*o,m[10]=n*l*l+r,m[14]=p-u*(h*l-a*s)-f*(c*l+a*o)-p*(n*l*l+r),m[3]=0,m[7]=0,m[11]=0,m[15]=1,d.elements=m,d},rotationTowards:function(e,t){var i=Math.acos(t.dot(e)/t.length()/e.length()),r=(new oe.Vec3).crossVectors(t,e).normalize();return this.makeRotationAxis(r,-i),this},equals:function(e){if(e instanceof ue){for(var t=0;t<this.elements.length;t++)if(Math.abs(this.elements[t]-e.elements[t])>1e-4)return!1;return!0}},fromRotationTranslation:function(e,t){var i=this,r=i.elements,a=e[0],n=e[1],o=e[2],s=e[3],l=a+a,h=n+n,c=o+o,u=a*l,f=a*h,p=a*c,d=n*h,m=n*c,g=o*c,v=s*l,y=s*h,A=s*c;return r[0]=1-(d+g),r[1]=f+A,r[2]=p-y,r[3]=0,r[4]=f-A,r[5]=1-(u+g),r[6]=m+v,r[7]=0,r[8]=p+y,r[9]=m-v,r[10]=1-(u+d),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,i},fromRotationTranslationScale:function(e,t,i){var r=e.x,a=e.y,n=e.z,o=e.w,s=this.elements,l=r+r,h=a+a,c=n+n,u=r*l,f=r*h,p=r*c,d=a*h,m=a*c,g=n*c,v=o*l,y=o*h,A=o*c,x=i.x,_=i.y,w=i.z;return s[0]=(1-(d+g))*x,s[1]=(f+A)*x,s[2]=(p-y)*x,s[3]=0,s[4]=(f-A)*_,s[5]=(1-(u+g))*_,s[6]=(m+v)*_,s[7]=0,s[8]=(p+y)*w,s[9]=(m-v)*w,s[10]=(1-(u+d))*w,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}},ue.__v1=new he,ue.__v2=new he,ue.__v3=new he,ue.__m1=new ue,ue.__m2=new ue,oe.Mat4=ue,oe.Euler=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||oe.Euler.DefaultOrder},oe.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],oe.Euler.DefaultOrder="XYZ",oe.Euler.prototype={constructor:oe.Euler,_x:0,_y:0,_z:0,_order:oe.Euler.DefaultOrder,_quaternion:t,_updateQuaternion:function(){this._quaternion!==t&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,a=r[0],n=r[4],o=r[8],s=r[1],l=r[5],h=r[9],c=r[2],u=r[6],f=r[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(i(o)),Math.abs(o)<.99999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-n,a)):(this._x=Math.atan2(u,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(h)),Math.abs(h)<.99999?(this._y=Math.atan2(o,f),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(u)),Math.abs(u)<.99999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-n,l)):(this._y=0,this._z=Math.atan2(s,a))):"ZYX"===t?(this._y=Math.asin(-i(c)),Math.abs(c)<.99999?(this._x=Math.atan2(u,f),this._z=Math.atan2(s,a)):(this._x=0,this._z=Math.atan2(-n,l))):"YZX"===t?(this._z=Math.asin(i(s)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,a)):(this._x=0,this._y=Math.atan2(o,f))):"XZY"===t?(this._z=Math.asin(-i(n)),Math.abs(n)<.99999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-h,f),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,i){function r(e){return Math.min(Math.max(e,-1),1)}var a=e.x*e.x,n=e.y*e.y,o=e.z*e.z,s=e.w*e.w;return t=t||this._order,"XYZ"===t?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-a-n+o),this._y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+a-n-o)):"YXZ"===t?(this._x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-a-n+o),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-a+n-o)):"ZXY"===t?(this._x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-a-n+o),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-a+n-o)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-a-n+o),this._y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+a-n-o)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-a+n-o),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+a-n-o),this._z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-a+n-o),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+a-n-o),this._z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,!1!==i&&this._updateQuaternion(),this},reorder:function(){var e=new oe.Quat;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==t&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new oe.Euler(this._x,this._y,this._z,this._order)}},oe.math={},oe.math.Plane=function(e,i){this.normal=e!==t?e:new he(1,0,0),this.constant=i!==t?i:0},oe.math.Plane.prototype={constructor:oe.math.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,i){var r=oe.math.Plane.__v1.subVectors(i,t).cross(oe.math.Plane.__v2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);return(t||new he).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e,t){var i=this.distanceToPoint(e),r=this.distanceToPoint(t);return i<0&&r>0||r<0&&i>0},isIntersectionFace:function(e,t){var i=[];i.push(t[e.a]),i.push(t[e.b]),i.push(t[e.c]),null!=e.d&&i.push(t[e.d]);var r,a,n,o=[];for(r=0;r<i.length;r++)o.push(this.distanceToPoint(i[r]));for(r=0;r<o.length;r++)if(0==r)a=n=o[r];else{if(n=o[r],a<0&&n>0||n<0&&a>0)return"intersect";a=n}return n>0?"in":"out"},intersectLine:function(e,i,r){var a=r||new he,n=oe.math.Plane.__v1.subVectors(i,e),o=this.normal.dot(n);if(0==o)return 0==this.distanceToPoint(e)?a.copy(e):t;var s=-(e.dot(this.normal)+this.constant)/o;return s<0||s>1?t:a.copy(n).multiplyScalar(s).add(e)},coplanarPoint:function(e){return(e||new he).copy(this.normal).multiplyScalar(-this.constant)},transform:function(e,t){t=t||(new oe.Mat3).getInverse(e).transpose();var i=oe.math.Plane.__v1.copy(this.normal).applyMatrix3(t),r=this.coplanarPoint(oe.math.Plane.__v2);return r.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(i,r),this},translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new oe.math.Plane).copy(this)}},oe.math.Plane.__vZero=new he(0,0,0),oe.math.Plane.__v1=new he,oe.math.Plane.__v2=new he,oe.Frustum=function(e,i,r,a,n,o){this.planes=[e!==t?e:new oe.math.Plane,i!==t?i:new oe.math.Plane,r!==t?r:new oe.math.Plane,a!==t?a:new oe.math.Plane,n!==t?n:new oe.math.Plane,o!==t?o:new oe.math.Plane]},oe.Frustum.prototype={set:function(e,t,i,r,a,n){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(a),o[5].copy(n),this},setPoints:function(e){this.points=e},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],a=i[1],n=i[2],o=i[3],s=i[4],l=i[5],h=i[6],c=i[7],u=i[8],f=i[9],p=i[10],d=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(o-r,c-s,d-u,y-m).normalize(),t[1].setComponents(o+r,c+s,d+u,y+m).normalize(),t[2].setComponents(o+a,c+l,d+f,y+g).normalize(),t[3].setComponents(o-a,c-l,d-f,y-g).normalize(),t[4].setComponents(o-n,c-h,d-p,y-v).normalize(),t[5].setComponents(o+n,c+h,d+p,y+v).normalize(),this},intersectsObjectAccurate:function(e,t){if(0==t)return this.intersectsObject(e);var i,r,a=e.worldMatrix,n=(this.planes,e.vertices),o=[],s=n.length;for(r=0;r<s;r++)if((i=n[r].clone()).applyMatrix4(a),o.push(i),this.containsPoint(i))return!0;if(2==t)if(e instanceof oe.Line)for(r=0,s=o.length;r<s-1;r++){var l=o[r],h=o[r+1];if(this.containsLine(l,h))return!0}else{var c,u=e.faces;for(r=0,s=u.length;r<s;r++){if(c=u[r],this.containsLine(o[c.a],o[c.b]))return!0;if(this.containsLine(o[c.b],o[c.c]))return!0;if(null!=c.d){if(this.containsLine(o[c.c],o[c.d]))return!0;if(this.containsLine(o[c.d],o[c.a]))return!0}else if(this.containsLine(o[c.a],o[c.c]))return!0}}return!1},intersectsObject:function(e){var t=e.worldMatrix,i=this.planes,r=t.getPosition();if(!e.computeBoundingSphere)return!1;e.boundingSphere||e.computeBoundingSphere();for(var a=-e.boundingSphere.radius*t.getMaxScaleOnAxis(),n=0;n<6;n++)if(i[n].distanceToPoint(r)<a)return!1;return!0},intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,a=0;a<6;a++)if(t[a].distanceToPoint(i)<r)return!1;return!0},intersectsBox:function(e){for(var t=new he,i=new he,r=this.planes,a=0;a<6;a++){var n=r[a];t.x=n.normal.x>0?e.min.x:e.max.x,i.x=n.normal.x>0?e.max.x:e.min.x,t.y=n.normal.y>0?e.min.y:e.max.y,i.y=n.normal.y>0?e.max.y:e.min.y,t.z=n.normal.z>0?e.min.z:e.max.z,i.z=n.normal.z>0?e.max.z:e.min.z;var o=n.distanceToPoint(t),s=n.distanceToPoint(i);if(o<0&&s<0)return!1}return!0},containsLine:function(e,t){for(var i=this.planes,r=new he,a=0;a<6;a++)if((r=i[a].intersectLine(e,t,r))&&this.containsPoint(r))return!0;return!1},containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new oe.Frustum).copy(this)}},oe.Ray=function(e,i){this.origin=e!==t?e:new he,this.direction=i!==t?i:new he},oe.Ray.prototype={constructor:oe.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new he).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(e){return this.origin.copy(this.at(e,oe.Ray.__v1)),this},closestPointToPoint:function(e,t){var i=t||new he;i.subVectors(e,this.origin);var r=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){var t=oe.Ray.__v1.subVectors(e,this.origin).dot(this.direction);return oe.Ray.__v1.copy(this.direction).multiplyScalar(t).add(this.origin),oe.Ray.__v1.distanceTo(e)},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){return 0!=e.normal.dot(this.direction)||0==e.distanceToPoint(this.origin)},distanceToPlane:function(e){var i=e.normal.dot(this.direction);return 0==i?0==e.distanceToPoint(this.origin)?0:t:-(this.origin.dot(e.normal)+e.constant)/i},intersectPlane:function(e,i){var r=this.distanceToPlane(e);return r===t?t:this.at(r,i)},transform:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},distanceSqToSegment:function(e,t,i,r){var a,n,o,s,l=e.clone().add(t).multiplyScalar(.5),h=t.clone().sub(e).normalize(),c=.5*e.distanceTo(t),u=this.origin.clone().sub(l),f=-this.direction.dot(h),p=u.dot(this.direction),d=-u.dot(h),m=u.lengthSq(),g=Math.abs(1-f*f);if(g>=0)if(a=f*d-p,n=f*p-d,s=c*g,a>=0)if(n>=-s)if(n<=s){var v=1/g;o=(a*=v)*(a+f*(n*=v)+2*p)+n*(f*a+n+2*d)+m}else n=c,o=-(a=Math.max(0,-(f*n+p)))*a+n*(n+2*d)+m;else n=-c,o=-(a=Math.max(0,-(f*n+p)))*a+n*(n+2*d)+m;else n<=-s?o=-(a=Math.max(0,-(-f*c+p)))*a+(n=a>0?-c:Math.min(Math.max(-c,-d),c))*(n+2*d)+m:n<=s?(a=0,o=(n=Math.min(Math.max(-c,-d),c))*(n+2*d)+m):o=-(a=Math.max(0,-(f*c+p)))*a+(n=a>0?c:Math.min(Math.max(-c,-d),c))*(n+2*d)+m;else n=f>0?-c:c,o=-(a=Math.max(0,-(f*n+p)))*a+n*(n+2*d)+m;return i&&i.copy(this.direction.clone().multiplyScalar(a).add(this.origin)),r&&r.copy(h.clone().multiplyScalar(n).add(l)),o},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new oe.Ray).copy(this)}},oe.Ray.__v1=new he,oe.Ray.__v2=new he,oe.Triangle=function(e,i,r){this.a=e!==t?e:new he,this.b=i!==t?i:new he,this.c=r!==t?r:new he},oe.Triangle.normal=function(e,t,i,r){var a=r||new he;a.subVectors(i,t),oe.Triangle.__v0.subVectors(e,t),a.cross(oe.Triangle.__v0);var n=a.lengthSq();return n>0?a.multiplyScalar(1/Math.sqrt(n)):a.set(0,0,0)},oe.Triangle.barycoordFromPoint=function(e,t,i,r,a){oe.Triangle.__v0.subVectors(r,t),oe.Triangle.__v1.subVectors(i,t),oe.Triangle.__v2.subVectors(e,t);var n=oe.Triangle.__v0.dot(oe.Triangle.__v0),o=oe.Triangle.__v0.dot(oe.Triangle.__v1),s=oe.Triangle.__v0.dot(oe.Triangle.__v2),l=oe.Triangle.__v1.dot(oe.Triangle.__v1),h=oe.Triangle.__v1.dot(oe.Triangle.__v2),c=n*l-o*o,u=a||new he;if(0==c)return u.set(-2,-1,-1);var f=1/c,p=(l*s-o*h)*f,d=(n*h-o*s)*f;return u.set(1-p-d,d,p)},oe.Triangle.containsPoint=function(e,t,i,r){var a=oe.Triangle.barycoordFromPoint(e,t,i,r,oe.Triangle.__v3);return a.x>=0&&a.y>=0&&a.x+a.y<=1},oe.Triangle.prototype={constructor:oe.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){return oe.Triangle.__v0.subVectors(this.c,this.b),oe.Triangle.__v1.subVectors(this.a,this.b),.5*oe.Triangle.__v0.cross(oe.Triangle.__v1).length()},midpoint:function(e){return(e||new he).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return oe.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new oe.math.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return oe.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return oe.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new oe.Triangle).copy(this)},intersectLine:function(e,t){var i=this.plane().intersectLine(e,t);return null!=i&&this.containsPoint(i)}},oe.Triangle.__v0=new he,oe.Triangle.__v1=new he,oe.Triangle.__v2=new he,oe.Triangle.__v3=new he,oe.Box2=function(e,i){this.min=e!==t?e:new le(1/0,1/0),this.max=i!==t?i:new le(-1/0,-1/0)},oe.Box2.prototype={constructor:oe.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new le;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){var t=e||new le;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new le;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new le).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new le).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new le;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};var fe={isImage:function(e){return e&&e.nodeName&&"img"===e.nodeName.toLowerCase()},isCanvas:function(e){return e&&e.nodeName&&"canvas"===e.nodeName.toLowerCase()},createView:function(e,t){var i=document.createElement("div");return i.style.position=ke.VIEW_POSITION,i.style.fontSize=ke.VIEW_FONT_SIZE,i.style.fontFamily=ke.VIEW_FONT_FAMILY,i.style.cursor="default",i.style.outline="none",i.style.textAlign="left",i.style.msTouchAction="none",i.tabIndex=0,t||(i.onmousedown=fe.preventDefault),i.style.setProperty&&(i.style.setProperty("-khtml-user-select","none",null),i.style.setProperty("-webkit-user-select","none",null),i.style.setProperty("-moz-user-select","none",null),i.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),e&&(i.style.overflow=e),i},preventDefault:function(e){ke.KEEP_DEFAULT_FUNCTION(e)||(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)},createCanvas:function(e){var t=document.createElement("canvas"),i=e.getView();return t.width=i.width,t.height=i.height,t.style.msTouchAction="none",t.style.position="absolute",t},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},getScrollTop:function(e){if(!e)return 0;var t=e.scrollTop,i=e.parentElement;return t+this.getScrollTop(i)},getScrollLeft:function(e){if(!e)return 0;var t=e.scrollLeft,i=e.parentElement;return t+this.getScrollLeft(i)},debug:function(e,t){try{e.call(t)}catch(e){alert(e)}},setFocus:function(e){if(document.activeElement!==e){var t,i,r,a=document.documentElement;document.body;a&&(pe.isIE||pe.isOpera||a.scrollLeft||a.scrollTop)&&(t=a.scrollLeft,i=a.scrollTop,r=a),e.focus(),r&&(r.scrollLeft=t,r.scrollTop=i)}},isRightClick:function(e){var t;if(!e)var e=window.event;return e.which?t=3==e.which:e.button&&(t=2==e.button),t}};oe.html=fe;var pe=function(){var e={},t=navigator.userAgent.toLowerCase();return e.isOpera=/opera/.test(t),e.isIE=/msie/.test(t)||/trident/.test(t),e.isFirefox=/firefox/i.test(t),e.isChrome=/chrome/i.test(t),e.isSafari=!e.isChrome&&/safari/i.test(t),e.isIPhone=/iphone/.test(t),e.isIPod=/ipod/.test(t),e.isIPad=/ipad/.test(t),e.isAndroid=/android/i.test(t),e.isWebOS=/webos/i.test(t),e.isMSToucheable=navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>1,e.isTouchable="ontouchend"in document||e.isMSToucheable,e.isIOS=e.isIPhone||e.isIPod||e.isIPad,e}();oe.ua=pe,function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);window.btoa||(window.btoa=function(t){var i,r,a,n,o,s;for(a=t.length,r=0,i="";r<a;){if(n=255&t.charCodeAt(r++),r==a){i+=e.charAt(n>>2),i+=e.charAt((3&n)<<4),i+="==";break}if(o=t.charCodeAt(r++),r==a){i+=e.charAt(n>>2),i+=e.charAt((3&n)<<4|(240&o)>>4),i+=e.charAt((15&o)<<2),i+="=";break}s=t.charCodeAt(r++),i+=e.charAt(n>>2),i+=e.charAt((3&n)<<4|(240&o)>>4),i+=e.charAt((15&o)<<2|(192&s)>>6),i+=e.charAt(63&s)}return i}),window.atob||(window.atob=function(e){var i,r,a,n,o,s,l;for(s=e.length,o=0,l="";o<s;){do{i=t[255&e.charCodeAt(o++)]}while(o<s&&-1==i);if(-1==i)break;do{r=t[255&e.charCodeAt(o++)]}while(o<s&&-1==r);if(-1==r)break;l+=String.fromCharCode(i<<2|(48&r)>>4);do{if(61==(a=255&e.charCodeAt(o++)))return l;a=t[a]}while(o<s&&-1==a);if(-1==a)break;l+=String.fromCharCode((15&r)<<4|(60&a)>>2);do{if(61==(n=255&e.charCodeAt(o++)))return l;n=t[n]}while(o<s&&-1==n);if(-1==n)break;l+=String.fromCharCode((3&a)<<6|n)}return l})}();var de=function(){var e=!1,t=document.createElement("canvas");if(t.getContext("2d")&&(e=!0),!e)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var i=!!t.getContext("2d").getImageData,r=!!t.toDataURL,a=!!window.btoa,n=function(e){var t=parseInt(e.width),i=parseInt(e.height);return e.getContext("2d").getImageData(0,0,t,i)},o=function(e){var t="";if("string"==typeof e)t=e;else for(var i=e,r=0;r<i.length;r++)t+=String.fromCharCode(i[r]);return btoa(t)},s=function(e){var t=[],i=e.width,r=e.height;t.push(66),t.push(77);var a=i*r*3+54;t.push(a%256),a=Math.floor(a/256),t.push(a%256),a=Math.floor(a/256),t.push(a%256),a=Math.floor(a/256),t.push(a%256),t.push(0),t.push(0),t.push(0),t.push(0),t.push(54),t.push(0),t.push(0),t.push(0);var n=[];n.push(40),n.push(0),n.push(0),n.push(0);var s=i;n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256);var l=r;n.push(l%256),l=Math.floor(l/256),n.push(l%256),l=Math.floor(l/256),n.push(l%256),l=Math.floor(l/256),n.push(l%256),n.push(1),n.push(0),n.push(24),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0);var h=i*r*3;n.push(h%256),h=Math.floor(h/256),n.push(h%256),h=Math.floor(h/256),n.push(h%256),h=Math.floor(h/256),n.push(h%256);for(var c=0;c<16;c++)n.push(0);var u=(4-3*i%4)%4,f=e.data,p="",d=r;do{for(var m=i*(d-1)*4,g="",v=0;v<i;v++){var y=4*v;g+=String.fromCharCode(f[m+y+2]),g+=String.fromCharCode(f[m+y+1]),g+=String.fromCharCode(f[m+y])}for(var A=0;A<u;A++)g+=String.fromCharCode(0);p+=g}while(--d);return o(t.concat(n))+o(p)},l=function(e,t){return"data:"+t+";base64,"+e},h=function(e){var t=document.createElement("img");return t.src=e,t},c=function(e,t,i,r,a){i=i||(t?t.w:e.width),r=r||(t?t.h:e.height);var n=document.createElement("canvas");n.width=i,n.height=r,n.style.width=i+"px",n.style.height=r+"px";var o=n.getContext("2d"),o=n.getContext("2d"),s=e.style.backgroundColor;return s||(s="PNG"===a?"rgba(255,255,255,0.0)":"BMP"===a?"rgba(255,255,255,0.01)":"#FFFFFF"),o.fillStyle=s,o.fillRect(0,0,i,r),t=t||{x:0,y:0,w:e.width,h:e.height},o.drawImage(e,t.x,t.y,t.w,t.h,0,0,i,r),n};return{saveAsPNG:function(e,t,i,a,n){if(!r)return!1;var o=c(e,t,a,n,"PNG").toDataURL("image/png");return i?h(o):o},saveAsJPEG:function(e,t,i,a,n){if(!r)return!1;var o=c(e,t,a,n,"JPEG").toDataURL("image/jpeg");return 5==o.indexOf("image/jpeg")&&(i?h(o):o)},saveAsBMP:function(e,t,r,o,u){if(!i||!a)return!1;var f=c(e,t,o,u,"BMP"),p=n(f),d=s(p);return r?h(l(d,"image/bmp")):l(d,"image/bmp")}}}(),me={},ge={cache:{},g:document.createElement("canvas").getContext("2d"),getTextSize:function(e,t){ge.g.font=e||ke.FONT;var i=ge.cache[ge.g.font];return i||(i=2*ge.g.measureText("e").width+4,ge.cache[ge.g.font]=i),{width:ge.g.measureText(t).width+4,height:i}}};me.g=ge,oe.g=ge;var ve={};setTimeout;ve.bcld=function(e,t,i,r,a,n,o,s,l){var h,c,u=e/2,f=[],p=[],d={vertices:[],faces:[],uvs:[],uv2s:[]};for(c=0;c<=t;c++){var m=[],g=[],v=c/t,y=v*(i-r)+r;for(h=0;h<=a;h++){var A=h/a,x=new he;x.x=y*Math.sin(A*s+l),x.y=-v*e+u,x.z=y*Math.cos(A*s+l),d.vertices.push(x),m.push(d.vertices.length-1),g.push(new le(A,1-v))}f.push(m),p.push(g)}var _,w,b=(i-r)/e;for(h=0;h<a;h++)for(0!==r?(_=d.vertices[f[0][h]].clone(),w=d.vertices[f[0][h+1]].clone()):(_=d.vertices[f[1][h]].clone(),w=d.vertices[f[1][h+1]].clone()),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*b).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize(),c=0;c<t;c++){var M=f[c][h],S=f[c+1][h],P=f[c+1][h+1],C=f[c][h+1],T=_.clone(),E=_.clone(),z=w.clone(),D=w.clone(),L=p[c][h].clone(),R=p[c+1][h].clone(),N=p[c+1][h+1].clone(),B=p[c][h+1].clone();d.faces.push(new Pe(M,S,C,[T,E,D],null,0)),d.uvs.push([L,R,B]),d.uv2s.push([L.clone(),R.clone(),B.clone()]),d.faces.push(new Pe(S,P,C,[E,z,D],null,0)),d.uvs.push([R,N,B]),d.uv2s.push([R.clone(),N.clone(),B.clone()])}var I=!1;if(!1===n&&r>0)for(d.vertices.push(new he(0,u,0)),I=!0,h=0;h<a;h++){var M=f[0][h],S=f[0][h+1],P=d.vertices.length-1,T=new he(0,1,0),E=new he(0,1,0),z=new he(0,1,0),F=d.vertices[M],V=d.vertices[S],L=new le((F.x/r+1)/2,1-(F.z/r+1)/2),R=new le((V.x/r+1)/2,1-(V.z/r+1)/2),N=new le(.5,.5);d.faces.push(new Pe(M,S,P,[T,E,z],null,1)),d.uvs.push([L,R,N]),d.uv2s.push([L.clone(),R.clone(),N.clone()])}var U=!1;if(!1===o&&i>0)for(d.vertices.push(new he(0,-u,0)),U=!0,h=0;h<a;h++){var M=f[c][h+1],S=f[c][h],P=d.vertices.length-1,T=new he(0,-1,0),E=new he(0,-1,0),z=new he(0,-1,0),F=d.vertices[M],V=d.vertices[S],L=new le((F.x/i+1)/2,(F.z/i+1)/2),R=new le((V.x/i+1)/2,(V.z/i+1)/2),N=new le(.5,.5);d.faces.push(new Pe(M,S,P,[T,E,z],null,2)),d.uvs.push([L,R,N]),d.uv2s.push([L.clone(),R.clone(),N.clone()])}if(s!==2*Math.PI){!I&&d.vertices.push(new he(0,u,0)),!U&&d.vertices.push(new he(0,-u,0));var M=f[0][0],S=f[t][0],P=d.vertices.length-1,C=d.vertices.length-2,L=new le(0,0),R=new le(0,1),N=new le(1,1),B=new le(1,0);d.faces.push(new Pe(M,P,S)),d.uvs.push([L,N,R]),d.uv2s.push([L.clone(),N.clone(),R.clone()]),d.faces.push(new Pe(C,P,M)),d.uvs.push([B,N,L]),d.uv2s.push([B.clone(),N.clone(),L.clone()]),M=f[0][a],S=f[t][a];var L=new le(0,0),R=new le(0,1),N=new le(1,1),B=new le(1,0);d.faces.push(new Pe(M,S,C)),d.uvs.push([L,R,B]),d.uv2s.push([L.clone(),R.clone(),B.clone()]),d.faces.push(new Pe(S,P,C)),d.uvs.push([R,N,B]),d.uv2s.push([R.clone(),N.clone(),B.clone()])}return d},ve.buildCubeData=function(e,t,i,r,a,n,o,s){function l(l){var d,m,g,v,y,A,x,_,w,b;h=c.length;var M,S="six-each"==o||"front-other"==o||"back-other"==o||"left-other"==o||"right-other"==o||"top-other"==o||"bottom-other"==o,P=new le(0,0),C=S?new le(1/3,.5):new le(1,1),T=o.split("-")[0];"six"==T?T=null:C=new le(.5,1),"right"==l?(d="z",m="y",g="x",v=-1,y=-1,A=e/2,x=i,_=t,w=n,b=a,M=0,P=new le(2/3,0)):"left"==l?(d="z",m="y",g="x",v=1,y=-1,A=-e/2,x=i,_=t,w=n,b=a,M=1):"top"==l?(d="x",m="z",g="y",v=1,y=1,A=t/2,x=e,_=i,w=r,b=n,M=2,P=new le(1/3,.5)):"bottom"==l?(d="x",m="z",g="y",v=1,y=-1,A=-t/2,x=e,_=i,w=r,b=n,M=3,P=new le(0,.5)):"front"==l?(d="x",m="y",g="z",v=1,y=-1,A=i/2,x=e,_=t,w=r,b=a,M=4,P=new le(1/3,0)):"back"==l&&(d="x",m="y",g="z",v=-1,y=-1,A=-i/2,x=e,_=t,w=r,b=a,M=5,P=new le(2/3,.5)),T&&(P=T==l?new le(0,0):new le(.5,0));var E,z,D=w+1,L=b+1;for(z=0;z<L;z++)for(E=0;E<D;E++){var R=new he;R[d]=(E/w*x-x/2)*v+s[d],R[m]=(z/b*_-_/2)*y+s[m],R[g]=A+s[g],c.push(R)}S&&(M=0);var N=new he;for(N[g]=A>0?1:-1,z=0;z<b;z++)for(E=0;E<w;E++){var B=E+D*z,I=E+D*(z+1),F=E+1+D*(z+1),V=E+1+D*z,U=[new le(E/w,1-z/b),new le(E/w,1-(z+1)/b),new le((E+1)/w,1-(z+1)/b),new le((E+1)/w,1-z/b)];if(S)for(var k=0;k<U.length;k++)U[k].multiply(C).add(P);var O=new Ce(B+h,I+h,F+h,V+h);O.normal.copy(N),O.vertexNormals.push(N.clone(),N.clone(),N.clone(),N.clone()),O.materialIndex=M,u.push(O),f.push([U[0],U[1],U[2],U[3]]),p.push([U[0].clone(),U[1].clone(),U[2].clone(),U[3].clone()])}}var h,c=[],u=[],f=[],p=[];return l("right"),l("left"),l("top"),l("bottom"),l("front"),l("back"),{vertices:c,faces:u,uvs:f,uv2s:p}},ve.bsd=function(e,t,i,r,a,n,o){var s,l,h=[],c=[],u=[],f=[],p=[],d=[];for(l=0;l<=i;l++){var m=[],g=[];for(s=0;s<=t;s++){var v=s/t,y=l/i,A=new he;A.x=-e*Math.cos(r+v*a)*Math.sin(n+y*o),A.y=e*Math.cos(n+y*o),A.z=e*Math.sin(r+v*a)*Math.sin(n+y*o),h.push(A),m.push(h.length-1),g.push(new le(v,1-y))}p.push(m),d.push(g)}for(l=0;l<i;l++)for(s=0;s<t;s++){var x=p[l][s+1],_=p[l][s],w=p[l+1][s],b=p[l+1][s+1],M=h[x].clone().normalize(),S=h[_].clone().normalize(),P=h[w].clone().normalize(),C=h[b].clone().normalize(),T=d[l][s+1].clone(),E=d[l][s].clone(),z=d[l+1][s].clone(),D=d[l+1][s+1].clone();Math.abs(h[x].y)===e?(u.push(new Pe(x,w,b,[M,P,C])),c.push([T,z,D]),f.push([T.clone(),z.clone(),D.clone()])):Math.abs(h[w].y)===e?(u.push(new Pe(x,_,w,[M,S,P])),c.push([T,E,z]),f.push([T.clone(),E.clone(),z.clone()])):(u.push(new Pe(x,_,b,[M,S,C])),c.push([T,E,D]),f.push([T.clone(),E.clone(),D.clone()]),u.push(new Pe(_,w,b,[S.clone(),P,C.clone()])),c.push([E.clone(),z,D.clone()]),f.push([E.clone(),z.clone(),D.clone()]))}return{vertices:h,faces:u,uvs:c,uv2s:f}};var ye=function(e,i){var r,a,n,o,s,l,h,c={},u=e.primitive;if(u.groups)return e.groups=u.groups,void(e.groupList=u.groupList);u.groups={};var f=e.material,p=e.getMaterialMapping();for(r=0,a=u.faces.length;r<a;r++)n=u.faces[r],c[l=(o=p[o=f instanceof oe.ArrayMaterial?n.materialIndex:0])!==t?o:-1]===t&&(c[l]={hash:l,counter:0}),h=c[l].hash+"_"+c[l].counter,u.groups[h]===t&&(u.groups[h]={faces3:[],faces4:[],materialIndex:o,vertices:0}),s=n instanceof Pe?3:4,u.groups[h].vertices+s>65535&&(i?u.groups[h].elementIndexUInt=!0:(c[l].counter+=1,h=c[l].hash+"_"+c[l].counter,u.groups[h]===t&&(u.groups[h]={faces3:[],faces4:[],materialIndex:o,vertices:0}))),n instanceof Pe?u.groups[h].faces3.push(r):u.groups[h].faces4.push(r),u.groups[h].vertices+=s;u.groupsList=[];for(var d in e.groups)u.groupsList.push(e.groups[d]);e.groups=u.groups,e.groupList=u.groupsList},Ae=function(e,i,r,a,n){var o,s,l,h,c,u,f,p,d,m,g,v,y,A,x=e,_=x,w=_.vertices,b=w.length,M=_.colors,S=M.length,P=_.sizes,C=P.length,T=a.__vertexArray,E=a.__colorArray,z=a.__normalArray,D=a.__sortArray,L=_.verticesNeedUpdate,R=(_.elementsNeedUpdate,_.normalsNeedUpdate),N=_.colorsNeedUpdate,B=_.__webglCustomAttributesList;if(C<b&&(C=b),x.sortParticles){for(n._projScreenMatrixPS.copy(n._projScreenMatrix),n._projScreenMatrixPS.multiply(x.matrixWorld),o=0;o<b;o++){h=w[o];var I=new he;I.copy(h),I.applyProjection(n._projScreenMatrixPS),D[o]=[I.z,o]}for(D.sort(function(e,t){return e[0]-t[0]}),o=0;o<b;o++)h=w[D[o][1]],T[c=3*o]=h.x,T[c+1]=h.y,T[c+2]=h.z;for(s=0;s<S;s++)c=3*s,f=M[D[s][1]],E[c]=f.r,E[c+1]=f.g,E[c+2]=f.b;for(l=0;l<C;l++)c=3*l,p=null==(p=P[D[l][1]])?1:p,z[c]=null==p.x?p||1:p.x,z[c+1]=0,z[c+2]=0;if(B)for(d=0,m=B.length;d<m;d++)if((A=B[d]).boundTo===t||"vertices"===A.boundTo)if(c=0,v=A.value.length,1===A.size)for(g=0;g<v;g++)u=D[g][1],A.array[g]=A.value[u];else if(2===A.size)for(g=0;g<v;g++)u=D[g][1],y=A.value[u],A.array[c]=y.x,A.array[c+1]=y.y,c+=2;else if(3===A.size)if("c"===A.type)for(g=0;g<v;g++)u=D[g][1],y=A.value[u],A.array[c]=y.r,A.array[c+1]=y.g,A.array[c+2]=y.b,c+=3;else for(g=0;g<v;g++)u=D[g][1],y=A.value[u],A.array[c]=y.x,A.array[c+1]=y.y,A.array[c+2]=y.z,c+=3;else if(4===A.size)for(g=0;g<v;g++)u=D[g][1],y=A.value[u],A.array[c]=y.x,A.array[c+1]=y.y,A.array[c+2]=y.z,A.array[c+3]=y.w,c+=4}else{if(L)for(o=0;o<b;o++)h=w[o],T[c=3*o]=h.x,T[c+1]=h.y,T[c+2]=h.z;if(N)for(s=0;s<S;s++)f=M[s],E[c=3*s]=f.r,E[c+1]=f.g,E[c+2]=f.b;if(R)for(l=0;l<C;l++)p=null==P[l]?1:P[l],z[c=3*l]=null==p.x?p||1:p.x,z[c+1]=0,z[c+2]=0;if(B)for(d=0,m=B.length;d<m;d++)if((A=B[d]).needsUpdate&&(A.boundTo===t||"vertices"===A.boundTo))if(v=A.value.length,c=0,1===A.size)for(g=0;g<v;g++)A.array[g]=A.value[g];else if(2===A.size)for(g=0;g<v;g++)y=A.value[g],A.array[c]=y.x,A.array[c+1]=y.y,c+=2;else if(3===A.size)if("c"===A.type)for(g=0;g<v;g++)y=A.value[g],A.array[c]=y.r,A.array[c+1]=y.g,A.array[c+2]=y.b,c+=3;else for(g=0;g<v;g++)y=A.value[g],A.array[c]=y.x,A.array[c+1]=y.y,A.array[c+2]=y.z,c+=3;else if(4===A.size)for(g=0;g<v;g++)y=A.value[g],A.array[c]=y.x,A.array[c+1]=y.y,A.array[c+2]=y.z,A.array[c+3]=y.w,c+=4}if((L||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,a.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,T,i)),(N||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,a.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,E,i)),(R||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,a.__webglNormalBuffer),r.bufferData(r.ARRAY_BUFFER,z,i)),B)for(d=0,m=B.length;d<m;d++)((A=B[d]).needsUpdate||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,A.buffer),r.bufferData(r.ARRAY_BUFFER,A.array,i))};ve.buildGroupBufferData=function(e,i,r,a,n,o,s,l){n._type;var h=n.isVertexColor(),c=n.needUV();var u,f,p,d,m,g,v,y,A,x,_,w,b,M,S,P,C,T,E,z,D,L,R,N,B,I=l.needSmoothNormal(i,n),F=0,V=0,U=0,k=0,O=0,X=0,G=0,W=0,Y=0,j=s.__vertexArray,H=s.__uvArray,q=s.__uv2Array,Z=s.__normalArray,Q=s.__colorArray,K=s.__webglCustomAttributesList,J=s.__faceArray,$=s.__lineArray,ee=i,te=ee.verticesNeedUpdate,ie=ee.elementsNeedUpdate,re=ee.uvsNeedUpdate,ae=ee.normalsNeedUpdate,ne=ee.colorsNeedUpdate,se=ee.vertices,le=e.faces3,he=e.faces4,ce=ee.faces,ue=ee.colors,fe=ee.uvs,pe=ee.uv2s;ee.colors;if(null!=s._vao&&(s._vao.dirty=!0),te){for(u=0,f=le.length;u<f;u++)_=se[(d=ce[le[u]]).a],w=se[d.b],b=se[d.c],j[V]=_.x,j[V+1]=_.y,j[V+2]=_.z,j[V+3]=w.x,j[V+4]=w.y,j[V+5]=w.z,j[V+6]=b.x,j[V+7]=b.y,j[V+8]=b.z,V+=9;for(u=0,f=he.length;u<f;u++)_=se[(d=ce[he[u]]).a],w=se[d.b],b=se[d.c],M=se[d.d],j[V]=_.x,j[V+1]=_.y,j[V+2]=_.z,j[V+3]=w.x,j[V+4]=w.y,j[V+5]=w.z,j[V+6]=b.x,j[V+7]=b.y,j[V+8]=b.z,j[V+9]=M.x,j[V+10]=M.y,j[V+11]=M.z,V+=12;o.bindBuffer(o.ARRAY_BUFFER,s.__webglVertexBuffer),o.bufferData(o.ARRAY_BUFFER,j,r),s.__vertexArray=j}if(ne&&h){for(u=0,f=le.length;u<f;u++)v=(d=ce[le[u]]).vertexColors,ue&&ue.length>0&&(v[0]=ue[d.a],v[1]=ue[d.b],v[2]=ue[d.c]),y=d.color,3===v.length&&h===oe.VertexColors?(S=v[0],P=v[1],C=v[2]):(S=y,P=y,C=y),Q[W]=S.r,Q[W+1]=S.g,Q[W+2]=S.b,Q[W+3]=P.r,Q[W+4]=P.g,Q[W+5]=P.b,Q[W+6]=C.r,Q[W+7]=C.g,Q[W+8]=C.b,W+=9;for(u=0,f=he.length;u<f;u++)v=(d=ce[he[u]]).vertexColors,y=d.color,4===v.length&&h===oe.VertexColors?(S=v[0],P=v[1],C=v[2],T=v[3]):(S=y,P=y,C=y,T=y),Q[W]=S.r,Q[W+1]=S.g,Q[W+2]=S.b,Q[W+3]=P.r,Q[W+4]=P.g,Q[W+5]=P.b,Q[W+6]=C.r,Q[W+7]=C.g,Q[W+8]=C.b,Q[W+9]=T.r,Q[W+10]=T.g,Q[W+11]=T.b,W+=12;W>0&&(o.bindBuffer(o.ARRAY_BUFFER,s.__webglColorBuffer),o.bufferData(o.ARRAY_BUFFER,Q,r))}if(ae){for(u=0,f=le.length;u<f;u++)if(d=ce[le[u]],m=d.vertexNormals,g=d.normal,3===m.length&&I)for(E=0;E<3;E++)D=m[E],Z[X]=D.x,Z[X+1]=D.y,Z[X+2]=D.z,X+=3;else for(E=0;E<3;E++)Z[X]=g.x,Z[X+1]=g.y,Z[X+2]=g.z,X+=3;for(u=0,f=he.length;u<f;u++)if(d=ce[he[u]],m=d.vertexNormals,g=d.normal,4===m.length&&I)for(E=0;E<4;E++)D=m[E],null==Z&&console.log("normal array is null"),Z[X]=D.x,Z[X+1]=D.y,Z[X+2]=D.z,X+=3;else for(E=0;E<4;E++)Z[X]=g.x,Z[X+1]=g.y,Z[X+2]=g.z,X+=3;o.bindBuffer(o.ARRAY_BUFFER,s.__webglNormalBuffer),o.bufferData(o.ARRAY_BUFFER,Z,r),s.__normalArray=Z}if(re&&fe&&c){for(u=0,f=le.length;u<f;u++)if(p=le[u],(A=fe[p])!==t)for(E=0;E<3;E++)L=A[E],H[U]=L.x,H[U+1]=L.y,U+=2;for(u=0,f=he.length;u<f;u++)if(p=he[u],(A=fe[p])!==t)for(E=0;E<4;E++)L=A[E],H[U]=L.x,H[U+1]=L.y,U+=2;U>0&&(o.bindBuffer(o.ARRAY_BUFFER,s.__webglUVBuffer),o.bufferData(o.ARRAY_BUFFER,H,r),s.uvArray=H)}if(re&&pe&&c){for(u=0,f=le.length;u<f;u++)if(p=le[u],(x=pe[p])!==t)for(E=0;E<3;E++)R=x[E],q[k]=R.x,q[k+1]=R.y,k+=2;for(u=0,f=he.length;u<f;u++)if(p=he[u],(x=pe[p])!==t)for(E=0;E<4;E++)R=x[E],q[k]=R.x,q[k+1]=R.y,k+=2;k>0&&(o.bindBuffer(o.ARRAY_BUFFER,s.__webglUV2Buffer),o.bufferData(o.ARRAY_BUFFER,q,r))}if(ie){for(u=0,f=le.length;u<f;u++)J[O]=F,J[O+1]=F+1,J[O+2]=F+2,O+=3,$[G]=F,$[G+1]=F+1,$[G+2]=F,$[G+3]=F+2,$[G+4]=F+1,$[G+5]=F+2,G+=6,F+=3;for(u=0,f=he.length;u<f;u++)J[O]=F,J[O+1]=F+1,J[O+2]=F+3,J[O+3]=F+1,J[O+4]=F+2,J[O+5]=F+3,O+=6,$[G]=F,$[G+1]=F+1,$[G+2]=F,$[G+3]=F+3,$[G+4]=F+1,$[G+5]=F+2,$[G+6]=F+2,$[G+7]=F+3,G+=8,F+=4;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s.__webglFaceBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,J,r),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s.__webglLineBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,$,r),s.__lineArray=$}if(K)for(E=0,z=K.length;E<z;E++)if((B=K[E]).__original.needsUpdate){if(Y=0,0,1===B.size){if(B.boundTo===t||"vertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)d=ce[le[u]],B.array[Y]=B.value[d.a],B.array[Y+1]=B.value[d.b],B.array[Y+2]=B.value[d.c],Y+=3;for(u=0,f=he.length;u<f;u++)d=ce[he[u]],B.array[Y]=B.value[d.a],B.array[Y+1]=B.value[d.b],B.array[Y+2]=B.value[d.c],B.array[Y+3]=B.value[d.d],Y+=4}else if("faces"===B.boundTo){for(u=0,f=le.length;u<f;u++)N=B.value[le[u]],B.array[Y]=N,B.array[Y+1]=N,B.array[Y+2]=N,Y+=3;for(u=0,f=he.length;u<f;u++)N=B.value[he[u]],B.array[Y]=N,B.array[Y+1]=N,B.array[Y+2]=N,B.array[Y+3]=N,Y+=4}}else if(2===B.size){if(B.boundTo===t||"vertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)d=ce[le[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=w.x,B.array[Y+3]=w.y,B.array[Y+4]=b.x,B.array[Y+5]=b.y,Y+=6;for(u=0,f=he.length;u<f;u++)d=ce[he[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],M=B.value[d.d],B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=w.x,B.array[Y+3]=w.y,B.array[Y+4]=b.x,B.array[Y+5]=b.y,B.array[Y+6]=M.x,B.array[Y+7]=M.y,Y+=8}else if("faces"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=N=B.value[le[u]],w=N,b=N,B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=w.x,B.array[Y+3]=w.y,B.array[Y+4]=b.x,B.array[Y+5]=b.y,Y+=6;for(u=0,f=he.length;u<f;u++)_=N=B.value[he[u]],w=N,b=N,M=N,B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=w.x,B.array[Y+3]=w.y,B.array[Y+4]=b.x,B.array[Y+5]=b.y,B.array[Y+6]=M.x,B.array[Y+7]=M.y,Y+=8}}else if(3===B.size){var de;if(de="c"===B.type?["r","g","b"]:["x","y","z"],B.boundTo===t||"vertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)d=ce[le[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],B.array[Y]=_[de[0]],B.array[Y+1]=_[de[1]],B.array[Y+2]=_[de[2]],B.array[Y+3]=w[de[0]],B.array[Y+4]=w[de[1]],B.array[Y+5]=w[de[2]],B.array[Y+6]=b[de[0]],B.array[Y+7]=b[de[1]],B.array[Y+8]=b[de[2]],Y+=9;for(u=0,f=he.length;u<f;u++)d=ce[he[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],M=B.value[d.d],B.array[Y]=_[de[0]],B.array[Y+1]=_[de[1]],B.array[Y+2]=_[de[2]],B.array[Y+3]=w[de[0]],B.array[Y+4]=w[de[1]],B.array[Y+5]=w[de[2]],B.array[Y+6]=b[de[0]],B.array[Y+7]=b[de[1]],B.array[Y+8]=b[de[2]],B.array[Y+9]=M[de[0]],B.array[Y+10]=M[de[1]],B.array[Y+11]=M[de[2]],Y+=12}else if("faces"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=N=B.value[le[u]],w=N,b=N,B.array[Y]=_[de[0]],B.array[Y+1]=_[de[1]],B.array[Y+2]=_[de[2]],B.array[Y+3]=w[de[0]],B.array[Y+4]=w[de[1]],B.array[Y+5]=w[de[2]],B.array[Y+6]=b[de[0]],B.array[Y+7]=b[de[1]],B.array[Y+8]=b[de[2]],Y+=9;for(u=0,f=he.length;u<f;u++)_=N=B.value[he[u]],w=N,b=N,M=N,B.array[Y]=_[de[0]],B.array[Y+1]=_[de[1]],B.array[Y+2]=_[de[2]],B.array[Y+3]=w[de[0]],B.array[Y+4]=w[de[1]],B.array[Y+5]=w[de[2]],B.array[Y+6]=b[de[0]],B.array[Y+7]=b[de[1]],B.array[Y+8]=b[de[2]],B.array[Y+9]=M[de[0]],B.array[Y+10]=M[de[1]],B.array[Y+11]=M[de[2]],Y+=12}else if("faceVertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=(N=B.value[le[u]])[0],w=N[1],b=N[2],B.array[Y]=_[de[0]],B.array[Y+1]=_[de[1]],B.array[Y+2]=_[de[2]],B.array[Y+3]=w[de[0]],B.array[Y+4]=w[de[1]],B.array[Y+5]=w[de[2]],B.array[Y+6]=b[de[0]],B.array[Y+7]=b[de[1]],B.array[Y+8]=b[de[2]],Y+=9;for(u=0,f=he.length;u<f;u++)_=(N=B.value[he[u]])[0],w=N[1],b=N[2],M=N[3],B.array[Y]=_[de[0]],B.array[Y+1]=_[de[1]],B.array[Y+2]=_[de[2]],B.array[Y+3]=w[de[0]],B.array[Y+4]=w[de[1]],B.array[Y+5]=w[de[2]],B.array[Y+6]=b[de[0]],B.array[Y+7]=b[de[1]],B.array[Y+8]=b[de[2]],B.array[Y+9]=M[de[0]],B.array[Y+10]=M[de[1]],B.array[Y+11]=M[de[2]],Y+=12}}else if(4===B.size)if(B.boundTo===t||"vertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)d=ce[le[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=_.z,B.array[Y+3]=_.w,B.array[Y+4]=w.x,B.array[Y+5]=w.y,B.array[Y+6]=w.z,B.array[Y+7]=w.w,B.array[Y+8]=b.x,B.array[Y+9]=b.y,B.array[Y+10]=b.z,B.array[Y+11]=b.w,Y+=12;for(u=0,f=he.length;u<f;u++)d=ce[he[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],M=B.value[d.d],B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=_.z,B.array[Y+3]=_.w,B.array[Y+4]=w.x,B.array[Y+5]=w.y,B.array[Y+6]=w.z,B.array[Y+7]=w.w,B.array[Y+8]=b.x,B.array[Y+9]=b.y,B.array[Y+10]=b.z,B.array[Y+11]=b.w,B.array[Y+12]=M.x,B.array[Y+13]=M.y,B.array[Y+14]=M.z,B.array[Y+15]=M.w,Y+=16}else if("faces"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=N=B.value[le[u]],w=N,b=N,B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=_.z,B.array[Y+3]=_.w,B.array[Y+4]=w.x,B.array[Y+5]=w.y,B.array[Y+6]=w.z,B.array[Y+7]=w.w,B.array[Y+8]=b.x,B.array[Y+9]=b.y,B.array[Y+10]=b.z,B.array[Y+11]=b.w,Y+=12;for(u=0,f=he.length;u<f;u++)_=N=B.value[he[u]],w=N,b=N,M=N,B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=_.z,B.array[Y+3]=_.w,B.array[Y+4]=w.x,B.array[Y+5]=w.y,B.array[Y+6]=w.z,B.array[Y+7]=w.w,B.array[Y+8]=b.x,B.array[Y+9]=b.y,B.array[Y+10]=b.z,B.array[Y+11]=b.w,B.array[Y+12]=M.x,B.array[Y+13]=M.y,B.array[Y+14]=M.z,B.array[Y+15]=M.w,Y+=16}else if("faceVertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=(N=B.value[le[u]])[0],w=N[1],b=N[2],B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=_.z,B.array[Y+3]=_.w,B.array[Y+4]=w.x,B.array[Y+5]=w.y,B.array[Y+6]=w.z,B.array[Y+7]=w.w,B.array[Y+8]=b.x,B.array[Y+9]=b.y,B.array[Y+10]=b.z,B.array[Y+11]=b.w,Y+=12;for(u=0,f=he.length;u<f;u++)_=(N=B.value[he[u]])[0],w=N[1],b=N[2],M=N[3],B.array[Y]=_.x,B.array[Y+1]=_.y,B.array[Y+2]=_.z,B.array[Y+3]=_.w,B.array[Y+4]=w.x,B.array[Y+5]=w.y,B.array[Y+6]=w.z,B.array[Y+7]=w.w,B.array[Y+8]=b.x,B.array[Y+9]=b.y,B.array[Y+10]=b.z,B.array[Y+11]=b.w,B.array[Y+12]=M.x,B.array[Y+13]=M.y,B.array[Y+14]=M.z,B.array[Y+15]=M.w,Y+=16}o.bindBuffer(o.ARRAY_BUFFER,B.buffer),o.bufferData(o.ARRAY_BUFFER,B.array,r)}a&&ve.deleteGroupBufferData(e)},ve.buildLineBufferData=function(e,i,r,a){var n,o,s,l,h,c,u,f,p,d,m,g,v=e,y=v.vertices,A=v.colors,x=v.lineDistances,_=y.length,w=A.length,b=x.length,M=a.__vertexArray,S=a.__colorArray,P=a.__lineDistanceArray,C=v.verticesNeedUpdate,T=v.colorsNeedUpdate,E=v.lineDistancesNeedUpdate,z=v.__webglCustomAttributesList;if(C){for(n=0;n<_;n++)l=y[n],M[h=3*n]=l.x,M[h+1]=l.y,M[h+2]=l.z;r.bindBuffer(r.ARRAY_BUFFER,a.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,M,i)}if(T){for(o=0;o<w;o++)c=A[o],S[h=3*o]=c.r,S[h+1]=c.g,S[h+2]=c.b;r.bindBuffer(r.ARRAY_BUFFER,a.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,S,i)}if(E){for(s=0;s<b;s++)P[s]=x[s];r.bindBuffer(r.ARRAY_BUFFER,a.__webglLineDistanceBuffer),r.bufferData(r.ARRAY_BUFFER,P,i)}if(z)for(u=0,f=z.length;u<f;u++)if((g=z[u]).needsUpdate&&(g.boundTo===t||"vertices"===g.boundTo)){if(h=0,d=g.value.length,1===g.size)for(p=0;p<d;p++)g.array[p]=g.value[p];else if(2===g.size)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,h+=2;else if(3===g.size)if("c"===g.type)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.r,g.array[h+1]=m.g,g.array[h+2]=m.b,h+=3;else for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,h+=3;else if(4===g.size)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,g.array[h+3]=m.w,h+=4;r.bindBuffer(r.ARRAY_BUFFER,g.buffer),r.bufferData(r.ARRAY_BUFFER,g.array,i)}},ve.buildLineBufferData=function(e,i,r,a){var n,o,s,l,h,c,u,f,p,d,m,g,v=e,y=v.vertices,A=v.colors,x=v.lineDistances,_=y.length,w=A.length,b=x.length,M=a.__vertexArray,S=a.__colorArray,P=a.__lineDistanceArray,C=v.verticesNeedUpdate,T=v.colorsNeedUpdate,E=v.lineDistancesNeedUpdate,z=v.__webglCustomAttributesList;if(C){for(n=0;n<_;n++)l=y[n],M[h=3*n]=l.x,M[h+1]=l.y,M[h+2]=l.z;r.bindBuffer(r.ARRAY_BUFFER,a.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,M,i)}if(T){for(o=0;o<w;o++)c=A[o],S[h=3*o]=c.r,S[h+1]=c.g,S[h+2]=c.b;r.bindBuffer(r.ARRAY_BUFFER,a.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,S,i)}if(E){for(s=0;s<b;s++)P[s]=x[s];r.bindBuffer(r.ARRAY_BUFFER,a.__webglLineDistanceBuffer),r.bufferData(r.ARRAY_BUFFER,P,i)}if(z)for(u=0,f=z.length;u<f;u++)if((g=z[u]).needsUpdate&&(g.boundTo===t||"vertices"===g.boundTo)){if(h=0,d=g.value.length,1===g.size)for(p=0;p<d;p++)g.array[p]=g.value[p];else if(2===g.size)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,h+=2;else if(3===g.size)if("c"===g.type)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.r,g.array[h+1]=m.g,g.array[h+2]=m.b,h+=3;else for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,h+=3;else if(4===g.size)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,g.array[h+3]=m.w,h+=4;r.bindBuffer(r.ARRAY_BUFFER,g.buffer),r.bufferData(r.ARRAY_BUFFER,g.array,i)}},ve.deleteGroupBufferData=function(e){delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray},ve.getMaterial=function(e,t){var i=e.material;return i instanceof oe.ArrayMaterial?(t>i.materials.length-1&&(t=i.materials.length-1),i.materials[t]):i},oe.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),i=this;i.faces[t]=i.faces[t]||{},i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{},i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,i=this.getFace(),r=this.size/i.resolution,a=0,n=String(e).split(""),o=n.length,s=[];for(t=0;t<o;t++){var l=new oe.Path,h=this.extractGlyphPoints(n[t],i,r,a,l);a+=h.offset,s.push(h.path)}var c,u,f=a/2;for(t=0;t<o;t++){l=s[t];for(u=0;u<l.actions.length;u++){var p=l.actions[u].args;for(c=0;c<p.length;c++)c%3==0&&(p[c]-=f)}}return{paths:s,offset:f}},extractGlyphPoints:function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d,m,g,v,y,A,x,_,w,b,M=[],S=t.glyphs[e]||t.glyphs["?"];if(S){if(S.o)for(c=(h=S._cachedOutline||(S._cachedOutline=S.o.split(" "))).length,u=i,f=i,o=0;o<c;)switch(h[o++]){case"m":p=h[o++]*u+r,d=h[o++]*f-0,a.moveTo(p,d,0);break;case"l":p=h[o++]*u+r,d=h[o++]*f-0,a.lineTo(p,d,0);break;case"q":if(m=h[o++]*u+r,g=h[o++]*f-0,A=h[o++]*u+r,x=h[o++]*f-0,a.quadraticCurveTo(A,x,0,m,g,0),b=M[M.length-1])for(v=b.x,y=b.y,s=1,l=this.divisions;s<=l;s++)P=s/l,oe.Shape.Utils.b2(P,v,A,m),oe.Shape.Utils.b2(P,y,x,g);break;case"b":if(m=h[o++]*u+r,g=h[o++]*f-0,A=h[o++]*u+r,x=h[o++]*-f-0,_=h[o++]*u+r,w=h[o++]*-f-0,a.bezierCurveTo(m,g,0,A,x,0,_,w,0),b=M[M.length-1])for(v=b.x,y=b.y,s=1,l=this.divisions;s<=l;s++){var P=s/l;oe.Shape.Utils.b3(P,v,A,_,m),oe.Shape.Utils.b3(P,y,x,w,g)}}return{offset:S.ha*i,path:a}}}},oe.FontUtils.generateShapes=function(e,i){var r=(i=i||{}).size!==t?i.size:100,a=i.curveSegments!==t?i.curveSegments:4,n=i.font!==t?i.font:"helvetiker",o=i.weight!==t?i.weight:"normal",s=i.style!==t?i.style:"normal";oe.FontUtils.size=r,oe.FontUtils.divisions=a,oe.FontUtils.face=n,oe.FontUtils.weight=o,oe.FontUtils.style=s;for(var l=oe.FontUtils.drawText(e).paths,h=[],c=0,u=l.length;c<u;c++)Array.prototype.push.apply(h,l[c].toShapes());return h},function(e){var t=function(e){for(var t=e.length,i=0,r=t-1,a=0;a<t;r=a++)i+=e[r].x*e[a].y-e[a].x*e[r].y;return.5*i},i=function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d;if(s=e[n[t]].x,l=e[n[t]].y,h=e[n[i]].x,c=e[n[i]].y,u=e[n[r]].x,f=e[n[r]].y,1e-10>(h-s)*(f-l)-(c-l)*(u-s))return!1;var m,g,v,y,A,x,_,w,b,M,S,P,C,T,E;for(m=u-h,g=f-c,v=s-u,y=l-f,A=h-s,x=c-l,o=0;o<a;o++)if(o!==t&&o!==i&&o!==r&&(p=e[n[o]].x,d=e[n[o]].y,_=p-s,w=d-l,b=p-h,M=d-c,S=p-u,P=d-f,E=m*M-g*b,C=A*w-x*_,T=v*P-y*S,E>=-1e-10&&T>=-1e-10&&C>=-1e-10))return!1;return!0};e.Triangulate=function(e,r){var a=e.length;if(a<3)return null;var n,o,s,l=[],h=[],c=[];if(t(e)>0)for(o=0;o<a;o++)h[o]=o;else for(o=0;o<a;o++)h[o]=a-1-o;var u=a,f=2*u;for(o=u-1;u>2;){if(f--<=0)return console.log("Warning, unable to triangulate polygon!"),r?c:l;if(n=o,u<=n&&(n=0),o=n+1,u<=o&&(o=0),s=o+1,u<=s&&(s=0),i(e,n,o,s,u,h)){var p,d,m,g,v;for(p=h[n],d=h[o],m=h[s],l.push([e[p],e[d],e[m]]),c.push([h[n],h[o],h[s]]),g=o,v=o+1;v<u;g++,v++)h[g]=h[v];f=2*--u}}return r?c:l},e.Triangulate.area=t}(oe.FontUtils),e._typeface_js={faces:oe.FontUtils.faces,loadFace:oe.FontUtils.loadFace},oe.typeface_js=e._typeface_js;var xe={easeNone:function(e,t,i,r){return i*e/r+t},easeIn:function(e,t,i,r){return i*(e/=r)*e+t},easeOut:function(e,t,i,r){return-i*(e/=r)*(e-2)+t},easeBoth:function(e,t,i,r){return(e/=r/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},easeInStrong:function(e,t,i,r){return i*(e/=r)*e*e*e+t},easeOutStrong:function(e,t,i,r){return-i*((e=e/r-1)*e*e*e-1)+t},easeBothStrong:function(e,t,i,r){return(e/=r/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t},elasticIn:function(e,t,i,r,a,n){var o;return 0===e?t:1==(e/=r)?t+i:(n||(n=.3*r),!a||a<Math.abs(i)?(a=i,o=n/4):o=n/(2*Math.PI)*Math.asin(i/a),-a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/n)+t)},elasticOut:function(e,t,i,r,a,n){var o;return 0===e?t:1==(e/=r)?t+i:(n||(n=.3*r),!a||a<Math.abs(i)?(a=i,o=n/4):o=n/(2*Math.PI)*Math.asin(i/a),a*Math.pow(2,-10*e)*Math.sin((e*r-o)*(2*Math.PI)/n)+i+t)},elasticBoth:function(e,t,i,r,a,n){var o;return 0===e?t:2==(e/=r/2)?t+i:(n||(n=r*(.3*1.5)),!a||a<Math.abs(i)?(a=i,o=n/4):o=n/(2*Math.PI)*Math.asin(i/a),e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/n)*-.5+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/n)*.5+i+t)},backIn:function(e,i,r,a,n){return n===t&&(n=1.70158),e===a&&(e-=.001),r*(e/=a)*e*((n+1)*e-n)+i},backOut:function(e,t,i,r,a){return void 0===a&&(a=1.70158),i*((e=e/r-1)*e*((a+1)*e+a)+1)+t},backBoth:function(e,t,i,r,a){return void 0===a&&(a=5.70158),(e/=r/2)<1?i/2*(e*e*((1+(a*=1.525))*e-a))+t:i/2*((e-=2)*e*((1+(a*=1.525))*e+a)+2)+t},bounceIn:function(e,t,i,r){return i-xe.bounceOut(r-e,0,i,r)+t},bounceOut:function(e,t,i,r){return(e/=r)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t},bounceBoth:function(e,t,i,r){return e<r/2?.5*xe.bounceIn(2*e,0,i,r)+t:.5*xe.bounceOut(2*e-r,0,i,r)+.5*i+t}},_e=function(){if(this._as=[],1===arguments.length){var e=arguments[0];if(e instanceof _e&&(e=e._as),e instanceof Array)for(var t=e.length,i=0;i<t;i++)this._as.push(e[i]);else null!=e&&this._as.push(e)}else if(arguments.length>1)for(t=arguments.length,i=0;i<t;i++)this._as.push(arguments[i])};oe.List=_e,oe.extend(oe.List,Object,{size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(e,i){return i===t?this._as.push(e):this._as.splice(i,0,e)},addAll:function(e){if(e instanceof _e&&(e=e._as),e instanceof Array)for(var t=e.length,i=0;i<t;i++)this._as.push(e[i]);else this._as.push(e)},get:function(e){return this._as[e]},remove:function(e){var t=this._as.indexOf(e);return t>=0&&t<this._as.length&&this.removeAt(t),t},removeAt:function(e){return this._as.splice(e,1)[0]},set:function(e,t){return this._as[e]=t},clear:function(){return this._as.splice(0,this._as.length)},contains:function(e){return this.indexOf(e)>=0},indexOf:function(e){return this._as.indexOf(e)},forEach:function(e,t){for(var i=this._as.length,r=0;r<i;r++){var a=this._as[r];t?e.call(t,a):e(a)}},forEachReverse:function(e,t){for(var i=this._as.length-1;i>=0;i--){var r=this._as[i];t?e.call(t,r):e(r)}},toArray:function(e,t){if(e){for(var i=[],r=this._as.length,a=0;a<r;a++){var n=this._as[a];t?e.call(t,n)&&i.push(n):e(n)&&i.push(n)}return i}return this._as.concat()},toList:function(e,t){if(e){for(var i=new _e,r=this._as.length,a=0;a<r;a++){var n=this._as[a];t?e.call(t,n)&&i.add(n):e(n)&&i.add(n)}return i}return new _e(this)},sort:function(e){return e?this._as.sort(e):this._as.sort(),this},toString:function(){return this._as.toString()}}),oe.ImageCache=function(){};var we=oe.ImageCache;we.AlarmBillboardImage=new Image,we.AlarmBillboardImage.src="data:image/png;base64,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",we.Logo=new Image,we.Logo.src="data:image/png;base64,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",oe.ImageUtils={},oe.ImageUtils.registerDefaultImage=function(e){null!=e.src?we.Logo.src=e.src:we.Logo.src=e},oe.ImageUtils.registerAlarmImage=function(e){null!=e.src?we.AlarmBillboardImage.src=e.src:we.AlarmBillboardImage.src=e},we.ssaoNormalImage=new Image,we.ssaoNormalImage.src="data:image/png;base64,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",we.ssaoNormalImage.loaded=!0,oe.EventDispatcher=function(){},oe.extend(oe.EventDispatcher,null,{constructor:oe.EventDispatcher,contains:function(e,t){if(this._ls)for(var i,r=0,a=this._ls.size();r<a;r++)if(i=this._ls.get(r),e===i.l&&t===i.s)return!0;return!1},add:function(e,t,i){if(null!=e){var r={l:e,s:t,a:i};this._ls||(this._ls=new _e),this._f?(this._addPendings||(this._addPendings=new _e),this._addPendings.add(r)):r.a?this._ls.add(r,0):this._ls.add(r)}else console.error("TGL.EventDispatcher#add:listener is null")},remove:function(e,t){this._ls&&(this._f?(this._removePendings||(this._removePendings=new _e),this._removePendings.add({l:e,s:t})):this._remove(e,t))},_remove:function(e,t){for(var i,r=0,a=this._ls.size();r<a;r++)if((i=this._ls.get(r)).l===e&&i.s===t)return void this._ls.removeAt(r)},fire:function(e){if(this._ls){var t,i,r=this._ls.size();for(this._f=!0,t=0;t<r;t++)(i=this._ls.get(t)).s?i.l.call(i.s,e):i.l(e);if(this._f=!1,this._removePendings){for(r=this._removePendings.size(),t=0;t<r;t++)i=this._removePendings.get(t),this._remove(i.l,i.s);delete this._removePendings}if(this._addPendings){for(r=this._addPendings.size(),t=0;t<r;t++)(i=this._addPendings.get(t)).a?this._ls.add(i,0):this._ls.add(i);delete this._addPendings}}}}),oe.PropertyChangeDispatcher=function(){this._dispatcher=new oe.EventDispatcher},oe.extend(oe.PropertyChangeDispatcher,Object,{addPropertyChangeListener:function(e,t,i){this._dispatcher.add(e,t,i)},removePropertyChangeListener:function(e,t){this._dispatcher.remove(e,t)},firePropertyChange:function(e,t,i){if(t==i)return!1;var r={property:e,oldValue:t,newValue:i,source:this};return this._dispatcher.fire(r),this.onPropertyChanged(r),!0},onPropertyChanged:function(e){}}),oe.Texture=function(e,i,r,a,n,o,s,l,h){oe.PropertyChangeDispatcher.call(this),this.id=oe.TextureIdCount++,this.name="",null!=e&&this.setImage(e),this.mipmaps=[],this.mapping=i!==t?i:new oe.UVMapping,this.wrapS=r!==t?r:oe.RepeatWrapping,this.wrapT=a!==t?a:oe.RepeatWrapping,this.magFilter=n!==t?n:oe.LinearFilter,this.minFilter=o!==t?o:oe.LinearMipMapLinearFilter,this.anisotropy=h!==t?h:1,this.format=s!==t?s:oe.RGBAFormat,this.type=l!==t?l:oe.UnsignedByteType,this.repeatX=1,this.repeatY=1,this.offsetX=0,this.offsetY=0,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},oe.extend(oe.Texture,oe.PropertyChangeDispatcher,{getUniqueCode:function(){if(!this._uniqueCode)if(fe.isImage(this._image)||"string"==typeof this._image||Oe.isArray(this._image))this._uniqueCode=this._imageSrc;else if(fe.isCanvas(this._image)){var e=this._image;e.__uniqueCode||(e.__uniqueCode=oe.id("texture")),this._uniqueCode=e.__uniqueCode}return this._uniqueCode},resetValue:function(){this.name="",this._image=null,this.mipmaps=[],this.mapping=new oe.UVMapping,this.wrapS=oe.RepeatWrapping,this.wrapT=oe.RepeatWrapping,this.magFilter=oe.LinearFilter,this.minFilter=oe.LinearMipMapLinearFilter,this.anisotropy=1,this.format=oe.RGBAFormat,this.type=oe.UnsignedByteType,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null,this._uniqueCode=null},clone:function(e,i){return e===t&&(e=new oe.Texture),null==i||i?e.setImage(this._image):e._image=this._image,e._imageSrc=this._imageSrc,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.flipX=this.flipX,e.unpackAlignment=this.unpackAlignment,e._uniqueCode=null,e},onloadTexture:function(){},setImageSrc:function(e){if("string"==typeof e)this._imageSrc=e;else if(Oe.isArray(e)){for(var t="",i=0;i<e.length;i++)"string"==typeof e[i]?t+=e:t+=e[i].src;this._imageSrc=t}else this._imageSrc=e.src},loadAllImages:function(e,t){for(var i=e.length,r=0,a=this,n=0;n<i;n++)!function(n){n.onload=function(){n.loaded=!0,n.onload=null,++r==i&&(a.onloadTexture(),a.firePropertyChange("image",t,a._image),e.loaded=!0)}}(e[n])},setImage:function(e){o=this._image;if(Oe.isArray(e)){for(var t,i="",r=[],a=0;a<e.length;a++)"string"==typeof e[a]?(i+=e,t=new Image,e[a].startsWith("data:image")||(t.crossOrigin="use-credentials"),t.src=e[a],r.push(t)):(i+=e[a].src,r.push(e[a]));this._imageSrc=i,this.loadAllImages(r,o),this._image=r}else if("string"==typeof e){if(this._image&&this._image.src===e)return;this._imageSrc=e;var n=new Image;e.startsWith("data:image")||(n.crossOrigin="use-credentials"),n.src=e,(s=this)._image=n,n.onload=function(e){n.loaded=!0,n.onload=null,s.onloadTexture(),s.firePropertyChange("image",o,n)}}else{if(this._image===e)return;this._imageSrc=e.src;var o=this._image;if(fe.isCanvas(e)&&(e.loaded=!0),e&&!e.loaded){var s=this;s._image=e;var l=e.onload;e.onload=function(t){l&&l.call(null,t),e.loaded=!0,e.onload=null,s.onloadTexture(),s.firePropertyChange("image",o,e)}}else this._image=e,this.firePropertyChange("image",o,e)}},getImage:function(){return this._image},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),oe.TextureIdCount=0,oe.PixelsTexture=function(e,t,i,r,a,n,o,s,l,h,c){oe.Texture.call(this,null,n,o,s,l,h,r,a,c),this.image={data:e,width:t,height:i}},oe.PixelsTexture.prototype=Object.create(oe.Texture.prototype),oe.PixelsTexture.prototype.clone=function(){var e=new oe.PixelsTexture;return oe.Texture.prototype.clone.call(this,e),e},oe.CompressedTexture=function(e,t,i,r,a,n,o,s,l){oe.Texture.call(this,null,t,i,r,a,n,o,s,l),this.image={width:0,height:0},this.flipY=!0,this.generateMipmaps=!1,this.anisotropy=16,this.setImage(e)},oe.CompressedTexture.prototype.getUniqueCode=function(){if(fe.isImage(this._image)||"string"==typeof this._image||Oe.isArray(this._image))return this._imageSrc+" "+this.type+"  "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy;if(fe.isCanvas(this._image)){var e=this._image;return e.__uniqueCode||(e.__uniqueCode=oe.id("texture")),e.__uniqueCode+" "+this.type+" "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy}},oe.CompressedTexture.prototype=Object.create(oe.Texture.prototype),oe.CompressedTexture.prototype.clone=function(){var e=new oe.CompressedTexture(this._image);return oe.Texture.prototype.clone.call(this,e),e},oe.CompressedTexture.prototype.setImage=function(e){var t=this._image;if(t!=e){this._imageSrc=e,this._image=e;var i=this,r=function(){i.loaded=!0,i.firePropertyChange("image",t,e),r=null},a=function(){console.error("LoadCompressedTexture Fail:"+e),a=null};oe.TextureUtils.loadCompressedTexture(e,this.mapping,r,a,this)}},oe.CompressedTexture.isDDSTexture=function(e){return!!e&&("string"==typeof e&&e.toLowerCase().endsWith(".dds"))};var be={pools:{},useTimes:{},size:0,setTexture:function(e,t){be.size++,be.pools[e]=t},getTexture:function(e){return be.pools[e]},useTexture:function(e){if(e){var t=e.id,i=be.useTimes[t]||0;i++,be.useTimes[t]=i}},unUseTexture:function(e){if(e){var t=e.id,i=be.useTimes[t]||0;if(i--,be.useTimes[t]=i,i<=0){var r=e.getUniqueCode();delete be.pools[r],delete be.useTimes[t];for(var a in be.pools)if(be.pools[a]==e){delete be.pools[a];break}be.size--,e.dispose()}}},clear:function(){this.pools={},this.useTimes={},this.size=0}};oe.TexturePool=be,oe.TexturePool.TestTexture=new oe.Texture,oe.SerializationSettings=function(){var e=oe.SerializationSettings;this.isDataBoxSerializable=e.isDataBoxSerializable,this.isStyleSerializable=e.isStyleSerializable,this.isClientSerializable=e.isClientSerializable,this.encodeURI=e.encodeURI,this._pm=oe.clone(e._pm),this._sm=oe.clone(e._sm),this._cm=oe.clone(e._cm)},function(){var e=oe.SerializationSettings;e.isDataBoxSerializable=!0,e.isStyleSerializable=!0,e.isClientSerializable=!0,e.encodeURI=!0,e._pm={},e._sm={},e._cm={},e.setPropertyType=function(t,i){e._pm[t]=i},e.getPropertyType=function(t){return e._pm[t]},e.setStyleType=function(t,i){e._sm[t]=i},e.getStyleType=function(t){return e._sm[t]},e.setClientType=function(t,i){e._cm[t]=i},e.getClientType=function(t){return e._cm[t]}}(),oe.extend(oe.SerializationSettings,Object,{setPropertyType:function(e,t){this._pm[e]=t},getPropertyType:function(e){return this._pm[e]},setStyleType:function(e,t){this._sm[e]=t},getStyleType:function(e){return this._sm[e]},setClientType:function(e,t){this._cm[e]=t},getClientType:function(e){return this._cm[e]}}),oe.Styles={_m:{},setStyle:function(e,t){return null==t?delete oe.Styles._m[e]:oe.Styles._m[e]=t,oe.Styles},getStyle:function(e){return oe.Styles._m[e]}},oe.Styles.MaterailType="S:m.type",oe.Styles.NormalType="S:m.normalType",oe.Styles.PREFIX_STYLE="S:",function(){var e=function(e,t){oe.SerializationSettings.setPropertyType(e,t)};e("combos","data.list"),e("name","cdata"),e("toolTip","cdata"),e("parent","data"),e("fromNode","data"),e("toNode","data"),e("alarmState","alarmstate"),e("vertices","list.vec3"),e("faces","serializeabe.list"),e("uvs","list.vec2"),e("position","vec3"),e("rotation","vec3"),e("scale","vec3"),e("location","point"),e("materialSize","number"),e("color","color"),e("ambient","color"),e("diffuse","color"),e("specular","color"),e("intensity","number"),e("distance","number"),e("type","number"),e("startClosed","boolean"),e("endClosed","boolean"),e("curveSegments","number"),e("amount","number"),e("vertical","boolean"),e("repeat","number"),e("centralized","boolean"),e("visible","boolean"),(e=function(e,t,i){null==i&&(i=null!=t?t instanceof oe.Vec2?"vec2":t instanceof oe.Vec3?"vec3":typeof t:"string"),oe.Styles.setStyle(e,t),oe.SerializationSettings.setStyleType(e,i)})("select.style","border"),e("select.width",1),e("select.color",65280),e("select.offset",0),e("outer.width",1),e("outer.offset",0),e("outer.color",null,"color"),e("m.type","basic"),e("m.color",16777215,"color"),e("m.side","front"),e("m.alphaTest",0),e("m.polygonOffset",!1),e("m.polygonOffsetFactor",0),e("m.polygonOffsetUnits",0),e("m.wireframe",!1),e("m.wireframeLinewidth",1),e("m.wireframeLinecolor",16777215,"color"),e("m.wireframeLineopacity",1),e("m.clipPlane",null,"vec4"),e("m.rimLightColor",null,"color"),e("m.rimLightScale",1),e("m.gradient",{}),e("m.gradientType",1),e("m.transparent",!1),e("m.opacity",1),e("m.visible",!0),e("m.depthTest",!0),e("m.depthMask",!0),e("m.alignment",new oe.Vec2(0,0)),e("m.linewidth",1),e("m.texture.image",null),e("m.texture.offset",new oe.Vec2(0,0)),e("m.texture.repeat",new oe.Vec2(1,1)),e("m.texture.wrapS",oe.RepeatWrapping),e("m.texture.wrapT",oe.RepeatWrapping),e("m.texture.flipX",!1),e("m.texture.flipY",!1),e("m.normalmap.image",null),e("m.envmap.image",null),e("m.specularmap.image",null),e("right.m.type","basic"),e("left.m.type","basic"),e("top.m.type","basic"),e("bottom.m.type","basic"),e("front.m.type","basic"),e("back.m.type","basic"),e("side.m.type","basic"),e("alarm.billboard.scale",null),e("alarm.billboard.position","top"),e("alarm.billboard.vertical",!1),e("annotation.class","tgl_annotation")}(),oe.extend(oe.Styles,Object,{}),oe.BoundingBox=function(e,i){this.min=e!==t?e:new he(1/0,1/0,1/0),this.max=i!==t?i:new he(-1/0,-1/0,-1/0)},oe.BoundingBox.prototype={constructor:oe.BoundingBox,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;i<r;i++)(t=e[i]).x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(e,t){var i=oe.BoundingBox.__v1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=0,this.max.x=this.max.y=this.max.z=0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new he).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new he).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e){return new he((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new he).copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return oe.BoundingBox.__v1.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){var t=e||new oe.BoundingSphere;return t.center=this.center(),t.radius=.5*this.size(oe.BoundingBox.__v0).length(),t},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},transform:function(e){var t=[oe.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),oe.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),oe.BoundingBox.__v1.set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),oe.BoundingBox.__v2.set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),oe.BoundingBox.__v3.set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),oe.BoundingBox.__v4.set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),oe.BoundingBox.__v5.set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),oe.BoundingBox.__v6.set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),oe.BoundingBox.__v7.set(this.max.x,this.max.y,this.max.z).applyMatrix4(e)];return this.makeEmpty(),this.setFromPoints(t),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new oe.BoundingBox).copy(this)}},oe.BoundingBox.__v0=new he,oe.BoundingBox.__v1=new he,oe.BoundingBox.__v2=new he,oe.BoundingBox.__v3=new he,oe.BoundingBox.__v4=new he,oe.BoundingBox.__v5=new he,oe.BoundingBox.__v6=new he,oe.BoundingBox.__v7=new he,oe.BoundingSphere=function(e,i){this.center=e!==t?e:new he,this.radius=i!==t?i:0},oe.BoundingSphere.prototype={constructor:oe.BoundingSphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var i=0,r=0,a=t.length;r<a;r++){var n=e.distanceToSquared(t[r]);i=Math.max(i,n)}return this.center=e,this.radius=Math.sqrt(i),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsBoundingSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new he;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new oe.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},transform:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new oe.BoundingSphere).copy(this)}},oe.Primitive=function(e,t){e=e||{},this.data=e,this.vertices=e.vertices,this.faces=e.faces,this.uvs=e.uvs,this.uv2s=e.uv2s,this.colors=e.colors||[],this.uniqueCode=t},oe.extend(oe.Primitive,Object,{clone:function(e){if(e){var t,i={};for(i.vertices=[],t=0;t<this.vertices.length;t++)i.vertices.push(this.vertices[t].clone());for(i.faces=[],t=0;t<this.faces.length;t++)i.faces.push(this.faces[t].clone());for(i.uvs=[],t=0;t<this.uvs.length;t++){for(var r=this.uvs[t],a=[],n=0;n<r.length;n++)a.push(r[n].clone);i.uvs.push(a)}for(i.uv2s=[],t=0;t<this.uv2s.length;t++)i.uv2s.push(this.uv2s[t].clone());return new oe.Primitive(i)}return new oe.Primitvie(this.data)}}),oe.PrimitiveCache={_cache:{},_useCount:{},getPrimitive:function(e){return e?oe.PrimitiveCache._cache[e]:null},setPrimitive:function(e,t){e&&(oe.PrimitiveCache._cache[e]=t)},usePrimitive:function(e){var t=oe.PrimitiveCache._useCount[e]||0;t++,oe.PrimitiveCache._useCount[e]=t},unUsePrimitive:function(e){var t=oe.PrimitiveCache._useCount[e]||0;--t<=0&&delete oe.PrimitiveCache._useCount[e]}},oe.PrimitiveGroupCache={},oe.Color=function(e){return e!==t&&this.set(e),this},oe.extend(oe.Color,Object,{r:1,g:1,b:1,getUniqueCode:function(){return""+this.r+this.g+this.b},set:function(e){switch(typeof e){case"number":this.setHex(e);break;case"string":this.setStyle(e)}},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return e.length&&(i=e[2],t=e[1],e=e[0]),this.r=e,this.g=t,this.b=i,this},setHSV:function(e,t,i){var r,a,n,o,s;return 0===i?this.r=this.g=this.b=0:(n=i*(1-t),o=i*(1-t*(a=6*e-(r=Math.floor(6*e)))),s=i*(1-t*(1-a)),0===r?(this.r=i,this.g=s,this.b=n):1===r?(this.r=o,this.g=i,this.b=n):2===r?(this.r=n,this.g=i,this.b=s):3===r?(this.r=n,this.g=o,this.b=i):4===r?(this.r=s,this.g=n,this.b=i):5===r&&(this.r=i,this.g=n,this.b=o)),this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e)){t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(oe.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},getHSV:function(e){var i,r,a=this.r,n=this.g,o=this.b,s=Math.max(Math.max(a,n),o),l=Math.min(Math.min(a,n),o),h=s;if(l===s)i=0,r=0;else{var c=s-l;r=c/s,i=a===s?(n-o)/c:n===s?2+(o-a)/c:4+(a-n)/c,(i/=6)<0&&(i+=1),i>1&&(i-=1)}return e===t&&(e={h:0,s:0,v:0}),e.h=i,e.s=r,e.v=h,e},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},clone:function(){return(new oe.Color).setRGB(this.r,this.g,this.b)},toString:function(){return this.getStyle()}}),oe.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oe.Data=function(e){if(oe.PropertyChangeDispatcher.call(this),this._childList=new _e,this._childMap={},this._clientMap={},e===t||null===e)this._id=oe.id("E");else if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)this._id=e;else{for(var i in e)if("clients"===i)for(var r in e.clients)this._clientMap[r]=e.clients[r];else"styles"===i?this.s(e.styles):null!=e[i]&&("id"===i?this._id=e[i]:this[oe.setter(i)]&&this[oe.setter(i)](e[i]));null==this._id&&(this._id=oe.id("E"))}},oe.extend(oe.Data,oe.PropertyChangeDispatcher,{___accessor:["name"],constructor:oe.Data,getId:function(){return this._id},onAlarmChange:function(){},onPropertyChange:function(e,t,i){},setGroupId:function(e){if(this._groupId!==e){var t=this._groupId;this._groupId=e,this.firePropertyChange("groupId",t,e)}},getGroupId:function(){return this._groupId},hasChildren:function(){return this._childList.size()>0},getChildren:function(){return this._childList},isDescendantOf:function(e){if(!e)return!1;if(!e.hasChildren())return!1;for(var t=this._parent;t;){if(e===t)return!0;t=t.getParent()}return!1},getParent:function(){return this._parent},getRoot:function(){var e=this._parent;return e&&null==e._parent?e:e&&null!=e._parent?e.getRoot(e):arguments[0]},setParent:function(e){if(!(this._isUpdatingParent||this._parent===e||this===e||e&&e.isDescendantOf(this))){var t=this._parent;this._parent=e,this._isUpdatingParent=!0,t&&t.removeChild(this),e&&e.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",t,e),this.onParentChanged(t,e)}},onParentChanged:function(e,t){},addChild:function(e,i){return i===t&&(i=this._childList.size()),!(!e||e===this)&&(!this._childMap[e.getId()]&&(!this.isDescendantOf(e)&&(e.getParent()&&e.getParent().removeChild(e),(i<0||i>this._childList.size())&&(i=this._childList.size()),this._childList.add(e,i),this._childMap[e._id]=e,e.setParent(this),this.firePropertyChange("children",null,e),this.onChildAdded(e,i),!0)))},onChildAdded:function(e,t){},clearChildren:function(){if(null!=this._childList&&this._childList.size()>0){var e=this;this._childList.toList().forEach(function(t){e.removeChild(t)})}},removeChild:function(e){if(!e)return!1;if(!this._childMap[e._id])return!1;var t=this._childList.remove(e);return delete this._childMap[e._id],this.firePropertyChange("children",e,null),e.setParent(null),this.onChildRemoved(e,t),!0},onChildRemoved:function(e,t){},c:function(e){if(e)for(var t in e)this.setClient(t,e[t])},setClient:function(e,t){if(null==e)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[e];return i===t?this:(null==t?delete this._clientMap[e]:this._clientMap[e]=t,this._clientMap[e]=t,this.firePropertyChange("C:"+e,i,t),this.onClientChanged(e,i,t),this)},getClient:function(e){return this._clientMap[e]},onClientChanged:function(e,t,i){},setPropertyValue:function(e,t){if(this[e]===t)return!1;var i=this[e];return i instanceof oe.Color&&null!=t?(i=i.clone(),t instanceof oe.Color?this[e].copy(t):this[e].set(t)):this[e]=t,!0}});var Me=1;oe.Element=function(e){var t=this._pickingId=Me++;this._pickingColor=[(t>>24&255)/255,(t>>16&255)/255,(t>>8&255)/255,(255&t)/255],this.styleMap={},this._visible=!0,this._selected=!1,this._selectable=!0,this._editable=!0,this.editing=!1,this.up=new he(0,1,0),this._position=new he(0,0,0),this._rotation=new he(0,0,0),this._scale=new he(1,1,1),this.eulerOrder=oe.defaultEulerOrder,this.rotationAutoUpdate=!0,this.matrix=new ue,this.worldMatrix=new ue,this.rotationWorldMatrix=new ue,this.matrixAutoUpdate=!1,this.worldMatrixNeedsUpdate=!0,this.quaternion=new oe.Quat,this.useQuaternion=!1,this._sizeFixed=!1,this._fixedSize=108,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this._vector=new he,this.renderDepth=null,this._attachId="",this._groupId=null,this.editTransformToParent=!1,this._alarmState=new oe.AlarmState(this),this._alarmBillboard=null,oe.Data.call(this,e)},oe.Element.__m1=new ue,oe.ElementIdCount=0,oe.extend(oe.Element,oe.Data,{IStyle:!0,___accessor:["visible","selected","selectable","editable","sizeFixed"],constructor:oe.Element,getAlarmState:function(){return this._alarmState},getDefaultInstance:function(){return this.constructor.defaultInstance===t&&(this.constructor.defaultInstance=new this.constructor),this.constructor.defaultInstance},onParentChanged:function(e,t){this.updateWorldMatrix(!0,!1)},onChildAdded:function(e,t){e.updateWorldMatrix(!0,!1)},onChildRemoved:function(e,t){e.updateWorldMatrix(!0,!1)},generatePrimitiveKey:function(){return null},serializeProperty:function(){},clear:function(e){},getSelectStyle:function(){return this.getStyle("select.style")},isSpaceChangedProperty:function(e){return"scale"===e||"position"===e||"rotation"===e},isStyleEquals:function(e,t,i){return null==t&&null==i||t===i},setStyle:function(e,t){if(null==e)return this;null==this.styleMap&&(this.styleMap={});var i=this.styleMap[e];return this.isStyleEquals(e,i,t)?this:(null==t?delete this.styleMap[e]:this.styleMap[e]=t,this.onStyleChanged(e,i,t),this.firePropertyChange(oe.Styles.PREFIX_STYLE+e,i,t),this)},c:function(e){if(e)for(var t in e)this.setClient(t,e[t])},s:function(e){if(null==e)return this;null==this.styleMap&&(this.styleMap={});var t,i,r,a={},n={};for(t in e)i=e[t],r=this.styleMap[t],this.isStyleEquals(t,r,i)||(null==i?delete this.styleMap[t]:this.styleMap[t]=i,n[t]=r,this.isMaterialStyle(t)&&(a[t]=[i,r]));this.onMaterialStylesChanged(a);for(t in e)this.firePropertyChange(oe.Styles.PREFIX_STYLE+t,n[t],this.styleMap[t]);return this},getStyle:function(e,t,i){null==i&&(i=!0);var r;return null!=this.styleMap&&(r=this.styleMap[e]),t&&(r=this.getCloneObject(r)),null==r&&i&&(r=this.getDefaultStyle(e,t)),r},getCloneObject:function(e){if(null==e)return null;if(oe.Utils.isArray(e)){for(var t=[],i=0;i<e.length;i++)t.push(this.getCloneObject(e[i]));return t}return e.clone?e.clone():e},getSideIndexMapping:function(){},setMaterialStyle:function(e,t){},setMaterialStyles:function(e){var t,i,r,a;for(var n in e)n.startsWith("m.")?t=n.substr(n.indexOf(".")+1):this.getSideIndexMapping()&&this.isSideStyle(r)?t=(r=r.substr(r.indexOf(".")+1)).substr(n.indexOf(".")+1):n.startsWith("alarm.billboard.")&&(a=!0),null==(i=e[n][0])?i=oe.Styles.getStyle(n):Oe.isArray(i)&&(i=i[0]),this._A97(this.material,t,i);a&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},onMaterialStylesChanged:function(e){this.setMaterialStyles(e)},isMaterialStyle:function(e){return!!e.startsWith("m.")||!(!this.getSideIndexMapping()||!this.isSideStyle(e))},onStyleChanged:function(e,t,i){if(e.startsWith("m."))this.setMaterialStyle(e,i);else if(this.getSideIndexMapping()&&this.isSideStyle(e)){var r=e.substr(0,e.indexOf("."));e=e.substr(e.indexOf(".")+1);var a=this.getSideMaterialIndex(r);this.setMaterialStyle(e,i,a)}else e.startsWith("alarm.billboard.")&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},textureMapping:{texture:"map",texture1:"map1",texture2:"map2",textureb:"blendMap",texturebp:"bumpMap",bumpmap:"bumpMap",lightMap:"lightMap",lightmap:"lightMap",normalmap:"normalMap",envmap:"envMap",specularmap:"specularMap"},_A97:function(e,t,i){if(t.startsWith("texture.")||t.startsWith("texture1.")||t.startsWith("texture2.")||t.startsWith("textureb.")||t.startsWith("texturen.")||t.startsWith("texturebp.")||t.startsWith("lightmap")||t.startsWith("envmap")||t.startsWith("normalmap")||t.startsWith("specularmap")){var r=t.substr(0,t.indexOf(".")),a=t.substr(t.indexOf(".")+1);if("offset"===a||"repeat"===a)return void e.setPropertyValue(a,this.getCloneObject(i));var n=this.textureMapping[r],o=e[n],s=oe.TexturePool.TestTexture;if("image"===a){var l=i;if(t.startsWith("envmap")&&Oe.isArray(l))for(var h=0;h<l.length;h++)if(null==l[h]){l=null;break}if(null==o&&null!=l){s.resetValue(),s._image=l,s.setImageSrc(l);c=s.getUniqueCode();null==(u=oe.TexturePool.getTexture(c))&&(u=this.createTexture(l),oe.TexturePool.setTexture(c,u)),e.setMap(u,n)}else if(null==l)e.setMap(null,n);else{o.clone(s,!1),s._image=l,s.setImageSrc(l);var c=s.getUniqueCode(),u=oe.TexturePool.getTexture(c);u===o||(null==u&&(u=this.createTexture(l),o.clone(u,!1),u.setImage(l),oe.TexturePool.setTexture(c,u)),e.setMap(u,n))}}else null!=o&&(o[a]=i)}else"type"===t&&e.setType?e.setType(i):e.setPropertyValue(t,this.getCloneObject(i))},createTexture:function(e){return oe.CompressedTexture.isDDSTexture(e)?new oe.CompressedTexture(e):new oe.Texture(e)},getDefaultStyle:function(e,t){if(null==e)return null;if(e.startsWith("m.")){if(this.material.materials){var i=[],r=e.substr(e.indexOf(".")+1),a=this.material.materials;a=a||[this.material];for(u=0;u<a.length;u++){m=a[u];if(r.startsWith("texture.")||r.startsWith("texture1.")||r.startsWith("texture2.")||r.startsWith("textureb.")||r.startsWith("texturen.")||r.startsWith("texturebp.")||r.startsWith("lightmap")||r.startsWith("envmap")||r.startsWith("normalmap")||r.startsWith("specularmap")){var n=r.substr(0,r.indexOf(".")),o=r.substr(r.indexOf(".")+1),s=(r.substr(r.indexOf(".")+1),m[this.textureMapping[n]]);if(s)if("image"===o)if(Oe.isArray(s._image)){var l=[];i.push(l);for(var h=0;h<s._image.length;h++)l.push(s._image[h].src)}else i.push(s._image.src);else"offset"===o||"repeat"===o?i.push(m[o]):i.push(m.map[o]);else i.push(oe.Styles.getStyle(e))}else{d=oe.Styles.getStyle(e);i.push(null==d?m[r]:d)}}t&&(i=this.getCloneObject(i));for(var c=!0,u=0;u<i.length;u++)if(0!=i.indexOf(i[u])){c=!1;break}return c?i[0]:i}return oe.Styles.getStyle(e)}if(this.isSideStyle(e)){var f=e.substr(0,e.indexOf(".")),r=(e=e.substr(e.indexOf(".")+1)).substr(e.indexOf(".")+1),p=this.getSideMaterialIndex(f);if(null!=p){var d,m=this.material.materials[p];return r.startsWith("texture.")?m.map&&(d="texture.image"===r?m.map._image.src:m.map[r]):d=m[r],t&&(d=this.getCloneObject(d)),d}}return oe.Styles.getStyle(e)},isSideStyle:function(e){if(-1===e.indexOf("."))return!1;var i=this.getSideIndexMapping();return!!i&&i[e.substr(0,e.indexOf("."))]!==t},setUp:function(e,t,i){var r;if(3===arguments.length){if(this.up.x===e&&this.up.y===t&&this.up.z===i)return;r=new he(e,t,i)}else{if(this.up.x===e.x&&this.up.y===e.y&&this.up.z===e.z)return;r=e}var a=this.up;this.up=r,this.onUpChanged(a,r),this.firePropertyChange("up",a,r)},getUp:function(){return this.up},onUpChanged:function(e,t){},checkNumber:function(e,t,i,r){Oe.isNaN(e)&&console.error(r+",x is not a number"),Oe.isNaN(t)&&console.error(r+",y is not a number"),Oe.isNaN(i)&&console.error(r+",z is not a number")},invalidateTexture:function(e){var t,i,r,a=this.material;if(null!=e&&a instanceof oe.ArrayMaterial){if("string"==typeof e){var n=this.getSideIndexMapping();if(null!=n&&(e=n[e]),null==e)return}if("number"!=typeof e)return;r=a instanceof oe.ArrayMaterial?a.materials[e]:a,this._dirtyMaterialTexture(r)}else if(a instanceof oe.ArrayMaterial)for(i=a.materials,t=0;t<i.length;t++)r=i[t],this._dirtyMaterialTexture(r);else this._dirtyMaterialTexture(a)},_dirtyMaterialTexture:function(e){null!=e&&(e.map instanceof oe.Texture&&this._dirtyTexture(e.map),e.lightMap instanceof oe.Texture&&this._dirtyTexture(e.lightMap))},_dirtyTexture:function(e){var t=e._image;e.firePropertyChange("image",null,t)},p:function(e,t,i){if(0===arguments.length)return this.getPosition();3===arguments.length?this.setPosition(e,t,i):this.setPosition(e)},checkPosition:function(e){return!0},setPosition:function(e,t,i){var r;if(3===arguments.length){if(this._position.x===e&&this._position.y===t&&this._position.z===i)return;this.checkNumber(e,t,i,"setPosition"),r=new he(e,t,i)}else{if(this._position.x===e.x&&this._position.y===e.y&&this._position.z===e.z)return;if(!(e instanceof he))throw"Element.setPosition : position is not instanceof TGL.Vec3";r=e}if(this.checkPosition(r)){var a=this._position;this._position=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("position",a,r)}},getPosition:function(e){return e==t&&(e=!0),e?this._position.clone():this._position},setPositionX:function(e){if(this._position.x!==e){this.checkNumber(e,0,0,"setPositionX");var t=this._position.x,i=this._position.clone();if(i.x=e,!this.checkPosition(i))return!1;this._position.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionX",t,e)}},setX:function(e){this.setPositionX(e)},getPositionX:function(){return this._position.x},getX:function(){return this.getPositionX()},setPositionY:function(e){if(this._position.y!==e){this.checkNumber(0,e,0,"setPositionY");var t=this._position.y,i=this._position.clone();if(i.y=e,!this.checkPosition(i))return!1;this._position.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionY",t,e)}},setY:function(e){this.setPositionY(e)},getPositionY:function(){return this._position.y},getY:function(){return this.getPositionY()},setPositionZ:function(e){if(this._position.z!==e){this.checkNumber(0,0,e,"setPositionZ");var t=this._position.z,i=this._position.clone();if(i.z=e,!this.checkPosition(i))return!1;this._position.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionZ",t,e)}},setZ:function(e){this.setPositionZ(e)},getPositionZ:function(){return this._position.z},getZ:function(){return this.getPositionZ()},setScale:function(e,t,i){var r;if(3===arguments.length){if(this._scale.x===e&&this._scale.y===t&&this._scale.z===i)return;this.checkNumber(e,t,i,"setScale"),r=new he(e,t,i)}else{if(this._scale.x===e.x&&this._scale.y===e.y&&this._scale.z===e.z)return;if(!(e instanceof he))throw"Element.setScale : scale is not instanceof TGL.Vec3";r=e}var a=this._scale;r.x=r.x||1,r.y=r.y||1,r.z=r.z||1,this._scale=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scale",a,r)},getScale:function(e){return e==t&&(e=!0),e?this._scale.clone():this._scale},setScaleX:function(e){if(this._scale.x!==e){this.checkNumber(e,0,0,"setScalX");var t=this._scale.x;this._scale.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleX",t,e)}},getScaleX:function(){return this._scale.x},setScaleY:function(e){if(this._scale.y!==e){this.checkNumber(0,e,0,"setScaleY");var t=this._scale.y;this._scale.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleY",t,e)}},getScaleY:function(){return this._scale.y},setScaleZ:function(e){if(this._scale.z!==e){this.checkNumber(0,0,e,"setScaleZ");var t=this._scale.z;this._scale.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleZ",t,e)}},getScaleZ:function(){return this._scale.z},setRotation:function(e,t,i){var r;if(3===arguments.length){if(this._rotation.x===e&&this._rotation.y===t&&this._rotation.z===i)return;this.checkNumber(e,t,i,"setRotation"),r=new he(e,t,i)}else{if(this._rotation.x===e.x&&this._rotation.y===e.y&&this._rotation.z===e.z)return;if(!(e instanceof he))throw"Element.setRotation : rotation is not instanceof TGL.Vec3";r=e}var a=this._rotation;this._rotation=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotation",a,r)},getRotation:function(e){return e==t&&(e=!0),e?this._rotation.clone():this._rotation},setRotationX:function(e){if(this._rotation.x!==e){this.checkNumber(e,0,0,"setRotationX");var t=this._rotation.x;this._rotation.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationX",t,e)}},getRotationX:function(){return this._rotation.x},setRotationY:function(e){if(this._rotation.y!==e){this.checkNumber(0,e,0,"setRotationY");var t=this._rotation.y;this._rotation.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationY",t,e)}},getRotationY:function(){return this._rotation.y},setRotationZ:function(e){if(this._rotation.z!==e){this.checkNumber(0,0,e,"setRotationZ");var t=this._rotation.z;this._rotation.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationZ",t,e)}},getRotationZ:function(){return this._rotation.z},applyMatrix:function(e){var t=this.matrix.clone();this.matrix.multiplyMatrices(e,this.matrix),this._scale.getScaleFromMatrix(this.matrix);var i=(new ue).extractRotation(this.matrix);this._rotation.setEulerFromRotationMatrix(i,this.eulerOrder),this._position.getPositionFromMatrix(this.matrix),this.updateWorldMatrix(!0,!1),this.firePropertyChange("matrix",t,this.matrix)},setMatrix:function(e){var t=this.matrix.clone();this.matrix.copy(e),this._scale.getScaleFromMatrix(this.matrix);var i=(new ue).extractRotation(this.matrix);this._rotation.setEulerFromRotationMatrix(i,this.eulerOrder),this._position.getPositionFromMatrix(this.matrix),this.updateWorldMatrix(!0,!1),this.firePropertyChange("matrix",t,this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.setPosition(this._position.clone().add(t.multiplyScalar(e)))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},rotateFromAxis:function(e,t,i){t=t.clone().applyMatrix4(this.matrix),e=e.clone().normalize().applyMatrix4((new ue).extractRotation(this.matrix));var r=(new ue).makeRotationAxisAndCenter(e,i,t);this.applyMatrix(r)},rotateFromWorldAxis:function(e,t){var i=new ue;i.makeRotationAxis(e.normalize(),t),i.multiply(this.matrix),this.matrix=i;var r=(new ue).extractRotation(this.matrix),a=new he;a.setEulerFromRotationMatrix(r,this.eulerOrder),this.setRotation(a)},getEulerAngles:function(){return this.matrix.getEulerAngles()},rotateFromWorldXAxis:function(e){this.rotateFromWorldAxis(new he(1,0,0),e)},rotateFromWorldYAxis:function(e){this.rotateFromWorldAxis(new he(0,1,0),e)},rotateFromWorldZAxis:function(e){this.rotateFromWorldAxis(new he(0,0,1),e)},getRelativeTransform:function(e){if(e instanceof oe.Element){var t=(new ue).getInverse(e.matrix.clone()),i=(new ue).multiplyMatrices(t,this.matrix.clone());return{position:(new he).getPositionFromMatrix(i),rotation:(new he).setEulerFromRotationMatrix(i),scale:(new he).getScaleFromMatrix(i),matrix:i}}return null},localToWorld:function(e){return null==this._parent?e:e.clone().applyMatrix4(this._parent.worldMatrix)},localToWorld2:function(e){return e.clone().applyMatrix4(this.worldMatrix)},getWorldPosition:function(){return this.worldMatrix.getPosition()},direction:function(e){var t=e.applyMatrix4((new ue).extractRotation(this.worldMatrix));return t.normalize(),t},frontDirection:function(){var e=new he(0,0,1);return(e=e.applyMatrix4((new ue).extractRotation(this.worldMatrix))).normalize(),e},worldPosition:function(e,t){return t=t>0?t:e.length(),this.worldMatrix.getPosition().add(this.direction(e).multiplyScalar(t))},frontWorldPosition:function(e){return e=e>0?e:1,this.worldMatrix.getPosition().add(this.frontDirection().multiplyScalar(e))},worldToLocal:function(e){return e.clone().applyMatrix4(oe.Element.__m1.getInverse(this.worldMatrix))},lookAt:function(e,t){this.matrix.lookAt(e,this._position,t||this.up),this.rotationAutoUpdate&&(!1===this.useQuaternion?this._rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1])),this.worldMatrixNeedsUpdate=!0},iterator:function(e){e(this),this._childList&&this._childList.forEach(function(t){t.iterator(e)})},getChildByName:function(e,i){for(var r=0,a=this.children.length;r<a;r++){var n=this.children[r];if(n.name===e)return n;if(!0===i&&(n=n.getChildByName(e,i))!==t)return n}return t},getDescendants:function(e){e===t&&(e=[]);var i=this.getChildren().toArray();Array.prototype.push.apply(e,i);for(var r=0,a=i.length;r<a;r++)i[r].getDescendants(e);return e},fixSize:function(e){if(this._sizeFixed){this.updateWorldMatrix();var t=new he,i=new he;t.getPositionFromMatrix(this.worldMatrix),e.updateWorldMatrix(),i.getPositionFromMatrix(e.worldMatrix);var r=t.distanceTo(i)/this._fixedSize;0===r&&(r=1e-5),this.setScale(r,r,r)}},updateMatrix:function(){this.matrix.setPosition(this._position),!1===this.useQuaternion?this.matrix.setRotationFromEuler(this._rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this._scale.x&&1===this._scale.y&&1===this._scale.z||this.matrix.scale(this._scale),this.worldMatrixNeedsUpdate=!0},updateWorldMatrix:function(e,i){if(i=i==t||i,!0===this.matrixAutoUpdate&&this.updateMatrix(),!0===this.worldMatrixNeedsUpdate||!0===e){!1===this.matrixAutoUpdate&&this.updateMatrix();var r=this.worldMatrix.clone();this._parent==t?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0,r.equals(this.worldMatrix)||(i&&this.firePropertyChange("worldMatrix",r,this.worldMatrix),this.updateCameraMatrix&&this.updateCameraMatrix(!1))}this._childList.forEach(function(t){t.updateWorldMatrix(e)})},cloneCallback:function(e){},clonePrefab:function(e){var i=new se.Entity;e===t&&(e=!0),i.name=this.name,null==i.up&&(i.up=new he(0,1,0)),i.up.copy(this.up),i._position.copy(this._position),i._rotation.copy(this._rotation),i.eulerOrder=this.eulerOrder,i._scale.copy(this._scale),i.renderDepth=this.renderDepth,i.rotationAutoUpdate=this.rotationAutoUpdate,i.matrix.copy(this.matrix),i.worldMatrix.copy(this.worldMatrix),i.rotationWorldMatrix.copy(this.rotationWorldMatrix),i.matrixAutoUpdate=this.matrixAutoUpdate,i.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,i.quaternion.copy(this.quaternion),i.useQuaternion=this.useQuaternion,i._visible=this._visible,i.castShadow=this.castShadow,i.receiveShadow=this.receiveShadow,i.frustumCulled=this.frustumCulled,i.styleMap=i.styleMap||{},e&&this._childList&&this._childList.forEach(function(t){i.addChild(t.clonePrefab(e))}),i.vertices=this.vertices,i.faces=this.faces,i.uvs=this.uvs,i.uv2s=this.uv2s,this.primitive&&(i.primitive=this.primitive,i.data=this.primitive.data,i.computed=!0);for(var r in this.styleMap)i.styleMap[r]=this.getCloneObject(this.styleMap[r]);if(null!=this._clientMap)for(var a in this._clientMap)i.setClient(a,this._clientMap[a]);if(i.material=this.material,this.material instanceof oe.ArrayMaterial){i.material=new oe.ArrayMaterial,i.material.materials=[];for(var n=0;n<this.material.materials.length;n++)i.material.materials.push(this.material.materials[n])}return i.materialSize=this.getMaterialSize?this.getMaterialSize():1,i.boundingBox=this.boundingBox,i},createCloneObject:function(){return this.constructor?new this.constructor:new oe.Element},clone:function(e,i,r){if("boolean"==typeof e&&(r=i,i=e,e=t),e==t&&(e=this.createCloneObject()),r===t&&(r=!0),e.name=this.name,null==e.up&&(e.up=new he(0,1,0)),e.up.copy(this.up),e._position.copy(this._position),e._rotation.copy(this._rotation),e.eulerOrder=this.eulerOrder,e._scale.copy(this._scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.worldMatrix.copy(this.worldMatrix),e.rotationWorldMatrix.copy(this.rotationWorldMatrix),e.matrixAutoUpdate=this.matrixAutoUpdate,e.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e._visible=this._visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.styleMap=e.styleMap||{},r&&this._childList&&this._childList.forEach(function(t){e.addChild(t.clone(i,r))}),this.constructor){var a=this.constructor.prototype.__accessor,n=this.constructor.prototype.__bool;if(a&&a.length>0)for(u=0;u<a.length;u++){var o=a[u],s=oe.getter(o,n),l=oe.setter(o);"vertices"===o?e.vertices=this.vertices:"faces"===o?e.faces=this.faces:e[l]&&e[l](this[s]())}}if(i&&this.vertices){var h=e,c=this.vertices;h.vertices=[],h.faces=[],h.uvs=[];for(var u=0,f=c.length;u<f;u++)h.vertices.push(c[u].clone());for(var p=this.faces,u=0,f=p.length;u<f;u++)h.faces.push(p[u].clone());for(var d=this.uvs,u=0,f=d.length;u<f;u++){for(var m=d[u],g=[],v=0,y=m.length;v<y;v++)g.push(new oe.Vec2(m[v].x,m[v].y));h.uvs.push(g)}}for(var A in this.styleMap)e.setStyle(A,this.getCloneObject(this.styleMap[A]));if(null!=this._clientMap)for(var x in this._clientMap)e.setClient(x,this._clientMap[x]);return e.cloneCallback(i),e},createSelectionCube:function(e){if(null==this.boundingBox&&this.computeBoundingBox(),e._attachId=this._id+"_selection",null==this.selectionData){var t=this.getStyle("select.offset"),i=this.boundingBox.min,r=this.boundingBox.max,a=(new he).center(i,r);e.width=r.x-i.x+t,e.height=r.y-i.y+t,e.depth=r.z-i.z+t,e.offset=a,e.computed=!1;e.computeNodeData();this.selectionData=e.data,ye(e,!0),this.selectionData.primitive=e.primitive,this.selectionData.groups=e.groups,this.selectionData.vertices=e.vertices}else{var n=this.selectionData;e.primitive=n.primitive,e.data=n,e.vertices=n.vertices,e.uvs=n.uvs,e.faces=n.faces,e.groups=n.groups}this.updateMatrix(!0),e._position.copy(this._position),e._scale.copy(this._scale),e._rotation.copy(this._rotation),e.useQuaternion=this.useQuaternion,e.quaternion=this.quaternion,e.worldMatrix=this.worldMatrix,e._parent=this.getParent(),e.updateMatrix(!0);var o=e.material;return o.wireframeLinewidth=this.getStyle("select.width"),o.color.set(this.getStyle("select.color")),o.wireframeLinecolor.set(this.getStyle("select.color")),e},createPropagateAlarmCube:function(e){if(null==this.boundingBox&&this.computeBoundingBox(),e._attachId=this._id,null==this.propagateAlarmData){var t=this.getStyle("outer.offset"),i=this.boundingBox.min,r=this.boundingBox.max;e.width=r.x-i.x+t,e.height=r.y-i.y+t,e.depth=r.z-i.z+t,e.computed=!1,e.computeNodeData(),this.propagateAlarmData=e.data,ye(e,!0),this.propagateAlarmData.primitive=e.primitive,this.propagateAlarmData.groups=e.groups;for(var a=(new he).center(i,r),n=0;n<e.vertices.length;n++)e.vertices[n].add(a);this.propagateAlarmData.vertices=e.vertices}else{var o=this.propagateAlarmData;e.primitive=o.primitive,e.data=o,e.vertices=o.vertices,e.uvs=o.uvs,e.faces=o.faces,e.groups=o.groups}this.updateMatrix(!0),e._position.copy(this._position),e._scale.copy(this._scale),e._rotation.copy(this._rotation),e.useQuaternion=this.useQuaternion,e.quaternion=this.quaternion,e.worldMatrix=this.worldMatrix,e._parent=this.getParent(),e.updateMatrix(!0);var s=e.material;s.wireframeLinewidth=this.getStyle("outer.width");var l=this.getAlarmState().getPropagateSeverity();return s.wireframeLinecolor.set(l.color),e},onAlarmChange:function(e,t){oe.Data.prototype.onAlarmChange.call(this,e,t);var i=this,r=this._alarmState.getHighestNativeAlarmSeverity();r?this.setStyle("m.alarmColor",new oe.Color(r.color)):this.setStyle("m.alarmColor",null),setTimeout(function(){var e=i._alarmState.getPropagateSeverity();e||(e=i._alarmState.getHighestNativeAlarmSeverity());var t=i._parent,r=!1;null!=t&&t._alarmState?t._alarmState.getPropagateSeverity()||(r=!0):r=!0,e&&r?(null==i._alarmBillboard&&i.setAlarmBillboard(new oe.Billboard),i.setAlarmBillboardImageAndColor(i._alarmBillboard,e)):i.setAlarmBillboard(null)},10)},setAlarmBillboardImageAndColor:function(e,t){e.setStyle("m.texture.image",oe.ImageCache.AlarmBillboardImage),e.setStyle("m.color",t.color),e.setStyle("m.alignment",oe.BillboardAlignment.bottomCenter)},_setAlarmBillboardPositionAndSize:function(e){null==this.boundingBox&&this.computeBoundingBox();var t=this.getStyle("alarm.billboard.position"),i=this.boundingBox,r=i.min,a=i.max,n=i.center(),o=i.size();"topLeft"===t?e._position.set(r.x,a.y,n.z):"topRight"===t?e._position.set(a.x,a.y,n.z):"topBack"===t?e._position.set(n.x,a.y,r.z):"topFront"===t?e._position.set(n.x,a.y,a.z):e._position.set(n.x,a.y,n.z);var s=this.getStyle("alarm.billboard.scale");s instanceof he?e._scale.copy(s):e._scale.set(o.x/2,o.x/2,1);var l=this.getStyle("alarm.billboard.vertical");e.setStyle("m.vertical",l)},setAlarmBillboard:function(e){if(this._alarmBillboard!=e){var t=this._alarmBillboard;e?(this._alarmBillboard=e,e.setParent(this),e.setClient("alarmBillboard",!0),this._setAlarmBillboardPositionAndSize(e)):(this._alarmBillboard.setParent(null),delete this._alarmBillboard),this.firePropertyChange("alarmBillboard",t,e)}}}),oe.Annotation=function(e,t,i){oe.Element.call(this,i),this._label=e,this._text=t,this._cameraPosition=null},oe.extend(oe.Annotation,oe.Element,{___accessor:["label","text","cameraPosition"]}),oe.Node=function(e){this.name="",this.computed=!1,this.selectionData=null,this.renderGroup=[],this.primitive=null,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.colors=this.colors||[],this.normals=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.computeNodeData(),oe.Element.call(this,e)},oe.extend(oe.Node,oe.Element,{__accessor:["vertices","faces","uvs","linkAgent"],__SizePropeties:[],setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.elementsNeedUpdate=e,this.uvsNeedUpdate=e,this.normalsNeedUpdate=e,this.colorsNeedUpdate=e},getLinks:function(){return this._links},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(e){this._allLinks||(this._allLinks=new _e),this._fromLinks||(this._fromLinks=new _e),this._allLinks.add(e),this._fromLinks.add(e),this._resetLinkSet()},_addToLink:function(e){this._allLinks||(this._allLinks=new _e),this._toLinks||(this._toLinks=new _e),this._allLinks.add(e),this._toLinks.add(e),this._resetLinkSet()},_removeFromLink:function(e){this._allLinks.remove(e),this._fromLinks.remove(e),0===this._allLinks.size()&&delete this._allLinks,0===this._fromLinks.size()&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(e){this._allLinks.remove(e),this._toLinks.remove(e),0===this._allLinks.size()&&delete this._allLinks,0===this._toLinks.size()&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){if(delete this._loopedLinks,this._allLinks&&0!==this._allLinks.size()){var e;this._allLinks.forEach(function(t){t.isLooped()&&(e||(e={}),e[t._id]||(this._loopedLinks||(this._loopedLinks=new _e),this._loopedLinks.add(t),e[t._id]=t))},this),e?(this._links=new _e,this._allLinks.forEach(function(t){e[t._id]?!1!==e[t._id]&&(e[t._id]=!1,this._links.add(t)):this._links.add(t)},this)):this._links=this._allLinks}else delete this._links},getLinkOffset:function(e){return new se.Vec3(0,0,0)},getLinkExtend:function(e){return new se.Vec3(0,0,0)},clearLinkOrthogonal:function(e,t){return!1},clearLinkExtend:function(e,t){return!1},needUpdate:function(){return this.verticesNeedUpdate||this.elementsNeedUpdate||this.uvsNeedUpdate||this.normalsNeedUpdate||this.colorsNeedUpdate},getVerticesWithChildren:function(e,t){function i(i){i.applyMatrix4(e),t.push(i)}null==t&&(t=[]),null==e&&(e=new ue);if(this instanceof oe.Node){if(null!=this.vertices&&0!=this.vertices.length){var r=this.getBoundingBox(),a=r.min,n=r.max;i(a.clone()),i(n.clone()),i(new he(a.x,a.y,n.z)),i(new he(a.x,n.y,a.z)),i(new he(n.x,a.y,a.z)),i(new he(n.x,n.y,a.z)),i(new he(n.x,a.y,n.z)),i(new he(a.x,n.y,n.z))}for(var o=0;o<(this._childList?this._childList.size():0);o++){var s=this._childList.get(o),l=new ue;l.multiplyMatrices(e,s.matrix.clone()),s.getVerticesWithChildren&&s.getVerticesWithChildren(l,t)}}return t},getBoundingBoxWithChildren:function(e){var t=this.getVerticesWithChildren();if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r.getParent()===this.getParent()&&r!==this){var a=(new ue).getInverse(this.matrix.clone()),n=(new ue).multiplyMatrices(a,r.matrix.clone());t=t.concat(r.getVerticesWithChildren(n))}}var o=new oe.BoundingBox;return o.setFromPoints(t),o},getWorldBoundingBox:function(){for(var e=[],t=0;t<this.vertices.length;t++){var i=this.vertices[t].clone();i.applyMatrix4(this.worldMatrix),e.push(i)}var r=new oe.BoundingBox;return r.setFromPoints(e),r},getBoundingBox:function(){return null==this.boundingBox&&this.computeBoundingBox(),this.boundingBox},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new oe.BoundingBox),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new oe.BoundingSphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},createCanvasSelectionCube:function(){return null==this._csc&&(this._csc=new Te,this._csc.material=new oe.EntityMaterial,this._csc.material.wireframe=!0),this.createSelectionCube(this._csc),this._csc},mergeVertices:function(){var e,i,r,a,n,o,s,l={},h=[],c=[],u=Math.pow(10,4);for(this.__tmpVertices=t,null==this.vertices&&console.log("vertices is null"),r=0,a=this.vertices.length;r<a;r++)e=this.vertices[r],l[i=[Math.round(e.x*u),Math.round(e.y*u),Math.round(e.z*u)].join("_")]===t?(l[i]=r,h.push(this.vertices[r]),c[r]=h.length-1):c[r]=c[l[i]];var f=[];for(r=0,a=this.faces.length;r<a;r++)if((n=this.faces[r])instanceof Pe){n.a=c[n.a],n.b=c[n.b],n.c=c[n.c],o=[n.a,n.b,n.c];for(var p=-1,d=0;d<3;d++)if(o[d]==o[(d+1)%3]){p=d,f.push(r);break}}else if(n instanceof Ce){n.a=c[n.a],n.b=c[n.b],n.c=c[n.c],n.d=c[n.d],o=[n.a,n.b,n.c,n.d];for(var p=-1,d=0;d<4;d++)o[d]==o[(d+1)%4]&&(p>=0&&f.push(r),p=d);if(p>=0){o.splice(p,1);var m=new Pe(o[0],o[1],o[2],n.normal,n.color,n.materialIndex);(s=this.uvs[r])&&s.splice(p,1),n.vertexNormals&&n.vertexNormals.length>0&&(m.vertexNormals=n.vertexNormals,m.vertexNormals.splice(p,1)),n.vertexColors&&n.vertexColors.length>0&&(m.vertexColors=n.vertexColors,m.vertexColors.splice(p,1)),this.faces[r]=m}}for(r=f.length-1;r>=0;r--);var g=this.vertices.length-h.length;return this.vertices=h,g},computeVertexNormals:function(e){var i,r,a,n,o,s;if(this.__tmpVertices===t){for(this.__tmpVertices=new Array(this.vertices.length),s=this.__tmpVertices,i=0,r=this.vertices.length;i<r;i++)s[i]=new oe.Vec3;for(a=0,n=this.faces.length;a<n;a++)(o=this.faces[a]).vertexNormals=[new oe.Vec3,new oe.Vec3,new oe.Vec3]}else for(s=this.__tmpVertices,i=0,r=this.vertices.length;i<r;i++)s[i].set(0,0,0);if(e){var l,h,c,u=new oe.Vec3,f=new oe.Vec3;new oe.Vec3,new oe.Vec3,new oe.Vec3;for(a=0,n=this.faces.length;a<n;a++)o=this.faces[a],l=this.vertices[o.a],h=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,h),f.subVectors(l,h),u.cross(f),s[o.a].add(u),s[o.b].add(u),s[o.c].add(u),o.d!=t&&s[o.d].add(u)}else for(a=0,n=this.faces.length;a<n;a++)s[(o=this.faces[a]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(i=0,r=this.vertices.length;i<r;i++)s[i].normalize();for(a=0,n=this.faces.length;a<n;a++)(o=this.faces[a]).vertexNormals[0].copy(s[o.a]),o.vertexNormals[1].copy(s[o.b]),o.vertexNormals[2].copy(s[o.c]),o.d!=t&&(o.vertexNormals[3]=s[o.d].clone())},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;e<t;e++)(i=this.faces[e]).centroid=i.centroid||new he,null==i.centroid&&console.log("fdasfdsa"),i.centroid.set||(i.centroid=new he),i.centroid.set(0,0,0),i instanceof Pe?(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof Ce&&(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.add(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,i,r,a,n,o=new he,s=new he;for(e=0,t=this.faces.length;e<t;e++)i=this.faces[e],r=this.vertices[i.a],a=this.vertices[i.b],n=this.vertices[i.c],o.subVectors(n,a),s.subVectors(r,a),o.cross(s),o.normalize(),i.normal.copy||(i.normal=new he),i.normal.copy(o)},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;i<r;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeVertex:function(){},computePrimitive:function(){},generalteGroup:function(){},getMatetial:function(){return this.material},computeNodeMaterial:function(e){},cacheNodeMaterial:function(e){},needComputeVertexNormal:function(){return!0},needComputeLineDistance:function(){return!1},computeNodeData:function(e){if(!1===this.computed){var t=this.generatePrimitiveKey();this._attachId&&(t+="_"+this._attachId);var i=oe.PrimitiveCache.getPrimitive(t),r=!1;if(i)this.primitive&&oe.PrimitiveCache.unUsePrimitive(i),this.computeNodeMaterial(i);else{var a=this.computeData();if(this.needComputeVertexNormal()&&(oe.Node.prototype.mergeVertices.call(a),oe.Node.prototype.computeFaceNormals.call(a),oe.Node.prototype.computeVertexNormals.call(a,!0)),(null==a.uv2s||0==a.uv2s.length)&&(a.uv2s=[],null!=a.uvs&&a.uvs.length>0))for(var n=0;n<a.uvs.length;n++){for(var o=[],s=a.uvs[n],l=0;l<s.length;l++)o.push(s[l].clone());a.uv2s.push(o)}i=new oe.Primitive(a,t),oe.PrimitiveCache.setPrimitive(t,i),this.cacheNodeMaterial(i),r=!0}return oe.PrimitiveCache.usePrimitive(i),this.primitive=i,this.data=i.data,this.vertices=i.vertices,this.faces=i.faces,this.uvs=i.uvs,this.uv2s=i.uv2s,this.colors=i.colors,this.needComputeLineDistance()&&(this.computeLineDistances(),this.data.lineDistances=this.lineDistances),this.computed=!0,r}},computeData:function(){var e={vertices:[],faces:[],uv2s:[],uvs:[]};return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e,e},setMaterial:function(e,t,i){var r=t.getUniqueCode?t.getUniqueCode():null,a=_t.getMaterial(r);a?(this.material.materials[e]=a,_t.useMaterial(a)):(this.material.materials[e]=t,_t.setMaterial(r,t),_t.useMaterial(t)),_t.unUseMaterial(i)},onMaterialMapping:function(){this.groups=t},getMaterialSize:function(){return this.materialSize||1},startBatch:function(){this.batch=!0},endBatch:function(){this.materialMappingChanges!==t&&(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",this.materialMappingChanges[0],this.materialMappingChanges[1]),this.materialMappingChanges=t),this.batch=!1},compareAndSetMaterial:function(e,t,i){this.setMaterial(i,t,e)},cloneStyle:function(e){if(this.getClassName()==e.getClassName()){for(var t=this.getMaterialMapping(),i=0;i<this.getMaterialSize();i++){var r=this.material.materials[i],a=e.material.materials[i];this.compareAndSetMaterial(r,a,i)}var n=this.getMaterialMapping();oe.Utils.isSame(t,n)||(this.batch?this.materialMappingChanges=[t,n]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",t,n)))}else console.warn("ApplyStyle fail, the source with not the same class")},_considerArray:function(e,t){if(e.startsWith("envmap.image")){var i=!1;if(Oe.isArray(t))for(var r=0;r<t.length;r++)if(Oe.isArray(t[r])){i=!0;break}return i}return Oe.isArray(t)},setMaterialStyles:function(e){for(var t,i,r,a,n,o=this.getMaterialMapping(),o=this.getMaterialMapping(),s=0;s<this.getMaterialSize();s++){r=(i=this.material.materials[s]).clone();var l=!1;for(var h in e){if(h.startsWith("m."))a=h.substr(h.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(h)){var c=h.substr(0,h.indexOf("."));if(this.getSideMaterialIndex(c)!=s)continue;!0,a=(n=h.substr(h.indexOf(".")+1)).substr(n.indexOf(".")+1)}null==(t=e[h][0])?t=oe.Styles.getStyle(h):this._considerArray(a,t)&&(t=t[s]),this._A97(r,a,t),l=!0}l&&this.compareAndSetMaterial(i,r,s)}this.changeMapping(o)},setMaterialStyle:function(e,t,i){var t,r,a,n,o,s=e;if(e.startsWith("m.")&&(s=e.substr(e.indexOf(".")+1)),null==i&&!oe.Utils.isArray(t)){var l=[];for(f=0;f<this.getMaterialSize();f++)l.push(t);this.styleMap[e]=l,t=l}var h=!1;if(s.startsWith("envmap.image")&&t&&Oe.isArray(t))for(f=0;f<t.length;f++){if(Oe.isArray(t[f])){h=!1;break}h=!0}c=this.getMaterialMapping();if(null!=i||oe.Utils.isArray(t)&&!h){if(oe.Utils.isArray(t)){r=t;for(f=0;f<this.getMaterialSize();f++)a=r[f],o=(n=this.material.materials[f]).clone(),null==a&&(a=oe.Styles.getStyle(e)),this._A97(o,s,a),this.compareAndSetMaterial(n,o,f)}else if(null!=i){var c=this.getMaterialMapping();o=(n=this.material.materials[i]).clone(),this._A97(o,s,t),this.compareAndSetMaterial(n,o,i),this.synchronizeIndexStyle(e,i,t)}}else for(var u=[],f=0;f<this.getMaterialSize();f++)!0!==u[f]&&(a=t,o=(n=this.material.materials[f]).clone(),null==a&&(a=oe.Styles.getStyle(e)),this._A97(o,s,a),this.compareAndSetMaterial(n,o,f));this.changeMapping(c)},changeMapping:function(e){var t=this.getMaterialMapping();oe.Utils.isSame(e,t)||(this.batch?this.materialMappingChanges=[e,t]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,t)))},synchronizeSideStyle:function(e,t,i){var r=this.getMaterialIndexSide(t);r&&null!=this.styleMap[r+"."+e]&&(this.styleMap[r+"."+e]=i)},synchronizeIndexStyle:function(e,t,i){var r=this.styleMap[e];if(null==r&&(r=this.getStyle(e),this.styleMap[e]=r),oe.Utils.isArray(r))r[t]=i;else{for(var a=[],n=0;n<this.getMaterialSize();n++)a.push(r);a[t]=i,this.styleMap[e]=a}},getDefaultMaterial:function(e,t){return e?e instanceof oe.ArrayMaterial?0===e.materials.length?_t.DefaultMaterial:(t>=e.materials.length&&(t=e.materials.length-1),e.materials[t]):e:_t.DefaultMaterial},createMaterial:function(e){var t=new oe.ArrayMaterial;this.material=t;for(var i=this.getMaterialSize(),r=0;r<i;r++)this.setMaterial(r,this.getDefaultMaterial(e,r))},onPropertyChange:function(e,t,i){this.changeProperty=e,this.oldGroups=this.groups;var r=this.isSizeChangedProperty(e);r&&this.onSizeChanged(),r&&this.onMaterialMapping(),r&&this.firePropertyChange("materialMapping",0,1)},onSizeChanged:function(){this.computed=!1,this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null,this.changeProperty=null},isSizeChangedProperty:function(e){return-1!==this.__SizePropeties.indexOf(e)||"vertices"==e||"faces"==e||"uvs"==e},isGroupChangedProperty:function(e){},getMaterialMapping:function(){var e={},t=this.material.materials;for(var i in t)e[i]=t.indexOf(t[i]);return e},getSideMaterialIndex:function(e){var t=this.getSideIndexMapping();if(t)return t[e]},getMaterialIndexSide:function(e){var t=this.getIndexSideMapping();if(t)return t[e]},getIndexSideMapping:function(){var e=this.getSideIndexMapping();if(e&&!this.IndexSideMapping){this.IndexSideMapping={};var t,i;for(t in e)i=e[t],this.IndexSideMapping[i]=t}return this.IndexSideMapping},getSideIndexMapping:function(){},disposeMaterial:function(){},getMaterial:function(){return this.material}});var Se=function(e,t,i){this.normal=e instanceof oe.Vec3?e:new oe.Vec3,this.vertexNormals=e instanceof Array?e:[],this.color=t instanceof oe.Color?t:new oe.Color,this.vertexColors=t instanceof Array?t:[],this.materialIndex=i||0,this.centroid=new oe.Vec3,this.needVertexNormal=!1};oe.Face=Se,Se.prototype={constructor:oe.Face,subClone:function(){},clone:function(){var e=this.subClone();e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;t<i;t++)e.vertexNormals.push(this.vertexNormals[t]);for(t=0,i=this.vertexColors.length;t<i;t++)e.vertexColors.push(this.vertexColors[t]);return e}};var Pe=function(e,t,i,r,a,n){oe.Face.call(this,r,a,n),this.a=e,this.b=t,this.c=i};oe.Face3=Pe,Pe.prototype=Object.create(oe.Face.prototype),Pe.prototype.constructor=oe.Face3,Pe.prototype.subClone=function(){return new Pe(this.a,this.b,this.c)},Pe.prototype.vertexCount=3,Pe.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c}};var Ce=function(e,t,i,r,a,n,o){oe.Face.call(this,a,n,o),this.a=e,this.b=t,this.c=i,this.d=r};oe.Face4=Ce,Ce.prototype=Object.create(oe.Face.prototype),Ce.prototype.constructor=oe.Face4,Ce.prototype.subClone=function(){return new Ce(this.a,this.b,this.c,this.d)},Ce.prototype.splitToFace3s=function(){return[new Pe(this.a,this.b,this.d,this.normal,this.color,this.materialIndex),new Pe(this.d,this.b,this.c,this.normal,this.color,this.materialIndex)]},Ce.prototype.vertexCount=4,Ce.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c,d:this.d}},oe.Entity=function(e,i){e instanceof oe.ArrayMaterial?(this.material=e,this.materialSize=this.material.materials.length||1):e instanceof oe.Material?(this.material=e,this.materialSize=1):e&&(this.materialSize=e),this.materialSize=this.materialSize||1,this.createMaterial(this.material),i!=t&&null==this._id&&(this._id=i),oe.Node.call(this,this._id),this.groups=null},oe.extend(oe.Entity,oe.Node,{constructor:oe.Entity,className:"TGL.Entity",__accessor:["computeVertexNormal"],__SizePropeties:["computeVertexNormal"],setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.elementsNeedUpdate=e,this.uvsNeedUpdate=e,this.normalsNeedUpdate=e,this.colorsNeedUpdate=e,this.buffersNeedUpdate=e},cloneCallback:function(e){e&&"TGL.Entity"===this.className&&(this.computed=!1,this.computeNodeData())},needComputeVertexNormal:function(){return this.computeVertexNormal},computeData:function(){return{vertices:this.vertices,faces:this.faces,uvs:this.uvs,uv2s:this.uv2s}},createCloneObject:function(){return this.constructor===oe.Entity?new oe.Entity(this.materialSize):oe.Element.prototype.createCloneObject.call(this)},getMaterialSize:function(){return this.materialSize},setMaterialSize:function(e){"number"==typeof e&&(this.materialSize=e,this.createMaterial(this.material))},calculateNormals:function(e,t){for(var i=[],r=0;r<e.length;r+=3)i[r+0]=0,i[r+1]=0,i[r+2]=0;for(r=0;r<t.length;r+=3){var a=[],n=[],o=[];a[0]=e[3*t[r+2]+0]-e[3*t[r+1]+0],a[1]=e[3*t[r+2]+1]-e[3*t[r+1]+1],a[2]=e[3*t[r+2]+2]-e[3*t[r+1]+2],n[0]=e[3*t[r]+0]-e[3*t[r+1]+0],n[1]=e[3*t[r]+1]-e[3*t[r+1]+1],n[2]=e[3*t[r]+2]-e[3*t[r+1]+2],o[0]=a[1]*n[2]-a[2]*n[1],o[1]=a[2]*n[0]-a[0]*n[2],o[2]=a[0]*n[1]-a[1]*n[0];for(var s=0;s<3;s++)i[3*t[r+s]+0]=i[3*t[r+s]+0]+o[0],i[3*t[r+s]+1]=i[3*t[r+s]+1]+o[1],i[3*t[r+s]+2]=i[3*t[r+s]+2]+o[2]}for(r=0;r<e.length;r+=3){var l=[];l[0]=i[r+0],l[1]=i[r+1],l[2]=i[r+2];var h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);0==h&&(h=1),l[0]=l[0]/h,l[1]=l[1]/h,l[2]=l[2]/h,i[r+0]=l[0],i[r+1]=l[1],i[r+2]=l[2]}return new Float32Array(i)}});var Te=function(){var e,t,i,r,a,n,o,s,l;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(e=(o=arguments[0]).width,t=o.height,i=o.depth,r=o.segmentsW,a=o.segmentsH,n=o.segmentsD,l=o.wrapMode,s=o.id):arguments[0]instanceof oe.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5],n=arguments[6],l=arguments[7]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],l=arguments[6],s=arguments[7]),this.width=e||1,this.height=t||1,this.depth=i||1,this.segmentsW=r||1,this.segmentsH=a||1,this.segmentsD=n||1,this.wrapMode=(l||"").toLowerCase(),this.materialSize=null==this.wrapMode||""==this.wrapMode?6:1,this.offset=new he(0,0,0),this._id=s,oe.Entity.call(this)};oe.Cube=Te,oe.extend(oe.Cube,oe.Entity,{__accessor:["width","height","depth","wrapMode"],__SizePropeties:["width","height","depth","wrapMode"],className:"TGL.Cube",getUVs:function(){return this.uvs},setPropertyValue:function(e,t){if(this[e]===t)return!1;if(this[e]=t,"wrapMode"===e){var i=this.wrapMode,r="six-each"==i||"front-other"==i||"back-other"==i||"left-other"==i||"right-other"==i||"top-other"==i||"bottom-other"==i,a=null==this.wrapMode||""==this.wrapMode?6:1;this.setMaterialSize(a),r||(this[e]="")}return!0},getLinkOffset:function(e){e.length();e.normalize();var t=e.x/this.getWidth(),i=e.y/this.getHeight(),r=e.z/this.getDepth(),a=Math.max(Math.abs(t),Math.abs(i),Math.abs(r));return a==Math.abs(t)?new he(this.getWidth()/2*(t<0?-1:1),0,0):a==Math.abs(i)?new he(0,this.getHeight()/2*(i<0?-1:1),0):new he(0,0,this.getDepth()/2*(r<0?-1:1))},getLinkExtend:function(e){var t=this.worldMatrix.clone();return t=(new se.Mat4).extractRotation(t),this.getLinkOffset(e.applyMatrix4((new ue).getInverse(t)))},computeData:function(){var e=ve.buildCubeData(this.width,this.height,this.depth,this.segmentsW,this.segmentsH,this.segmentsD,this.wrapMode,this.offset||new he(0,0,0));return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e,e},getSideIndexMapping:function(){return this.wrapMap?null:oe.Cube.SideIndexMapping},generatePrimitiveKey:function(){return"cube_"+this.width+"_"+this.height+"_"+this.depth+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.segmentsD+"_"+(this.material instanceof oe.ArrayMaterial?1:0)+"_"+this.wrapMode+"_"+this.offset.x+"_"+this.offset.y+"_ "+this.offset.z+"_"+oe.Utils.toString(this.getMaterialMapping())},serialize:function(e){var t=e;1!==this.width&&t.serializeSimple("p","width",this.width,"number"),1!==this.height&&t.serializeSimple("p","height",this.height,"number"),1!==this.depth&&t.serializeSimple("p","depth",this.depth,"number"),1!==this.widthSegemtns&&t.serializeSimple("p","widthSegemtns",this.widthSegemtns,"number"),1!==this.heightSegments&&t.serializeSimple("p","heightSegments",this.heightSegments,"number"),1!==this.depthSegments&&t.serializeSimple("p","depthSegments",this.depthSegments,"number"),oe.Element.serialize.call(this,t)}}),Te.SideIndexMapping={right:0,left:1,top:2,bottom:3,front:4,back:5},oe.Sphere=function(){var e,i,r,a,n,o,s;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var l=arguments[0];e=l.radius,i=l.segmentsW,r=l.segmentsH,a=l.longitudeStart,n=l.longitudeLength,o=l.latitudeStart,this._id=l.id}else arguments[0]instanceof oe.Material?(this.material=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],o=arguments[6],s=arguments[7]):(e=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3],n=arguments[4],o=arguments[5],s=arguments[6]);this.radius=e||50,this.segmentsW=Math.max(3,Math.floor(i)||22),this.segmentsH=Math.max(2,Math.floor(r)||15),this.longitudeStart=a!==t?a:0,this.longitudeLength=n!==t?n:2*Math.PI,this.latitudeStart=o!==t?o:0,this.latitudeLength=s!==t?s:Math.PI,this.materialSize=1,oe.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},oe.extend(oe.Sphere,oe.Entity,{constructor:oe.Sphere,__accessor:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],__SizePropeties:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],className:"TGL.Sphere",computeData:function(){var e=ve.bsd(this.radius,this.segmentsW,this.segmentsH,this.longitudeStart,this.longitudeLength,this.latitudeStart,this.latitudeLength);return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e,e},generatePrimitiveKey:function(){return"sphere_"+this.radius+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.longitudeStart+"_"+this.longitudeLength+"_"+this.latitudeStart+"_"+this.latitudeLength},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new oe.BoundingSphere(new oe.Vec3,this.radius))},getLinkOffset:function(e){e.length();return e.normalize(),e.multiplyScalar(this.radius)},serialize:function(e){var t=e;50!==this.radius&&t.serializeSimple(vt,"radius",this.radius,"number"),24!==this.widthSegments&&t.serializeSimple(vt,"widthSegments",this.widthSegments,"number"),18!==this.heightSegments&&t.serializeSimple(vt,"heightSegments",this.heightSegments,"number"),0!==this.phiStart&&t.serializeSimple(vt,"phiStart",this.phiStart,"number"),this.phiLength!==2*Math.PI&&t.serializeSimple(vt,"phiLength",this.phiLength,"number"),0!==this.thetaStart&&t.serializeSimple(vt,"thetaStart",this.thetaStart,"number"),this.thetaLength!==Math.PI&&t.serializeSimple(vt,"thetaLength",this.thetaLength,"number")}}),oe.Plane=function(){var e,t,i,r;arguments[0]instanceof oe.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),this.width=e||5,this.height=t||5,this.segmentsW=i||1,this.segmentsH=r||1,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.materialSize=1,this.computeData=function(){var e,t,i=this.width/2,r=this.height/2,a=this.segmentsW,n=this.segmentsH,o=a+1,s=n+1,l=this.width/a,h=this.height/n,c=new oe.Vec3(0,0,1),u={vertices:[],faces:[],uvs:[]};for(t=0;t<s;t++)for(e=0;e<o;e++){var f=e*l-i,p=t*h-r;u.vertices.push(new oe.Vec3(f,-p,0))}for(t=0;t<n;t++)for(e=0;e<a;e++){var d=e+o*t,m=e+o*(t+1),g=e+1+o*(t+1),v=e+1+o*t,y=new oe.Vec2(e/a,1-t/n),A=new oe.Vec2(e/a,1-(t+1)/n),x=new oe.Vec2((e+1)/a,1-(t+1)/n),_=new oe.Vec2((e+1)/a,1-t/n),w=new oe.Face4(d,m,g,v);w.normal.copy(c),w.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),u.faces.push(w),u.uvs.push([y,A,x,_])}return u},oe.Entity.call(this),this.computeCentroids()},oe.extend(oe.Plane,oe.Entity,{constructor:oe.Plane,className:"TGL.Plane",__accessor:["width","height","segmentsW","segmentsH"],__SizePropeties:["width","height","segmentsW","segmentsH"],clone:function(){var e=new oe.Plane(this.material,this.width,this.height,this.segmentsW,this.segmentsH);return this.superClass.clone.call(this,e),e},getSelectStyle:function(){var e=this.getStyle("select.style");return"outline.normal"!=e&&"outline"!=e||(e="outline.wireframe"),e}}),oe.Cylinder=function(){var e,i,r,a,n,o,s,l,h,c;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(e=(c=arguments[0]).radiusTop,i=c.radiusBottom,r=c.height,a=c.segmentsR,n=c.segmentsH,o=c.openTop,s=c.openBottom,l=c.arcLength,h=c.arcStart,this._id=c.id):arguments[0]instanceof oe.Material?(this.material=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],o=arguments[6],s=arguments[7],l=arguments[8],h=arguments[9]):(e=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3],n=arguments[4],o=arguments[5],s=arguments[6],l=arguments[7],h=arguments[8]),this.radiusTop=e=e!==t?e:20,this.radiusBottom=i=i!==t?i:20,this.height=r=r!==t?r:100,this.segmentsR=a=a||20,this.segmentsH=n=n||1,this.openTop=o!==t&&o,this.openBottom=s!=t&&s,this.arcLength=l!==t?l:2*Math.PI,this.arcStart=h!==t?h:0,this.materialSize=3,oe.Entity.call(this),this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals()},oe.extend(oe.Cylinder,oe.Entity,{constructor:oe.Cylinder,__accessor:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],__bool:["openTop","openBottom"],__SizePropeties:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],className:"TGL.Cylinder",computeData:function(){return ve.bcld(this.height,this.segmentsH,this.radiusBottom,this.radiusTop,this.segmentsR,this.openTop,this.openBottom,this.arcLength,this.arcStart)},getLinkOffset:function(e){var t=e.length();e.normalize();var i=e.x,r=e.y,a=e.z,n=Math.sqrt(i*i+a*a),o=r>0?this.radiusTop:this.radiusBottom;return Math.abs(r/n)>this.height/2/o&&t>0?new he(0,this.height/2*(r>0?1:-1),0):new he(i,0,a).normalize().multiplyScalar((this.radiusTop+this.radiusBottom)/2)},getLinkExtend:function(e){var t=this.worldMatrix.clone();return t=(new se.Mat4).extractRotation(t),this.getLinkOffset(e.applyMatrix4((new ue).getInverse(t)))},clearLinkOrthogonal:function(e,t,i,r){r=r||0;var a=this.getHeight()/2+r,n=(this.radiusTop+this.radiusBottom)/2+r;return"orthogonal.x"==i||"orthogonal.x.n"==i?!(Math.abs(e.y-t.y)>a||Math.abs(e.z-t.z)>n):"orthogonal.y"==i||"orthogonal.y.n"==i?!(Math.abs(e.x-t.x)>n||Math.abs(e.z-t.z)>n):("orthogonal.z"==i||"orthogonal.z.n"==i)&&!(Math.abs(e.y-t.y)>a||Math.abs(e.z-t.z)>n)},clearLinkExtend:function(e,t){if("extend.x"===t);else if("extend.y"===t&&e>this.getHeight()/2)return!0;return!1},getSideIndexMapping:function(){return oe.Cylinder.SideIndexMapping},generatePrimitiveKey:function(){return"cylinder_"+this.height+"_"+this.segmentsH+"_"+this.radiusTop+"_"+this.radiusBottom+"_"+this.segmentsR+"_"+this.openTop+"_"+this.openBottom+"_"+this.arcLength+"_"+this.arcStart+oe.Utils.toString(this.getMaterialMapping())},needComputeVertexNormal:function(){return!1}}),oe.Cylinder.SideIndexMapping={side:0,top:1,bottom:2},oe.Circle=function(){var e,i,r,a;4===arguments.length?(e=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3]):(this.material=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.radius=e=e||50,this.segments=i=i!==t?Math.max(3,i):8,this.thetaStart=r=r!==t?r:0,this.thetaLength=a=a!==t?a:2*Math.PI,this.materialSize=1,oe.Entity.call(this),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new oe.BoundingSphere(new oe.Vec3,e)},oe.extend(oe.Circle,oe.Entity,{clone:function(){var e=new oe.Circle(this.material,this.radius,this.segments,this.thetaStart,this.thetaLength);return this.constructor.superClass.clone.call(this,e),e},computeData:function(){var e,t=this.segments,i=[],r=new oe.Vec3,a=new oe.Vec2(.5,.5),n={vertices:[],faces:[],uvs:[],uv2s:[]};for(n.vertices.push(r),i.push(a),e=0;e<=t;e++){var o=new oe.Vec3,s=this.thetaStart+e/t*this.thetaLength;o.x=this.radius*Math.cos(s),o.y=this.radius*Math.sin(s),n.vertices.push(o),i.push(new oe.Vec2((o.x/this.radius+1)/2,(o.y/this.radius+1)/2))}var l=new oe.Vec3(0,0,1);for(e=1;e<=t;e++){var h=e,c=e+1;n.faces.push(new oe.Face3(h,c,0,[l,l,l])),n.uvs.push([i[e],i[e+1],a])}return n}}),oe.Torus=function(){var e,t,i,r,a,n;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(e=(n=arguments[0]).radius,t=n.tube,i=n.segmentsR,r=n.segmentsT,a=n.arc,this._id=n.id):arguments[0]instanceof oe.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.materialSize=1,this.radius=e||100,this.tube=t||40,this.segmentsR=i||8,this.segmentsT=r||6,this.arc=a||2*Math.PI,oe.Entity.call(this),this.computeNodeData(),this.computeCentroids()},oe.extend(oe.Torus,oe.Entity,{__accessor:["radius","tube","segmentsR","segmentsT","arc"],__SizePropeties:["radius","tube","segmentsR","segmentsT","arc"],className:"TGL.Torus",generatePrimitiveKey:function(){return"torus_"+this.radius+"_"+this.tube+"_"+this.segmentsR+"_"+this.segmentsT+"_"+this.arc},computeData:function(){for(var e=new oe.Vec3,t=[],i=[],r={vertices:[],faces:[],uvs:[],uv2s:[]},a=0;a<=this.segmentsR;a++)for(l=0;l<=this.segmentsT;l++){var n=l/this.segmentsT*this.arc,o=a/this.segmentsR*Math.PI*2;e.x=this.radius*Math.cos(n),e.y=this.radius*Math.sin(n);var s=new oe.Vec3;s.x=(this.radius+this.tube*Math.cos(o))*Math.cos(n),s.y=(this.radius+this.tube*Math.cos(o))*Math.sin(n),s.z=this.tube*Math.sin(o),r.vertices.push(s),t.push(new oe.Vec2(l/this.segmentsT,a/this.segmentsR)),i.push(s.clone().sub(e).normalize())}for(a=1;a<=this.segmentsR;a++)for(var l=1;l<=this.segmentsT;l++){var h=(this.segmentsT+1)*a+l-1,c=(this.segmentsT+1)*(a-1)+l-1,u=(this.segmentsT+1)*(a-1)+l,f=(this.segmentsT+1)*a+l,p=new oe.Face3(h,c,f,[i[h],i[c],i[f]]);p.normal.add(i[h]),p.normal.add(i[c]),p.normal.add(i[f]),p.normal.normalize(),r.faces.push(p),r.uvs.push([t[h].clone(),t[c].clone(),t[f].clone()]),(p=new oe.Face3(c,u,f,[i[c],i[u],i[f]])).normal.add(i[c]),p.normal.add(i[u]),p.normal.add(i[f]),p.normal.normalize(),r.faces.push(p),r.uvs.push([t[c].clone(),t[u].clone(),t[f].clone()])}return r}}),oe.Arrow=function(){var e,t,i,r,a;arguments[0]instanceof oe.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.materialSize=1,this.tailHeight=e||100,this.tailRadius=t||20,this.headHeight=i||20,this.headRadius=r||30,this.radiusSegments=a||30,oe.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},oe.extend(oe.Arrow,oe.Entity,{constructor:oe.Arrow,className:"TGL.Arrow",computeData:function(){var e=this.tailHeight,t=this.tailRadius,i=this.headHeight,r=this.headRadius,a=this.radiusSegments;this.headRadius<this.tailRadius&&(this.headRadius=this.tailRadius);var n,o,s=e+i,l=s/2,h=[],c=[],u=[],f=[];for(o=0;o<=2;o++){var p=[],d=[],m=(g=o/2)*r;for(n=0;n<=a;n++){v=n/a;(y=new oe.Vec3).x=m*Math.sin(v*Math.PI*2),y.y=-g*i+l,y.z=m*Math.cos(v*Math.PI*2),this.vertices.push(y),p.push(this.vertices.length-1),d.push(new oe.Vec2(v,1-g))}h.push(p),u.push(d)}for(this.vertices.push(new oe.Vec3(0,l-i,0)),o=0;o<=2;o++){var p=[],d=[],g=o/2,m=t;for(n=0;n<=a;n++){var v=n/a,y=new oe.Vec3;y.x=m*Math.sin(v*Math.PI*2),y.y=-g*e+l-i,y.z=m*Math.cos(v*Math.PI*2),this.vertices.push(y),p.push(this.vertices.length-1),d.push(new oe.Vec2(v,1-g))}c.push(p),f.push(d)}this.vertices.push(new oe.Vec3(0,-l,0));R=this.headRadius/s;for(n=0;n<a;n++)for(D=this.vertices[h[0][n]].clone(),L=this.vertices[h[0][n+1]].clone(),D.setY(Math.sqrt(D.x*D.x+D.z*D.z)*R).normalize(),L.setY(Math.sqrt(L.x*L.x+L.z*L.z)*R).normalize(),o=0;o<2;o++){var A=h[o][n],x=h[o+1][n],_=h[o+1][n+1],w=h[o][n+1],b=D.clone(),M=D.clone(),S=L.clone(),P=L.clone(),C=u[o][n].clone(),T=u[o+1][n].clone(),E=u[o+1][n+1].clone(),z=u[o][n+1].clone();this.faces.push(new oe.Face3(A,x,w,[b,M,P])),this.uvs.push([C,T,z]),this.faces.push(new oe.Face3(x,_,w,[M,S,P])),this.uvs.push([T,E,z])}for(n=0;n<a;n++){var A=h[o][n+1],x=h[o][n],_=h.length-1,b=new oe.Vec3(0,-1,0),M=new oe.Vec3(0,-1,0),S=new oe.Vec3(0,-1,0),C=u[o][n+1].clone(),T=u[o][n].clone(),E=new oe.Vec2(T.u,1);this.faces.push(new oe.Face3(A,x,_,[b,M,S])),this.uvs.push([C,T,E])}var D,L,R=0;for(n=0;n<a;n++)for(D=this.vertices[c[1][n]].clone(),L=this.vertices[c[1][n+1]].clone(),D.setY(Math.sqrt(D.x*D.x+D.z*D.z)*R).normalize(),L.setY(Math.sqrt(L.x*L.x+L.z*L.z)*R).normalize(),o=0;o<2;o++){var A=c[o][n],x=c[o+1][n],_=c[o+1][n+1],w=c[o][n+1],b=D.clone(),M=D.clone(),S=L.clone(),P=L.clone(),C=u[o][n].clone(),T=u[o+1][n].clone(),E=u[o+1][n+1].clone(),z=u[o][n+1].clone();this.faces.push(new oe.Face3(A,x,w,[b,M,P])),this.uvs.push([C,T,z]),this.faces.push(new oe.Face3(x,_,w,[M,S,P])),this.uvs.push([T,E,z])}for(n=0;n<a;n++){var A=c[o][n+1],x=c[o][n],_=c.length-1,b=new oe.Vec3(0,-1,0),M=new oe.Vec3(0,-1,0),S=new oe.Vec3(0,-1,0),C=f[o][n+1].clone(),T=f[o][n].clone(),E=new oe.Vec2(T.u,1);this.faces.push(new oe.Face3(A,x,_,[b,M,S])),this.uvs.push([C,T,E])}return this}}),oe.BufferNode=function(){this.name="",this.attributes={},this.dynamic=!1,this.boundingBox=null,this.boundingSphere=null,this.mode="TRIANGLES",arguments[0]instanceof oe.Material?this.material=arguments[0]:this.material=new se.EntityMaterial,oe.Element.call(this)},oe.extend(oe.BufferNode,oe.Element,{constructor:oe.BufferNode,addAttribute:function(e,t){if(t.array||(t={array:t}),"index"===e||t.array.BYTES_PER_ELEMENT||(t.array=new Float32Array(t.array)),this.attributes[e]=t,"position"===e&&(this.computed=!0,this.computeBoundingBox(),this.computeBoundingSphere()),"index"===e){var i,r=t.array.BYTES_PER_ELEMENT;r?i=1===r?5121:2===r?5123:5125:t.array.length<=256?(i=5121,r=1,t.array=new Uint8Array(t.array)):t.array.length<=65536?(i=5123,r=2,t.array=new Uint16Array(t.array)):(i=5125,r=4,t.array=new Uint32Array(t.array)),t.element_type=i,t.element_size=r}},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)},_applyMatrix:function(e){var i,r;this.attributes.position&&(i=this.attributes.position.array),this.attributes.normal&&(r=this.attributes.normal.array),i!==t&&(e.multiplyVec3Array(i),this.verticesNeedUpdate=!0),r!==t&&((new oe.Matrix3).getNormalMatrix(e).multiplyVec3Array(r),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new oe.BoundingBox);var e=this.attributes.position&&this.attributes.position.array;if(e){var i,r,a,n=this.boundingBox;e.length>=3&&(n.min.x=n.max.x=e[0],n.min.y=n.max.y=e[1],n.min.z=n.max.z=e[2]);for(var o=3,s=e.length;o<s;o+=3)i=e[o],r=e[o+1],a=e[o+2],i<n.min.x?n.min.x=i:i>n.max.x&&(n.max.x=i),r<n.min.y?n.min.y=r:r>n.max.y&&(n.max.y=r),a<n.min.z?n.min.z=a:a>n.max.z&&(n.max.z=a)}e!==t&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var e=new oe.BoundingBox,t=new oe.Vec3;return function(){null===this.boundingSphere&&(this.boundingSphere=new oe.BoundingSphere);var i=this.attributes.position&&this.attributes.position.array;if(i){for(var r=this.boundingSphere.center,a=[],n=0,o=i.length;n<o;n+=3)t.set(i[n],i[n+1],i[n+2]),a.push(t);e.setFromPoints(a),e.center(r);for(var s=0,n=0,o=i.length;n<o;n+=3)t.set(i[n],i[n+1],i[n+2]),s=Math.max(s,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s)}}}(),computeVertexNormals:function(){if(this.attributes.position){var e,i,r,a,n=this.attributes.position.array.length;if(this.attributes.normal===t)this.attributes.normal={itemSize:3,array:new Float32Array(n)};else for(e=0,i=this.attributes.normal.array.length;e<i;e++)this.attributes.normal.array[e]=0;var o,s,l,h,c,u,f=this.attributes.position&&this.attributes.position.array,p=this.attributes.normal.array,d=new oe.Vec3,m=new oe.Vec3,g=new oe.Vec3,v=new oe.Vec3,y=new oe.Vec3;if(this.attributes.index){var A=this.attributes.index.array,x=this.offsets;for(r=0,a=x.length;r<a;++r){var _=x[r].start,w=x[r].count,b=x[r].index;for(e=_,i=_+w;e<i;e+=3)o=b+A[e],s=b+A[e+1],l=b+A[e+2],h=f[3*o],c=f[3*o+1],u=f[3*o+2],d.set(h,c,u),h=f[3*s],c=f[3*s+1],u=f[3*s+2],m.set(h,c,u),h=f[3*l],c=f[3*l+1],u=f[3*l+2],g.set(h,c,u),v.subVectors(g,m),y.subVectors(d,m),v.cross(y),p[3*o]+=v.x,p[3*o+1]+=v.y,p[3*o+2]+=v.z,p[3*s]+=v.x,p[3*s+1]+=v.y,p[3*s+2]+=v.z,p[3*l]+=v.x,p[3*l+1]+=v.y,p[3*l+2]+=v.z}}else for(e=0,i=f.length;e<i;e+=9)h=f[e],c=f[e+1],u=f[e+2],d.set(h,c,u),h=f[e+3],c=f[e+4],u=f[e+5],m.set(h,c,u),h=f[e+6],c=f[e+7],u=f[e+8],g.set(h,c,u),v.subVectors(g,m),y.subVectors(d,m),v.cross(y),p[e]=v.x,p[e+1]=v.y,p[e+2]=v.z,p[e+3]=v.x,p[e+4]=v.y,p[e+5]=v.z,p[e+6]=v.x,p[e+7]=v.y,p[e+8]=v.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,r,a=this.attributes.normal.array,n=0,o=a.length;n<o;n+=3)e=a[n],t=a[n+1],i=a[n+2],r=1/Math.sqrt(e*e+t*t+i*i),a[n]*=r,a[n+1]*=r,a[n+2]*=r},clone:function(e,t,i){var r=se.Element.prototype.clone.call(this,e,t,i);return r.attributes=this.attributes,r.dynamic=this.dynamic,r.boundingBox=this.boundingBox,r.boundingSphere=this.boundingSphere,r.mode=this.mode,r.material=this.material,r.computed=this.computed,r},clonePrefab:function(e){return this.clone(null,!1,e)},intersect:function(){var e=new he,t=new he,i=new he,r=new he,a=new he,n=new he,o=new he,s=new he,l=1e-6;return function(h,c){function u(){return r.subVectors(t,e),a.subVectors(i,e),o.crossVectors(c,a),!((m=r.dot(o))>-l&&m<l)&&(g=1/m,n.subVectors(h,e),!((f=n.dot(o)*g)<0||f>1)&&(s.crossVectors(n,r),!((p=c.dot(s)*g)<0||f+p>1)&&(d=a.dot(s)*g,!0)))}var f,p,d,m,g,v,y,A,x,_=this.attributes,w=_.index.array,b=_.position.array,M=w&&w.length||b.length/3,S=Number.MAX_VALUE,P=!1;if(w)for(v=0;v<M;v+=3)y=3*w[v],e.set(b[y],b[y+1],b[y+2]),y=3*w[v+1],t.set(b[y],b[y+1],b[y+2]),y=3*w[v+2],i.set(b[y],b[y+1],b[y+2]),u()&&d<S&&(S=d,f,p,P||(P=!0));else for(y=0,v=0;v<M;v+=3)e.set(b[y++],b[y++],b[y++]),t.set(b[y++],b[y++],b[y++]),i.set(b[y++],b[y++],b[y++]),u()&&d<S&&(S=d,f,p,P||(P=!0));return P?((A=new he).copy(c),A.multiplyScalar(S),x=A.length(),A.add(h),{point:A,distance:x}):null}}()}),oe.Particle=function(e,t,i){var r;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])&&(r=arguments[0],this._id=r.id),oe.Node.call(this,this._id),this.material=new oe.ParticleMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1,this.vertices=(r?r.vertices:e)||[],this.colors=(r?r.colors:t)||[],this.sizes=(r?r.sizes:i)||[],this.setUpdateFlags(!0)},oe.extend(oe.Particle,oe.Node,{clone:function(e){return e===t&&(e=new oe.Particle(this.material)),e.sortParticles=this.sortParticles,e.frustumCulled=this.frustumCulled,oe.Element.prototype.clone.call(this,e),e},needUpdate:function(){return!1},setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.dirtyColors=e,this.normalsNeedUpdate=e},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)},setMaterialStyles:function(e){oe.Element.prototype.setMaterialStyles.call(this,e)}}),oe.Line=function(e){this.material=new oe.LineMaterial({color:16777215}),oe.Node.call(this,e),this.type=this.type!==t?this.type:oe.LineStrip},oe.LineStrip=0,oe.LinePieces=1,oe.extend(oe.Line,oe.Node,{className:"TGL.Line",__accessor:["vertices","type","colors"],__SizePropeties:["vertices","type","colors"],clone:function(e){return e===t&&(e=new oe.Line(this.material,this.type)),oe.Element.prototype.clone.call(this,e,!0),e},onPropertyChange:function(e,t,i){},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)},setMaterialStyles:function(e){oe.Element.prototype.setMaterialStyles.call(this,e)}}),oe.Line.createEllipse=function(e,t,i,r,a,n,o){"number"==typeof e?(o=n,n=a,a=r,r=i,i=t,t=e,e=new oe.Line):null==e&&(e=new oe.Line);for(var s=new oe.EllipseCurve(0,0,t,i,a,n,o),l=[],h=r||50,c=0;c<=h;c++){var u=s.getPoint(c/h);l.push(u)}return e.setVertices(l),e},oe.Line.createHelix=function(e,t,i,r,a,n){"number"==typeof e?(n=a,a=r,r=i,i=t,t=e,e=new oe.Line):null==e&&(e=new oe.Line);var o=[],s=n||50;a=a||1;for(var l,h,c,u,f=0;f<=s;f++)l=(i*f+t*(s-f))/s,c=a*Math.PI*2*f/s,h=r*(.5-f/s),u=new he(l*Math.sin(c),h,l*Math.cos(c)),o.push(u);return e.setVertices(o),e},oe.Line.createRectangle=function(e,t,i,r){"number"==typeof e?(r=i||1,i=t,t=e,e=new oe.Line):null==e&&(e=new oe.Line);var a=r||50,n=2*(t+i)/a,o=[];if(n>Math.min(t,i))o.push(new he(-t/2,-i/2,0)),o.push(new he(-t/2,i/2,0)),o.push(new he(t/2,i/2,0)),o.push(new he(t/2,-i/2,0)),o.push(new he(-t/2,-i/2,0));else for(var s,l=-t/2,h=-i/2,c=0;c<=a;c++)l==-t/2&&h<i/2?h+n<=i/2?h+=n:(o.push(new he(-t/2,i/2,0)),o.push(new he(-t/2,i/2,0)),l+=h+n-i/2,h=i/2):h==i/2&&l<=t/2?l+n<=t/2?l+=n:(o.push(new he(t/2,i/2,0)),o.push(new he(t/2,i/2,0)),h-=l+n-t/2,l=t/2):l==t/2&&h>-i/2?h-n>=-i/2?h-=n:(o.push(new he(t/2,-i/2,0)),o.push(new he(t/2,-i/2,0)),l-=-i/2-h+n,h=-i/2):h==-i/2&&l>=-t/2&&(l-n>=-t/2?l-=n:(h+=-t/2-l+n,l=-t/2)),s=new he(l,h,0),o.push(s);return e.setVertices(o),e},oe.Line.createNurbs=function(e,t,i,r,a){if(Array.isArray(e)?(a=r,r=i,i=t,t=e,e=new oe.Line):null==e&&(e=new oe.Line),a){var n=e.material;n.skyY=a.skyY||0,n.horizonY=a.horizonY||0,n.earthY=a.earthY||0,n.skyColor=a.skyColor||new se.Color(16777215),n.horizonColor=a.horizonColor||new se.Color(16777215),n.earthColor=a.earthColor||new se.Color(16777215)}i>t.length-1&&(console.log("max degree is :",t.length-1),i=t.length-1);for(var o=[],s=0;s<=i;s++)o.push(0);for(var s=0,l=t.length;s<l;s++){var h=(s+1)/(l-i);o.push(se.Math.clamp(h,0,1))}var c=new se.NurbsCurve(i,o,t);return e.setVertices(c.getPoints(t.length*r)),e},oe.Line.createDottedLine=function(e,t,i,r){e instanceof Array?(i=t,t=e,e=new oe.Line):null==e&&(e=new oe.Line);for(var a=[],n=t[0],o=1;o<t.length;o++){var s=t[o],r=s.distanceTo(n)/(i[0]+i[1])||20,l=n.x,h=n.y,c=n.z,u=(s.x-l)/r,f=(s.y-h)/r,p=(s.z-c)/r,d=i[0]/(i[0]+i[1]),m=u*d,g=f*d,v=p*d;a.push(new se.Vec3(l,h,c));for(var y=0;y<r;y++){var A=l+y*u,x=h+y*f,_=c+y*p;a.push(new se.Vec3(A,x,_));var A=l+y*u+m,x=h+y*f+g,_=c+y*p+v;a.push(new se.Vec3(A,x,_))}n=s}return e.setVertices(a),e},oe.LineX=function(){var e,t,i;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];e=r.points,t=r.colors,i=r.lineWidth,this._id=r.id||this._id}else e=arguments[0],t=arguments[1],i=arguments[2];this.material=new oe.LineXMaterial({color:16777215}),this.points=e||[],this.colors=t||[],this.lineWidth=i||1,oe.Entity.call(this,this.material,this._id)};var Ee=function(e,t,i){if(t=t||[],null==e)return t;i=i||20,e instanceof oe.Curve||console.error(" TGL.LineX#makeSegment:TGL.Curve required");for(var r=0;r<i;r++)t.push(e.getPointAt(r/i));return t},ze=function(e,t,i){if(null==e||e.actions.length<2)return null;for(var r,a=[],n=e.curves,o=n.length,s=0;s<o;s++)(r=n[s])instanceof oe.LineCurve3?a.push(r.v1):r instanceof oe.Curve&&Ee(r,a,t),s==o-1&&a.push(r.v2);return i.push(a),i};oe.LineX.createLineXFromPathAndColors=function(e,t,i,r){var a=[];return e&&e.actions?ze(e,r,a):e instanceof Array&&e.forEach(function(e){ze(e,r,a)}),t=t||[],i=i||1,r=r||20,new oe.LineX(a,t,i)},oe.extend(oe.LineX,oe.Entity,{__accessor:["points","colors","lineWidth"],__SizePropeties:["points","colors","lineWidth"],computeData:function(){for(var e,t=this.points,r=this.colors,a={vertices:[],verticesPrev:[],verticesNext:[],offset:[],faces:[],uvs:[]},n=i(t),o=0,s=this.lineWidth,l=0;l<n.length;l++){var h=n[l],c=s;s instanceof Array&&(c=l<(e=s.length)-1?s[l]:s[e-1]),this._computeOnePath(h,r,a,c,o),o+=2*h.length}return a},_computeOnePath:function(e,t,i,r,a){var n=t.length;0!=n&&(i.colors=[]);var o=e.length,s=i.vertices,l=i.verticesPrev,h=i.verticesNext,c=[],u=i.offset,f=i.faces,p=[0],d=0;!function(){for(var t=1;t<o;t++){var i=e[t],r=e[t-1],a=new he(i.x,i.y,i.z).distanceTo(new he(r.x,r.y,r.z));d+=a,p.push(d)}}();for(var m=[],g=0;g<o;g++){var v=e[g],y=new he(v.x,v.y,v.z);if(s.push(y),s.push(y.clone()),m.push(y),m.push(y.clone()),u.push(r/2),u.push(-r/2),c.push(new se.Vec2(p[g]/d,0)),c.push(new se.Vec2(p[g]/d,1)),i.colors){var A=t[Math.floor(g*n/o)];A instanceof oe.Color||(A=new oe.Color(A)),i.colors.push(A),i.colors.push(A.clone())}}for(g=0;g<o;g++){var x=(b=2*g)>=2?b-2:0,_=b<o-2?b+2:2*o-1,y=m[x];l.push(y.clone()),l.push(y.clone()),y=m[_],h.push(y.clone()),h.push(y.clone())}var w=o-1;for(g=0;g<w;g++){var b=2*g,M=b+a,S=new Pe(M,M+1,M+2);S.materialIndex=0,i.uvs.push([c[b],c[b+1],c[b+2]]),f.push(S),S=new Pe(M+2,M+1,M+3),i.uvs.push([c[b+2],c[b+1],c[b+3]]),S.materialIndex=0,f.push(S)}},getPointAt:function(e){null==e&&console.error("LineX#getPointAt method need one argument:percent"),(e=e||0)<0?e=0:e>1&&(e=1);var t=this.lineDistances.length;if(0==t&&console.error("There is  no data in lineDistances"),0==e)return this.vertices[0].clone();if(1==e)return this.vertices[t-1].clone();var i=this.lineDistances[t-1];0==i&&console.error("Total length is zero");for(var r=null,a=0;a<t;a+=2){var n=this.lineDistances[a]/i,o=a+2<t?a+2:a,s=this.lineDistances[o]/i;if(n<=e&&e<s){var l=this.vertices[a],h=this.vertices[o],c=h.clone().sub(l).length();if(0!=c){var u=(e-n)*i/c;r=(new he).lerpVectors(l,h,u);break}r=l.clone(),console.error("There are two same points")}}return r},needComputeVertexNormal:function(){return!1},needComputeLineDistance:function(){return!0}}),oe.PathLine=function(){var e,t,i;if(1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof oe.Path)){var r=arguments[0];e=r.path,t=r.segments,i=r.type,this._id=r.id||this._id}else e=arguments[0],t=arguments[1],i=arguments[2],this._id=arguments[3];oe.Line.call(this,{vertices:[],colors:[],type:i,id:this._id}),this.segments=t||20,this.setPath(e)},oe.extend(oe.PathLine,oe.Line,{constructor:oe.PathLine,className:"TGL.PathLine",__accessor:["path","segments"],__SizePropeties:["path","segments"],onPropertyChange:function(){this.computeNodeData()},computeNodeData:function(){this.computeData()},adjustPath:function(e){return e},computeData:function(){var e=this.path;if(e){var t,i,r,a,n,o=(e=this.adjustPath(e)).curves.length,s=e.curves,l=[],h=e.getLength(),c=0,u=this.segments;for(g=0;g<o;g++){if(i=s[g],r=i.getLength(),i instanceof oe.LineCurve3){var f=c/h,p=(r+c)/h;l.push(f),l.push(p)}else for(a=g>0?1:0;a<=u;a++){var d=(r*a/u+c)/h;l.push(d)}c+=r}for(var m=[],g=0;g<l.length;g++)t=l[g],n=e.getPointAt(t),m.push(n);return this.vertices=m,[]}}}),oe.Polyhedron=function(){function e(e){var t=e.normalize().clone();t.index=h.vertices.push(t)-1;var a=i(e)/2/Math.PI+.5,n=r(e)/Math.PI+.5;return t.uv=new oe.Vec3(a,1-n),t}function t(e,t,r){var n=new oe.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);n.centroid.add(e).add(t).add(r).divideScalar(3),h.faces.push(n);var o=i(n.centroid);h.uvs.push([a(e.uv,e,o),a(t.uv,t,o),a(r.uv,r,o)])}function i(e){return Math.atan2(e.z,-e.x)}function r(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function a(e,t,i){return i<0&&1===e.x&&(e=new oe.Vec3(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new oe.Vec3(i/2/Math.PI+.5,e.y)),e.clone()}var n,o,s,l;arguments[0]instanceof oe.Material?(this.material=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3],l=arguments[4]):(n=arguments[0],o=arguments[1],s=arguments[2],l=arguments[3]),this.materialSize=1,oe.Entity.call(this),s=s||1,l=l||0;for(var h=this,c=0,u=n.length;c<u;c++)e(new oe.Vec3(n[c][0],n[c][1],n[c][2]));for(var f=this.vertices,p=[],c=0,u=o.length;c<u;c++){var d=f[o[c][0]],m=f[o[c][1]],g=f[o[c][2]];p[c]=new oe.Face3(d.index,m.index,g.index,[d.clone(),m.clone(),g.clone()])}for(var c=0,u=p.length;c<u;c++)!function(i,r){for(var a=Math.pow(2,r),n=(Math.pow(4,r),e(h.vertices[i.a])),o=e(h.vertices[i.b]),s=e(h.vertices[i.c]),l=[],c=0;c<=a;c++){l[c]=[];for(var u=e(n.clone().lerp(s,c/a)),f=e(o.clone().lerp(s,c/a)),p=a-c,d=0;d<=p;d++)l[c][d]=0==d&&c==a?u:e(u.clone().lerp(f,d/p))}for(c=0;c<a;c++)for(d=0;d<2*(a-c)-1;d++){var m=Math.floor(d/2);d%2==0?t(l[c][m+1],l[c+1][m],l[c][m]):t(l[c][m+1],l[c+1][m+1],l[c+1][m])}}(p[c],l);for(var c=0,u=this.uvs.length;c<u;c++){var v=this.uvs[c],y=v[0].x,A=v[1].x,x=v[2].x,_=Math.max(y,Math.max(A,x)),w=Math.min(y,Math.min(A,x));_>.9&&w<.1&&(y<.2&&(v[0].x+=1),A<.2&&(v[1].x+=1),x<.2&&(v[2].x+=1))}for(var c=0,u=this.vertices.length;c<u;c++)this.vertices[c].multiplyScalar(s);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new oe.BoundingSphere(new oe.Vec3,s)},oe.extend(oe.Polyhedron,oe.Entity,{}),oe.Octahedron=function(e,t,i){var r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],a=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];oe.Polyhedron.call(this,e,r,a,t,i)},oe.extend(oe.Octahedron,oe.Polyhedron,{clone:function(){return new oe.Octahedron(this.material,this.radius,this.detail)}}),oe.Axis=function(e){var t=e&&e.size||1,i=[],r=[];i.push(new oe.Vec3,new oe.Vec3(t,0,0),new oe.Vec3,new oe.Vec3(0,t,0),new oe.Vec3,new oe.Vec3(0,0,t)),r.push(new oe.Color(16711680),new oe.Color(16711680),new oe.Color(65280),new oe.Color(65280),new oe.Color(255),new oe.Color(255));var a=new oe.LineMaterial({vertexColors:oe.VertexColors,depthTest:!1,depthMask:!1});oe.Line.call(this,{vertices:i,colors:r,type:oe.LinePieces,size:t}),this.material=a,this.xAxisText=this.makeAxisText("X",16711680),this.yAxisText=this.makeAxisText("Y",65280),this.zAxisText=this.makeAxisText("Z",255),this.xAxisText.setParent(this),this.yAxisText.setParent(this),this.zAxisText.setParent(this),this.xAxisText.setPosition(t,0,0),this.yAxisText.setPosition(0,t,0),this.zAxisText.setPosition(0,0,t),this._sizeFixed=!0},oe.extend(oe.Axis,oe.Line,{showAxisText:function(e){this.xAxisText._visible=e,this.yAxisText._visible=e,this.zAxisText._visible=e},setSize:function(e){this.vertices[1].x=e,this.vertices[3].y=e,this.vertices[5].z=e},fixSize:function(e){oe.Element.prototype.fixSize.call(this,e);this._scale.x,this._scale.y,this._scale.z;this.xAxisText.setScale(3,3,1),this.yAxisText.setScale(3,3,1),this.zAxisText.setScale(3,3,1)},makeAxisText:function(e,t){var i=oe.BillboardAlignment.topLeft,r=document.createElement("canvas"),a=r.getContext("2d");a.font="Bold 36px Arial",t instanceof oe.Color||(t=new oe.Color(t));var n=a.measureText(e).width;r.width=Oe.nextPowerOfTwo(n),r.height=Oe.nextPowerOfTwo(2*a.measureText("e").width+4),a.fillStyle="rgba("+255*t.r+", "+255*t.g+", "+255*t.b+", 1.0)",a.fillText(e,0,10);var o=new oe.Texture(r),s=new oe.BillboardMaterial({map:o,useScreenCoordinates:!1,alignment:i,depthTest:!1,depthMask:!1}),l=new oe.Billboard;return l.material=s,l}}),oe.Curve=function(){},oe.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},oe.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},oe.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i},oe.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i},oe.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},oe.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],a=this.getPoint(0),n=0;for(r.push(0),i=1;i<=e;i++)n+=(t=this.getPoint(i/e)).distanceTo(a),r.push(n),a=t;return this.cacheArcLengths=r,r},oe.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},oe.Curve.prototype.getUtoTmapping=function(e,t){var i,r=this.getLengths(),a=0,n=r.length;i=t||e*r[n-1];for(var o,s=0,l=n-1;s<=l;)if(a=Math.floor(s+(l-s)/2),(o=r[a]-i)<0)s=a+1;else{if(!(o>0)){l=a;break}l=a-1}if(a=l,r[a]==i)return c=a/(n-1);var h=r[a],c=(a+(i-h)/(r[a+1]-h))/(n-1);return c},oe.Curve.prototype.getTangent=function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),i>1&&(i=1);var r=this.getPoint(t);return this.getPoint(i).clone().sub(r).normalize()},oe.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},oe.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,a){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*a},tangentSpline:function(e,t,i,r,a){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,r,a){var n=.5*(i-e),o=.5*(r-t),s=a*a;return(2*t-2*i+n+o)*(a*s)+(-3*t+3*i-2*n-o)*s+n*a+t}},oe.Curve.create=function(e,t){return e.prototype=Object.create(oe.Curve.prototype),e.prototype.getPoint=t,e},oe.LineCurve=function(e,t){this.v1=e,this.v2=t},oe.LineCurve.prototype=Object.create(oe.Curve.prototype),oe.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},oe.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},oe.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},oe.LineCurve3=function(e,t){this.v1=e,this.v2=t,this.getPoint=function(e){var t=new oe.Vec3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}},oe.extend(oe.LineCurve3,oe.Curve,{}),oe.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},oe.CurvePath.prototype=Object.create(oe.Curve.prototype),oe.CurvePath.prototype.add=function(e){this.curves.push(e)},oe.CurvePath.prototype.checkConnection=function(){},oe.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new oe.LineCurve3(t,e))},oe.CurvePath.prototype.getPoint=function(e){for(var t,i,r=e*this.getLength(),a=this.getCurveLengths(),n=0;n<a.length;){if(a[n]>=r){var o=1-(t=a[n]-r)/(i=this.curves[n]).getLength();return i.getPointAt(o)}n++}return null},oe.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},oe.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,r=this.curves.length;for(e=0;e<r;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t,t},oe.CurvePath.prototype.getBoundingBox=function(){var e,t,i,r,a,n,o=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=a=Number.POSITIVE_INFINITY;var s,l,h,c,u=o[0]instanceof oe.Vec3;for(c=u?new oe.Vec3:new oe.Vec2,l=0,h=o.length;l<h;l++)(s=o[l]).x>e?e=s.x:s.x<r&&(r=s.x),s.y>t?t=s.y:s.y<a&&(a=s.y),u&&(s.z>i?i=s.z:s.z<n&&(n=s.z)),c.add(s);var f={minX:r,minY:a,maxX:e,maxY:t,centroid:c.divideScalar(h)};return u&&(f.maxZ=i,f.minZ=n),f},oe.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},oe.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},oe.CurvePath.prototype.createGeometry=function(e){for(var t=new oe.Entity,i=0;i<e.length;i++)t.vertices.push(new oe.Vec3(e[i].x,e[i].y,e[i].z||0));return t},oe.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},oe.CurvePath.prototype.getTransformedPoints=function(e,t){var i,r,a=this.getPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)a=this.getWrapPoints(a,t[i]);return a},oe.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,r,a=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)a=this.getWrapPoints(a,t[i]);return a},oe.CurvePath.prototype.getWrapPoints=function(e,t){var i,r,a,n,o,s,l=this.getBoundingBox();for(i=0,r=e.length;i<r;i++){n=(a=e[i]).x,o=a.y,s=n/l.maxX,s=t.getUtoTmapping(s,n);var h=t.getPoint(s),c=t.getTangent(s);c.set(-c.y,c.x).multiplyScalar(o),a.x=h.x+c.x,a.y=h.y+c.y}return e},oe.EllipseCurve=function(e,t,i,r,a,n,o){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=a||0,this.aEndAngle=n||2*Math.PI,this.aClockwise=o},oe.EllipseCurve.prototype=Object.create(oe.Curve.prototype),oe.EllipseCurve.prototype.getPoint=function(e){var t,i=this.aEndAngle-this.aStartAngle;i<0&&(i+=2*Math.PI),i>2*Math.PI&&(i-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-i):this.aStartAngle+e*i;var r=this.aX+this.xRadius*Math.cos(t),a=this.aY+this.yRadius*Math.sin(t);return new oe.Vec3(r,a,0)},oe.ArcCurve=function(e,t,i,r,a,n){oe.EllipseCurve.call(this,e,t,i,i,r,a,n)},oe.ArcCurve.prototype=Object.create(oe.EllipseCurve.prototype),oe.NurbsCurve=function(e,t,i){this.degree=e||3,this.knots=t||[],this.ctrlPoints=[];for(var r=0;r<i.length;++r){var a=i[r];this.ctrlPoints[r]=new oe.Vec4(a.x,a.y,a.z,a.w)}},oe.NurbsCurve.prototype=Object.create(oe.Curve.prototype),oe.NurbsCurve.prototype.constructor=oe.NurbsCurve,oe.NurbsCurve.prototype.getPoint=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=oe.NurbsUtils.calcBSplinePoint(this.degree,this.knots,this.ctrlPoints,t);return 1!=i.w&&i.divideScalar(i.w),new oe.Vec3(i.x,i.y,i.z)},oe.NurbsCurve.prototype.getTangent=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=oe.NurbsUtils.calcNURBSDerivatives(this.degree,this.knots,this.ctrlPoints,t,1)[1].clone();return i.normalize(),i},oe.NurbsSurface=function(e,t,i){this.degreeU=e,this.degreeV=t,this.knotsU=this.calculateKnots(e,i.length),this.knotsV=this.calculateKnots(t,i[0].length),this.ctlPoints=[];for(var r=i.length,a=i[0].length,n=0;n<r;++n){this.ctlPoints[n]=[];for(var o=0;o<a;++o){var s=i[n][o];this.ctlPoints[n][o]=new oe.Vec4(s.x,s.y,s.z,s.w)}}},oe.NurbsSurface.prototype={constructor:oe.NurbsSurface,calculateKnots:function(e,t){for(var i=[],r=0;r<=e;r++)i.push(0);for(r=0;r<t;r++){var a=(r+1)/(t-e);i.push(se.Math.clamp(a,0,1))}return i},getPoint:function(e,t){var i=this.knotsU[0]+e*(this.knotsU[this.knotsU.length-1]-this.knotsU[0]),r=this.knotsV[0]+t*(this.knotsV[this.knotsV.length-1]-this.knotsV[0]);return oe.NurbsUtils.calcSurfacePoint(this.degreeU,this.degreeV,this.knotsU,this.knotsV,this.ctlPoints,i,r)}},oe.Surface=function(e,t,i,r){this.parameters={func:function(t,i){return e.getPoint(t,i)},slices:t,stacks:i},this.ctrlCond=r,this.material=new oe.SurfaceMaterial,oe.Entity.call(this)},oe.extend(oe.Surface,oe.Entity,{constructor:oe.Surface,className:"TGL.Surface",createMaterial:function(e){a=new oe.ArrayMaterial;this.material=a;for(var t=this.ctrlCond,i=this.getMaterialSize(),r=0;r<i;r++){var a=this.getDefaultMaterial(e,r);t&&(a.skyY=t.skyY||0,a.horizonY=t.horizonY||0,a.earthY=t.earthY||0,a.skyColor=t.skyColor||new se.Color(16777215),a.horizonColor=t.horizonColor||new se.Color(16777215),a.earthColor=t.earthColor||new se.Color(16777215)),this.setMaterial(r,a)}},setMaterial:function(e,t,i){var r=t.getUniqueCode?t.getUniqueCode():null,a=_t.getMaterial(r);a?(this.material.materials[e]=a,_t.useMaterial(a)):(this.material.materials[e]=t,_t.setMaterial(r,t),_t.useMaterial(t)),_t.unUseMaterial(i)},computeData:function(){var e={};e.faces=[],e.uvs=[],e.vertices=[];var t,i,r=this.parameters.stacks,a=this.parameters.slices,n=this.parameters.func,o=a+1,s=[];for(t=0;t<=r;t++){var l=t/r;for(i=0;i<=a;i++){var h=i/a,c=n(h,l);s.push(new le(h,l)),e.vertices.push(new he(c.x,c.y,c.z))}}var u,f,p,d;for(t=0;t<r;t++)for(i=0;i<a;i++){var m=new Ce(u=t*o+i,f=t*o+i+1,p=(t+1)*o+i+1,d=(t+1)*o+i),g=e.vertices[u].clone().sub(e.vertices[f].clone()),v=e.vertices[d].clone().sub(e.vertices[f].clone()),y=g.cross(v).normalize();m.normal.copy(y),e.faces.push(m),e.uvs.push([s[u],s[f],s[p],s[d]])}return e}}),oe.LensFlare=function(e){var i,r,a,n,o,s,l;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(i=(l=arguments[0]).texture,r=l.size,a=l.distance,n=l.blending,o=l.color,s=l.opacity,l.id):arguments[0]instanceof oe.Material?(this.material=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3],n=arguments[4],o=arguments[5],s=arguments[6]):(i=arguments[0],r=arguments[1],a=arguments[2],n=arguments[3],o=arguments[4],s=arguments[5],arguments[6]),this.texture=i||null,this.size=r||-1,this.distance=a||0,this.blending=n||oe.NormalBlending,this.color=o||new oe.Color(16777215),this.opacity=s||1,this.material||(this.material=new oe.Material),this.lensFlares=[],oe.Node.apply(this,arguments),this.positionScreen=new he,this.customUpdateCallback=t,this.texture&&this.add(this.texture,this.size,this.distance,this.blending,this.color)},oe.extend(oe.LensFlare,oe.Node,{isLensFlare:!0,add:function(e,i,r,a,n,o){i===t&&(i=-1),r===t&&(r=0),o===t&&(o=1),n===t&&(n=new oe.Color(16777215)),a===t&&(a=oe.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:i,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:n,blending:a})},updateLensFlares:function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,a=2*-this.positionScreen.y;for(e=0;e<i;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+a*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},copy:function(e){oe.Node.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,i=e.lensFlares.length;t<i;t++)this.lensFlares.push(e.lensFlares[t]);return this}}),oe.Path=function(e){oe.CurvePath.call(this),this.actions=[],this.points=[],e&&this.fromPoints(e)},oe.extend(oe.Path,oe.CurvePath,{constructor:oe.Path,className:"TGL.Path",serializeJsonValue:function(){return{actions:this.actions,class:"TGL.Path"}},deserializeJsonValue:function(e){var t,i,r,a;for(a=0;a<e.actions.length;a++)t=(i=e.actions[a]).action,r=i.args,this[t].apply(this,r)},clone:function(){var e=new oe.Path;return e.points=this.points.slice(),e.actions=this.actions.slice(),e}}),oe.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"curveTo",BEZIER_CURVE_TO:"bCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},oe.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y,e[0].z);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y,e[t].z)},oe.Path.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.lineTo(e.x,e.y,e.z)},oe.Path.prototype.reverse=function(){var e,t,i,r,a,n=new oe.Path,o=this.actions.length;for(e=o-1;e>=0;e--){if(t=this.actions[e].args,i=t.length,e===o-1&&n.moveTo(t[i-3],t[i-2],t[i-1]),null!=r)switch(a){case oe.PathActions.MOVE_TO:n.moveTo(t[i-3],t[i-2],t[i-1]);break;case oe.PathActions.LINE_TO:n.lineTo(t[i-3],t[i-2],t[i-1]);break;case oe.PathActions.QUADRATIC_CURVE_TO:n.quadraticCurveTo(r[0],r[1],r[2],t[i-3],t[i-2],t[i-1]);break;case oe.PathActions.BEZIER_CURVE_TO:n.bezierCurveTo(r[3],r[4],r[5],r[0],r[1],r[2],t[i-3],t[i-2],t[i-1])}r=t,a=this.actions[e].action}return n},oe.Path.prototype.moveTo=function(e,t,i){e=e||0,t=t||0,i=i||0,this.actions.push({action:oe.PathActions.MOVE_TO,args:[e,t,i]}),this.points.push(new he(e,t,i))},oe.Path.prototype.lineTo=function(e,t,i){if(e=e||0,t=t||0,i=i||0,this.actions&&1===this.actions.length){var r=this.actions[0].args;r[0]===e&&r[1]===t&&r[2]===i&&(e+=.01)}var a=this.actions[this.actions.length-1].args,n=a[a.length-3],o=a[a.length-2],s=a[a.length-1],l=new oe.LineCurve3(new oe.Vec3(n,o,s),new oe.Vec3(e,t,i));this.curves.push(l),this.actions.push({action:oe.PathActions.LINE_TO,args:[e,t,i]}),this.points.push(new he(e,t,i))},oe.Path.prototype.quadraticCurveTo=function(e,t,i,r,a,n){e=e||0,t=t||0,i=i||0,r=r||0,a=a||0,n=n||0,this.actions&&1===this.actions.length&&(o=this.actions[0].args)[0]===r&&o[1]===a&&o[2]===n&&(console.log("TGL.Path:quadraticCurveTo the same point of moveTo"),r=.01);var o=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-3],h=s[s.length-2],c=s[s.length-1],u=new oe.QuadraticBezierCurve3(new oe.Vec3(l,h,c),new oe.Vec3(e,t,i),new oe.Vec3(r,a,n));this.curves.push(u),this.actions.push({action:oe.PathActions.QUADRATIC_CURVE_TO,args:o}),this.points.push(new he(r,a,n))},oe.Path.prototype.curveTo=oe.Path.prototype.quadraticCurveTo,oe.Path.prototype.bezierCurveTo=function(e,t,i,r,a,n,o,s,l){var h=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,u=c[c.length-3],f=c[c.length-2],p=c[c.length-1],d=new oe.CubicBezierCurve3(new oe.Vec3(u,f,p),new oe.Vec3(e,t,i),new oe.Vec3(r,a,n),new oe.Vec3(o,s,l));this.curves.push(d),this.actions.push({action:oe.PathActions.BEZIER_CURVE_TO,args:h}),this.points.push(new he(o,s,l))},oe.Path.prototype.isClockwise=function(){if(this.points.length<2)return t;if(this.points.length<3){var e=this.points[0];return this.points[1].x>e.x}return oe.Math.isClockwise(this.points)},oe.Path.prototype.bCurveTo=oe.Path.prototype.bezierCurveTo,oe.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],a=i[i.length-1],n=[new oe.Vec2(r,a)];Array.prototype.push.apply(n,e);var o=new oe.SplineCurve(n);this.curves.push(o),this.actions.push({action:oe.PathActions.CSPLINE_THRU,args:t})},oe.Path.prototype.arc=function(e,t,i,r,a,n){var o=this.actions[this.actions.length-1].args,s=o[o.length-3],l=o[o.length-2];this.absarc(e+s,t+l,i,r,a,n)},oe.Path.prototype.absarc=function(e,t,i,r,a,n){this.absellipse(e,t,i,i,r,a,n)},oe.Path.prototype.ellipse=function(e,t,i,r,a,n,o){var s=this.actions[this.actions.length-1].args,l=s[s.length-3],h=s[s.length-2];this.absellipse(e+l,t+h,i,r,a,n,o)},oe.Path.prototype.absellipse=function(e,t,i,r,a,n,o){var s=Array.prototype.slice.call(arguments),l=new oe.EllipseCurve(e,t,i,r,a,n,o);this.curves.push(l);var h=l.getPoint(1);s.push(h.x),s.push(h.y),this.actions.push({action:oe.PathActions.ELLIPSE,args:s})},oe.Path.prototype.toArray=function(){var e,t=this.actions.length,i=[];for(e=0;e<t;e++){var r=this.actions[e];"moveTo"===r.action?(i.push("m"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2])):"lineTo"===r.action?(i.push("l"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2])):"curveTo"===r.action&&(i.push("c"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2]),i.push(r.args[3]),i.push(r.args[4]),i.push(r.args[5]))}return i},oe.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var i=[],r=0;r<e;r++)i.push(this.getPoint(r/e));return i},oe.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,r,a,n,o,s,l,h,c,u,f,p,d,m,g,v,y,A,x,_,w,b,M,S=[];for(i=0,r=this.actions.length;i<r;i++)switch(a=this.actions[i],n=a.action,o=a.args,n){case oe.PathActions.MOVE_TO:case oe.PathActions.LINE_TO:S.push(new oe.Vec3(o[0],o[1],o[2]));break;case oe.PathActions.QUADRATIC_CURVE_TO:for(s=o[3],l=o[4],h=o[5],p=o[0],d=o[1],m=o[2],S.length>0?(g=(A=S[S.length-1]).x,v=A.y,y=A.z):(g=(A=this.actions[i-1].args)[A.length-3],v=A[A.length-2],y=A[A.length-1]),x=1;x<=e;x++)_=x/e,w=oe.Shape.Utils.b2(_,g,p,s),b=oe.Shape.Utils.b2(_,v,d,l),M=oe.Shape.Utils.b2(_,y,m,h),S.push(new oe.Vec3(w,b,M));break;case oe.PathActions.BEZIER_CURVE_TO:for(s=o[6],l=o[7],h=o[8],p=o[0],d=o[1],m=o[2],c=o[3],u=o[4],f=o[5],S.length>0?(g=(A=S[S.length-1]).x,v=A.y,y=A.z):(g=(A=this.actions[i-1].args)[A.length-3],v=A[A.length-2],y=A[A.length-1]),x=1;x<=e;x++)_=x/e,w=oe.Shape.Utils.b3(_,g,p,c,s),b=oe.Shape.Utils.b3(_,v,d,u,l),M=oe.Shape.Utils.b3(_,y,m,f,h),S.push(new oe.Vec3(w,b,M));break;case oe.PathActions.CSPLINE_THRU:A=this.actions[i-1].args;var P=[new oe.Vec2(A[A.length-2],A[A.length-1])],C=e*o[0].length;P=P.concat(o[0]);var T=new oe.SplineCurve(P);for(x=1;x<=C;x++)S.push(T.getPointAt(x/C));break;case oe.PathActions.ARC:var E=o[0],z=o[1],D=o[2],L=o[3],R=o[4],N=!!o[5],B=R-L,I=2*e;for(x=1;x<=I;x++)_=x/I,N||(_=1-_),F=L+_*B,w=E+D*Math.cos(F),b=z+D*Math.sin(F),S.push(new oe.Vec3(w,b));break;case oe.PathActions.ELLIPSE:var F,E=o[0],z=o[1],V=o[2],U=o[3],L=o[4],R=o[5],N=!!o[6],B=R-L,I=2*e;for(x=1;x<=I;x++)_=x/I,N||(_=1-_),F=L+_*B,w=E+V*Math.cos(F),b=z+U*Math.sin(F),S.push(new oe.Vec3(w,b))}var k=S[S.length-1];return Math.abs(k.x-S[0].x)<1e-10&&Math.abs(k.y-S[0].y)<1e-10&&S.splice(S.length-1,1),t&&S.push(S[0]),S},oe.Path.prototype.toShapes=function(e){var i,r,a,n,o,s=[],l=new oe.Path;for(i=0,r=this.actions.length;i<r;i++)o=(a=this.actions[i]).args,(n=a.action)==oe.PathActions.MOVE_TO&&0!=l.actions.length&&(s.push(l),l=new oe.Path),l[n].apply(l,o);if(0!=l.actions.length&&s.push(l),0==s.length)return[];var h,c,u,f=[];if(1==s.length)return c=s[0],u=new oe.Shape,u.actions=c.actions,u.curves=c.curves,f.push(u),f;var p=!oe.Shape.Utils.isClockWise(s[0].getPoints());if(p=e?!p:p)for(u=new oe.Shape,i=0,r=s.length;i<r;i++)c=s[i],h=oe.Shape.Utils.isClockWise(c.getPoints()),(h=e?!h:h)?(u.actions=c.actions,u.curves=c.curves,f.push(u),u=new oe.Shape):u.holes.push(c);else{for(u=t,i=0,r=s.length;i<r;i++)c=s[i],h=oe.Shape.Utils.isClockWise(c.getPoints()),(h=e?!h:h)?(u&&f.push(u),(u=new oe.Shape).actions=c.actions,u.curves=c.curves):u.holes.push(c);f.push(u)}return f},oe.Shape=function(){oe.Path.apply(this,arguments),this.holes=[]},oe.Shape.prototype=Object.create(oe.Path.prototype),oe.Shape.prototype.extrude=function(e){return new oe.ShapeNode(this,e)},oe.Shape.prototype.makeGeometry=function(e){return new oe.ShapeGeometry(this,e)},oe.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},oe.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},oe.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},oe.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},oe.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},oe.Shape.Utils={removeHoles:function(e,t){var i,r,a,n,o,s,l,h,c,u,f,p,d,m,g,v,y=e.concat(),A=y.concat(),x=[];for(o=0;o<t.length;o++){for(l=t[o],Array.prototype.push.apply(A,l),h=Number.POSITIVE_INFINITY,s=0;s<l.length;s++){f=l[s];var _=[];for(u=0;u<y.length;u++)p=y[u],c=f.distanceToSquared(p),_.push(c),c<h&&(h=c,a=s,n=u)}i=n-1>=0?n-1:y.length-1,r=a-1>=0?a-1:l.length-1;var w=[l[a],y[n],y[i]],b=oe.FontUtils.Triangulate.area(w),M=[l[a],l[r],y[n]],S=oe.FontUtils.Triangulate.area(M),P=n,C=a;a+=-1,(n+=1)<0&&(n+=y.length),n%=y.length,a<0&&(a+=l.length),a%=l.length,i=n-1>=0?n-1:y.length-1,r=a-1>=0?a-1:l.length-1,w=[l[a],y[n],y[i]];var T=oe.FontUtils.Triangulate.area(w);M=[l[a],l[r],y[n]],b+S>T+oe.FontUtils.Triangulate.area(M)&&(a=C,(n=P)<0&&(n+=y.length),n%=y.length,a<0&&(a+=l.length),a%=l.length,i=n-1>=0?n-1:y.length-1,r=a-1>=0?a-1:l.length-1),d=y.slice(0,n),m=y.slice(n),g=l.slice(a),v=l.slice(0,a);var E=[l[a],y[n],y[i]],z=[l[a],l[r],y[n]];x.push(E),x.push(z),y=d.concat(g).concat(v).concat(m)}return{shape:y,isolatedPts:x,allpoints:A}},triangulateShape:function(e,i){var r,a,n,o,s,l,h=oe.Shape.Utils.removeHoles(e,i),c=h.shape,u=h.allpoints,f=h.isolatedPts,p=oe.FontUtils.Triangulate(c,!1),d={};for(r=0,a=u.length;r<a;r++)d[s=u[r].x+":"+u[r].y]!==t&&console.log("Duplicate point",s),d[s]=r;for(r=0,a=p.length;r<a;r++)for(o=p[r],n=0;n<3;n++)(l=d[s=o[n].x+":"+o[n].y])!==t&&(o[n]=l);for(r=0,a=f.length;r<a;r++)for(o=f[r],n=0;n<3;n++)(l=d[s=o[n].x+":"+o[n].y])!==t&&(o[n]=l);return p.concat(f)},isClockWise:function(e){return oe.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,a){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,a)}},oe.CubicBezierCurve3=oe.Curve.create(function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},function(e){var t,i,r;return t=oe.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=oe.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),r=oe.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new oe.Vec3(t,i,r)}),oe.QuadraticBezierCurve3=oe.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i,r;return t=oe.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=oe.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),r=oe.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new oe.Vec3(t,i,r)}),oe.PathNode=function(e,i,r,a,n,o,s,l,h,c){this.materialSize=1,this.closed=!1;var u;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof oe.Path)?(u=arguments[0],this.path=u.path,this.segments=u.segments||20,this.radius=u.radius||1,this.segmentsR=u.segmentsR||8,this.shape=u.shape,this.startCap=u.startCap||"plain",this.endCap=u.endCap||"plain",this.arc=u.arc!=t?u.arc:2*Math.PI,this.arcStart=u.arcStart!=t?u.arcStart:0,this.cutSurface=u.cutSurface||"none",this.startCapR=u.startCapR,this.endCapR=u.endCapR,this.startCapSize=u.startCapSize,this.endCapSize=u.endCapSize,this.binormal=u.binormal,this.startCapExtend=u.startCapExtend===t?1:u.startCapExtend,this.endCapExtend=u.endCapExtend===t?1:u.endCapExtend,this._id=u.id):(this.path=e,this.segments=i||20,this.radius=r||1,this.segmentsR=a||8,this.shape=s,this.startCap=n||"plain",this.endCap=o||"plain",this.arc=l!=t?l:2*Math.PI,this.arcStart=h!=t?h:0,this.cutSurface=c||"none"),this.shape instanceof Array&&(this.segmentsR=this.shape.length),this.startCapSize=this.startCapSize||1,this.endCapSize=this.endCapSize||1,this.segmentsCap=20,this.arc===2*Math.PI&&(this.cutSurface="none"),oe.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},oe.extend(oe.PathNode,oe.Entity,{constructor:oe.PathNode,className:"TGL.PathNode",__accessor:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],__SizePropeties:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],getCrossSectionPoint:function(){},needComputeVertexNormal:function(){return!0},adjustPath:function(e,t,i){t=t||this.radius,i=i||this._adjustTimes||2;var r,a,n,o,s,l,h,c,u,f,p,d=new oe.Path,m=new he,g=new he,v=new he,y=new he,A=e.actions.length;for(p=0;p<A;p++)if(n=e.actions[p],s=p+1===A?null:e.actions[p+1],o=n.args,"moveTo"===n.action)d.moveTo(o[0],o[1],o[2]);else if("lineTo"===n.action)if(s&&"lineTo"===s.action){if(r=e.actions[p-1],a=r.args,l=s.args,h=new he(a[0],a[1],a[2]),c=new he(o[0],o[1],o[2]),u=new he(l[0],l[1],l[2]),m.subVectors(c,h),g.subVectors(c,u),0==g.length()){e.actions.splice(p,1),p-=1,A-=1;continue}m.angleTo(g),f=Math.min(m.length()/2,g.length()/2),f=Math.min(t*i,f),v.addVectors(c,m.normalize().multiplyScalar(-f)),y.addVectors(c,g.normalize().multiplyScalar(-f)),d.lineTo(v.x,v.y,v.z),d.curveTo(c.x,c.y,c.z,y.x,y.y,y.z)}else d.lineTo(o[0],o[1],o[2]);else"quadraticCurveTo"===n.action&&d.curveTo(o[0],o[1],o[2],o[3],o[4],o[5]);return d},_resetPath:function(){return this.path},getPointAt:function(e){return this._realPath?this._realPath.getPoint(e):null},getTangentAt:function(e){if(this._realPath){var t=this._realPath.getPoint(e),i=this._realPath.getPoint(e-.001);return t.sub(i).normalize()}return null},computeData:function(){this.grid=[],this.startGrid=[],this.endGrid=[];var e,t,i,r,a,n,o,s,l,h,c,u,f,p,d=this.segmentsCap,m=new oe.Vec3,g={};if(g.faces=[],g.uvs=[],g.vertices=[],null==this.path)return g;var v=this._resetPath(),y=this.startCap,A=this.endCap,x=this.cutSurface;this._realPath=v,1==this._autoAjust&&(v=this.adjustPath(v));var _,w,b=v.curves.length,M=v.curves,S=[],P=v.getLength(),C=0,T=this.segments;for(s=0;s<b;s++){if(_=M[s],w=_.getLength(),_ instanceof oe.LineCurve3){var E=(1e-4*w+C)/P,z=(.9999*w+C)/P;S.push(E),S.push(z)}else{var D=.998*w;for(Z=0;Z<=T;Z++){var L=(.001*w+D*Z/T+C)/P;S.push(L)}}C+=w}var R=this.frenetFrames(v,S,this.closed,this.binormal),N=R.tangents,B=R.normals,I=R.binormals;this.tangents=N,this.normals=B,this.binormals=I;var F,V=0,U=S.length-1,k=U+1,O=0,X=0;for(s=0;s<k;s++){if(this.grid[s]=[],ue=S[s],o=v.getPointAt(ue),e=N[s],t=B[s],i=I[s],"none"!==y&&0===s)if("round"===y||"arrow"===y){O+=this.radius*this.startCapSize;for(var G=o.clone().add(e.clone().multiplyScalar(-this.radius*this.startCapSize)),W=0;W<=d;W++){this.startGrid[W]=[];q=W/d*Math.PI/2;j="round"===y?G.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*(1-Math.cos(q)))):G.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*W/d));for(Z=0;Z<this.segmentsR;Z++)r=Z/this.segmentsR*this.arc+this.arcStart,"round"===y?(a=-this.radius*Math.cos(r)*Math.sin(q),n=this.radius*Math.sin(r)*Math.sin(q)):(a=-this.radius*Math.cos(r)*W/d,n=this.radius*Math.sin(r)*W/d,a*=this.startCapR||1.3,n*=this.startCapR||1.3),(H=j.clone()).x+=a*t.x+n*i.x,H.y+=a*t.y+n*i.y,H.z+=a*t.z+n*i.z,this.startGrid[W][Z]=g.vertices.push(H)-1;"center"===x&&(this.startGrid[W][this.segmentsR]=g.vertices.push(j.clone())-1)}}else V=g.vertices.push(o);for(Z=0;Z<this.segmentsR;Z++){if(F=Z/(this.segmentsR-1),this.shape instanceof Array)a=-this.shape[Z].x,n=this.shape[Z].y;else if(this.shape instanceof oe.Path){var Y=this.shape.getPointAt(F);a=-Y.x,n=-Y.y}else r=Z/this.segmentsR*this.arc+this.arcStart,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);m.copy(o),m.x+=a*t.x+n*i.x,m.y+=a*t.y+n*i.y,m.z+=a*t.z+n*i.z,this.grid[s][Z]=function(e,t,i,r){return r.vertices.push(new oe.Vec3(e,t,i))-1}(m.x,m.y,m.z,g)}if("center"===x&&(this.grid[s][this.segmentsR]=g.vertices.push(o.clone())-1),"none"!==A&&s===k-1)if("round"===A||"arrow"===A){X+=this.radius*this.endCapSize;for(var j,H,G=o.clone().add(e.clone().multiplyScalar(this.radius*this.endCapSize)),W=0;W<=d;W++){this.endGrid[W]=[];var q=(1-W/d)*Math.PI/2;j="round"===A?G.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-Math.cos(q)))):G.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-W/d)));for(var Z=0;Z<this.segmentsR;Z++)r=Z/this.segmentsR*this.arc+this.arcStart,"round"===A?(a=-this.radius*Math.cos(r)*Math.sin(q),n=this.radius*Math.sin(r)*Math.sin(q)):(a=-this.radius*Math.cos(r)*(1-W/d),n=this.radius*Math.sin(r)*(1-W/d),a*=this.endCapR||1.3,n*=this.endCapR||1.3),(H=j.clone()).x+=a*t.x+n*i.x,H.y+=a*t.y+n*i.y,H.z+=a*t.z+n*i.z,this.endGrid[W][Z]=g.vertices.push(H)-1;"center"===x&&(this.endGrid[W][this.segmentsR]=g.vertices.push(j)-1)}}else g.vertices.push(o)}var Q=this.segmentsR,K=this.segmentsR;this.arc!==2*Math.PI&&("center"===x?(Q++,K++):"none"===x&&Q--);var J=this.arc/Math.PI/2,$=v.getLength(),ee=$+O+X,te=O/ee,ie=te,re=$/ee,ae=te+re,ne=X/ee;if("none"!==y)if("plain"===y)for(c=0,Z=0;Z<this.segmentsR;Z++){h=(Z+1)%this.segmentsR,u=this.grid[0][Z],_=this.grid[0][h],g.faces.push(new oe.Face3(c,u,_)),r=Z/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);se=new le(.5,.5);r=Z/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);he=new le((a/this.radius+1)/2,(n/this.radius+1)/2);r=h/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);ce=new le((a/this.radius+1)/2,(n/this.radius+1)/2);g.uvs.push([se,he,ce])}else for(s=0;s<=d;s++)for(Z=0;Z<Q;Z++){if(l=s+1,h=(Z+1)%K,c=this.startGrid[s][Z],l===d+1?(u=this.grid[0][Z],_=this.grid[0][h]):(u=this.startGrid[l][Z],_=this.startGrid[l][h]),f=this.startGrid[s][h],Z>=this.segmentsR-1){ue=(W=this.segmentsR-1)/this.segmentsR*J;Q===this.segmentsR?(se=new oe.Vec2(s/d*te+0,ue),he=new oe.Vec2((s+1)/d*te+0,ue),ce=new oe.Vec2((s+1)/d*te+0,1),p=new oe.Vec2(s/d*te+0,1)):Z>this.segmentsR-1?(se=new oe.Vec2(s/d*te+0,(1+ue)/2),he=new oe.Vec2((s+1)/d*te+0,(1+ue)/2),ce=new oe.Vec2((s+1)/d*te+0,1),p=new oe.Vec2(s/d*te+0,1)):(se=new oe.Vec2(s/d*te+0,ue),he=new oe.Vec2((s+1)/d*te+0,ue),ce=new oe.Vec2((s+1)/d*te+0,(1+ue)/2),p=new oe.Vec2(s/d*te+0,(1+ue)/2))}else se=new oe.Vec2(s/d*te+0,Z/this.segmentsR*J),he=new oe.Vec2((s+1)/d*te+0,Z/this.segmentsR*J),ce=new oe.Vec2((s+1)/d*te+0,(Z+1)/this.segmentsR*J),p=new oe.Vec2(s/d*te+0,(Z+1)/this.segmentsR*J);0!==s&&(g.faces.push(new oe.Face3(c,u,f,V-1)),g.uvs.push([se,he,p])),g.faces.push(new oe.Face3(u,_,f,V-1)),g.uvs.push([he.clone(),ce,p.clone()])}for(s=0;s<U;s++)for(Z=0;Z<Q;Z++){if(l=this.closed?(s+1)%U:s+1,h=(Z+1)%K,c=this.grid[s][Z],u=this.grid[l][Z],_=this.grid[l][h],f=this.grid[s][h],Z>=this.segmentsR-1){ue=(W=this.segmentsR-1)/this.segmentsR*J;Q===this.segmentsR?(se=new oe.Vec2(S[s]*re+ie,ue),he=new oe.Vec2(S[s+1]*re+ie,ue),ce=new oe.Vec2(S[s+1]*re+ie,1),p=new oe.Vec2(S[s]*re+ie,1)):Z>this.segmentsR-1?(se=new oe.Vec2(S[s]*re+ie,(ue+1)/2),he=new oe.Vec2(S[s+1]*re+ie,(ue+1)/2),ce=new oe.Vec2(S[s+1]*re+ie,1),p=new oe.Vec2(S[s]*re+ie,1)):(se=new oe.Vec2(S[s]*re+ie,ue),he=new oe.Vec2(S[s+1]*re+ie,ue),ce=new oe.Vec2(S[s+1]*re+ie,(ue+1)/2),p=new oe.Vec2(S[s]*re+ie,(ue+1)/2))}else se=new oe.Vec2(S[s]*re+ie,Z/this.segmentsR*J),he=new oe.Vec2(S[s+1]*re+ie,Z/this.segmentsR*J),ce=new oe.Vec2(S[s+1]*re+ie,(Z+1)/this.segmentsR*J),p=new oe.Vec2(S[s]*re+ie,(Z+1)/this.segmentsR*J);g.faces.push(new oe.Face3(c,u,f)),g.uvs.push([se,he,p]),g.faces.push(new oe.Face3(u,_,f)),g.uvs.push([he.clone(),ce,p.clone()])}if("none"!==A){c=g.vertices.length-1;b=this.grid.length;if("plain"===A)for(Z=0;Z<this.segmentsR;Z++){h=(Z+1)%this.segmentsR,u=this.grid[b-1][Z],_=this.grid[b-1][h],g.faces.push(new oe.Face3(c,_,u)),r=Z/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);var se=new le(.5,.5);r=Z/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);var he=new le((a/this.radius+1)/2,(n/this.radius+1)/2);r=h/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);var ce=new le((a/this.radius+1)/2,(n/this.radius+1)/2);g.uvs.push([se,ce,he])}else for(s=-1;s<d;s++)for(Z=0;Z<Q;Z++){if(l=s+1,h=(Z+1)%K,-1===s?(c=this.grid[b-1][Z],f=this.grid[b-1][h]):(c=this.endGrid[s][Z],f=this.endGrid[s][h]),u=this.endGrid[l][Z],_=this.endGrid[l][h],Z>=this.segmentsR-1){var ue=(W=this.segmentsR-1)/this.segmentsR*J;Q===this.segmentsR?(se=new oe.Vec2(s/d*ne+ae,ue),he=new oe.Vec2((s+1)/d*ne+ae,ue),ce=new oe.Vec2((s+1)/d*ne+ae,1),p=new oe.Vec2(s/d*ne+ae,1)):Z>this.segmentsR-1?(se=new oe.Vec2(s/d*ne+ae,(1+ue)/2),he=new oe.Vec2((s+1)/d*ne+ae,(1+ue)/2),ce=new oe.Vec2((s+1)/d*ne+ae,1),p=new oe.Vec2(s/d*ne+ae,1)):(se=new oe.Vec2(s/d*ne+ae,ue),he=new oe.Vec2((s+1)/d*ne+ae,ue),ce=new oe.Vec2((s+1)/d*ne+ae,(1+ue)/2),p=new oe.Vec2(s/d*ne+ae,(1+ue)/2))}else se=new oe.Vec2(s/d*ne+ae,Z/this.segmentsR*J),he=new oe.Vec2((s+1)/d*ne+ae,Z/this.segmentsR*J),ce=new oe.Vec2((s+1)/d*ne+ae,(Z+1)/this.segmentsR*J),p=new oe.Vec2(s/d*ne+ae,(Z+1)/this.segmentsR*J);g.faces.push(new oe.Face3(c,u,f)),g.uvs.push([se,he,p]),g.faces.push(new oe.Face3(u,_,f)),g.uvs.push([he.clone(),ce,p.clone()])}}return g},frenetFrames:function(e,t,i,r){new oe.Vec3;var a,n,o,s,l,h,c,u=new oe.Vec3,f=(new oe.Vec3,[]),p=[],d=[],m=new oe.Vec3,g=new oe.Mat4,v=t.length-1+1,y=1e-4,A=[];for(A.tangents=f,A.normals=p,A.binormals=d,h=0;h<v;h++){c=t[h];var x=e.getTangentAt(c);f[h]=new oe.Vec3(x.x,x.y,x.z?x.z:0),f[h].normalize()}for(p[0]=new oe.Vec3,d[0]=new oe.Vec3,n=Number.MAX_VALUE,o=Math.abs(f[0].x),s=Math.abs(f[0].y),l=Math.abs(f[0].z),s<=n&&(n=s,u.set(0,1,0)),o<=n&&(n=o,u.set(1,0,0)),l<=n&&u.set(0,0,1),r&&(u=r.clone()),m.crossVectors(f[0],u).normalize(),p[0].crossVectors(f[0],m),d[0].crossVectors(f[0],p[0]),h=1;h<v;h++)p[h]=p[h-1].clone(),d[h]=d[h-1].clone(),m.crossVectors(f[h-1],f[h]),m.length()>y&&(m.normalize(),a=Math.acos(oe.Math.clamp(f[h-1].dot(f[h]),-1,1)),p[h].applyMatrix4(g.makeRotationAxis(m,a))),d[h].crossVectors(f[h],p[h]);if(i)for(a=Math.acos(oe.Math.clamp(p[0].dot(p[v-1]),-1,1)),a/=v-1,f[0].dot(m.crossVectors(p[0],p[v-1]))>0&&(a=-a),h=1;h<v;h++)p[h].applyMatrix4(g.makeRotationAxis(f[h],a*h)),d[h].crossVectors(f[h],p[h]);return A}}),oe.PathCube=function(e,t,i,r,a){var n;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof oe.Path)?(n=arguments[0],this.path=n.path,this.width=n.width||50,this.height=n.height||100,this.curveSegements=n.curveSegements||32,this.repeat=n.repeat||20,this._id=n.id):(this.path=e,this.width=t||50,this.height=i||100,this.curveSegements=r||32,this.repeat=a||20),this.materialSize=6,oe.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},oe.PathCube.SideIndexMapping={bottom:0,outside:1,inside:2,top:3,aside:4,zside:5},oe.extend(oe.PathCube,oe.Entity,{__accessor:["path","width","height","curveSegements","repeat"],__SizePropeties:["path","width","height","curveSegements","repeat"],constructor:oe.PathCube,className:"TGL.PathCube",getSideIndexMapping:function(){return oe.PathCube.SideIndexMapping},computeData:function(){var e={};if(e.vertices=[],e.faces=[],e.uvs=[],e.uv2s=[],null==this.path)return e;var t,i=this.computePoints(this.path,this.width,this.curveSegements),r=i[0],a=i[1],n=r.length,o=i[2],s=this.height,l=this.repeat,h=[],c=[],u=[],f=[],p=this.path.isClockwise();for(this.innerPoints=this.clonePoints(r),this.outerPoints=this.clonePoints(a),t=0;t<n;t++)this.exchangeYZ(r[t]),this.exchangeYZ(a[t]),h[t]=e.vertices.push(r[t])-1,c[t]=e.vertices.push(a[t])-1,u[t]=e.vertices.push(r[t].clone().setY(s))-1,f[t]=e.vertices.push(a[t].clone().setY(s))-1;var d=o?n:n-1;for(t=0;t<d;t++)this.generateTop(e,t,n,u,f,!0,l),this.generateBottom(e,t,n,h,c,l),this.generateSideWall(e,t,n,f,c,!0,l,p),this.generateSideWall(e,t,n,u,h,!1,l,p);return o||(this.generateEnd(e,u,h,c,f,l,!0),this.generateEnd(e,u,h,c,f,l,!1)),this.clockwise=p,e},clonePoints:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].clone());return t},getInsidePoints:function(){return this.clockwise?this.innerPoints:this.outerPoints},generateEnd:function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m,g,v,y,A,x,_,w,b,M,S,P,C=o?0:i.length-1;s=t[C],l=i[C],h=r[C],c=a[C],b=e.vertices[s],M=e.vertices[l],S=e.vertices[h],P=e.vertices[c],u=b.x,f=b.y,p=b.z,d=M.x,m=M.y,g=M.z,v=S.x,y=S.y,_=S.z,A=P.x,x=P.y,w=P.z;var T=Math.abs(p-_),E=Math.abs(u-v);o?(e.faces.push(new oe.Face3(s,l,c,null,null,4)),T<E?e.uvs.push([new oe.Vec2(u/n,f/n),new oe.Vec2(d/n,m/n),new oe.Vec2(A/n,x/n)]):e.uvs.push([new oe.Vec2(p/n,f/n),new oe.Vec2(g/n,m/n),new oe.Vec2(w/n,x/n)]),e.uv2s.push([new le(0,1),new le(0,0),new le(1,1)]),e.faces.push(new oe.Face3(l,h,c,null,null,4)),T<E?e.uvs.push([new oe.Vec2(d/n,m/n),new oe.Vec2(v/n,y/n),new oe.Vec2(A/n,x/n)]):e.uvs.push([new oe.Vec2(g/n,m/n),new oe.Vec2(_/n,y/n),new oe.Vec2(w/n,x/n)]),e.uv2s.push([new le(0,0),new le(1,0),new le(1,1)])):(e.faces.push(new oe.Face3(l,s,c,null,null,5)),T<E?e.uvs.push([new oe.Vec2(d/n,m/n),new oe.Vec2(u/n,f/n),new oe.Vec2(A/n,x/n)]):e.uvs.push([new oe.Vec2(g/n,m/n),new oe.Vec2(p/n,f/n),new oe.Vec2(w/n,x/n)]),e.uv2s.push([new le(0,0),new le(0,1),new le(1,1)]),e.faces.push(new oe.Face3(h,l,c,null,null,5)),T<E?e.uvs.push([new oe.Vec2(v/n,y/n),new oe.Vec2(d/n,m/n),new oe.Vec2(A/n,x/n)]):e.uvs.push([new oe.Vec2(_/n,y/n),new oe.Vec2(g/n,m/n),new oe.Vec2(w/n,x/n)]),e.uv2s.push([new le(1,0),new le(0,0),new le(1,1)]))},generateSideWall:function(e,t,i,r,a,n,o,s){var l,h,c,u,f,p,d,m,g,v,y,A,x,_,w,b,M,S,P,C,T;b=(t+1)%i,l=r[t],h=a[t],c=a[b],u=r[b],S=e.vertices[l],P=e.vertices[h],C=e.vertices[c],T=e.vertices[u],f=S.x,p=S.y,d=S.z,m=P.x,g=P.y,v=P.z,y=C.x,A=C.y,w=C.z,x=T.x,_=T.y,M=T.z;var E,z=Math.abs(d-w),D=Math.abs(f-y);n?(E=s?1:2,e.faces.push(new oe.Face3(l,h,u,null,null,E)),z<D?e.uvs.push([new oe.Vec2(f/o,p/o),new oe.Vec2(m/o,g/o),new oe.Vec2(x/o,_/o)]):e.uvs.push([new oe.Vec2(d/o,p/o),new oe.Vec2(v/o,g/o),new oe.Vec2(M/o,_/o)]),e.uv2s.push([new le(0,1),new le(0,0),new le(1,1)]),e.faces.push(new oe.Face3(h,c,u,null,null,E)),z<D?e.uvs.push([new oe.Vec2(m/o,g/o),new oe.Vec2(y/o,A/o),new oe.Vec2(x/o,_/o)]):e.uvs.push([new oe.Vec2(v/o,g/o),new oe.Vec2(w/o,A/o),new oe.Vec2(M/o,_/o)]),e.uv2s.push([new le(0,0),new le(1,0),new le(1,1)])):(E=s?2:1,e.faces.push(new oe.Face3(h,l,u,null,null,E)),z<D?e.uvs.push([new oe.Vec2(m/o,g/o),new oe.Vec2(f/o,p/o),new oe.Vec2(x/o,_/o)]):e.uvs.push([new oe.Vec2(v/o,g/o),new oe.Vec2(d/o,p/o),new oe.Vec2(M/o,_/o)]),e.uv2s.push([new le(0,0),new le(0,1),new le(1,1)]),e.faces.push(new oe.Face3(c,h,u,null,null,E)),z<D?e.uvs.push([new oe.Vec2(y/o,A/o),new oe.Vec2(m/o,g/o),new oe.Vec2(x/o,_/o)]):e.uvs.push([new oe.Vec2(w/o,A/o),new oe.Vec2(v/o,g/o),new oe.Vec2(M/o,_/o)]),e.uv2s.push([new le(1,0),new le(0,0),new le(1,1)]))},generateBottom:function(e,t,i,r,a,n){this.generateTop(e,t,i,r,a,!1,n)},generateTop:function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m,g,v,y,A,x,_,w,b;A=(t+1)%i,s=r[t],l=a[t],h=a[A],c=r[A],x=e.vertices[s],_=e.vertices[l],w=e.vertices[h],b=e.vertices[c],u=x.x,x.y,f=x.z,p=_.x,_.y,d=_.z,m=w.x,w.y,y=w.z,g=b.x,b.y,v=b.z,n?(e.faces.push(new oe.Face3(s,l,c,null,null,3)),e.uvs.push([new oe.Vec2(u/o,f/o),new oe.Vec2(p/o,d/o),new oe.Vec2(g/o,v/o)]),e.uv2s.push([new le(0,1),new le(0,0),new le(1,1)]),e.faces.push(new oe.Face3(l,h,c,null,null,3)),e.uvs.push([new oe.Vec2(p/o,d/o),new oe.Vec2(m/o,y/o),new oe.Vec2(g/o,v/o)]),e.uv2s.push([new le(0,0),new le(1,0),new le(1,1)])):(e.faces.push(new oe.Face3(l,s,c,null,null,0)),e.uvs.push([new oe.Vec2(p/o,d/o),new oe.Vec2(u/o,f/o),new oe.Vec2(g/o,v/o)]),e.uv2s.push([new le(0,0),new le(0,1),new le(1,1)]),e.faces.push(new oe.Face3(h,l,c,null,null,0)),e.uvs.push([new oe.Vec2(m/o,y/o),new oe.Vec2(p/o,d/o),new oe.Vec2(g/o,v/o)]),e.uv2s.push([new le(1,0),new le(0,0),new le(1,1)]))},exchangeYZ:function(e){var t=e.y;e.y=e.z,e.z=-t},addPoints:function(e,t,i,r,a){t.multiplyScalar(.5),i.push((new oe.Vec3).subVectors(e,t)),r.push((new oe.Vec3).addVectors(e,t))},computeCurvePoint:function(e,t,i,r,a,n,o,s,l){var h,c,u,f,p,d,m,g,v=r?0:1,y=new oe.Vec3,A=s;if(e){c=e.getTangentAt(1),u=t.getTangentAt(0),p=oe.Math.isConcave(c,u,!1),u.multiplyScalar(-1),d=c.angleTo(u),f=Math.sin(d/2),h=t.getPoint(0),f=0==f?.1:f;var x=p?i/f:-i/f;1==f?y.crossVectors(u,new he(0,0,1)).normalize().multiplyScalar(x):y.addVectors(c,u).normalize().multiplyScalar(x),this.addPoints(h,y,n,o,l)}else u=t.getTangentAt(v),h=t.getPoint(v),y.crossVectors(u,new oe.Vec3(0,0,1)).normalize().multiplyScalar(i),this.addPoints(h,y,n,o,l);if(!(t instanceof oe.LineCurve3)&&a){var _=A+1;for(m=0;m<_-2;m++)g=m/(_-1),u=t.getTangentAt(g),h=t.getPointAt(g),y.crossVectors(u,new oe.Vec3(0,0,1)).normalize().multiplyScalar(i),m*t.getLength()/A>i/Math.abs(f)&&this.addPoints(h,y,n,o,l)}},computePoints:function(e,t,i){new oe.Vec3;var r,a,n,o=e.isClockwise(),s=e.curves[0].getPoint(0),l=e.curves[e.curves.length-1].getPoint(1);n=s.equals(l),a=e.curves.length;var h=[],c=[];new oe.Path,e.getLength();for(r=0;r<a;r++){var u=r-1;n&&-1===u&&(u=a-1);var f=e.curves[u],p=e.curves[r];this.computeCurvePoint(f,p,t,!0,!0,h,c,i,o),r!==a-1||n||this.computeCurvePoint(null,p,t,!1,!1,h,c,i,o)}return[h,c,n]}}),oe.ShapeNode=function(e,t,i,r,a){if(null==e)return e=[],this.materialSize=3,void oe.Entity.call(this);var n;if(!(1===arguments.length&&arguments[0]instanceof Object)||arguments[0]instanceof oe.Shape||arguments[0]instanceof oe.Path&&!Array.isArray(arguments[0]))this.options={curveSegments:t,amount:i,vertical:r,zMinusHalfAmount:this.zMinusHalfAmount,repeat:a||20};else{if(n=arguments[0],null==(e=n.path))return e=[],this.materialSize=3,void oe.Entity.call(this);t=n.curveSegments,i=n.amount,r=n.vertical,a=n.repeat,this.options={curveSegments:n.curveSegments,amount:n.amount,vertical:n.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:n.repeat||20},this._id=n.id}var o=[];e instanceof oe.Path?(o=e.toShapes(),this.path=e):o=e,this.curveSegments=t,this.amount=i,this.vertical=r,this.repeat=a||20,o=o instanceof Array?o:[o],this.shapes=o,this.shapebb=o[o.length-1].getBoundingBox(),this.materialSize=3,oe.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},oe.ShapeNode.SideIndexMapping={bottom:0,side:1,top:2},oe.extend(oe.ShapeNode,oe.Entity,{constructor:oe.ShapeNode,className:"TGL.ShapeNode",__accessor:["path","curveSegments","amount","vertical","repeat"],__bool:["vertical"],__SizePropeties:["path","curveSegments","amount","vertical","repeat"],computeData:function(){return this.options={curveSegments:this.curveSegments,amount:this.amount,vertical:this.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:this.repeat||20},this.addShapes(this.path,this.options)},getSideIndexMapping:function(){return oe.ShapeNode.SideIndexMapping},addShapes:function(e,t){var i=[];i=e instanceof oe.Path?e.toShapes():e;var r={};if(r.vertices=[],r.uvs=[],r.uv2s=[],r.faces=[],!i)return r;for(var a=i.length,n=0;n<a;n++){var o=i[n];this.addShape(o,t,r)}var s=new oe.BoundingBox;s.setFromPoints(r.vertices);var l=(s.max.y-s.min.y)/2;if(t.zMinusHalfAmount)for(h=0;h<r.vertices.length;h++)r.vertices[h].y-=l;if(t.vertical)for(var h=0;h<r.vertices.length;h++){var c=r.vertices[h].y;r.vertices[h].y=r.vertices[h].z,r.vertices[h].z=-c}return r}}),oe.ShapeNode.prototype.addShape=function(e,i,r){function a(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}function n(e,t,i){return s(e,t,i)}function o(e,t,i){var r=Math.atan2(t.y-e.y,t.x-e.x),a=Math.atan2(i.y-e.y,i.x-e.x);r>a&&(a+=2*Math.PI);var n=(r+a)/2,o=-Math.cos(n),s=-Math.sin(n);return new oe.Vec2(o,s)}function s(e,t,i){var r,a,n,s,l,h=oe.ShapeNode.__v1,c=oe.ShapeNode.__v2,u=oe.ShapeNode.__v3,f=oe.ShapeNode.__v4,p=oe.ShapeNode.__v5,d=oe.ShapeNode.__v6;return h.set(e.x-t.x,e.y-t.y),c.set(e.x-i.x,e.y-i.y),r=h.normalize(),a=c.normalize(),u.set(-r.y,r.x),f.set(a.y,-a.x),p.copy(e).add(u),d.copy(e).add(f),p.equals(d)?f.clone():(p.copy(t).add(u),d.copy(i).add(f),n=r.dot(f),s=d.sub(p).dot(f),0===n&&(console.log("Either infinite or no solutions!"),0===s?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),(l=s/n)<0?o(e,t,i):r.multiplyScalar(l).add(p).sub(e).clone())}function l(e){for(var t=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=e;o<r.uvs.length;o++)for(var s=r.uvs[o],l=0;l<s.length;l++)(f=s[l]).x>a&&(a=f.x),f.y>n&&(n=f.y),f.x<t&&(t=f.x),f.y<i&&(i=f.y);for(var h=a-t,c=n-i,o=e;o<r.uvs.length;o++){for(var s=r.uvs[o],u=[],l=0;l<s.length;l++){var f=s[l];u.push(new le((f.x-t)/h,(f.y-i)/c))}r.uv2s.push(u)}}function h(e,t){var i,r;for(Z=e.length;--Z>=0;){i=Z,(r=Z-1)<0&&(r=e.length-1);var a=0,n=_+2*y;for(a=0;a<n;a++){var o=j*a,s=j*(a+1);f(t+i+o,t+r+o,t+r+s,t+i+s,e,a,n,i,r)}}}function c(e,t,i){r.vertices.push(new oe.Vec3(e,t,i-(m?d/2:0)))}function u(t,a,n,o){t+=R,a+=R,n+=R;var s=o?0:2;if(oe.Math.isClockwise([r.vertices[t],r.vertices[a],r.vertices[n]]),"z"){r.faces.push(new oe.Face3(t,a,n,null,null,s));l=o?S.generateBottomUV(r,e,i,t,a,n):S.generateTopUV(r,e,i,t,a,n);r.uvs.push(l)}else{r.faces.push(new oe.Face3(t,n,a,null,null,s));var l=o?S.generateBottomUV(r,e,i,t,n,a):S.generateTopUV(r,e,i,t,n,a);r.uvs.push(l)}}function f(t,a,n,o,s,l,h,c,u){if(t+=R,a+=R,n+=R,o+=R,oe.Math.isClockwise([r.vertices[t],r.vertices[a],r.vertices[o]]),"z"){r.faces.push(new oe.Face3(t,a,o,null,null,M)),r.faces.push(new oe.Face3(a,n,o,null,null,M));f=S.generateSideWallUV(r,e,s,i,t,a,n,o,l,h,c,u);r.uvs.push([f[0],f[1],f[3]]),r.uvs.push([f[1],f[2],f[3]])}else{r.faces.push(new oe.Face3(t,o,a,null,null,M)),r.faces.push(new oe.Face3(a,o,n,null,null,M));var f=S.generateSideWallUV(r,e,s,i,t,a,n,o,l,h,c,u);r.uvs.push([f[0],f[3],f[1]]),r.uvs.push([f[1],f[3],f[2]])}}var p,d=i.amount!==t?i.amount:100,m=i.zMinusHalfAmount!==t&&i.zMinusHalfAmount,g=i.bevelThickness!==t?i.bevelThickness:6,v=i.bevelSize!==t?i.bevelSize:g-2,y=i.bevelSegments!==t?i.bevelSegments:3,A=i.bevelEnabled!==t&&i.bevelEnabled,x=i.curveSegments!==t?i.curveSegments:12,_=i.steps!==t?i.steps:1,w=i.extrudePath,b=!1,M=(i.material,i.extrudeMaterial||1),S=i.UVGenerator!==t?i.UVGenerator:oe.ShapeNode.WorldUVGenerator;S.repeat=i.repeat,S.amount=d;var P,C,T,E;this.shapebb;w&&(p=w.getSpacedPoints(_),b=!0,A=!1,P=i.frames!==t?i.frames:oe.PathNode.prototype.frenetFrames(w,_,!1),C=new oe.Vec3,T=new oe.Vec3,E=new oe.Vec3),A||(y=0,g=0,v=0);var z,D,L,R=r.vertices.length,N=e.extractPoints(x),B=N.shape,I=N.holes,F=!oe.Shape.Utils.isClockWise(B);if(F){for(B=B.reverse(),D=0,L=I.length;D<L;D++)z=I[D],oe.Shape.Utils.isClockWise(z)&&(I[D]=z.reverse());F=!1}var V=oe.Shape.Utils.triangulateShape(B,I),U=B;for(D=0,L=I.length;D<L;D++)z=I[D],B=B.concat(z);for(var k,O,X,G,W,Y,j=B.length,H=V.length,q=(U.length,Math.PI,[]),Z=0,Q=U.length,K=Q-1,J=Z+1;Z<Q;Z++,K++,J++){K===Q&&(K=0),J===Q&&(J=0);U[Z],U[K],U[J];q[Z]=n(U[Z],U[K],U[J])}var $,ee=[],te=q.concat();for(D=0,L=I.length;D<L;D++){for(z=I[D],$=[],Z=0,K=(Q=z.length)-1,J=Z+1;Z<Q;Z++,K++,J++)K===Q&&(K=0),J===Q&&(J=0),$[Z]=n(z[Z],z[K],z[J]);ee.push($),te=te.concat($)}for(k=0;k<y;k++){for(G=g*(1-(X=k/y)),O=v*Math.sin(X*Math.PI/2),Z=0,Q=U.length;Z<Q;Z++)c((W=a(U[Z],q[Z],O)).x,W.y,-G);for(D=0,L=I.length;D<L;D++)for(z=I[D],$=ee[D],Z=0,Q=z.length;Z<Q;Z++)c((W=a(z[Z],$[Z],O)).x,W.y,-G)}for(O=v,Z=0;Z<j;Z++)W=A?a(B[Z],te[Z],O):B[Z],b?(T.copy(P.normals[0]).multiplyScalar(W.x),C.copy(P.binormals[0]).multiplyScalar(W.y),E.copy(p[0]).add(T).add(C),c(E.x,E.y,E.z)):c(W.x,W.y,0);var ie;for(ie=1;ie<=_;ie++)for(Z=0;Z<j;Z++)W=A?a(B[Z],te[Z],O):B[Z],b?(T.copy(P.normals[ie]).multiplyScalar(W.x),C.copy(P.binormals[ie]).multiplyScalar(W.y),E.copy(p[ie]).add(T).add(C),c(E.x,E.y,E.z)):c(W.x,W.y,d/_*ie);for(k=y-1;k>=0;k--){for(G=g*(1-(X=k/y)),O=v*Math.sin(X*Math.PI/2),Z=0,Q=U.length;Z<Q;Z++)c((W=a(U[Z],q[Z],O)).x,W.y,d+G);for(D=0,L=I.length;D<L;D++)for(z=I[D],$=ee[D],Z=0,Q=z.length;Z<Q;Z++)W=a(z[Z],$[Z],O),b?c(W.x,W.y+p[_-1].y,p[_-1].x+G):c(W.x,W.y,d+G)}!function(){var e=r.uvs.length;if(A){var t=0,i=j*t;for(Z=0;Z<H;Z++)u((Y=V[Z])[2]+i,Y[1]+i,Y[0]+i,!0);for(i=j*(t=_+2*y),Z=0;Z<H;Z++)u((Y=V[Z])[0]+i,Y[1]+i,Y[2]+i,!1)}else{for(Z=0;Z<H;Z++)u((Y=V[Z])[2],Y[1],Y[0],!0);for(Z=0;Z<H;Z++)u((Y=V[Z])[0]+j*_,Y[1]+j*_,Y[2]+j*_,!1)}l(e)}(),function(){var e=r.uvs.length,t=0;for(h(U,t),t+=U.length,D=0,L=I.length;D<L;D++)h(z=I[D],t),t+=z.length;l(e)}()},oe.ShapeNode.WorldUVGenerator={generateTopUV:function(e,t,i,r,a,n){var o=e.vertices[r].x,s=e.vertices[r].y,l=e.vertices[a].x,h=e.vertices[a].y,c=e.vertices[n].x,u=e.vertices[n].y;return[new oe.Vec2(o/this.repeat,s/this.repeat),new oe.Vec2(l/this.repeat,h/this.repeat),new oe.Vec2(c/this.repeat,u/this.repeat)]},generateBottomUV:function(e,t,i,r,a,n){return this.generateTopUV(e,t,i,r,a,n)},uv:function(e,t,i){return new le(Math.sqrt(e*e+t*t)/this.repeat,(1-i)/this.repeat)},generateSideWallUV:function(e,t,i,r,a,n,o,s,l,h,c,u){var f=e.vertices[a].x,p=e.vertices[a].y,d=e.vertices[a].z,m=e.vertices[n].x,g=e.vertices[n].y,v=e.vertices[n].z,y=e.vertices[o].x,A=e.vertices[o].y,x=e.vertices[o].z,_=e.vertices[s].x,w=e.vertices[s].y,b=e.vertices[s].z;return Math.abs(p-g)<Math.abs(f-m)?[new oe.Vec2(f/this.repeat,(this.amount-d)/this.repeat),new oe.Vec2(m/this.repeat,(this.amount-v)/this.repeat),new oe.Vec2(y/this.repeat,(this.amount-x)/this.repeat),new oe.Vec2(_/this.repeat,(this.amount-b)/this.repeat)]:[new oe.Vec2(p/this.repeat,(this.amount-d)/this.repeat),new oe.Vec2(g/this.repeat,(this.amount-v)/this.repeat),new oe.Vec2(A/this.repeat,(this.amount-x)/this.repeat),new oe.Vec2(w/this.repeat,(this.amount-b)/this.repeat)]}},oe.ShapeNode.__v1=new oe.Vec2,oe.ShapeNode.__v2=new oe.Vec2,oe.ShapeNode.__v3=new oe.Vec2,oe.ShapeNode.__v4=new oe.Vec2,oe.ShapeNode.__v5=new oe.Vec2,oe.ShapeNode.__v6=new oe.Vec2,oe.TextNode=function(e,i,r,a,n,o,s){var l;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(e=(l=arguments[0]).text,this.font=l.font||"helvetiker",this.size=l.size||150,this.weight=l.weight||"normal",this.fontStyle=l.fontStyle||"normal",this.height=l.height||50,this._id=l.id,this.curveSegments=l.curveSegments):(this.font=a||"helvetiker",this.size=i||150,this.weight=n||"normal",this.fontStyle=o||"normal",this.height=r||50,this.curveSegments=s);var h={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0};this.text=e;var c=oe.FontUtils.generateShapes(e,h);h.amount=h.height!==t?h.height:50,h.bevelThickness===t&&(h.bevelThickness=10),h.bevelSize===t&&(h.bevelSize=8),h.bevelEnabled===t&&(h.bevelEnabled=!1),oe.ShapeNode.call(this,c,h.curveSegments,this.height,!1,50,!0)},oe.extend(oe.TextNode,oe.ShapeNode,{constructor:oe.TextNode,className:"TGL.TextNode",__accessor:["text","size","height","font","weight","fontStyle"],__SizePropeties:["text","size","height","font","weight","fontStyle"],computeData:function(){var e={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0},t={curveSegments:this.curveSegments,amount:this.height,vertical:!1,zMinusHalfAmount:!0,repeat:20},i=oe.FontUtils.generateShapes(this.text,e);return oe.ShapeNode.prototype.addShapes.call(this,i,t)}}),oe.LatheNode=function(e,i,r,a,n,o){this.materialSize=3;var s;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof oe.Path)?(s=arguments[0],this.path=s.path,this.segmentsH=s.segmentsH||64,this.segmentsR=s.segmentsR||20,this.arc=s.arc!=t?s.arc:2*Math.PI,this.startClosed=s.startClosed,this.endClosed=s.endClosed,this._id=s.id):(this.path=e,this.segmentsH=i||64,this.segmentsR=r||20,this.arc=a!=t?a:2*Math.PI,this.startClosed=n,this.endClosed=o),oe.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},oe.extend(oe.LatheNode,oe.Entity,{constructor:oe.LatheNode,className:"TGL.LatheNode",__accessor:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],__SizePropeties:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],computeData:function(){function e(e){var t=e.x,i=e.z,r=(1+(0===i?t/Math.abs(t):t/Math.abs(i)))/2;r=oe.Math.clamp(r,0,1);var a=(1+(0===t?i/Math.abs(i):i/Math.abs(t)))/2;return a=oe.Math.clamp(a,0,1),new oe.Vec2(r,a)}var t={};if((t={}).faces=[],t.uvs=[],t.vertices=[],null==this.path)return t;var i,r,a,n,o,s,l,h=[],c=this.path,u=this.segmentsH,f=this.segmentsR;for(oe.Shape.Utils.isClockWise(c.getPoints())||(c=c.reverse()),r=0;r<=u;r++){for(i=c.getPoint(r/u),h[r]=[],n=Math.abs(i.x),o=i.y,this.startClosed&&0===r&&t.vertices.push(new oe.Vec3(0,o,0)),a=0;a<f;a++)l=a/f*this.arc,s=new oe.Vec3(n*Math.cos(l),o,n*Math.sin(l)),h[r][a]=t.vertices.push(s)-1;this.endClosed&&r===u&&t.vertices.push(new oe.Vec3(0,o,0))}var p,d,m,g,v,y,A,x,_,w,b=this.arc==2*Math.PI;if(this.startClosed)for(p=0,a=0;a<(b?f:f-1);a++)d=(a+1)%f,m=h[0][a],g=h[0][d],v=new oe.Vec2(.5,.5),y=e(t.vertices[m]),A=e(t.vertices[g]),t.faces.push(new oe.Face3(p,m,g)),t.uvs.push([v,y,A]);for(r=0;r<u;r++)for(a=0;a<(b?f:f-1);a++)_=r+1,d=(a+1)%f,p=h[r][a],m=h[_][a],g=h[_][d],w=h[r][d],v=new oe.Vec2(r/u,a/f),y=new oe.Vec2((r+1)/u,a/f),A=new oe.Vec2((r+1)/u,(a+1)/f),x=new oe.Vec2(r/u,(a+1)/f),t.faces.push(new oe.Face3(p,m,w)),t.uvs.push([v,y,x]),t.faces.push(new oe.Face3(m,g,w)),t.uvs.push([y.clone(),A,x.clone()]);if(this.endClosed)for(p=t.vertices.length-1,a=0;a<(b?f:f-1);a++)d=(a+1)%f,m=h[h.length-1][a],g=h[h.length-1][d],v=new oe.Vec2(0,0),y=new oe.Vec2(1,a/f),A=new oe.Vec2(1,(a+1)/f),t.faces.push(new oe.Face3(p,m,g)),t.uvs.push([v,y,A]);return t}}),oe.CurvePlane=function(e,t,i,r){this.pathH=e,this.pathV=t,this.segmentsH=i||20,this.segmentsV=r||20,oe.Entity.call(this)},oe.extend(oe.CurvePlane,oe.Entity,{constructor:oe.CurvePlane,className:"TGL.CurvePlane",computeData:function(){var e={};if(e.faces=[],e.uvs=[],e.vertices=[],null==this.pathV||null==this.pathH)return e;var t,i,r,a,n,o,s,l,h,c,u=this.pathV,f=this.pathH,p=this.segmentsV,d=this.segmentsH,m=p+1,g=d+1;for(this.grid=[],t=0;t<g;t++){this.grid[t]=[];var v=f.getPointAt(t/g);for(i=0;i<m;i++){var y=u.getPointAt(i/m);this.grid[t][i]=e.vertices.push(new he(v.x,y.y,v.z+y.z))-1}}for(t=0;t<d;t++)for(i=0;i<p;i++)r=this.grid[t][i],a=this.grid[t][i+1],n=this.grid[t+1][i+1],o=this.grid[t+1][i],s=new le(t/g,i/m),l=new le(t/g,(i+1)/m),h=new le((t+1)/g,(i+1)/m),c=new le((t+1)/g,i/m),e.faces.push(new Pe(r,n,a)),e.uvs.push([s,h,l]),e.faces.push(new Pe(r,o,n)),e.uvs.push([s.clone(),c.clone(),h]);return e}}),oe.ComboNode=function(e,t,i,r,a){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var n=e;this.combos=n.combos||[],this.operators=n.operators,this.centralized=i,this.names=a,this._id=n.id}else this.combos=e||[],this.operators=t,this.centralized=i,this._id=r,this.names=a;this.csgs=[],oe.Entity.call(this)},oe.extend(oe.ComboNode,oe.Entity,{constructor:oe.ComboNode,className:"TGL.ComboNode",__accessor:["combos","operators","centralized","names"],__SizePropeties:["combos","operators","centralized"],getOffsetPosition:function(){return this._offsetPosition},getSideIndexMapping:function(){var e,t,i,r,a=this.combos,n=this.names||[],o={},s=0;if(a&&a.length)for(i=0;i<a.length;i++){e=a[i],(t=n[i])||((r=e.getClassName())&&r.indexOf(".")>0&&(r=r.substr(r.lastIndexOf(".")+1)),t=(t=r+""+i).toLowerCase());var l=e.getSideIndexMapping();if(l)for(var h in l)o[t+"-"+h]=s++;else o[t]=s++}return o},computeData:function(){this.csgs=[];var e={vertices:[],faces:[],uvs:[],uv2s:[]};if(!this.combos)return e;if(null==this.operators||0==this.operators.length){var i=Oe.mergeElements(this.combos);if(this.materialSize=i.material.materials.length,this.material=i.material,this.orgMaterial=i.material,e={vertices:i.vertices,faces:i.faces,uvs:i.uvs,uv2s:i.uv2s||[]},this.centralized&&e.vertices){(l=new oe.BoundingBox).setFromPoints(e.vertices);h=l.center();for(r=0;r<e.vertices.length;r++)(c=e.vertices[r]).sub(h);this._offsetPosition=h}return e}this.operators=this.operators||[];var r,a,n,o,s=this.combos.length;for(r=0;r<s;r++)this.csgs.push(new oe.CSG(this.combos[r]));for(r=0;r<s;r++)null==a?a=this.csgs[r]:"+"===(n=this.operators[r-1])||n==t?a=a.union(this.csgs[r]):"-"===n?a=a.substract(this.csgs[r]):"^"===n&&(a=a.intersect(this.csgs[r]));if(!a)return e;if(o=a.toMesh(),"centralized"==this.changeProperty&&null!=this.material||(this.materialSize=o.material.materials.length,this.material=o.material,this.orgMaterial=o.material),e={vertices:o.vertices,faces:o.faces,uvs:o.uvs,uv2s:o.uv2s},this.centralized&&e.vertices){var l=new oe.BoundingBox;l.setFromPoints(e.vertices);var h=l.center();for(r=0;r<e.vertices.length;r++){var c=e.vertices[r];c.sub(h)}this._offsetPosition=h}return o=t,e},refreshStyleMap:function(){for(var e=this.combos,t=this.styleMap,i=0,r=0;r<e.length;r++){var a=e[r],n=a.getMaterailSize();for(var o in a.styleMap)for(var s=t[o]||(t[o]=[]),l=a.styleMap[o],h=0;h<n;h++)s[i+h]=Oe.isArray(l)?l[h]:l;i+=n}},computeNodeMaterial:function(e){this.material=e.material,this.materialSize=e.materialSize},cacheNodeMaterial:function(e){e.material=this.material,e.materialSize=this.materialSize},needComputeVertexNormal:function(){return!0},generatePrimitiveKey:function(){return null},changeMapping:function(e){var t=this.getMaterialMapping();oe.Utils.isSame(e,t)||(this.batch?this.materialMappingChanges=[e,t]:(this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,t)))},isStyleEquals:function(e,t,i){return!1},getSelectStyle:function(){var e=this.getStyle("select.style");return"outline.normal"!=e&&"outline"!=e||(e="outline.wireframe"),e},onMaterialMapping:function(){this.groups=t,this.primitive.groups=t}}),oe.Terrain=function(e){if(e=e||{},this._id=e.id,this.width=e.width,this.depth=e.depth,this.segmentsW=e.segmentsW||30,this.segmentsD=e.segmentsD||30,this.heightMap=e.heightMap,this.heightUnit=e.heightUnit||1,this.maxHeight=e.maxHeight||255,this.minHeight=e.minHeight||0,this.baseLayerHeight=e.baseLayerHeight||0,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):fe.isCanvas(this.heightMap)?this.canvas=this.heightMap:fe.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var t=this;this.image.onload=function(e){var i=document.createElement("canvas");i.width=t.image.width,i.height=t.image.height,i.getContext("2d").drawImage(t.image,0,0),t.canvas=i,t.computed=!1,t.computeNodeData(),t.firePropertyChange("width",0,1)}}this.materialSize=2,oe.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},oe.extend(oe.Terrain,oe.Entity,{constructor:oe.Terrain,className:"TGL.Terrain",__accessor:["width","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__SizePropeties:["width","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__bool:["smooth"],computeLayerData:function(e,t,i){var r,a,n=this.width/2,o=this.depth/2,s=i?this.segmentsW:1,l=i?this.segmentsD:1,h=s+1,c=l+1,u=this.width/s,f=this.depth/l,p=new oe.Vec3(0,0,1),d=e.vertices.length;for(a=0;a<c;a++)for(r=0;r<h;r++){var m=r*u-n,g=a*f-o,v=0;v=i?i.call(this,r/h,a/c):this.baseLayerHeight*this.heightUnit,e.vertices.push(new oe.Vec3(m,v,g))}for(a=0;a<l;a++)for(r=0;r<s;r++){var y=r+h*a+d,A=r+h*(a+1)+d,x=r+1+h*(a+1)+d,_=r+1+h*a+d,w=new oe.Vec2(r/s,1-a/l),b=new oe.Vec2(r/s,1-(a+1)/l),M=new oe.Vec2((r+1)/s,1-(a+1)/l),S=new oe.Vec2((r+1)/s,1-a/l);if(i)(P=new oe.Face3(y,A,_)).materialIndex=t,e.faces.push(P),e.uvs.push([w,b,S]),(P=new oe.Face3(A,x,_)).materialIndex=t,e.faces.push(P),e.uvs.push([b.clone(),M,S.clone()]);else{var P=new oe.Face4(y,A,x,_);P.normal.copy(p),P.vertexNormals.push(p.clone(),p.clone(),p.clone(),p.clone()),P.materialIndex=t,e.faces.push(P),e.uvs.push([w,b,M,S])}}},computeData:function(){var e={};return e.vertices=[],e.faces=[],e.uvs=[],this.computeLayerData(e,0),this.computeLayerData(e,1,this.getHeight),e},getFaceNormal:function(e,t){this.computeFaceNormals();var i=this.segmentsW*e,r=this.segmentsD*t,a=Math.floor(i),n=Math.floor(r),o=n*this.segmentsW+a;o=2*o+1,a!=Math.round(i)&&n!=Math.round(r)&&o++;var s=this.faces[o];this.vertices[s.a],this.vertices[s.b],this.vertices[s.c];return s.normal.clone()},setHeightMap:function(e){if(this.heightMap=e,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):fe.isCanvas(this.heightMap)?this.canvas=this.heightMap:fe.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var t=this;if(this.image.width){var i=document.createElement("canvas");i.width=t.image.width,i.height=t.image.height,i.getContext("2d").drawImage(t.image,0,0),t.canvas=i,t.computed=!1,t.computeNodeData(),t.firePropertyChange("width",0,1)}else this.image.onload=function(e){var i=document.createElement("canvas");i.width=t.image.width,i.height=t.image.height,i.getContext("2d").drawImage(t.image,0,0),t.canvas=i,t.computed=!1,t.computeNodeData(),t.firePropertyChange("width",0,1)}}},getHeight:function(e,t){if(null==this.canvas)return 0;var i=this.canvas;if(null==this.heightData){for(var r=i.width*i.height,a=new Float32Array(r),n=0;n<r;n++)a[n]=0;for(var o=i.getContext("2d").getImageData(0,0,i.width,i.height).data,s=0,n=0,l=o.length;n<l;n+=4){var h=o[n]+o[n+1]+o[n+2];a[s++]=h/3}this.heightData=a}var c=e*i.width,u=t*i.height,f=Math.floor(c),p=Math.floor(u),d=[],m=[];d.push(f),c!=f&&d.push(f+1),m.push(p),u!=p&&m.push(p+1);var g,v=d.length*m.length,y=0;for(n=0;n<d.length;n++)for(s=0;s<m.length;s++)g=m[s]*i.width+d[n],y+=this.heightData[g];return y/=v,y=oe.Math.clamp(y,this.minHeight,this.maxHeight),y*=this.heightUnit},getSideIndexMapping:function(){return oe.Terrain.SideIndexMapping},refreshUniforms:function(e){e.heightUnit&&(e.heightUnit.value=this.heightUnit)}}),oe.Terrain.SideIndexMapping={layer0:0,layer1:1},oe.Link=function(e,t,i){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];e=r.fromNode,t=r.toNode,this._id=r.id}else this._id=i;oe.Line.call(this),this.setFromNode(e),this.setToNode(t),this._editable=!1},oe.extend(oe.Link,oe.Line,{className:"TGL.Link",___accessor:["linkType","extend","controls"],__SizePropeties:["fromNode","toNode","linkType","extend","controls"],setFromNode:function(e){if(this._fromNode!=e){var t=this._fromNode;this._fromNode=e,this.onPropertyChange(),this.firePropertyChange("fromNode",t,e),this._fromNode=e,t&&(t._removeFromLink(this),t.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(e){if(this._toNode!=e){var t=this._toNode;this._toNode=e,this.onPropertyChange(),this.firePropertyChange("toNode",t,e),t&&(t.removePropertyChangeListener(this.handleNodePropertyChange),t._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(e){if(e.property.startsWith("position")||"worldMatrix"==e.property){var t=this.vertices;this.onPropertyChange(),this.firePropertyChange("vertices",t,this.vertices)}},computeNodeData:function(){this.computeData()},updateMatrix:function(){},updateWorldMatrix:function(){},computeData:function(){if(null!=this._fromNode&&null!=this._toNode){null==this._extend&&(this._extend=0);var e=this._fromNode.worldMatrix.getPosition(),t=this._toNode.worldMatrix.getPosition(),i=[];if(i.push(e.clone()),"orthogonal.x"==this._linkType){var r=Math.max(e.x,t.x),a=new he(r+this._extend,e.y,e.z);i.push(a),a=new he(r+this._extend,t.y,t.z),i.push(a)}else if("orthogonal.x.n"==this._linkType){var n=Math.min(e.x,t.x),a=new he(n-this._extend,e.y,e.z);i.push(a),a=new he(n-this._extend,t.y,t.z),i.push(a)}else if("orthogonal.y"==this._linkType){var o=Math.max(e.y,t.y),a=new he(e.x,o+this._extend,e.z);i.push(a),a=new he(t.x,o+this._extend,t.z),i.push(a)}else if("orthogonal.y.n"==this._linkType){var s=Math.min(e.y,t.y),a=new he(e.x,s-this._extend,e.z);i.push(a),a=new he(t.x,s-this._extend,t.z),i.push(a)}else if("orthogonal.z"==this._linkType){var l=Math.max(e.z,t.z),a=new he(e.x,e.y,l+this._extend);i.push(a),a=new he(t.x,t.y,l+this._extend),i.push(a)}else if("orthogonal.z.n"==this._linkType){var h=Math.min(e.z,t.z),a=new he(e.x,e.y,h-this._extend);i.push(a),a=new he(t.x,t.y,h-this._extend),i.push(a)}else if("control"==this._linkType){var c=this._controls;if(c&&c.length>0)for(var u=0;u<c.length;u++)c[u]instanceof he&&i.push(c[u].clone())}i.push(t.clone()),this.vertices=i}},onPropertyChange:function(){this.vertices=this.vertices||[],this.computeData(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null}}),oe.PathLink=function(e,t,i){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];e=r.fromNode,t=r.toNode,this._id=r.id}else this._id=i;oe.PathNode.call(this),this._autoAjust=!0,this.setFromNode(e),this.setToNode(t)},oe.PathLink.allLinkTypes=["extend.x","extend.y","extend.z","extend.x.n","extend.y.n","extend.z.n","orthogonal.x","orthogonal.y","orthogonal.z","orthogonal.x.n","orthogonal.y.n","orthogonal.z.n","flex.x","flex.y","flex.z","flex.yz","flex.xz","flex.xy"],oe.extend(oe.PathLink,oe.PathNode,{className:"TGL.PathLink",___accessor:["linkType","extend","controls","fromOffset","toOffset"],__SizePropeties:["fromOffset","toOffset","path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","fromNode","toNode","linkType","extend","controls"],setFromNode:function(e){if(this._fromNode!=e){var t=this._fromNode;this._fromNode=e,this._dirtyPath=!0,this.onPropertyChange("fromNode",t,e),this.firePropertyChange("fromNode",t,e),this._fromNode=e,t&&(t._removeFromLink(this),t.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(e){if(this._toNode!=e){var t=this._toNode;this._toNode=e,this.onPropertyChange("toNode",t,e),this.firePropertyChange("toNode",t,e),t&&(t.removePropertyChangeListener(this.handleNodePropertyChange),t._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(e){var t=e.source,i=e.property;if(i.startsWith("position")||i.startsWith("rotation")||i.startsWith("scale")||"worldMatrix"==i||"linkAgent"===i||t.isSizeChangedProperty(i)||"parent"===i){this.vertices;this._dirtyPath=!0;var r=this;ke.PATH_LINK_COMPUTE_DELAY?setTimeout(function(){r._computePath()},10):r._computePath()}},_resetPath:function(){if(this.path){if("arrow"!==this.endCap)return this.path;if(this.endCapExtend*this.endCapR>1)return this.path;!0;var e,t,i,r=this.path,a=new oe.Path,n=r.actions.length,o=null;for(t=0;t<n-1;t++)i=(e=r.actions[t]).args,o=new oe.Vec3(i[0],i[1],i[2]),"moveTo"===e.action?a.moveTo(i[0],i[1],i[2]):"lineTo"===e.action?a.lineTo(i[0],i[1],i[2]):"quadraticCurveTo"===e.action&&(a.curveTo(i[0],i[1],i[2],i[3],i[4],i[5]),o=new oe.Vec3(i[3],i[4],i[5]));if(t=n-1,e=r.actions[t],i=e.args,"lineTo"===e.action){var s=new oe.Vec3(i[0],i[1],i[2]),l=(new he).subVectors(s,o).normalize(),n=this.radius*this.endCapSize,h=null;h=(new he).subVectors(s,o).length()<n?o.add(l.multiplyScalar(.1)):s.clone().sub(l.multiplyScalar(n)),a.lineTo(h.x,h.y,h.z)}return a}},_getNodeOffset:function(e,t,i){t=e.worldToLocal(t.clone()),i=e.worldToLocal(i.clone());var r=(new he).subVectors(i,t),a=r.length(),n=e.getLinkOffset(r);return n&&n.length()>a&&n.normalize().multiplyScalar(a-.1),n||new he(0,0,0)},updateMatrix:function(){},updateWorldMatrix:function(e,t){},onPropertyChange:function(e,t,i){"fromNode"!==e&&"toNode"!==e&&"linkType"!==e&&"extend"!==e&&"controls"!==e&&"fromOffset"!==e&&"toOffset"!==e||(this._dirtyPath=!0),oe.Node.prototype.onPropertyChange.call(this,e,t,i)},computeData:function(){return this._computePath(),oe.PathNode.prototype.computeData.call(this)},_clearFromNodeExtend:function(e,t,i){},_flex:function(e,t,i,r,a){e=e.substr(e.indexOf(".")+1);for(var n,o=["x","y","z"],s=new he,l=new he,h=0;h<3;h++)s[n=o[h]]=n===e?r[n]:t[n],l[n]=n===e?r[n]:i[n];a.push(s,l)},_flex2:function(e,t,i,r){var a=["x","y","z"],n=(e=e.substr(e.indexOf(".")+1))[0],o=e[1];if(t[n]!=i[n]){for(var s=new se.Vec3,l=0;l<a.length;l++)s[a[l]]=a[l]==n?i[a[l]]:t[a[l]];r.push(s)}if(t[o]!=i[o]){for(var h=new se.Vec3,l=0;l<a.length;l++)h[a[l]]=a[l]==n||a[l]==o?i[a[l]]:t[a[l]];r.push(h)}},_orthogonal:function(e,t,i,r){e=e.substr(e.indexOf(".")+1);var a,n=!1,o=["x","y","z"],s=new he,l=0;e.endsWith(".n")&&(n=!0,e=e[0]);for(var h=n?t[e]:i[e],c=0;c<o.length;c++)(a=o[c])!==e&&t[a]==i[a]&&l++;if(2!==l){for(c=0;c<o.length;c++)s[a=o[c]]=a!==e?h:n?i[a]:t[a];r.push(s)}},_removeSamePoint:function(e){},computeLoopPath:function(e){var t=new se.Path;return t.moveTo(e.x,e.y,e.z),t.lineTo(e.x,e.y+200,e.z),t.lineTo(e.x+200,e.y+200,e.z),t.lineTo(e.x+200,e.y,e.z),t.lineTo(e.x,e.y,e.z),this.setPath(t),t},_computePath:function(){if(this._dirtyPath&&(this._dirtyPath=!1,null!=this._fromNode&&null!=this._toNode)){null==this._extend&&(this._extend=0);var e=this._fromNode.getLinkAgent()||this._fromNode,t=this._toNode.getLinkAgent()||this._toNode,i=e.localToWorld2(new he(0,0,0)),r=t.localToWorld2(new he(0,0,0));if(e==t)return this.computeLoopPath(i,r);if(!i.equals(r)){var a=[],n=this.radius*this.endCapSize;if(this._linkType&&this._linkType.startsWith("extend")){var o,s,l,h;if("extend.x"===this._linkType){o=new he(1,0,0);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.max(i.x,r.x)+this._extend+n+.1,s=new he(h,i.y,i.z),l=new he(h,r.y,r.z)}else if("extend.y"===this._linkType){o=new he(0,1,0);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.max(i.y,r.y)+this._extend+n+.1,s=new he(i.x,h,i.z),l=new he(r.x,h,r.z)}else if("extend.z"===this._linkType){o=new he(0,0,1);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.max(i.z,r.z)+this._extend+n+.1,s=new he(i.x,i.y,h),l=new he(r.x,r.y,h)}else if("extend.x.n"===this._linkType){o=new he(-1,0,0);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.min(i.x,r.x)-this._extend-n-.1,s=new he(h,i.y,i.z),l=new he(h,r.y,r.z)}else if("extend.y.n"===this._linkType){o=new he(0,-1,0);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.min(i.y,r.y)-this._extend-n-.1,s=new he(i.x,h,i.z),l=new he(r.x,h,r.z)}else if("extend.z.n"===this._linkType){o=new he(0,0,-1);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.min(i.z,r.z)-this._extend-n-.1,s=new he(i.x,i.y,h),l=new he(r.x,r.y,h)}s?a.push(i,s,l,r):a.push(i,r)}else{if(a.push(i),"orthogonal.x"===this._linkType)if(i.y==r.y&&i.z==r.z);else{var c=r.x,u=new he(c,i.y,i.z);a.push(u)}else if("orthogonal.x.n"===this._linkType){var c=i.x,u=new he(c,r.y,r.z);a.push(u)}else if("orthogonal.y"===this._linkType){var f=r.y,u=new he(i.x,f,i.z);a.push(u)}else if("orthogonal.y.n"===this._linkType){var f=i.y,u=new he(r.x,f,r.z);a.push(u)}else if("orthogonal.z"===this._linkType){u=new he(i.x,i.y,r.z);a.push(u)}else if("orthogonal.z.n"===this._linkType){u=new he(r.x,r.y,i.z);a.push(u)}var p=new he(i.x+r.x,i.y+r.y,i.z+r.z).multiplyScalar(.5);if("flex.x"!==this._linkType&&"flex.y"!==this._linkType&&"flex.z"!==this._linkType||this._flex(this._linkType,i,r,p,a),"flex.yz"!==this._linkType&&"flex.zy"!==this._linkType&&"flex.xy"!==this._linkType&&"flex.yx"!==this._linkType&&"flex.xz"!==this._linkType&&"flex.zx"!==this._linkType||this._flex2(this._linkType,i,r,a),"control"===this._linkType){var d=this.getControls();Oe.isArray(d)&&(a=a.concat(d))}a.push(r),v=a.length;var m=this._getNodeOffset(e,a[0].clone(),a[1].clone()),g=this._getNodeOffset(t,a[v-1].clone(),a[v-2].clone());i=e.localToWorld2(m),r=t.localToWorld2(g),a[0]=i,a[v-1]=r}var v=a.length,y=this.getFromOffset(),A=this.getToOffset();y&&a[0].add(y),A&&a[v-1].add(A);for(var x,_=new oe.Path,w=0;w<v;w++)x=a[w],0===w?_.moveTo(x.x,x.y,x.z):_.lineTo(x.x,x.y,x.z);return this.setPath(_),_}this.setPath(null)}}}),se.LoadingManager=function(e,i,r){var a=this,n=0,o=0;this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(e){o++},this.itemEnd=function(e){n++,a.onProgress!==t&&a.onProgress(e,n,o),n===o&&a.onLoad!==t&&a.onLoad()}},se.DefaultLoadingManager=new se.LoadingManager,se.ImageLoader=function(e){this.manager=e!==t?e:se.DefaultLoadingManager},se.ImageLoader.prototype={constructor:se.ImageLoader,load:function(e,i,r,a){var n=this,o=document.createElement("img");return i!==t&&o.addEventListener("load",function(t){n.manager.itemEnd(e),i(this)},!1),r!==t&&o.addEventListener("progress",function(e){r(e)},!1),a!==t&&o.addEventListener("error",function(e){a(e)},!1),this.crossOrigin!==t&&(o.crossOrigin=this.crossOrigin),o.src=e,n.manager.itemStart(e),o},loadFile:function(e,i,r,a){var n=this,o=new FileReader;i!==t&&(o.onload=function(){i(o.result),n.manager.itemEnd(e.name)}),r!==t&&o.addEventListener("progress",function(e){r(e)},!1),a!==t&&o.addEventListener("error",function(e){a(e)},!1),o.readAsDataURL(e),n.manager.itemStart(e.name)},setCrossOrigin:function(e){this.crossOrigin=e}},se.XHRLoader=function(e){this.manager=e!==t?e:se.DefaultLoadingManager},se.XHRLoader.prototype={constructor:se.XHRLoader,load:function(e,i,r,a){var n=this,o=new XMLHttpRequest;i!==t&&o.addEventListener("load",function(t){i(t.target.responseText),n.manager.itemEnd(e)},!1),r!==t&&o.addEventListener("progress",function(e){r(e)},!1),a!==t&&o.addEventListener("error",function(e){a(e)},!1),this.crossOrigin!==t&&(o.crossOrigin=this.crossOrigin),o.open("GET",e,!0),o.send(null),n.manager.itemStart(e)},loadFile:function(e,i,r,a){if(e){var n=this,o=new FileReader;i!==t&&(o.onload=function(){i(o.result),n.manager.itemEnd(e.name)}),r!==t&&o.addEventListener("progress",function(e){r(e)},!1),a!==t&&o.addEventListener("error",function(e){a(e)},!1),o.readAsText(e),n.manager.itemStart(e.name)}},setCrossOrigin:function(e){this.crossOrigin=e}},se.MTLLoader=function(e,t,i){this.baseUrl=e,this.options=t,this.crossOrigin=i},se.extend(se.MTLLoader,null,{constructor:se.MTLLoader,load:function(e,t,i,r){var a=this,n=new se.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(a.parse(e))})},loadFile:function(e,t,i,r){var a=this;(new se.XHRLoader).loadFile(e,function(e){t(a.parse(e))})},loadText:function(e,t){t(this.parse(e))},parse:function(e){var t=e.split("\n"),i={},r=/\s+/,a={};this.baseUrl||(this.baseUrl={});for(var n=0;n<t.length;n++){var o=t[n];if(0!==(o=o.trim()).length&&"#"!==o.charAt(0)){var s=o.indexOf(" "),l=s>=0?o.substring(0,s):o;l=l.toLowerCase();var h=s>=0?o.substring(s+1):"";if(h=h.trim(),"newmtl"===l)i={name:h},a[h]=i;else if(i)if("ka"===l||"kd"===l||"ks"===l){var c=h.split(r,3);i[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else if("map_kd"===l||"map_ka"===l){var u=h,f=h;if(h.indexOf(".")>0){h=h.substring(0,h.lastIndexOf(".")).toLowerCase();var p={};if(/\-s/.test(h)&&(p=(d=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/).exec(h),h=(m=h.split(p[0]))[m.length-1].trim(),f=(g=u.split(p[0]))[g.length-1].trim()),/\-t/.test(h)){var d=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;p=d.exec(h);var m=h.split(p[0]);h=m[m.length-1].trim();var g=u.split(p[0]);f=g[g.length-1].trim()}}this.baseUrl[h]||(this.baseUrl[h]=f),i[l]=u}else i[l]=h}}var v=new se.MTLLoader.MaterialCreator(this.baseUrl,this.options);return v.setMaterials(a),v}}),se.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:se.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:se.RepeatWrapping},se.extend(se.MTLLoader.MaterialCreator,se.EventDispatcher,{constructor:se.MTLLoader.MaterialCreator,setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i],a={};t[i]=a;for(var n in r){var o=!0,s=r[n],l=n.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(o=!1);break;case"d":this.options&&this.options.invertTransparency&&(s=1-s)}o&&(a[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return this.materials[e]===t&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,i=this.materialsInfo[e],r={name:e,side:this.side};for(var a in i){var n=i[a];switch(a.toLowerCase()){case"kd":r.diffuse=(new se.Color).setRGB(n[0],n[1],n[2]);break;case"ka":r.ambient=(new se.Color).setRGB(n[0],n[1],n[2]);break;case"ks":r.specular=(new se.Color).setRGB(n[0],n[1],n[2]);break;case"map_kd":if("string"==typeof this.baseUrl)r.map={},r.map.img=this.baseUrl+n,r.map.wrapS=this.wrap,r.map.wrapT=this.wrap;else if("object"==typeof this.baseUrl&&n.indexOf(".")>0){n=n.substring(0,n.lastIndexOf(".")).toLowerCase();var o={};if(/\-s/.test(n)&&(o=(s=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/).exec(n),n=(l=n.split(o[0]))[l.length-1].trim(),o.repeatR=parseInt(o[1]),o.repeatC=parseInt(o[2])),/\-t/.test(n)){var s=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;o=s.exec(n);var l=n.split(o[0]);n=l[l.length-1].trim(),o.repeatR=parseInt(o[1]),o.repeatC=parseInt(o[2])}this.baseUrl[n]&&(r.map={},r.map.img=this.baseUrl[n],r.map.wrapS=t.wrap,r.map.wrapT=t.wrap,r.map.repeatR=o.repeatR||1,r.map.repeatC=o.repeatC||1)}break;case"ns":r.shininess=n;break;case"d":n<1&&(r.transparent=!0,r.opacity=n)}}return r.diffuse&&(r.ambient||(r.ambient=r.diffuse),r.color=r.diffuse),this.materials[e]=r,this.materials[e]},loadTexture:function(e,t,i,r){if(/\.dds$/i.test(e))n=se.ImageUtils.loadCompressedTexture(e,t,i,r);else{var a=new Image,n=new se.Texture(a,t),o=new se.ImageLoader;o.crossOrigin=this.crossOrigin,o.load(e,function(e){n.image=se.MTLLoader.ensurePowerOfTwo_(e),n.needsUpdate=!0,i&&i(n)})}return n}}),se.MTLLoader.ensurePowerOfTwo_=function(e){if(!se.MTLLoader.isPowerOfTwo_(e.width)||!se.MTLLoader.isPowerOfTwo_(e.height)){var t=document.createElement("canvas");return t.width=se.MTLLoader.nextHighestPowerOfTwo_(e.width),t.height=se.MTLLoader.nextHighestPowerOfTwo_(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},se.MTLLoader.isPowerOfTwo_=function(e){return 0==(e&e-1)},se.MTLLoader.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},se.OBJMTLLoader=function(){},se.extend(se.OBJMTLLoader,se.MTLLoader,{constructor:se.OBJMTLLoader,load:function(e,t,i,r,a,n){var o=this;new se.MTLLoader(i).load(t,function(t){var a=t;a.preload();var n=new se.XHRLoader(o.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(t){var n=o.parse(t),s="";!i&&e.lastIndexOf("/")>0&&(s=e.substring(0,e.lastIndexOf("/")+1));for(var l=0;l<n._childList._as.length;l++){var h=n._childList._as[l];if(h.mname){var c=a.create(h.mname);o.setGeometryStyle(h,c,s)}for(var u=0;u<h._childList._as.length;u++){var f=h._childList._as[u];if(f.mname){var p=a.create(f.mname);o.setGeometryStyle(f,p,s)}}}r(n)})})},setGeometryStyle:function(e,t,i){var r={};if(t.map){i?this.loadTexture(e,i+t.map.img):this.loadTexture(e,t.map.img);var a=t.map.repeatR,n=t.map.repeatC;a&&n&&(r["m.texture.repeat"]=new se.Vec2(a,n),r["m.texture.wrapS"]=oe.RepeatWrapping,r["m.texture.wrapT"]=oe.RepeatWrapping)}r["m.ambient"]=t.ambient,r["m.specular"]=t.specular,r["m.color"]=t.color,t.transparent&&(r["m.transparent"]=!0,r["m.opacity"]=t.opacity),e.s(r)},loadBase64:function(e,t,i,r,a,n){var o=this,s=se.base64decode(t),l=se.base64decode(e);new se.MTLLoader(i).loadText(s,function(e){var t=e;t.preload();for(var i=o.parse(l),a=0;a<i._childList._as.length;a++){var n=i._childList._as[a];if(n.mname){var s=t.create(n.mname);o.setGeometryStyle(n,s,"")}for(var h=0;h<n._childList._as.length;h++){var c=n._childList._as[h];if(c.mname){var u=t.create(c.mname);o.setGeometryStyle(c,u,"")}}}r(i)})},loadFiles:function(e,t,i,r,a,n){var o=this;new se.MTLLoader(i).loadFile(t,function(t){var i=t;i.preload(),new se.XHRLoader(o.manager).loadFile(e,function(e){for(var t=o.parse(e),a=0;a<t._childList._as.length;a++){var n=t._childList._as[a];if(n.mname){var s=i.create(n.mname);o.setGeometryStyle(n,s)}for(var l=0;l<n._childList._as.length;l++){var h=n._childList._as[l];if(h.mname){var c=i.create(h.mname);o.setGeometryStyle(h,c)}}}r(t)})})},loadTexture:function(e,t){"string"==typeof t?e.setStyle("m.texture.image",t):e&&t&&(new se.ImageLoader).loadFile(t,function(t){e.setStyle("m.texture.image",t)})},parse:function(e,i){function r(e,t,i){return new se.Vec3(e,t,i)}function a(e,t,i,r,a){return new se.Face3(e,t,i,r,null,a)}function n(e,i){if(p.length>0&&(f.vertices=p,v.length>0&&(f.setMaterialSize(v.length),f.setStyle("m.normalType",oe.NormalTypeSmooth)),f.computed=!1,f.computeCentroids(),f.computeFaceNormals(),f.computeBoundingSphere(),f.faces.length>0)){var r=f._name;u.addChild(f),(f=new se.Entity)._name=r,f.setStyle("m.type","phong"),d=0}e!==t&&(f._name=e),f.setClient("name",e),f.setClient("bid",e),i!==t&&(f.mname=i)}function o(e,i,r,n,o){n===t?f.faces.push(a(parseInt(e)-(h+1),parseInt(i)-(h+1),parseInt(r)-(h+1))):f.faces.push(a(parseInt(e)-(h+1),parseInt(i)-(h+1),parseInt(r)-(h+1),[m[parseInt(n[0])-1].clone(),m[parseInt(n[1])-1].clone(),m[parseInt(n[2])-1].clone()],o))}function s(e,t,i){f.uvs.push([g[parseInt(e)-1].clone(),g[parseInt(t)-1].clone(),g[parseInt(i)-1].clone()])}function l(e,i,r){var a=v.length>0?v.indexOf(y):0;if(e[3]===t)o(e[0],e[1],e[2],r,a),i!==t&&i.length>0&&s(i[0],i[1],i[2]);else{if(r!==t&&r.length>0)if(r.length>4)for(var n=1,l=r.length-1;n<l;n++)o(e[0],e[n],e[n+1],[r[0],r[n],r[n+1]],a);else o(e[0],e[1],e[3],[r[0],r[1],r[3]],a),o(e[1],e[2],e[3],[r[1],r[2],r[3]],a);else if(e.length>4)for(var n=1,l=e.length-1;n<l;n++)o(e[0],e[n],e[n+1]);else o(e[0],e[1],e[3]),o(e[1],e[2],e[3]);if(i!==t&&i.length>0)if(i.length>4)for(var n=1,l=i.length-1;n<l;n++)s(i[0],i[n],i[n+1]);else s(i[0],i[1],i[3]),s(i[1],i[2],i[3])}}var h=0,c=new se.Entity,u=c,f=new se.Entity;f.setStyle("m.type","phong");for(var p=[],d=0,m=[],g=[],v=[],y=0,A=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,x=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,_=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,w=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,b=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,M=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))*/,S=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,P=/s( +(\d))?/,C=e.split("\n"),T=0;T<C.length;T++){var E,z=C[T];if(0!==(z=z.trim()).length&&("#"!==z.charAt(0)||"o"==z.charAt(2)))if(null!==(E=A.exec(z)))p.push(r(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])));else if(null!==(E=x.exec(z)))m.push(r(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])));else if(null!==(E=_.exec(z)))g.push(function(e,t){return new se.Vec2(e,t)}(parseFloat(E[1]),parseFloat(E[2])));else if(null!==(E=w.exec(z)))l([E[1],E[2],E[3],E[4]]);else if(null!==(E=b.exec(z)))l([E[2],E[5],E[8],E[11]],[E[3],E[6],E[9],E[12]]);else if(null!==(E=M.exec(z))){var D=[],L=[],R=[];(z=(z=z.substr(2)).split(/\s+/)).forEach(function(e){e=e.split("/"),D.push(e[0]),R.push(e[1]),L.push(e[2])}),l(D,R,L)}else if(null!==(E=S.exec(z)))l([E[2],E[5],E[8],E[11]],[],[E[3],E[6],E[9],E[12]]);else if("#"===z.charAt(0)&&"o"===z.charAt(2))n(),h+=p.length,p=[],(u=new se.Entity)._name=z.substring(2).trim(),c.addChild(u);else if(/^g /.test(z))n(z.substring(2).trim(),t);else if(/^usemtl /.test(z))n(t,z.substring(7).trim());else if(/^mtllib /.test(z)){if(i){var N=z.substring(7);i(N=N.trim())}}else/^s /.test(z)&&(E=P.exec(z),v.indexOf(E[2])<0&&v.push(E[2]),y=E[2])}return n(t,t),c}});se.DaeAdapter=function(){function e(e,t,a){O=e,C(),j=u(),(W=new o).parse();var n=U();if(q=E(),H=D(),K=r(),W)for(var s=0;s<W.nodes.length;s++)i(W.nodes[s]);var l={lights:n,visualScenes:W,images:q,materials:K,geometries:j,entityies:Q};t&&t(l)}function i(e,t){if(e){for(var r={},a=0;a<e.geometries.length;a++){var n,o=e.geometries[a],s=o.instance_material,l=j[o.url],h={},c=[],u=0;if(l){if(!l.mesh||!l.mesh.primitives)continue;if(s)for(S=0;S<s.length;S++){var f=s[S],p=K[f.target],d=p.instance_effect.url,m=H[d].shader.material;if(l.doubleSided){if(!(f.symbol in r)){var g=m.clone();g.side=se.DoubleSide,r[f.symbol]=g}m=r[f.symbol]}m.opacity=m.opacity?m.opacity:1,h[f.symbol]=u,c.push(m),(n=m).name=null==p.name||""===p.name?p.id:p.name,u++}var v=n||new se.LambertMaterial({color:14540253,shading:se.FlatShading,side:l.doubleSided?se.DoubleSide:se.FrontSide}),y=l.mesh.node3D;if(u>1)for(v=new se.ArrayMaterial(c),S=0;S<y.faces.length;S++){var A=y.faces[S];A.materialIndex=h[A.daeMaterial]}v instanceof se.ArrayMaterial&&y.setMaterialSize(v.materials.length),y.createMaterial(v),y.matrix=e.matrix,y.matrix.decompose(y._position,y.quaternion,y.scale);var x=y.quaternion;if(x){var _=x.x*x.x,w=x.y*x.y,b=x.z*x.z,M=x.w*x.w;y._rotation.x=Math.atan2(2*(x.x*x.w-x.y*x.z),M-_-w+b),y._rotation.y=Math.asin(se.Math.clamp(2*(x.x*x.z+x.y*x.w),-1,1)),y._rotation.z=Math.atan2(2*(x.z*x.w-x.x*x.y),M+_-w-b)}Q.push(y)}}for(var S=0;S<e.nodes.length;S++)i(e.nodes[S],e)}}function r(){var e=O.querySelectorAll("library_materials material"),t={};if(e&&e.length>0)for(var i=0;i<e.length;i++){var r=e[i];if(r){var n=(new a).parse(r);n&&(t[n.id]=n)}}return t}function a(){this.id="",this.name="",this.instance_effect=null}function n(){this.url=""}function o(){this.nodes=[],this.id="",this.name=""}function s(){this.nodes=[],this.id="",this.name="",this.sid="",this.type="",this.controllers=[],this.geometries=[],this.type="",this.layer="",this.matrix=new se.Mat4,this.transforms=[]}function l(){this.sid="",this.type="",this.data=[]}function h(){this.url="",this.instance_material=[]}function c(){this.symbol="",this.target=""}function u(){var e={};e.entity=[];var t=O.querySelectorAll("library_geometries geometry");if(t&&t.length>0)for(var i=0;i<t.length;i++){var r=(new f).parse(t[i]);r&&(e[r.id]=r,e.entity.push(r))}return e}function f(){this.id="",this.mesh=null}function p(){this.sources={},this.primitives=[],this.vertices=null,this.node3D=null}function d(e,t){var i=[e[t],e[t+1],e[t+2]];return m(i,-1),new se.Vec3(i[0],i[1],i[2])}function m(e,t){if(!0===J.convertUpAxis&&X!==J.upAxis)switch(G){case"XtoY":i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":var i=e[1];e[1]=e[2],e[2]=t*i}}function g(){this.id="",this.input={}}function v(){this.semantic="",this.offset=0,this.source="",this.set=0}function y(){this.inputs=[],this.count=0,this.p=[],this.material=""}function A(){y.call(this),this.vcount=3}function x(){this.id,this.dataType,this.technique_common={},this.accessor=null,this.data=[]}function _(){this.source="",this.count=0,this.stride=0,this.params=[]}function w(e){return e?parseInt(e,10):0}function b(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function M(e){var i=[];if(!e)return e;if((e=b(e)).length>0)for(var r=e.split(/\s+/),a=0;a<r.length;a++){var n=r[a];n!=t&&null!=n&&null!=parseFloat(n)&&i.push(parseFloat(n))}return i}function S(e){var i=[];if(!e)return[];if((e=b(e)).length>0)for(var r=e.split(/\s+/),a=0;a<r.length;a++){var n=r[a];n!=t&&null!=n&&null!=parseInt(n)&&i.push(parseInt(n))}return i}function P(e){var t=[];if(!e)return[];if((e=b(e)).length>0)for(var i=e.split(/\s+/),r=0;r<i.length;r++)t.push("true"==i[r]||"1"==i[r]);return t}function C(){if(!0!==J.convertUpAxis||X===J.upAxis)G=null;else switch(X){case"X":G="Y"===J.upAxis?"XtoY":"XtoZ";break;case"Y":G="X"===J.upAxis?"YtoX":"YtoZ";break;case"Z":G="X"===J.upAxis?"ZtoX":"ZtoY"}}function T(e){if(J.convertUpAxis){var t=[e[0],e[4],e[8]];m(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],m(t=[e[1],e[5],e[9]],-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],m(t=[e[2],e[6],e[10]],-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],m(t=[e[0],e[1],e[2]],-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],m(t=[e[4],e[5],e[6]],-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],m(t=[e[8],e[9],e[10]],-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],m(t=[e[3],e[7],e[11]],-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return new se.Mat4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function E(){var e=O.querySelectorAll("library_images image"),t={};if(e&&e.length>0)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=(new z).parse(r);t[a.id]=a}}return t}function z(){this.id="",this.init_from=""}function D(){var e=O.querySelectorAll("library_effects effect"),t={};if(e&&e.length>0)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=(new L).parse(r);t[a.id]=a}}return t}function L(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function R(e,t){this.type=e,this.effect=t,this.material=null}function N(){this.color=new se.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function B(e){this.effect=e,this.init_from=null,this.format=null}function I(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function F(e){for(var i=O.querySelectorAll("library_nodes node"),r=0;r<i.length;r++){var a=i[r].attributes.getNamedItem("id");if(a&&a.value===e)return i[r]}return t}function V(e,t){e.doubleSided=!1;var i=t.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}function U(){var e=[],t=O.querySelectorAll("library_lights light");if(t&&t.length>0)for(var i=0;i<t.length;i++){t[i];var r=(new k).parse(t);e.push(r)}return e}function k(){this.id="",this.name="",this.technique=""}this.id="",this.name="",this.type="";var O=null,X="Y",G=null,W=null,Y={},j={},H={},q={},Z="",Q=[],K={},J={};return a.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"==e.childNodes[t].nodeName){this.instance_effect=(new n).parse(e.childNodes[t]);break}return this},n.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},o.prototype.parse=function(){var e=O.querySelectorAll("library_visual_scenes visual_scene");if(!e||e.length<0)return this;this.id="",this.name="";for(var t=0;t<e.length;t++){var i=e[t];if(i&&i.childNodes&&i.childNodes.length>0)for(var r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];if(a&&a.nodeName)switch(a.nodeName){case"node":this.nodes.push((new s).parse(a))}}}return this},s.prototype.parse=function(e){if(!e)return this;if(this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"==this.type?this.type:"NODE",e.childNodes.length>0)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"node":this.nodes.push((new s).parse(i));break;case"instance_camera":case"instance_controller":break;case"instance_geometry":this.geometries.push((new h).parse(i));break;case"instance_light":break;case"instance_node":var r=F(i.getAttribute("url").replace(/^#/,""));r&&this.nodes.push((new s).parse(r));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new l).parse(i));break;case"extra":break;default:console.log(i.nodeName)}}return this.updateMatrix(),this},s.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},l.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=M(e.textContent),this.convert(),this},l.prototype.convert=function(){switch(this.type){case"matrix":this.obj=T(this.data);break;case"rotate":this.angle=se.Math.degToRad(this.data[3]);case"translate":m(this.data,-1),this.obj=new se.Vec3(this.data[0],this.data[1],this.data[2]);break;case"scale":m(this.data,1),this.obj=new se.Vec3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},l.prototype.apply=function(){var e=new se.Mat4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),l.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=se.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=se.Math.degToRad(e[3])}}},h.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"==i.nodeName){for(var r=i.querySelectorAll("instance_material"),a=0;a<r.length;a++){var n=r[a];this.instance_material.push((new c).parse(n))}break}}return this},c.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},f.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&"mesh"==i.nodeName){var r=(new p).parse(i);r&&(this.mesh=r)}}return this},p.prototype.parse=function(e){if(e&&e.childNodes&&e.childNodes.length>0)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":var r=i.getAttribute("id");this.sources[r]=(new x).parse(i);break;case"vertices":var a=new g;this.vertices=a.parse(i);break;case"polygons":var n=(new y).parse(i);n&&this.primitives.push(n);break;case"triangles":var o=(new A).parse(i);o&&this.primitives.push(o);break;case"polylist":this.primitives.push(null)}}this.node3D=new se.Entity;var s=null;for(this.vertices&&this.vertices.input&&this.vertices.input.POSITION&&(s=this.sources[this.vertices.input.POSITION.source].data),t=0;t<this.primitives.length;t++){var l=this.primitives[t];l.setVertices(this.vertices),this.handlePrimitive(l,this.node3D)}for(t=0;t<s.length;t+=3)this.node3D.vertices.push(d(s,t).clone());return this.node3D.computeFaceNormals(),this},p.prototype.handlePrimitive=function(e,i){var r,a,n,o,s,l,h,c=e.p,u=e.inputs,f=0,p=3,m=0,g=[];for(r=0;r<u.length;r++){var v=(n=u[r]).offset+1;switch(m=m<v?v:m,n.semantic){case"TEXCOORD":g.push(n.set)}}for(var y=0;y<c.length;++y)for(var A=c[y],x=0;x<A.length;){var _=[],w=[],b=null,M=[];for(p=e.vcount?e.vcount.length?e.vcount[f++]:e.vcount:A.length/m,r=0;r<p;r++)for(a=0;a<u.length;a++)switch(n=u[a],l=this.sources[n.source],o=A[x+r*m+n.offset],h=l.accessor.params.length,s=o*h,n.semantic){case"VERTEX":_.push(o);break;case"NORMAL":w.push(d(l.data,s));break;case"TEXCOORD":(b=b||{})[n.set]===t&&(b[n.set]=[]),b[n.set].push(new se.Vec2(l.data[s],l.data[s+1]));break;case"COLOR":M.push((new se.Color).setRGB(l.data[s],l.data[s+1],l.data[s+2]))}if(0==w.length)if(n=this.vertices.input.NORMAL){h=(l=l[n.source]).accessor.params.length;for(var S=0,P=_.length;S<P;S++)w.push(d(l.data,_[S]*h))}else i.calcNormals=!0;if(!b&&(b={},n=this.vertices.input.TEXCOORD)){g.push(n.set),h=(l=this.sources[n.source]).accessor.params.length;for(var S=0,P=_.length;S<P;S++)s=_[S]*h,b[n.set]===t&&(b[n.set]=[]),b[n.set].push(new se.Vec2(l.data[s],1-l.data[s+1]))}if(0==M.length&&(n=this.vertices.input.COLOR)){h=(l=this.sources[n.source]).accessor.params.length;for(var S=0,P=_.length;S<P;S++)s=_[S]*h,M.push((new se.Color).setRGB(l.data[s],l.data[s+1],l.data[s+2]))}var C,T,E=null,z=[];if(3===p)z.push(new se.Face3(_[0],_[1],_[2],w,M.length?M:new se.Color(16711680)));else if(4===p)z.push(new se.Face3(_[0],_[1],_[3],[w[0],w[1],w[3]],M.length?[M[0],M[1],M[3]]:new se.Color(16711680))),z.push(new se.Face3(_[1],_[2],_[3],[w[1],w[2],w[3]],M.length?[M[1],M[2],M[3]]:new se.Color(16711680)));else if(p>4&&J.subdivideFaces){var D=M.length?M:new se.Color;for(a=1;a<p-1;)z.push(new se.Face3(_[0],_[a],_[a+1],[w[0],w[a++],w[a]],D))}if(z.length)for(var S=0,P=z.length;S<P;S++)for((E=z[S]).daeMaterial=e.material,i.faces.push(E),a=0;a<g.length;a++)C=b[g[a]],T=p>4?[C[0],C[S+1],C[S+2]]:4===p?0===S?[C[0],C[1],C[3]]:[C[1].clone(),C[2],C[3].clone()]:[C[0],C[1],C[2]],i.uvs===t&&(i.uvs=[]),i.uvs.push(T);else console.log("dropped face with vcount "+p+" for geometry with id: "+i.id);x+=m*p}},g.prototype.parse=function(e){if(e&&(this.id=e.getAttribute("id"),e.childNodes.length>0))for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"input":var r=(new v).parse(i);this.input[r.semantic]=r}}return this},v.prototype.parse=function(e){return e&&(this.semantic=e.getAttribute("semantic"),this.offset=w(e.getAttribute("offset")),this.set=w(e.getAttribute("set")),this.source=e.getAttribute("source").replace(/^#/,""),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0)),this},y.prototype.parse=function(e){if(e&&(this.count=e.getAttribute("count"),this.material=e.getAttribute("material"),e.childNodes.length>0))for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"input":var r=(new v).parse(i);r&&this.inputs.push(r);break;case"p":this.p.push(S(i.textContent))}}return this},y.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source==e.id&&(this.inputs[t].source=e.input.POSITION.source)},A.prototype=Object.create(y.prototype),x.prototype.parse=function(e){if(!e)return this;if(this.id=e.getAttribute("id"),e.childNodes.length>0)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"float_array":this.dataType=i.nodeName,this.data=M(i.textContent);break;case"bool_array":this.dataType=i.nodeName,this.data=P(i.textContent);break;case"int_array":this.data=S(i.textContent),this.dataType=i.nodeName;break;case"technique_common":if(i.childNodes&&i.childNodes.length>0)for(var r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];if(a&&a.nodeName)switch(a.nodeName){case"accessor":var n=(new _).parse(a);n.source&&(this.technique_common[n.source]=n,this.accessor=n)}}}}return this},x.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var r=T(this.data.slice(i,i+16));e.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},_.prototype.parse=function(e){if(!e)return this;if(this.source=e.getAttribute("source"),this.count=w(e.getAttribute("count")),this.stride=w(e.getAttribute("stride")),e.childNodes.length>0)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"param":var r={};r.name=i.getAttribute("name"),r.type=i.getAttribute("type"),this.params.push(r)}}return this},z.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},L.prototype.create=function(){if(null==this.shader)return null},L.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),V(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},L.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[t]=new B(this).parse(r);break;case"sampler2D":this.sampler[t]=new I(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},L.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":t=r;break;case"newparam":this.parseNewparam(r);break;case"image":var a=(new z).parse(r);q[a.id]=a;break;case"extra":break;default:console.log(r.nodeName)}}return t},L.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new R(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i)}}},L.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i)}}},L.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(i)}}},R.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new N).parse(i);break;case"bump":var r=i.getAttribute("bumptype");r?"heightfield"===r.toLowerCase()?this.bump=(new N).parse(i):"normalmap"===r.toLowerCase()?this.normal=(new N).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+r+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new N).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new N).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var a=i.querySelectorAll("float");a.length>0&&(this[i.nodeName]=parseFloat(a[0].textContent))}}return this.create(),this},R.prototype.create=function(){var e={},i=!1;if(this.transparency!==t&&this.transparent!==t){this.transparent;var r=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;r>0&&(i=!0,e.transparent=!0,e.opacity=1-r)}var a={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var n in this)switch(n){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var o=this[n];if(o instanceof N)if(o.isTexture()){var s=o.texture,l=this.effect.sampler[s],h=null;if(l!==t&&l.source!==t){var c=this.effect.surface[l.source];h=q[c.init_from]}else h=q[s];if(h){var u=Z+h.init_from,f=new Image;f.loaded=!1;var p=new se.Texture;p._imageSrc=u,p._image=f,p.setImage(u),p.wrapS=o.texOpts.wrapU?se.RepeatWrapping:se.ClampToEdgeWrapping,p.wrapT=o.texOpts.wrapV?se.RepeatWrapping:se.ClampToEdgeWrapping,p.offsetX=o.texOpts.offsetU,p.offsetY=o.texOpts.offsetV,p.repeatX=o.texOpts.repeatU,p.repeatY=o.texOpts.repeatV,e[a[n]]=p,"emission"===n&&(e.emissive=16777215)}}else"diffuse"!==n&&i||("emission"===n?e.emissive=o.color.getHex():e[n]=o.color.getHex());break;case"shininess":e[n]=this[n];break;case"reflectivity":e[n]=this[n],e[n]>0&&(e.envMap=J.defaultEnvMap),e.combine=se.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[n],1!==this[n]&&(e.envMap=J.defaultEnvMap)}switch(e.shading=se.SmoothShading,e.side=this.effect.doubleSided?se.DoubleSide:se.FrontSide,this.type){case"constant":e.emissive!=t&&(e.color=e.emissive),this.material=new se.EntityMaterial(e);break;case"phong":case"blinn":e.diffuse!=t&&(e.color=e.diffuse),this.material=new se.EntityMaterial(e);break;case"lambert":default:e.diffuse!=t&&(e.color=e.diffuse),this.material=new se.LambertMaterial(e)}return this.material},N.prototype.isColor=function(){return null==this.texture},N.prototype.isTexture=function(){return null!=this.texture},N.prototype.parse=function(e){"transparent"==e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var r=M(i.textContent);this.color=new se.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},N.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1]).childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?this.texOpts[i.nodeName]=1:this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},B.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},I.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},k.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},k.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];switch(a.nodeName){case"color":var n=M(a.textContent);this.color=new se.Color(0),this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"falloff_angle":this.falloff_angle=parseFloat(a.textContent);break;case"quadratic_attenuation":var o=parseFloat(a.textContent);this.distance=o?Math.sqrt(1/o):0}}}return this},k.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},{load:function(i,r,a){var n=0;if(i!==t){var o=i.split("/");o.pop(),Z=(o.length<1?".":o.join("/"))+"/"}var s=new XMLHttpRequest;s.onreadystatechange=function(){4==s.readyState?0!=s.status&&200!=s.status||(s.responseXML?e(s.responseXML,r,i):s.responseText?e((new DOMParser).parseFromString(s.responseText,"application/xml"),r,i):console.error("ColladaLoader: Empty or non-existing file ("+i+")")):3==s.readyState&&a&&(0==n&&(n=s.getResponseHeader("Content-Length")),a({total:n,loaded:s.responseText.length}))},s.open("GET",i,!0),s.send(null)},parse:e,geometries:Y,options:J}};var De=se.GLTFLoader={DRACO_DECODER_PATH:"/"},Le={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",COLOR_0:"color",JOINTS_0:"joint",WEIGHTS_0:"weight"},Re={5121:Uint8Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ne={5121:1,5123:2,5125:4,5126:4},Be={0:"POINTS",1:"LINES",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN"},Ie={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fe={translation:3,rotation:4,scale:3},Ve={33071:"CLAMP_TO_EDGE",10497:"REPEAT",33648:"MIRRORED_REPEAT"},Ue={9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR"};De.load=function(e,t,i,l){De._dracoDecoderUrl||(De._dracoDecoderUrl=o(a)),s((e+=e.endsWith("/")?"":"/")+t+".gltf","json",function(t,a){function o(e,t){u[t]=e,++f===p&&h()}function h(){t.accessors.forEach(function(e,i){var r,a=Re[e.componentType],n=t.bufferViews[e.bufferView],o=n&&n.byteStride||0,s=n&&u[n.buffer],l=(e.byteOffset||0)+(n&&n.byteOffset||0),h=e.count;r=o?h*(o/Ne[e.componentType]):h*Ie[e.type],d.push({buffer:n&&new a(s,l,r),offset:l,count:h,stride:o,type:e.componentType})}),t.meshes.forEach(function(e){e.primitives.forEach(function(e){var i=e.extensions&&e.extensions.KHR_draco_mesh_compression;if(i){var r=new Worker(De._dracoDecoderUrl),a=t.bufferViews[i.bufferView],n=new Int8Array(u[a.buffer],a.byteOffset,a.byteLength);r.onmessage=function(t){if("init"===t.data)r.postMessage({type:"decode",encodedData:n,attributes:i.attributes,mode:null==e.mode?"TRIANGLES":Be[e.mode]},[n.buffer]);else{_++;var a=t.data;a.error?console.error(a.error):(null!=e.indices&&(d[e.indices].buffer=a.indices),Object.keys(a.datas).forEach(function(t){var i=e.attributes[t];d[i].buffer=a.datas[t]})),_===x.length&&c()}},x.push(r),r.postMessage({type:"init",path:De.DRACO_DECODER_PATH})}})}),0===x.length&&c()}function c(){t.meshes.forEach(function(e){var t=[],i={primitives:t};m.push(i),null!=e.name&&(i.name=e.name),null!=e.weights&&(i.weights=e.weights),e.primitives.forEach(function(e){var r={},a={buffers:r};t.push(a),null!=e.mode&&(a.mode=Be[e.mode]),Object.keys(e.attributes).forEach(function(t){var i=d[e.attributes[t]],a={data:i.buffer,type:i.type};i.stride&&(a.stride=i.stride),r[Le[t]]=a}),e.targets&&(i.targetCount=e.targets.length,e.targets.forEach(function(e,t){r["position"+t]=d[e.POSITION].buffer,e.NORMAL&&(r["normal"+t]=d[e.NORMAL].buffer),e.TANGENT&&(r["tangent"+t]=d[e.TANGENT].buffer)})),null!=e.indices&&(r.index=d[e.indices].buffer),null!=e.material&&(a.material=e.material)})}),t.nodes&&t.nodes.forEach(function(e){var t={},i=new se.Mat4;v.push(t),null!=e.name&&(t.name=e.name),e.rotation&&(t.rotation=e.rotation),e.translation&&(t.translation=e.translation),e.scale&&(t.scale=e.scale),e.weights&&(t.weights=e.weights),e.children&&(t.children=e.children),e.matrix?i.set(e.matrix):(e.rotation||e.scale||e.translation)&&(e.translation&&i.translate(e.translation),e.scale&&i.scale(e.scale),e.rotation&&i.setRotationFromQuaternion(e.rotation)),i&&(t.matrix=i),null!=e.mesh&&(t.mesh=e.mesh),e.camera}),t.skins&&t.skins.forEach(function(e){for(var t=d[e.inverseBindMatrices],i=new Array(e.joints.length),r={joints:e.joints,inverseBindMatrices:i},a=0;a<e.joints.length;a++)i[a]=new Float32Array(t.buffer.buffer,16*a*4,16);g.push(r)}),t.nodes&&t.nodes.forEach(function(e,t){var i=v[t];null!=e.skin&&(i.skin=g[e.skin])}),t.animations&&t.animations.forEach(function(e){var t=[],i={channels:t},r=[];y.push(i),null!=e.name&&(i.name=e.name),e.samplers.forEach(function(e){r.push({input:d[e.input].buffer,interpolation:e.interpolation,output:d[e.output]})}),e.channels.forEach(function(e){var i=v[e.target.node],a=m[i.mesh],n=e.target.path,o=r[e.sampler],s=o.output,l=s.buffer.buffer,h=[];if("weights"===n){for(var c=a.targetCount,u=s.count/c,f=0;f<u;f++){d=s.offset+4*f*c;h.push(new Float32Array(l,d,c))}o.splitOutput=h,i.weights||(i.weights=a.weights.slice(0))}else{for(var p=Fe[n],f=0;f<s.count;f++){var d=s.offset+4*f*p;h.push(new(3===p?se.Vec3:se.Quat)(new Float32Array(l,d,p)))}o.output=h,"translation"!==n||i.translation||(i.translation=new se.Vec3),"rotation"!==n||i.rotation||(i.rotation=new se.Quat),"scale"!==n||i.scale||(i.scale=new se.Vec3)}t.push({node:e.target.node,sampler:o,path:n})})}),t.textures&&t.textures.forEach(function(i){var r={};if(A.push(r),null!=i.sampler){var a=t.samplers[i.sampler];a.magFilter&&(r.magFilter=Ue[a.magFilter]),a.minFilter&&(r.minFilter=Ue[a.minFilter]),a.wrapS&&(r.wrapS=Ve[a.wrapS]),a.wrapT&&(r.wrapT=Ve[a.wrapT])}if(null!=i.source){var n=t.images[i.source];n.uri&&(r.url=e+n.uri)}}),i(r({nodes:v,scenes:t.scenes,meshes:m,animations:y,textures:A,materials:t.materials},l))}if(!t)return i(null,a);var u=[],f=0,p=t.buffers.length,d=[],m=[],g=[],v=[],y=[],A=[],x=[],_=0;t.buffers.forEach(function(t,i){0===t.uri.indexOf("data:")?o(n(t.uri),i):s(e+t.uri,"arraybuffer",function(e){o(e,i)})})})},oe.TextureUtils={crossOrigin:"anonymous",loadTexture:function(e,i,r,a){var n=new oe.ImageLoader;n.crossOrigin=this.crossOrigin;var o=new oe.Texture(t,i),s=n.load(e,function(){o.needsUpdate=!0,r&&r(o)});return o.image=s,o.sourceFile=e,o},loadCompressedTexture:function(e,t,i,r,a){(a=a||new oe.CompressedTexture).mapping=t;var n=new XMLHttpRequest;return n.onload=function(){var e=n.response,t=oe.TextureUtils.parseDDS(e,!0);a.format=t.format,a.mipmaps=t.mipmaps,a.image.width=t.width,a.image.height=t.height,a.generateMipmaps=!1,a.needsUpdate=!0,i&&i(a)},n.onerror=r,n.open("GET",e,!0),n.responseType="arraybuffer",n.send(null),a},loadTextureCube:function(e,i,r,a){var n=[];n.loadCount=0;var o=new oe.Texture;o.image=n,i!==t&&(o.mapping=i),o.flipY=!1;for(var s=0,l=e.length;s<l;++s){var h=new Image;n[s]=h,h.onload=function(){n.loadCount+=1,6===n.loadCount&&(o.needsUpdate=!0,r&&r(o))},h.onerror=a,h.crossOrigin=this.crossOrigin,h.src=e[s]}return o},loadCompressedTextureCube:function(e,i,r,a){var n=[];n.loadCount=0;var o=new oe.CompressedTexture;o.image=n,i!==t&&(o.mapping=i),o.flipY=!1,o.generateMipmaps=!1;if(e instanceof Array)for(var s=0,l=e.length;s<l;++s){var h={};n[s]=h,(u=new XMLHttpRequest).onload=function(e,t){return function(){var i=e.response,a=oe.TextureUtils.parseDDS(i,!0);t.format=a.format,t.mipmaps=a.mipmaps,t.width=a.width,t.height=a.height,n.loadCount+=1,6===n.loadCount&&(o.format=a.format,o.needsUpdate=!0,r&&r(o))}}(u,h),u.onerror=a;c=e[s];u.open("GET",c,!0),u.responseType="arraybuffer",u.send(null)}else{var c=e,u=new XMLHttpRequest;u.onload=function(){var e=u.response,t=oe.TextureUtils.parseDDS(e,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,a=0;a<i;a++){n[a]={mipmaps:[]};for(var s=0;s<t.mipmapCount;s++)n[a].mipmaps.push(t.mipmaps[a*t.mipmapCount+s]),n[a].format=t.format,n[a].width=t.width,n[a].height=t.height}o.format=t.format,o.needsUpdate=!0,r&&r(o)}},u.onerror=a,u.open("GET",c,!0),u.responseType="arraybuffer",u.send(null)}return o},loadDDSTexture:function(e,i,r,a){var n=[];n.loadCount=0;var o=new oe.CompressedTexture;o.image=n,i!==t&&(o.mapping=i),o.flipY=!1,o.generateMipmaps=!1;var s=new XMLHttpRequest;return s.onload=function(){var e=s.response,t=oe.TextureUtils.parseDDS(e,!0);if(t.isCubemap)for(var i=t.mipmaps.length/t.mipmapCount,a=0;a<i;a++){n[a]={mipmaps:[]};for(var l=0;l<t.mipmapCount;l++)n[a].mipmaps.push(t.mipmaps[a*t.mipmapCount+l]),n[a].format=t.format,n[a].width=t.width,n[a].height=t.height}else o.image.width=t.width,o.image.height=t.height,o.mipmaps=t.mipmaps;o.format=t.format,o.needsUpdate=!0,r&&r(o)},s.onerror=a,s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null),o},parseDDS:function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},a=i("DXT1"),n=i("DXT3"),o=i("DXT5"),s=new Int32Array(e,0,31);if(542327876!==s[0])return console.error("TextureUtils.parseDDS(): Invalid magic number in DDS header"),r;if(4&!s[20])return console.error("TextureUtils.parseDDS(): Unsupported format, must contain a FourCC code"),r;var l,h=s[21],c=!1;switch(h){case a:l=8,r.format=oe.RGB_S3TC_DXT1_Format;break;case n:l=16,r.format=oe.RGBA_S3TC_DXT3_Format;break;case o:l=16,r.format=oe.RGBA_S3TC_DXT5_Format;break;default:if(!(32==s[22]&&16711680&s[23]&&65280&s[24]&&255&s[25]&&4278190080&s[26]))return console.error("TextureUtils.parseDDS(): Unsupported FourCC code: ",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(h)),r;c=!0,l=64,r.format=oe.RGBAFormat}r.mipmapCount=1,131072&s[2]&&!1!==t&&(r.mipmapCount=Math.max(1,s[7])),r.isCubemap=!!(512&s[28]),r.width=s[4],r.height=s[3];for(var u=s[1]+4,f=r.width,p=r.height,d=r.isCubemap?6:1,m=0;m<d;m++){for(var g=0;g<r.mipmapCount;g++){if(c)v=(y=function(e,t,i,r){for(var a=i*r*4,n=new Uint8Array(e,t,a),o=new Uint8Array(a),s=0,l=0,h=0;h<r;h++)for(var c=0;c<i;c++){var u=n[l],f=n[++l],p=n[++l],d=n[++l];l++,o[s]=p,o[++s]=f,o[++s]=u,o[++s]=d,s++}return o}(e,u,f,p)).length;else var v=Math.max(4,f)/4*Math.max(4,p)/4*l,y=new Uint8Array(e,u,v);var A={data:y,width:f,height:p};r.mipmaps.push(A),u+=v,f=Math.max(.5*f,1),p=Math.max(.5*p,1)}f=r.width,p=r.height}return r},getNormalMap:function(e,t){var i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};t|=1;var r=e.width,a=e.height,n=document.createElement("canvas");n.width=r,n.height=a;var o=n.getContext("2d");o.drawImage(e,0,0);for(var s=o.getImageData(0,0,r,a).data,l=o.createImageData(r,a),h=l.data,c=0;c<r;c++)for(var u=0;u<a;u++){var f=u-1<0?0:u-1,p=u+1>a-1?a-1:u+1,d=c-1<0?0:c-1,m=c+1>r-1?r-1:c+1,g=[],v=[0,0,s[4*(u*r+c)]/255*t];g.push([-1,0,s[4*(u*r+d)]/255*t]),g.push([-1,-1,s[4*(f*r+d)]/255*t]),g.push([0,-1,s[4*(f*r+c)]/255*t]),g.push([1,-1,s[4*(f*r+m)]/255*t]),g.push([1,0,s[4*(u*r+m)]/255*t]),g.push([1,1,s[4*(p*r+m)]/255*t]),g.push([0,1,s[4*(p*r+c)]/255*t]),g.push([-1,1,s[4*(p*r+d)]/255*t]);for(var y=[],A=g.length,x=0;x<A;x++){var _=g[x],w=g[(x+1)%A];_=i(_,v),w=i(w,v),y.push(function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}(function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}(_,w)))}for(var b=[0,0,0],x=0;x<y.length;x++)b[0]+=y[x][0],b[1]+=y[x][1],b[2]+=y[x][2];b[0]/=y.length,b[1]/=y.length,b[2]/=y.length;var M=4*(u*r+c);h[M]=(b[0]+1)/2*255|0,h[M+1]=(b[1]+1)/2*255|0,h[M+2]=255*b[2]|0,h[M+3]=255}return o.putImageData(l,0,0),n},generateDataTexture:function(e,t,i){for(var r=e*t,a=new Uint8Array(3*r),n=Math.floor(255*i.r),o=Math.floor(255*i.g),s=Math.floor(255*i.b),l=0;l<r;l++)a[3*l]=n,a[3*l+1]=o,a[3*l+2]=s;var h=new oe.DataTexture(a,e,t,oe.RGBFormat);return h.needsUpdate=!0,h}},oe.DataBox=function(e){oe.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=e),this._dataList=new _e,this._dataMap={},this._rootList=new _e,this._rootMap={},this._clientMap={},this._lightList=new _e,this._flareList=new _e,this._billboardList=new _e,this._nodeList=new _e,this._annotationList=new _e,this._particleList=new _e,this.nodes=[],this.particles=[],this.billboards=[],this._dataBoxChangeDispatcher=new oe.EventDispatcher,this._dataPropertyChangeDispatcher=new oe.EventDispatcher,this._groupLists={},this.selection=new _e,this instanceof oe.AlarmBox||(this._selectionModel=new oe.SelectionModel(this),this._alarmBox=new oe.AlarmBox(this),this._alarmStatePropagator=new oe.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0)),this.batch=!1,this._clientMap={}},oe.extend(oe.DataBox,oe.PropertyChangeDispatcher,{constructor:oe.DataBox,className:"TGL.DataBox",___accessor:["name"],add:function(e,t){if(e){1===arguments.length&&(t=-1);var i=e.getId();if(this._dataMap.hasOwnProperty(i)){if(this._dataMap[i]!==e)throw"Data with ID '"+i+"' already exists"}else this._dataMap[i]=e,this._dataList.add(e),e.getParent()||(this._rootMap[i]=e,t>=0?this._rootList.add(e,t):this._rootList.add(e)),e instanceof oe.Billboard?this._billboardList.add(e):e instanceof oe.LensFlare?this._flareList.add(e):e instanceof oe.Node?this._nodeList.add(e):e instanceof oe.Particle?this._particleList.add(e):e instanceof oe.Annotation?this._annotationList.add(e):e instanceof oe.Light&&this._lightList.add(e),this._dataBoxChangeDispatcher.fire({kind:"add",data:e,source:this}),e.getGroupId()&&this.groupElements(e,null,e.getGroupId()),e.addPropertyChangeListener(this.handleDataPropertyChange,this),e._selected=!1}},onPropertyChange:function(){},firePropertyChange:function(){},addByDescendant:function(e,t){t&&0==t(e)||e&&(this.add(e),e.getChildren().size()>0&&e.getChildren().forEach(function(e){this.addByDescendant(e,t)},this))},getAlarmBox:function(){return this._alarmBox},removeById:function(e,t){var i=this.getDataById(e);this.remove(i,t)},remove:function(e,t){if(e&&this._dataMap.hasOwnProperty(e.getId())){e instanceof oe.Link&&(e.setFromNode(null),e.setToNode(null)),e instanceof oe.Node&&e.getLinks()&&e.getLinks().toList().forEach(function(e){this.remove(e)},this),t&&(e.getChildren().forEach(function(t){e.removeChild(t)},this),e.getParent()&&e.getParent().removeChild(e)),this._dataList.remove(e);var i=e._id;delete this._dataMap[i],this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(e)),e instanceof oe.Billboard?this._billboardList.remove(e):e instanceof oe.Node?this._nodeList.remove(e):e instanceof oe.Particle?this._particleList.remove(e):e instanceof oe.Annotation?this._annotationList.remove(e):e instanceof oe.Light?this._lightList.remove(e):e instanceof oe.LensFlare&&this._flareList.remove(e),e.getGroupId()&&this.groupElements(e,e.getGroupId(),null),e.removePropertyChangeListener(this.handleDataPropertyChange,this),this._dataBoxChangeDispatcher.fire({kind:"remove",data:e,source:this}),this._selectionModel&&this._selectionModel.removeSelection(e)}},removeByDescendant:function(e,t,i){if(e){var r=this;e.hasChildren()&&e.getChildren().forEachReverse(function(e){r.removeByDescendant(e,t,i)}),i&&0==i(e)||this.remove(e,t)}},containsById:function(e){return this._dataMap.hasOwnProperty(e)},contains:function(e){return!!e&&this._dataMap[e._id]===e},lightsSize:function(){return this._lightList.size()},getLights:function(){return this._lightList},getLightsArray:function(){return this._lightList.toArray()},getAnnotations:function(){return this._annotationList},clear:function(e){if(this._dataList.size()>0){var t=this._dataList.toList(function(t){return!this._lightList.contains(t)||e},this);if(t.forEach(function(e){e.removePropertyChangeListener(this.handleDataPropertyChange,this)},this),this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._nodeList.clear(),this._billboardList.clear(),e)this._lightList.clear(),this._flareList.clear();else{var i=this;this._lightList.forEach(function(e){i._dataList.add(e);var t=e.getId();i._dataMap[t]=e,null==e.getParent()&&(i._rootList.add(e),i._rootMap[t]=e)})}this._dataBoxChangeDispatcher.fire({kind:"clear",datas:t}),this.clearSelection()}},startBatch:function(){this.batch=!0},endBatch:function(){this.batch=!1,this._dataBoxChangeDispatcher.fire({kind:"batchEnd"})},removeSelection:function(){this._selectionModel.toSelection().forEach(function(e){this.remove(e)},this)},clearSelection:function(){this._selectionModel&&this._selectionModel.clearSelection()},clearEditing:function(){this._nodeList.forEach(function(e){e.editing=!1}),this._billboardList.forEach(function(e){e.editing=!1})},getDataById:function(e){return this._dataMap[e]},groupElements:function(e,t,i){var r;t&&(r=this._groupLists[t])&&(r.remove(e),r.isEmpty()&&delete this._groupLists[t]),i&&(null==(r=this._groupLists[i])&&(r=new _e,this._groupLists[i]=r),r.contains(e)||r.add(e))},synchronizeGroup:function(e,t,i,r){if(!this.isAdjustingGroup){this.isAdjustingGroup=!0;var a=e.getGroupId(),n=new oe.Vec3;if(a){var o=this._groupLists[a];o&&o.size()>1&&o.forEach(function(a){a===e||a.isDescendantOf(e)||e.isDescendantOf(a)||(n.subVectors(i,t),a[oe.setter(r)](a[oe.getter(r)]().clone().add(n)))})}this.isAdjustingGroup=!1}},handleDataPropertyChange:function(e){var t=e.source;if("parent"===e.property){var i=t.getId();t.getParent()?this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(t)):this._rootMap[i]||(this._rootMap[i]=t,this._rootList.add(t))}else if("groupId"===e.property){var r=e.oldValue,a=e.newValue;this.groupElements(t,r,a)}else"position"===e.property||"scale"===e.property||"rotation"===e.property?this.synchronizeGroup(t,e.oldValue,e.newValue,e.property):"selected"===e.property&&(t._selected?this._selectionModel.appendSelection(t):this._selectionModel.removeSelection(t));this.onDataPropertyChanged(t,e),this._dataPropertyChangeDispatcher.fire(e)},onDataPropertyChanged:function(e,t){},addDataBoxChangeListener:function(e,t,i){this._dataBoxChangeDispatcher.add(e,t,i)},removeDataBoxChangeListener:function(e,t){this._dataBoxChangeDispatcher.remove(e,t)},addDataPropertyChangeListener:function(e,t,i){this._dataPropertyChangeDispatcher.add(e,t,i)},removeDataPropertyChangeListener:function(e,t){this._dataPropertyChangeDispatcher.remove(e,t)},allocateLights:function(){var e,t,i,r,a,n;i=r=a=0;var o=this._lightList;for(e=0,t=o.size();e<t;e++)(n=o.get(e)).onlyShadow||(n instanceof oe.DirectionalLight&&i++,n instanceof oe.PointLight&&r++,n instanceof oe.SpotLight&&a++);return{directional:i,point:r,spot:a,hemi:0}},allocateShadows:function(){var e,t,i,r=0,a=this._lightList;for(e=0,t=a.size();e<t;e++)(i=a.get(e)).castShadow&&(i instanceof oe.SpotLight&&r++,i instanceof oe.DirectionalLight&&!i.shadowCascade&&r++);return r},allocatePointShadows:function(){var e,t,i,r=0,a=this._lightList;for(e=0,t=a.size();e<t;e++)(i=a.get(e)).castShadow&&i instanceof oe.PointLight&&r++;return r},getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(e){var t=this._limit;this._limit=e,this.firePropertyChange("limit",t,e),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(e){for(0===arguments.length&&(e=1);e>0&&this._dataList.size()>0;){var t=this._dataList.get(0);this.remove(t),e--}},getSiblings:function(e){if(!this.contains(e))throw e+" dosen't belong to this dataBox";var t=e.getParent();return t?t.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(e){return e.getParent()?e.getParent().getChildren().indexOf(e):this._rootList.indexOf(e)},getNodes:function(){return this._nodeList},getBillboards:function(){return this._billboardList},getLensFlares:function(){return this._flareList},getDatas:function(){return this._dataList},getDataAt:function(e){return this._dataList.get(e)},toDatas:function(e,t){return this._dataList.toList(e,t)},forEach:function(e,t){this._dataList.forEach(e,t)},forEachReverse:function(e,t){this._dataList.forEachReverse(e,t)},forEachByDepthFirst:function(e,t,i){if(t)this._depthFirst(e,t,i);else for(var r=this._rootList.size(),a=0;a<r;a++){var n=this._rootList.get(a);if(!1===this._depthFirst(e,n,i))return}},_depthFirst:function(e,t,i){for(var r=t.getChildrenSize(),a=0;a<r;a++){var n=t.getChildAt(a);if(!1===this._depthFirst(e,n,i))return!1}if(i){if(!1===e.call(i,t))return!1}else if(!1===e(t))return!1},forEachByBreadthFirst:function(e,t,i){var r=new _e;for(t?r.add(t):this._rootList.forEach(r.add,r);r.size()>0;)if((t=r.removeAt(0)).getChildren().forEach(r.add,r),i){if(!1===e.call(i,t))return}else if(!1===e(t))return},getAlarmStatePropagator:function(){return this._alarmStatePropagator},setAlarmStatePropagator:function(e){this._alarmStatePropagator!=e&&(this._alarmStatePropagator&&this._alarmStatePropagator.setEnable(!1),this._alarmStatePropagator=e,this._alarmStatePropagator.setEnable(!0))},setClient:function(e,t){if(null==e)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[e];if(i!==t)return null==t?delete this._clientMap[e]:this._clientMap[e]=t,this._clientMap[e]=t,this.firePropertyChange("C:"+e,i,t),this},getClient:function(e){return this._clientMap[e]}}),oe.QuickFinder=function(e,t,i,r,a){if(this._map={},!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=oe.getter(t)),this._valueFunction=r||this.getValue,this._filterFunction=a||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},oe.extend(oe.QuickFinder,Object,{_NULL_:"mono-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(e){"add"===e.kind?this._addData(e.data):"remove"===e.kind?this._removeData(e.data):"clear"===e.kind&&(this._map={})},handleDataPropertyChange:function(e){if(this._filterFunction.call(this,e.source)){if("accessor"===this._propertyType&&this._propertyName===e.property);else if("style"===this._propertyType&&e.source.IStyle&&"S:"+this._propertyName===e.property);else if("client"!==this._propertyType||"C:"+this._propertyName!==e.property)return;var t=this._getMap(e.oldValue);t&&t.remove(e.source),this._addData(e.source)}},_getMap:function(e){return e=null==e?this._NULL_:e,this._map[e]},find:function(e){var t=this._getMap(e);return t?t.toList():new _e},findFirst:function(e){var t=this._getMap(e);return!t||t.isEmpty()?null:t.get(0)},_addData:function(e){if(this._filterFunction.call(this,e)){var t=this._valueFunction.call(this,e),i=this._getMap(t);i||(i=new _e,t=null==t?this._NULL_:t,this._map[t]=i),i.add(e)}},_removeData:function(e){if(this._filterFunction.call(this,e)){var t=this._valueFunction.call(this,e),i=this._getMap(t);i&&(i.remove(e),i.isEmpty()&&(t=null==t?this._NULL_:t,delete this._map[t]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(e){return!("style"===this._propertyType&&!e.IStyle)&&!("accessor"===this._propertyType&&this._valueFunction===this.getValue&&!e[this._getter])},getValue:function(e){return"accessor"===this._propertyType?e[this._getter]():"style"===this._propertyType&&e.getStyle?e.getStyle(this._propertyName):"client"===this._propertyType&&e.getClient?e.getClient(this._propertyName):null}}),oe.SelectionModel=function(e){oe.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new _e,this._selectionChangeDispatcher=new oe.EventDispatcher,this._selectionMap={},this._setDataBox(e)},oe.extend(oe.SelectionModel,oe.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(e){if(this._selectionMode!==e&&("noneSelection"===e||"singleSelection"===e||"multipleSelection"===e)){this.clearSelection();var t=this._selectionMode;this._selectionMode=e,this.firePropertyChange("selectionMode",t,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(e){if(!e)throw"dataBox can not be null";if(this._dataBox!==e){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var t=this._dataBox;this._dataBox=e,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",t,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(e){if("remove"===e.kind){var t=e.data;this.contains(t)&&(this._selectionList.remove(t),delete this._selectionMap[t.getId()],this.fireSelectionChange("remove",new _e(t))),t._selected=!1}else"clear"===e.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(e){if(this._filterFunction!==e){this.clearSelection();var t=this._filterFunction;this._filterFunction=e,this.firePropertyChange("filterFunction",t,this._filterFunction)}},fireSelectionChange:function(e,t,i){i&&(this._selectionList.forEach(function(e){i.contains(e)?i.remove(e):i.add(e)}),t=i.toList()),this._selectionChangeDispatcher.fire({kind:e,datas:new _e(t)})},addSelectionChangeListener:function(e,t,i){this._selectionChangeDispatcher.add(e,t,i)},removeSelectionChangeListener:function(e,t){this._selectionChangeDispatcher.remove(e,t)},_filterList:function(e,t){for(var i=new _e(e),r=0;r<i.size();r++){var a=i.get(r);(this._filterFunction&&!this._filterFunction(a)||t&&this.contains(a)||!t&&!this.contains(a)||!this._dataBox.contains(a))&&(i.removeAt(r),r--)}return i},appendSelection:function(e){if("noneSelection"!==this._selectionMode){var t=this._filterList(e,!0);if(!t.isEmpty()){var i=null;"singleSelection"===this._selectionMode&&(i=new _e(this._selectionList),this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={},t=new _e(t.get(t.size()-1)));for(var r=0;r<t.size();r++){var a=t.get(r);a._selected=!0,this._selectionList.add(a),this._selectionMap[a._id]=a}this.fireSelectionChange("append",t,i)}}},removeSelection:function(e){var t=this._filterList(e);if(0!==t.size()){for(var i=0;i<t.size();i++){var r=t.get(i);r._selected=!1,this._selectionList.remove(r),delete this._selectionMap[r.getId()]}this.fireSelectionChange("remove",t)}},toSelection:function(e,t){return this._selectionList.toList(e,t)},getSelection:function(){return this._selectionList},setSelection:function(e){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=e)){var t=new _e(this._selectionList);this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={};var i=this._filterList(e,!0);"singleSelection"===this._selectionMode&&i.size()>1&&(i=new _e(i.get(i.size()-1)));for(var r=0;r<i.size();r++){var a=i.get(r);a._selected=!0,this._selectionList.add(a),this._selectionMap[a.getId()]=a}this.fireSelectionChange("set",null,t)}},clearSelection:function(){if(this._selectionList.size()>0){var e=this._selectionList.toList();this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",e)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var e=this._dataBox.toDatas(),t=0,i=null;if(this._filterFunction)for(t=0;t<e.size();t++)i=e.get(t),this._filterFunction(i)||(e.removeAt(t),t--);var r=new _e(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&e.size()>1&&(e=new _e(e.get(e.size()-1))),t=0;t<e.size();t++)i=e.get(t),this._selectionList.add(i),this._selectionMap[i.getId()]=i;this.fireSelectionChange("all",null,r)}},size:function(){return this._selectionList.size()},contains:function(e){return!!e&&null!=this._selectionMap[e._id]},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(e){return!!e&&("noneSelection"!==this._selectionMode&&!(this._filterFunction&&!this._filterFunction(e)))}}),oe.AlarmSeverity=function(e,t,i,r,a){this.value=e,this.name=t,this.nickName=i,this.color=r,this.displayName=a},oe.extend(oe.AlarmSeverity,Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var e=oe.AlarmSeverity;e.severities=new _e,e._vm={},e._nm={},e._cp=function(e,t){if(e&&t){var i=e.value-t.value;return i>0?1:i<0?-1:0}return e&&!t?1:!e&&t?-1:0},e.forEach=function(t,i){e.severities.forEach(t,i)},e.getSortFunction=function(){return e._cp},e.setSortFunction=function(t){e._cp=t,e.severities.sort(t)},e.add=function(t,i,r,a,n){var o=new e(t,i,r,a,n);return e._vm[t]=o,e._nm[i]=o,e.severities.add(o),e.severities.sort(e._cp),o},e.remove=function(t){var i=e._nm[t];return i&&(delete e._nm[t],delete e._vm[i.value],e.severities.remove(i)),i},e.CRITICAL=e.add(500,"Critical","C","#FF0000"),e.MAJOR=e.add(400,"Major","M","#FFA000"),e.MINOR=e.add(300,"Minor","m","#FFFF00"),e.WARNING=e.add(200,"Warning","W","#00FFFF"),e.INDETERMINATE=e.add(100,"Indeterminate","N","#C800FF"),e.CLEARED=e.add(0,"Cleared","R","#00FF00"),e.isClearedAlarmSeverity=function(e){return!!e&&0===e.value},e.getByName=function(t){return e._nm[t]},e.getByValue=function(t){return e._vm[t]},e.clear=function(){e.severities.clear(),e._vm={},e._nm={}},e.compare=function(t,i){return e._cp(t,i)}}(),oe.AlarmState=function(e){this._e=e,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},oe.extend(oe.AlarmState,Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var e=null;for(var t in this._am)t=oe.AlarmSeverity.getByName(t),oe.AlarmSeverity.isClearedAlarmSeverity(t)||0!==this.getAcknowledgedAlarmCount(t)&&(e=e&&oe.AlarmSeverity.compare(e,t)>0?e:t);this._haa=e},_c2:function(){var e=null;for(var t in this._nm)t=oe.AlarmSeverity.getByName(t),oe.AlarmSeverity.isClearedAlarmSeverity(t)||0!==this.getNewAlarmCount(t)&&(e=e&&oe.AlarmSeverity.compare(e,t)>0?e:t);this._hna=e},_c3:function(){if(this._hna){for(var e in this._nm)if(e=oe.AlarmSeverity.getByName(e),!oe.AlarmSeverity.isClearedAlarmSeverity(e)&&0!==this.getNewAlarmCount(e)&&oe.AlarmSeverity.compare(this._hna,e)>0)return void(this._hls=!0);this._hls=!1}else this._hls=!1},_c4:function(){var e=this._haa,t=this._hna,i=this._ps;this._hoa=e,oe.AlarmSeverity.compare(t,this._hoa)>0&&(this._hoa=t),oe.AlarmSeverity.compare(i,this._hoa)>0&&(this._hoa=i)},_c5:function(){var e=this._haa,t=this._hna;this._hta=e,oe.AlarmSeverity.compare(t,this._hta)>0&&(this._hta=t)},increaseAcknowledgedAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._am[e.name];null==i&&(i=0),i+=t,this._am[e.name]=i,this._f(),this._e.onAlarmChange()}},increaseNewAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._nm[e.name];null==i&&(i=0),i+=t,this._nm[e.name]=i,this._f(),this._e.onAlarmChange()}},decreaseAcknowledgedAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._am[e.name];if(null==i&&(i=0),(i-=t)<0)throw"Alarm count can not be negative";this._am[e.name]=i,this._f(),this._e.onAlarmChange()}},decreaseNewAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._nm[e.name];if(null==i&&(i=0),(i-=t)<0)throw"Alarm count can not be negative";this._nm[e.name]=i,this._f(),this._e.onAlarmChange()}},acknowledgeAlarm:function(e){this.decreaseNewAlarm(e,1),this.increaseAcknowledgedAlarm(e,1)},acknowledgeAllAlarms:function(e){if(e){var t=this.getNewAlarmCount(e);this.decreaseNewAlarm(e,t),this.increaseAcknowledgedAlarm(e,t)}else for(var i in this._nm)this.acknowledgeAllAlarms(oe.AlarmSeverity.getByName(i))},_c6:function(){this._aac=0;for(var e in this._am)e=oe.AlarmSeverity.getByName(e),this._aac+=this.getAcknowledgedAlarmCount(e)},getAcknowledgedAlarmCount:function(e){if(e){var t=this._am[e.name];return null==t?0:t}return this._aac},getAlarmCount:function(e){return this.getAcknowledgedAlarmCount(e)+this.getNewAlarmCount(e)},_c7:function(){this._nac=0;for(var e in this._nm)e=oe.AlarmSeverity.getByName(e),this._nac+=this.getNewAlarmCount(e)},getNewAlarmCount:function(e){if(e){var t=this._nm[e.name];return null==t?0:t}return this._nac},setNewAlarmCount:function(e,t){this._nm[e.name]=t,this._f()},removeAllNewAlarms:function(e){e?delete this._nm[e]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(e,t){this._am[e.name]=t,this._f()},removeAllAcknowledgedAlarms:function(e){e?delete this._am[e.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(e){if(this._ep||(e=null),this._ps!==e){var t=this._ps;this._ps=e,this._f(),this._e.onAlarmChange(),this._e.firePropertyChange("propagateSeverity",t,e)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(e){var t=this._ep;this._ep=e,this._e.firePropertyChange("enablePropagation",t,e)&&(e||this.setPropagateSeverity(null))}}),oe.Alarm=function(e,t,i,r,a){oe.Data.call(this,e),this._id=null!=e?e:oe.id("A"),this._elementId=t,this._alarmSeverity=i,this._acked=r||!1,this._cleared=a||!1},oe.extend(oe.Alarm,oe.Data,{IAlarm:!0,getElementId:function(){return this._elementId},___accessor:["acked","cleared","alarmSeverity"]}),oe.AlarmBox=function(e){if(!e)throw"elementBox can not be null.";oe.AlarmBox.superClass.constructor.call(this),this._elementBox=e,this._alarmElementMapping=new oe.AlarmElementMapping(this,e),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},oe.extend(oe.AlarmBox,oe.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(e){var t=this._removeAlarmWhenAlarmIsCleared;if(this._removeAlarmWhenAlarmIsCleared=e,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",t,e),e)for(var i in this.datas){var r=this.datas[i];r.isCleard()&&this.remove(r)}},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(e){if(!e)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==e){var t=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=e,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",t,e)}},handleElementBoxChange:function(e){"add"===e.kind?this.handleElementAdded(e.data):"remove"===e.kind?(this.handleElementRemoved(e.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(e.data)):"clear"===e.kind&&(e.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(e){"add"===e.kind?this._increaseAlarmState(e.data):"remove"===e.kind?this._decreaseAlarmState(e.data):"clear"===e.kind&&e.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(e){var t=e.source;t.isCleared()||("alarmSeverity"===e.property?this.handleAlarmSeverityChange(t,e):"acked"===e.property&&this.handleAckedChange(t,e)),"cleared"===e.property&&(t.isCleared()?(this._decreaseAlarmState(t,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(t)):this._increaseAlarmState(t,!0))},handleAckedChange:function(e,t){if(e.getAlarmSeverity()){var i=this.getCorrespondingElements(e);if(i)for(var r=0;r<i.size();r++){var a=i.get(r);t.oldValue?a.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()),t.newValue?a.getAlarmState().increaseAcknowledgedAlarm(e.getAlarmSeverity()):a.getAlarmState().increaseNewAlarm(e.getAlarmSeverity())}}},handleAlarmSeverityChange:function(e,t){var i=t.oldValue,r=t.newValue,a=this.getCorrespondingElements(e);if(a)for(var n=0;n<a.size();n++){var o=a.get(n);i&&(e.isAcked()?o.getAlarmState().decreaseAcknowledgedAlarm(i):o.getAlarmState().decreaseNewAlarm(i)),r&&(e.isAcked()?o.getAlarmState().increaseAcknowledgedAlarm(r):o.getAlarmState().increaseNewAlarm(r))}},getCorrespondingAlarms:function(e){return this._alarmElementMapping.getCorrespondingAlarms(e)},getCorrespondingElements:function(e){return this._alarmElementMapping.getCorrespondingElements(e)},handleElementAdded:function(e){var t=this.getCorrespondingAlarms(e);if(t)for(var i=0;i<t.size();i++){var r=t.get(i);if(!r.isCleared()){var a=r.getAlarmSeverity();a&&(r.isAcked()?e.getAlarmState().increaseAcknowledgedAlarm(a):e.getAlarmState().increaseNewAlarm(a))}}},_increaseAlarmState:function(e,t){if(!e.isCleared()||t){var i=e.getAlarmSeverity();if(i){var r=this.getCorrespondingElements(e);if(r)for(var a=0;a<r.size();a++){var n=r.get(a);e.isAcked()?n.getAlarmState().increaseAcknowledgedAlarm(i):n.getAlarmState().increaseNewAlarm(i)}}}},_decreaseAlarmState:function(e,t){if(e.isCleared||console.log(),!e.isCleared()||t){var i=e.getAlarmSeverity();if(i){var r=this.getCorrespondingElements(e);if(r)for(var a=0;a<r.size();a++){var n=r.get(a);e.isAcked()?n.getAlarmState().decreaseAcknowledgedAlarm(i):n.getAlarmState().decreaseNewAlarm(i)}}}},handleElementRemoved:function(e){var t=this.getCorrespondingAlarms(e);t&&t.forEach(function(t){!t.isCleared()&&t.getAlarmSeverity()&&(t.isAcked()?e.getAlarmState().decreaseAcknowledgedAlarm(t.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(t.getAlarmSeverity()))})},removeAlarmsByElement:function(e){var t=this.getCorrespondingAlarms(e);t&&t.forEach(this.remove,this)},add:function(e,t){if(!e.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&e.isCleared()||oe.AlarmBox.superClass.add.apply(this,arguments)}}),oe.AlarmElementMapping=function(e,t){if(!t)throw"ElementBox can not be null";if(!e)throw"AlarmBox can not be null";this._elementBox=t,this._alarmBox=e,this._alarmsFinder=new oe.QuickFinder(e,"elementId")},oe.extend(oe.AlarmElementMapping,Object,{getCorrespondingAlarms:function(e){return this._alarmsFinder.find(e.getId())},getCorrespondingElements:function(e){var t=this._elementBox.getDataById(e.getElementId());return new _e(t)},dispose:function(){delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),oe.PropertyPropagator=function(e,t,i){if(!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=oe.getter(t),this._setter=oe.setter(t)),this._enable=!1,this._isPropagating=!1},oe.extend(oe.PropertyPropagator,Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(e){if(this._enable!==e)if(this._enable=e,this._enable){this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this);for(var t in this._dataBox.datas)this.propagate(this._dataBox.datas[t])}else this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)},handleDataBoxChange:function(e){e.data&&this.propagate(e.data)},handleDataPropertyChange:function(e){if(this.isInterestedProperty(e))this.propagate(e.source);else if("parent"===e.property){var t=e.oldValue;t&&this.propagate(t),this.propagate(e.source)}},isInterestedProperty:function(e){return"accessor"===this._propertyType&&this._propertyName===e.property||(!("style"!==this._propertyType||!e.IElement||"S:"+this._propertyName!==e.property)||"client"===this._propertyType&&"C:"+this._propertyName===e.property)},propagate:function(e){e&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(e),this._isPropagating=!1)},propagateToTop:function(e){for(this.propagateToParent(null,e);e&&e.getParent();)this.propagateToParent(e,e.getParent()),e=e.getParent()},propagateToParent:function(e,t){}}),oe.AlarmStatePropagator=function(e){oe.AlarmStatePropagator.superClass.constructor.call(this,e,"alarmState")},oe.extend(oe.AlarmStatePropagator,oe.PropertyPropagator,{handleDataPropertyChange:function(e){"enablePropagation"===e.property?this.propagate(e.source):oe.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,e)},propagateToParent:function(e,t){var i=null;t.getChildren().forEach(function(e){var t=e.getAlarmState().getHighestOverallAlarmSeverity();oe.AlarmSeverity.compare(t,i)>0&&(i=t)}),t.getAlarmState&&t.getAlarmState().setPropagateSeverity(i)}});var ke={KEEP_DEFAULT_FUNCTION:function(e){return!(!e.target.keepDefault&&!e.target.getAttribute("keepDefault"))||(!(!e.target.parentNode||!e.target.parentNode.keepDefault&&!e.target.parentNode.getAttribute("keepDefault"))||!!e.shiftKey)}};ke.paintSortFunction=function(e,t){return e.z!==t.z?e.z-t.z:0},ke.doubleClickToLookAtFunction=function(e){return!0},ke.needSmoothNormalFunction=function(e){return!(e instanceof Te||e instanceof oe.TextNode||e instanceof oe.PathCube||e instanceof oe.ShapeNode||e instanceof oe.ComboNode||"TGL.Entity"==e.getClassName())},ke.PATH_LINK_COMPUTE_DELAY=!1,oe.Defaults=ke,oe.ShaderChunk={gradient_parts_fragment:["#ifdef MAX_GRADIENT","uniform vec3 gradientColor[MAX_GRADIENT];","uniform float gradientStop[MAX_GRADIENT];","uniform int gradientType;","#endif"].join("\n"),gradient_basic_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] <= gradientUV){","if((gradientStop[i] >= gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 =gradientStop[i]; ","gl_FragColor = vec4( (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1),opacity);","break;","}","}","}","#endif"].join("\n"),gradient_phong_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] < gradientUV){","if((gradientStop[i] > gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 = gradientStop[i]; ","tempDiffuse = (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1);","break;","}","}","}","#endif"].join("\n"),rim_light_fragment:["#ifdef USE_RIM_LIGHT","float d = dot(viewPosition, normal);","float vdn = 1.0 - d;","vdn = pow(vdn, rimLightScale);","gl_FragColor.rgb += rimLightColor * vdn;","#endif"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#else","vec4 cubeColor = textureCube( envMap, vec3(reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","#ifdef PHONG","#else","float specularStrength = 1.0;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP ) ","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","uniform vec4 offsetRepeat;","uniform bool flipX; ","uniform bool flipY; ","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","#endif","#ifdef USE_MAP","uniform bool mapLoaded;","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","if(flipX || flipY){","float sx = 1.0, ox = 0.0;","float sy = 1.0,oy = 0.0;","if(flipX){  sx = -1.0;ox = 1.0;}","if(flipY){  sy = -1.0; oy = 1.0;}","vUv.x = uv.x * offsetRepeat.z * sx  + offsetRepeat.x + offsetRepeat.z * ox;","vUv.y = uv.y * offsetRepeat.w * sy  + offsetRepeat.y + offsetRepeat.w * oy;","}else{","vUv = uv * offsetRepeat.zw  + offsetRepeat.xy;","}","oUv = uv;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","if(mapLoaded){","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = texelColor * gl_FragColor;","}","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = uspecularStrength;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0 ","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += tempDiffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ]) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += tempDiffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += tempDiffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += tempDiffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","float ssao = 1.0;","#ifdef USE_SSAO","ssao = clamp(1.0 - texture2D(mapSSAO, (finalPosition.xy / finalPosition.w / 2.0 + vec2(0.5,0.5))).x,0.0,1.0);","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient * ssao) + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient) * ssao ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","mat4 boneMatZ = getBoneMatrix( skinIndex.z );","mat4 boneMatW = getBoneMatrix( skinIndex.w );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","skinned \t  += boneMatZ * skinVertex * skinWeight.z;","skinned \t  += boneMatW * skinVertex * skinWeight.w;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += morphTarget0 * morphTargetInfluences[ 0 ];","morphed += morphTarget1 * morphTargetInfluences[ 1 ];","morphed += morphTarget2 * morphTargetInfluences[ 2 ];","morphed += morphTarget3 * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += morphTarget4 * morphTargetInfluences[ 4 ];","morphed += morphTarget5 * morphTargetInfluences[ 5 ];","morphed += morphTarget6 * morphTargetInfluences[ 6 ];","morphed += morphTarget7 * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal += morphNormal0 * morphTargetInfluences[ 0 ];","morphedNormal += morphNormal1 * morphTargetInfluences[ 1 ];","morphedNormal += morphNormal2 * morphTargetInfluences[ 2 ];","morphedNormal += morphNormal3 * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","uniform sampler2D pShadowMap[MAX_POINT_SHADOWS];","uniform vec2 pShadowMapSize[ MAX_POINT_SHADOWS ];","uniform float pShadowDarkness[MAX_POINT_SHADOWS];","uniform float pShadowRadius [MAX_POINT_SHADOWS];","uniform float pShadowBias [MAX_POINT_SHADOWS];","uniform vec3 pPosition[MAX_POINT_SHADOWS];","uniform float shadowCameraNear;","uniform float shadowCameraFar;","varying vec4 pWorldPosition;","vec2 cubeToUV( vec3 v, float texelSizeY ) {","\tvec3 absV = abs( v );","\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );","\tabsV *= scaleToCube;","\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );","\tvec2 planar = v.xy;","\tfloat almostATexel = 1.5 * texelSizeY;","\tfloat almostOne = 1.0 - almostATexel;","\tif ( absV.z >= almostOne ) {","\t\tif ( v.z > 0.0 )","\t\t\tplanar.x = 4.0 - v.x;","\t\t} else if ( absV.x >= almostOne ) {","\t\t \tfloat signX = sign( v.x );","\t\t\tplanar.x = v.z * signX + 2.0 * signX;","\t\t} else if ( absV.y >= almostOne ) {","\t\t\tfloat signY = sign( v.y );","\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;","\t\t\tplanar.y = v.z * signY - 2.0;","\t\t}","\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );","}","float unpack (vec4 colour){","const vec4 bitShifts = vec4(1.0,1.0 / 255.0,1.0 / (255.0 * 255.0),1.0 / (255.0 * 255.0 * 255.0));","return dot(colour, bitShifts) ;","}","float texture2DCompare( sampler2D depths, vec2 uv, float compare ){","\treturn step( compare, unpack( texture2D( depths, uv ) ) );","}","float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec3 lightToPosition, float shadowCameraNear, float shadowCameraFar ) {","\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );","\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );","\tdp += shadowBias;","\tvec3 bd3D = normalize( lightToPosition );","\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )","\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;","\treturn (","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )","\t) * ( 1.0 / 9.0 );","#else","\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );","#endif","}","#endif","#if defined(USE_SHADOWMAP) || defined(USE_POINT_SHADOWMAP)","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3(inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2(inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif","#ifdef USE_POINT_SHADOWMAP"," ","for( int i = 0; i < MAX_POINT_SHADOWS; i ++ ) {","vec3 lightToPosition = pWorldPosition.xyz - pPosition[i];","vec2 shadowMapSize = pShadowMapSize[i];","float shadow = getPointShadow(pShadowMap[i],shadowMapSize,pShadowBias[i],pShadowRadius[i],lightToPosition,shadowCameraNear,shadowCameraFar);","float darkness = 1.0 - pShadowDarkness[i];","gl_FragColor.xyz *= (darkness + (1.0 - darkness) * shadow);","}","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","varying vec4 pWorldPosition;","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","#ifdef USE_POINT_SHADOWMAP","pWorldPosition = modelMatrix * vec4(position,1.0);","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},oe.UniformsUtils={merge:function(e){var t,i,r,a={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(i in r)a[i]=r[i]}return a},clone:function(e){var t,i,r,a={};for(t in e){a[t]={};for(i in e[t])(r=e[t][i])instanceof oe.Color||r instanceof oe.Vec2||r instanceof oe.Vec3||r instanceof oe.Vec4||r instanceof oe.Mat4||r instanceof oe.Texture?a[t][i]=r.clone():r instanceof Array?a[t][i]=r.slice():a[t][i]=r}return a}},oe.UniformsLib={outline:{diffuse:{type:"c",value:new oe.Color(15658734)},outline_offset:{type:"f",value:0}},glow:{map:{type:"t",value:null}},blur:{orientation:{type:"i",value:0},texelSize:{type:"v2",value:new oe.Vec2(512,512)},blurAmount:{type:"i",value:10},blurScale:{type:"f",value:1},blurStrength:{type:"f",value:.2},map:{type:"t",value:null},useBlur:{type:"i",value:1},blurGlobalAlpha:{type:"f",value:1}},deferred:{linearDepth:{type:"f",value:9e3},isNormal:{type:"i",value:1}},ssao:{map0:{type:"t",value:null},map1:{type:"t",value:null},map2:{type:"t",value:null},occluderBias:{type:"f",value:.05},samplingRadius:{type:"f",value:20},attenuation:{type:"v2",value:new le(1,0)},texelSize:{type:"v2",value:new le(1/512,1/512)}},common:{diffuse:{type:"c",value:new oe.Color(15658734)},wireframeLinecolor:{type:"c",value:new oe.Color(0)},wireframeLineopacity:{type:"f",value:1},opacity:{type:"f",value:1},clipPlane:{type:"v4",value:new oe.Vec4(0,0,0,0)},rimLightColor:{type:"c",value:new oe.Color(0)},rimLightScale:{type:"f",value:1},map:{type:"t",value:null},mapLoaded:{type:"i",value:0},offsetRepeat:{type:"v4",value:new oe.Vec4(0,0,1,1)},flipX:{type:"i",value:0},flipY:{type:"i",value:0},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},gradient:{gradientColor:{type:"v3v",value:[]},gradientStop:{type:"fv1",value:[]},gradientType:{type:"i",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new oe.Vec2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new oe.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new oe.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new oe.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},pShadowMap:{type:"tv",value:[]},pShadowMapSize:{type:"v2v",value:[]},pShadowDarkness:{type:"fv1",value:[]},pShadowRadius:{type:"fv1",value:[]},pShadowBias:{type:"fv1",value:[]},pPosition:{type:"v3v",value:[]},shadowCameraNear:{type:"f",value:.1},shadowCameraFar:{type:"f",value:1e4}},gradientramp:{skyColor:{type:"c",value:new oe.Color(16777215)},horizonColor:{type:"c",value:new oe.Color(16777215)},earthColor:{type:"c",value:new oe.Color(16777215)},skyY:{type:"f",value:0},horizonY:{type:"f",value:0},earthY:{type:"f",value:0}}},oe.ShaderLib={outline:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.outline]),vertexShader:["uniform float outline_offset;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position + normalize(position)  * outline_offset, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","void main() {","gl_FragColor = vec4(diffuse, 1.0 );","}"].join("\n")},blur:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.blur]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform vec2 texelSize;","uniform sampler2D map;","uniform int orientation;","uniform int blurAmount;","uniform float blurScale;","uniform float blurStrength;","uniform int useBlur;","uniform float blurGlobalAlpha;","uniform sampler2D depthMap;","varying vec2 vUv;","float Gaussian (float x, float deviation){","return (1.0 / sqrt(2.0 * 3.141592 * deviation)) * exp(-((x * x) / (2.0 * deviation)));","}","void main (){","float halfBlur = float(blurAmount) * 0.5;","vec4 colour = vec4(0.0);","if(useBlur == 0){","colour = texture2D(map,vUv);","}else {","vec4 texColour = vec4(0.0);","float deviation = halfBlur * 0.35;","deviation *= deviation;","float strength = 1.0 - blurStrength;","if ( orientation == 0 ){","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount ){","break;","}","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(offset / texelSize.x * blurScale, 0.0)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}else{","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount )","break;","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(0.0, offset / texelSize.y * blurScale)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}","}","gl_FragColor = clamp(colour, 0.0, 1.0);","if(useBlur == 0){","gl_FragColor.w *=  gl_FragColor.w * gl_FragColor.w * gl_FragColor.w * blurGlobalAlpha;","}","}"].join("\n")},linex:{uniforms:oe.UniformsUtils.merge([{near:{type:"f",value:.1},opacity:{type:"f",value:1},viewport:{type:"v4",value:new oe.Vec4(0)},lineColor:{type:"c",value:new oe.Color(16777215)},modelViewProjectionMatrix:{type:"m4",value:new ue},useVertexColor:{type:"i",value:0},totalSize:{type:"f",value:0},dashSize:{type:"f",value:0},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new oe.Vec4(0,0,1,1)}},oe.UniformsLib.gradient]),vertexShader:["attribute vec3 positionPrev;","attribute vec3 positionNext;","attribute float offset;","attribute float lineDistances;","varying  vec3 vColor;","varying float vLineDistance;","varying vec2 vUv;","varying vec2 oUv;","uniform mat4 modelViewProjectionMatrix;","uniform vec4 viewport;","uniform float near;","uniform vec4 offsetRepeat;","vec4 clipNear(vec4 p1,vec4 p2){","\tfloat n = (p1.w - near) / (p1.w - p2.w);","\treturn vec4(mix(p1.xy,p2.xy,n),-near,near);","}","void main(){"," \tvLineDistance = lineDistances;","\tvec4 prevProj = modelViewProjectionMatrix * vec4(positionPrev, 1.0);","\tvec4 currProj = modelViewProjectionMatrix * vec4(position, 1.0);","\tvec4 nextProj = modelViewProjectionMatrix * vec4(positionNext, 1.0);","\tif (currProj.w < 0.0) {","\t\tif (prevProj.w < 0.0) {","\t \t\tcurrProj = clipNear(currProj, nextProj);","\t\t}else {","\t\t\tcurrProj = clipNear(currProj, prevProj);","\t\t}","\t}","\tvec2 prevScreen = (prevProj.xy / abs(prevProj.w) + 1.0) * 0.5 * viewport.zw;","\tvec2 currScreen = (currProj.xy / abs(currProj.w) + 1.0) * 0.5 * viewport.zw;","\tvec2 nextScreen = (nextProj.xy / abs(nextProj.w) + 1.0) * 0.5 * viewport.zw;","\tvec2 dir;","\tfloat len = offset;","\tif(position == positionPrev){","\t\tdir = normalize(nextScreen - currScreen);","\t}else if(position == positionNext){","\t\tdir = normalize(currScreen - prevScreen);","\t}else {","\t\tvec2 dirA = normalize(currScreen - prevScreen);","\t\tvec2 dirB = normalize(nextScreen - currScreen);","\t\tvec2 tanget = normalize(dirA + dirB);","\t\tfloat miter = 1.0 / max(dot(tanget,dirA),0.5);","\t\tlen *= miter;","   if(abs(len) > length (currScreen - prevScreen)){","     len = length (currScreen - prevScreen) * sign(len);","   }","   if(abs(len) > length (nextScreen - currScreen)){","     len = length (nextScreen - currScreen) * sign(len);","   }","\t\tdir = tanget;","\t}","\tdir = vec2(-dir.y,dir.x) * len;","\tcurrScreen += dir;","\tcurrProj.xy = (currScreen / viewport.zw - 0.5) * 2.0 * abs(currProj.w);","\tgl_Position = currProj;","\tvColor = color;","\toUv = uv;","\tvUv = uv * offsetRepeat.zw  + offsetRepeat.xy;","}"].join("\n"),fragmentShader:["uniform vec3 lineColor;","uniform float opacity;","uniform int useVertexColor;","uniform float totalSize;","uniform float dashSize;","varying  vec3 vColor;","varying float vLineDistance;","varying vec2 vUv;","varying vec2 oUv;","#ifdef USE_MAP","uniform sampler2D map;","#endif",oe.ShaderChunk.gradient_parts_fragment,"void main (){","\tif(totalSize > dashSize && dashSize > 0.0){","\t     if ( mod( vLineDistance, totalSize ) > (totalSize - dashSize) ) {","\t\t\tdiscard;","\t\t}","\t}","#ifndef MAX_GRADIENT","\tif(useVertexColor == 0){","\t\tgl_FragColor = vec4(lineColor,opacity);","\t}else{","\t\tgl_FragColor = vec4(vColor,opacity);","\t}","#endif",oe.ShaderChunk.gradient_basic_fragment,"#ifdef USE_MAP","\tgl_FragColor *= texture2D(map,vUv);","#endif","}"].join("\n")},lensflare:{uniforms:{renderType:{type:"i",value:2},screenPosition:{type:"v3",value:new oe.Vec3(0)},scale:{type:"v2",value:new oe.Vec2(0)},rotation:{type:"f",value:0},occlusionMap:{type:"t",value:null},map:{type:"t",value:null}},vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},deferred:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.deferred]),vertexShader:["varying vec4 vPosition;","varying vec3 vNormal;","void main (){","vNormal = mat3(modelViewMatrix) * normal;","vPosition = modelViewMatrix * vec4(position, 1.0);","gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fragmentShader:["uniform float linearDepth;","uniform int isNormal;","varying vec4 vPosition;","varying vec3 vNormal;","void main (){","float linear_depth = length(vPosition) / linearDepth;","if(isNormal == 1){","vec3 normal = normalize(vNormal);","gl_FragColor = vec4(normal.x, normal.y, normal.z, 1.0);","}else{","gl_FragColor = vec4(vPosition.x, vPosition.y, vPosition.z, linear_depth);","}","}"].join("\n")},ssao:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.ssao]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D map0;","uniform sampler2D map1;","uniform sampler2D map2;","uniform vec2 texelSize;","uniform float occluderBias;","uniform float samplingRadius;","uniform vec2 attenuation;","varying vec2 vUv;","float samplePixels (vec3 srcPosition, vec3 srcNormal, vec2 uv){","vec3 dstPosition = texture2D(map0, uv).xyz;","vec3 positionVec = dstPosition - srcPosition;","float intensity = max(dot(normalize(positionVec), srcNormal) - occluderBias, 0.0);","float dist = length(positionVec);","float attenuationValue = 1.0 / (attenuation.x + (attenuation.y * dist));","return intensity * attenuationValue;","}","void main (){","vec3 srcPosition = texture2D(map0, vUv).xyz;","vec3 srcNormal = texture2D(map1, vUv).xyz;","vec2 randVec = normalize(texture2D(map2, vUv).xy * 2.0 - 1.0);","float srcDepth = texture2D(map0, vUv).w;","float kernelRadius = samplingRadius * (1.0 - srcDepth);","vec2 kernel[4];","kernel[0] = vec2(0.0, 1.0);","kernel[1] = vec2(1.0, 0.0);","kernel[2] = vec2(0.0, -1.0);","kernel[3] = vec2(-1.0, 0.0);","const float sin45 = 0.707107;","float occlusion = 0.0;","for (int i = 0; i < 4; ++i){","vec2 k1 = reflect(kernel[i], randVec);","vec2 k2 = vec2(k1.x * sin45 - k1.y * sin45,k1.x * sin45 + k1.y * sin45);","k1 *= texelSize;","k2 *= texelSize;","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.75);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius * 0.5);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.25);","}","occlusion /= 16.0;","occlusion = clamp(occlusion, 0.0, 1.0);","gl_FragColor =  vec4(occlusion,0.0,0.0,1.0);","}"].join("\n")},basic:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.common,oe.UniformsLib.gradient,oe.UniformsLib.fog,oe.UniformsLib.gradientramp]),vertexShader:[oe.ShaderChunk.map_pars_vertex,oe.ShaderChunk.lightmap_pars_vertex,oe.ShaderChunk.envmap_pars_vertex,oe.ShaderChunk.color_pars_vertex,oe.ShaderChunk.morphtarget_pars_vertex,oe.ShaderChunk.skinning_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"varying vec3 vPosition;","void main() {",oe.ShaderChunk.map_vertex,oe.ShaderChunk.lightmap_vertex,oe.ShaderChunk.color_vertex,oe.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",oe.ShaderChunk.morphnormal_vertex,oe.ShaderChunk.skinnormal_vertex,oe.ShaderChunk.defaultnormal_vertex,"#endif",oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.skinning_vertex,oe.ShaderChunk.default_vertex,oe.ShaderChunk.worldpos_vertex,oe.ShaderChunk.envmap_vertex,oe.ShaderChunk.shadowmap_vertex,"vPosition = position;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 wireframeLinecolor;","uniform float wireframeLineopacity;","uniform float opacity;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.map_pars_fragment,oe.ShaderChunk.gradient_parts_fragment,oe.ShaderChunk.lightmap_pars_fragment,oe.ShaderChunk.envmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,oe.ShaderChunk.specularmap_pars_fragment,"vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","#ifdef USE_CLIP_PLANE","if (dot(vPosition, clipPlane.xyz) > clipPlane.w) discard;","#endif","#ifdef USE_WIREFRAME","float wireframeLineopacityValue = wireframeLineopacity * opacity;","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(skyColor ,wireframeLineopacityValue),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(earthColor ,wireframeLineopacityValue),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, wireframeLineopacityValue );","}","else{","gl_FragColor = vec4( wireframeLinecolor, wireframeLineopacityValue );","}","#else","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, opacity );","}","else{","gl_FragColor = vec4( diffuse, opacity );","}",oe.ShaderChunk.gradient_basic_fragment,oe.ShaderChunk.map_fragment,oe.ShaderChunk.alphatest_fragment,oe.ShaderChunk.lightmap_fragment,"if(skyY <= earthY){",oe.ShaderChunk.color_fragment,"}",oe.ShaderChunk.envmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.fog_fragment,"#endif","}"].join("\n")},lambert:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.common,oe.UniformsLib.fog,oe.UniformsLib.lights,oe.UniformsLib.shadowmap,{ambient:{type:"c",value:new oe.Color(16777215)},emissive:{type:"c",value:new oe.Color(0)},wrapRGB:{type:"v3",value:new oe.Vec3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",oe.ShaderChunk.map_pars_vertex,oe.ShaderChunk.lightmap_pars_vertex,oe.ShaderChunk.envmap_pars_vertex,oe.ShaderChunk.lights_lambert_pars_vertex,oe.ShaderChunk.color_pars_vertex,oe.ShaderChunk.morphtarget_pars_vertex,oe.ShaderChunk.skinning_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"void main() {",oe.ShaderChunk.map_vertex,oe.ShaderChunk.lightmap_vertex,oe.ShaderChunk.color_vertex,oe.ShaderChunk.morphnormal_vertex,oe.ShaderChunk.skinbase_vertex,oe.ShaderChunk.skinnormal_vertex,oe.ShaderChunk.defaultnormal_vertex,oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.skinning_vertex,oe.ShaderChunk.default_vertex,oe.ShaderChunk.worldpos_vertex,oe.ShaderChunk.envmap_vertex,oe.ShaderChunk.lights_lambert_vertex,oe.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.map_pars_fragment,oe.ShaderChunk.lightmap_pars_fragment,oe.ShaderChunk.envmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,oe.ShaderChunk.shadowmap_pars_fragment,oe.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",oe.ShaderChunk.map_fragment,oe.ShaderChunk.alphatest_fragment,oe.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",oe.ShaderChunk.lightmap_fragment,oe.ShaderChunk.color_fragment,oe.ShaderChunk.envmap_fragment,oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.common,oe.UniformsLib.gradient,oe.UniformsLib.bump,oe.UniformsLib.normalmap,oe.UniformsLib.fog,oe.UniformsLib.lights,oe.UniformsLib.shadowmap,oe.UniformsLib.gradientramp,{ambient:{type:"c",value:new oe.Color(16777215)},emissive:{type:"c",value:new oe.Color(0)},specular:{type:"c",value:new oe.Color(1118481)},uspecularStrength:{type:"f",value:1},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new oe.Vec3(1,1,1)},mapSSAO:{type:"t",value:null}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;","varying vec4 finalPosition;",oe.ShaderChunk.map_pars_vertex,oe.ShaderChunk.lightmap_pars_vertex,oe.ShaderChunk.envmap_pars_vertex,oe.ShaderChunk.lights_phong_pars_vertex,oe.ShaderChunk.color_pars_vertex,oe.ShaderChunk.morphtarget_pars_vertex,oe.ShaderChunk.skinning_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"varying vec3 vPosition;","void main() {",oe.ShaderChunk.map_vertex,oe.ShaderChunk.lightmap_vertex,oe.ShaderChunk.color_vertex,oe.ShaderChunk.morphnormal_vertex,oe.ShaderChunk.skinbase_vertex,oe.ShaderChunk.skinnormal_vertex,oe.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.skinning_vertex,oe.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",oe.ShaderChunk.worldpos_vertex,oe.ShaderChunk.envmap_vertex,oe.ShaderChunk.lights_phong_vertex,oe.ShaderChunk.shadowmap_vertex,"finalPosition = gl_Position;","vPosition = position;","}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 wireframeLinecolor;","uniform float wireframeLineopacity;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float uspecularStrength;","uniform float shininess;","varying vec4 finalPosition;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.gradient_parts_fragment,oe.ShaderChunk.map_pars_fragment,oe.ShaderChunk.lightmap_pars_fragment,oe.ShaderChunk.envmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,oe.ShaderChunk.lights_phong_pars_fragment,oe.ShaderChunk.shadowmap_pars_fragment,oe.ShaderChunk.bumpmap_pars_fragment,oe.ShaderChunk.normalmap_pars_fragment,oe.ShaderChunk.specularmap_pars_fragment,"#ifdef USE_SSAO","uniform sampler2D mapSSAO;","#endif","vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","#ifdef USE_CLIP_PLANE","if (dot(vPosition, clipPlane.xyz) > clipPlane.w) discard;","#endif","#ifdef USE_WIREFRAME","float wireframeLineopacityValue = wireframeLineopacity * opacity;","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(skyColor ,wireframeLineopacityValue),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(earthColor ,wireframeLineopacityValue),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( vec3 ( 1.0 ), wireframeLineopacityValue );","}","else{","gl_FragColor = vec4( wireframeLinecolor, wireframeLineopacityValue );","}","#else","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( vec3 ( 1.0 ), opacity );","}","else{","gl_FragColor = vec4(  vec3 ( 1.0 ), opacity );","}","vec3 tempDiffuse = diffuse;",oe.ShaderChunk.gradient_phong_fragment,oe.ShaderChunk.map_fragment,oe.ShaderChunk.alphatest_fragment,oe.ShaderChunk.specularmap_fragment,oe.ShaderChunk.lights_phong_fragment,oe.ShaderChunk.lightmap_fragment,oe.ShaderChunk.color_fragment,oe.ShaderChunk.envmap_fragment,oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.rim_light_fragment,oe.ShaderChunk.fog_fragment,"#endif","}"].join("\n")},particle_basic:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.particle,oe.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",oe.ShaderChunk.color_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"void main() {",oe.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * normal.x * ( scale / length( mvPosition.xyz ) );","#else","float s = normal.x;","if(s == 0.0){","   s = 1.0;","}","gl_PointSize = size * s;","#endif","gl_Position = projectionMatrix * mvPosition;",oe.ShaderChunk.worldpos_vertex,oe.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.map_particle_pars_fragment,oe.ShaderChunk.fog_pars_fragment,oe.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",oe.ShaderChunk.map_particle_fragment,oe.ShaderChunk.alphatest_fragment,oe.ShaderChunk.color_fragment,oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n")},billboard:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")},dashed:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.common,oe.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}},oe.UniformsLib.gradientramp]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;","varying vec3 vPosition;",oe.ShaderChunk.color_pars_vertex,"void main() {",oe.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vPosition = position;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.fog_pars_fragment,"vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, opacity );",oe.ShaderChunk.fog_fragment,"}","else{","gl_FragColor = vec4( diffuse, opacity );",oe.ShaderChunk.color_fragment,oe.ShaderChunk.fog_fragment,"}","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.fog,oe.UniformsLib.lights,oe.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new oe.Vec2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new oe.Color(16777215)},uSpecularColor:{type:"c",value:new oe.Color(1118481)},uSpecualarStrength:{type:"f",value:1},uAmbientColor:{type:"c",value:new oe.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new oe.Vec2(0,0)},uRepeat:{type:"v2",value:new oe.Vec2(1,1)},wrapRGB:{type:"v3",value:new oe.Vec3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform vec3 uSpecularStrength;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",oe.ShaderChunk.shadowmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",oe.ShaderChunk.skinning_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"void main() {",oe.ShaderChunk.skinbase_vertex,oe.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{isCube:{type:"i",value:0},nearDistance:{type:"f",value:10},farDistance:{type:"f",value:1e4},referencePosition:{type:"v3",value:new se.Vec3}},vertexShader:[oe.ShaderChunk.morphtarget_pars_vertex,oe.ShaderChunk.skinning_pars_vertex,"varying vec4 vPosition1;","void main() {",oe.ShaderChunk.skinbase_vertex,oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.skinning_vertex,oe.ShaderChunk.default_vertex,"vPosition1 = modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int isCube;","uniform float nearDistance;","uniform float farDistance;","varying vec4 vPosition1;","varying vec3 vPosition2;","vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","vec4 pack (float depth){","const vec4 bias = vec4(1.0 / 255.0,1.0 / 255.0,1.0 / 255.0, 0.0);","float r = depth;","float g = fract(r * 255.0);","float b = fract(g * 255.0);","float a = fract(b * 255.0);","vec4 colour = vec4(r, g, b, a);","return colour - (colour.yzww * bias);","}","void main() {","if(isCube == 1){"," \tfloat dist = length( vPosition1.xyz/vPosition1.w);","\t\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );","\t\tgl_FragData[ 0 ] = pack(dist);","}else{","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}","}"].join("\n")}};oe.UniformsUtils={merge:function(e){var t,i,r,a={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(i in r)a[i]=r[i]}return a},clone:function(e){var t,i,r,a={};for(t in e){a[t]={};for(i in e[t])(r=e[t][i])instanceof oe.Color||r instanceof oe.Vec2||r instanceof oe.Vec3||r instanceof oe.Vec4||r instanceof oe.Mat4||r instanceof oe.Texture?a[t][i]=r.clone():r instanceof Array?a[t][i]=r.slice():a[t][i]=r}return a}},oe.UniformsLib={outline:{diffuse:{type:"c",value:new oe.Color(15658734)},outline_offset:{type:"f",value:0}},glow:{map:{type:"t",value:null}},blur:{orientation:{type:"i",value:0},texelSize:{type:"v2",value:new oe.Vec2(512,512)},blurAmount:{type:"i",value:10},blurScale:{type:"f",value:1},blurStrength:{type:"f",value:.2},map:{type:"t",value:null},useBlur:{type:"i",value:1},blurGlobalAlpha:{type:"f",value:1}},deferred:{linearDepth:{type:"f",value:9e3},isNormal:{type:"i",value:1}},ssao:{map0:{type:"t",value:null},map1:{type:"t",value:null},map2:{type:"t",value:null},occluderBias:{type:"f",value:.05},samplingRadius:{type:"f",value:20},attenuation:{type:"v2",value:new le(1,0)},texelSize:{type:"v2",value:new le(1/512,1/512)}},common:{diffuse:{type:"c",value:new oe.Color(15658734)},wireframeLinecolor:{type:"c",value:new oe.Color(0)},wireframeLineopacity:{type:"f",value:1},opacity:{type:"f",value:1},clipPlane:{type:"v4",value:new oe.Vec4(0,0,0,0)},rimLightColor:{type:"c",value:new oe.Color(0)},rimLightScale:{type:"f",value:1},map:{type:"t",value:null},mapLoaded:{type:"i",value:0},offsetRepeat:{type:"v4",value:new oe.Vec4(0,0,1,1)},flipX:{type:"i",value:0},flipY:{type:"i",value:0},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},gradient:{gradientColor:{type:"v3v",value:[]},gradientStop:{type:"fv1",value:[]},gradientType:{type:"i",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new oe.Vec2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new oe.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new oe.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new oe.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},pShadowMap:{type:"tv",value:[]},pShadowMapSize:{type:"v2v",value:[]},pShadowDarkness:{type:"fv1",value:[]},pShadowRadius:{type:"fv1",value:[]},pShadowBias:{type:"fv1",value:[]},pPosition:{type:"v3v",value:[]},shadowCameraNear:{type:"f",value:.1},shadowCameraFar:{type:"f",value:1e4}},gradientramp:{skyColor:{type:"c",value:new oe.Color(16777215)},horizonColor:{type:"c",value:new oe.Color(16777215)},earthColor:{type:"c",value:new oe.Color(16777215)},skyY:{type:"f",value:0},horizonY:{type:"f",value:0},earthY:{type:"f",value:0}},linex:{near:{type:"f",value:.1},opacity:{type:"f",value:1},viewport:{type:"v4",value:new oe.Vec4(0)},lineColor:{type:"c",value:new oe.Color(16777215)},modelViewProjectionMatrix:{type:"m4",value:new ue},useVertexColor:{type:"i",value:0},totalSize:{type:"f",value:0},dashSize:{type:"f",value:0}},lensflare:{renderType:{type:"i",value:2},screenPosition:{type:"v3",value:new oe.Vec3(0)},scale:{type:"v2",value:new oe.Vec2(0)},rotation:{type:"f",value:0},occlusionMap:{type:"t",value:null},map:{type:"t",value:null}}},oe.ShaderTerrain={terrain:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.fog,oe.UniformsLib.lights,oe.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableDiffuse3:{type:"i",value:0},enableDisplacement:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDiffuse3:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},heightUnit:{type:"f",value:1},blendRange:{type:"fv1",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new oe.Color(15658734)},uSpecularColor:{type:"c",value:new oe.Color(1118481)},uAmbientColor:{type:"c",value:new oe.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new oe.Vec2(1,1)},uRepeatOverlay:{type:"v2",value:new oe.Vec2(1,1)},uOffset:{type:"v2",value:new oe.Vec2(0,0)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableDiffuse3;","uniform bool enableSpecular;","uniform bool enableDisplacement;","uniform float blendRange[2];","uniform float heightUnit;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDiffuse3;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",oe.ShaderChunk.shadowmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( (enableDiffuse1 && enableDiffuse2)  || (enableDiffuse1 && enableDiffuse3) || (enableDiffuse2 && enableDiffuse3) ){","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","vec4 colDiffuse3 = texture2D( tDiffuse3, uvOverlay );","vec4 allDefiuuses[3];","allDefiuuses[0] = colDiffuse1;","allDefiuuses[1] = colDiffuse2;","allDefiuuses[2] = colDiffuse3;","#ifdef GAMMA_INPUT","colDiffuse1.xyz *= colDiffuse1.xyz;","colDiffuse2.xyz *= colDiffuse2.xyz;","colDiffuse3.xyz *= colDiffuse3.xyz;","#endif","vec4 mixColor;","if(enableDisplacement){","vec4 dis = texture2D( tDisplacement, uvBase );","if(enableDiffuse1 && enableDiffuse2 && enableDiffuse3){","float total = dis.r + dis.g + dis.b;","if(total == 0.0){","mixColor = colDiffuse1 * 1.0/3.0 + colDiffuse2 * 1.0/3.0 + colDiffuse3 * 1.0/3.0;","}else{","mixColor = colDiffuse1 * dis.r/total + colDiffuse2 * dis.g/total + colDiffuse3 * dis.b/total;","}","}","}else {","mixColor = colDiffuse2;","float y = vPosition.y;","float blend2Bottom = blendRange[1] * heightUnit * 255.0;","float percent = 0.0;","if(y < blendRange[0] * heightUnit * 255.0){","mixColor = colDiffuse1;","percent = y / (blendRange[0] * heightUnit * 255.0);","if(percent >=0.8){","mixColor = mix(colDiffuse1,colDiffuse2,(percent - 0.8) / 0.2);","}","} else if(y > blend2Bottom){","mixColor = colDiffuse3;","percent = (y - blend2Bottom) / (heightUnit * 255.0 - blend2Bottom);","if(percent <= 0.2){","mixColor = mix(colDiffuse2,colDiffuse3,percent/0.2);","}","}","}","gl_FragColor = gl_FragColor * mixColor;"," } else if( enableDiffuse1 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDistance = lDistance;","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","hemiDiffuse += uDiffuseColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","hemiSpecular += uSpecularColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif",oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","varying vec3 vViewPosition;",oe.ShaderChunk.shadowmap_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vPosition = vec4(position,1.0);","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",oe.ShaderChunk.shadowmap_vertex,"}"].join("\n")}},oe.ShaderLib.terrain=oe.ShaderTerrain.terrain,oe.Fog=function(e,i,r){this.name="",this.color=new oe.Color(e),this.near=i!==t?i:1,this.far=r!==t?r:1e3},oe.Fog.prototype={constructor:oe.Fog,clone:function(){return new oe.Flog(this.color.getHex(),this.near,this.far)},refreshUniforms:function(e){e.fogNear.value=this.near,e.fogFar.value=this.far,e.fogColor.value=this.color}},oe.FogExp2=function(e,i){this.name="",this.color=new oe.Color(e),this.density=i!==t?i:1},oe.FogExp2.prototype={DensityFactor:25e-5,constructor:oe.FogExp2,clone:function(){return new oe.FogExp2(this.color.getHex(),this.density)},refreshUniforms:function(e){e.fogDensity.value=this.density*this.DensityFactor,e.fogColor.value=this.color}};var Oe={},Xe=Oe.RADIANS_TO_DEGREES=180/Math.PI,Ge=Oe.DEGREES_TO_RADIANS=Math.PI/180;Oe.isPowerOfTwo=function(e){return 0==(e&e-1)},Oe.clone=function(e,i){i==t&&(i=new e.prototype.constructor);for(var r in e)if("id"!==r){var a=e[r];if(a.copy&&"function"==typeof a.copy)i[r].copy(a);else if(a instanceof Array){var n=a,o=i[r];null==o&&(o=[]);for(var s=0;s<n.length;s++){var l=n[s];o.push(l.clone())}}else i[r]=a}},Oe.paramToGL=function(e,t,i){if(t){var r=i?i._glExtensionCompressedTextureS3TC:null;switch(e){case oe.RepeatWrapping:return t.REPEAT;case oe.ClampToEdgeWrapping:return t.CLAMP_TO_EDGE;case oe.MirroredRepeatWrapping:return t.MIRRORED_REPEAT;case oe.NearestFilter:return t.NEAREST;case oe.NearestMipMapNearestFilter:return t.NEAREST_MIPMAP_NEAREST;case oe.NearestMipMapLinearFilter:return t.NEAREST_MIPMAP_LINEAR;case oe.LinearFilter:return t.LINEAR;case oe.LinearMipMapNearestFilter:return t.LINEAR_MIPMAP_NEAREST;case oe.LinearMipMapLinearFilter:return t.LINEAR_MIPMAP_LINEAR;case oe.ByteType:return t.BYTE;case oe.UnsignedByteType:return t.UNSIGNED_BYTE;case oe.ShortType:return t.SHORT;case oe.UnsignedShortType:return t.UNSIGNED_SHORT;case oe.IntType:return t.INT;case oe.UnsignedIntType:return t.UNSIGNED_INT;case oe.FloatType:return t.FLOAT;case oe.AlphaFormat:return t.ALPHA;case oe.RGBFormat:return t.RGB;case oe.RGBAFormat:return t.RGBA;case oe.LuminanceFormat:return t.LUMINANCE;case oe.LuminanceAlphaFormat:return t.LUMINANCE_ALPHA;case oe.RGB_S3TC_DXT1_Format:return r.COMPRESSED_RGB_S3TC_DXT1_EXT;case oe.RGBA_S3TC_DXT1_Format:return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;case oe.RGBA_S3TC_DXT3_Format:return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;case oe.RGBA_S3TC_DXT5_Format:return r.COMPRESSED_RGBA_S3TC_DXT5_EXT;case oe.AddEquation:return t.FUNC_ADD;case oe.SubtractEquation:return t.FUNC_SUBTRACT;case oe.ReverseSubtractEquation:return t.FUNC_REVERSE_SUBTRACT;case oe.ZeroFactor:return t.ZERO;case oe.OneFactor:return t.ONE;case oe.SrcColorFactor:return t.SRC_COLOR;case oe.OneMinusSrcColorFactor:return t.ONE_MINUS_SRC_COLOR;case oe.SrcAlphaFactor:return t.SRC_ALPHA;case oe.OneMinusSrcAlphaFactor:return t.ONE_MINUS_SRC_ALPHA;case oe.DstAlphaFactor:return t.DST_ALPHA;case oe.OneMinusDstAlphaFactor:return t.ONE_MINUS_DST_ALPHA;case oe.DstColorFactor:return t.DST_COLOR;case oe.OneMinusDstColorFactor:return t.ONE_MINUS_DST_COLOR;case oe.SrcAlphaSaturateFactor:return t.SRC_ALPHA_SATURATE}return 0}console.error("No webgl context")},Oe.createElement=function(e,i,r,a){var n,o,s,l,h=e.vertices.length,c=(e.uvs.length,e.vertices),u=i.vertices,f=e.faces,p=i.faces,d=e.uvs,m=i.uvs,g=[],v=[],y=[];a===t&&(a=0),e instanceof oe.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,o=(new ce).getNormalMatrix(n)),i instanceof oe.Element&&(i.matrixAutoUpdate&&i.updateMatrix(),s=i.matrix,l=(new ce).getNormalMatrix(s));for(var A=0,x=c.length;A<x;A++){w=(_=c[A]).clone();n&&w.applyMatrix4(n),v.push(w)}for(var A=0,x=u.length;A<x;A++){var _=u[A],w=_.clone();s&&w.applyMatrix4(s),v.push(w)}for(A=0,x=f.length;A<x;A++){var b=(z=f[A]).vertexNormals,M=z.vertexColors;(C=z instanceof Pe?new Pe(z.a,z.b,z.c):new Ce(z.a,z.b,z.c,z.d)).normal.copy(z.normal),o&&C.normal.applyMatrix3(o).normalize();for(var S=0,P=b.length;S<P;S++)T=b[S].clone(),o&&T.applyMatrix3(o).normalize(),C.vertexNormals.push(T);C.color.copy(z.color);for(var S=0,P=M.length;S<P;S++)E=M[S],C.vertexColors.push(E.clone());C.materialIndex=z.materialIndex,C.centroid.copy(z.centroid),n&&C.centroid.applyMatrix4(n),g.push(C)}for(A=0,x=p.length;A<x;A++){var C,T,E,z=p[A],b=z.vertexNormals,M=z.vertexColors;(C=z instanceof Pe?new Pe(z.a+h,z.b+h,z.c+h):new Ce(z.a+h,z.b+h,z.c+h,z.d+h)).normal.copy(z.normal),l&&C.normal.applyMatrix3(l).normalize();for(var S=0,P=b.length;S<P;S++)T=b[S].clone(),l&&T.applyMatrix3(l).normalize(),C.vertexNormals.push(T);C.color.copy(z.color);for(var S=0,P=M.length;S<P;S++)E=M[S],C.vertexColors.push(E.clone());C.materialIndex=z.materialIndex+a,C.centroid.copy(z.centroid),s&&C.centroid.applyMatrix4(s),g.push(C)}for(A=0,x=d.length;A<x;A++){for(var D=[],S=0,P=(L=d[A]).length;S<P;S++)D.push(new le(L[S].x,L[S].y));y.push(D)}for(A=0,x=m.length;A<x;A++){for(var L=m[A],D=[],S=0,P=L.length;S<P;S++)D.push(new le(L[S].x,L[S].y));y.push(D)}var R=new oe.Entity;return R.vertices=v,R.faces=g,R.uvs=y,R.material=r===t?e.material:r,R},Oe.transformElement=function(e,t){var i,r,a=e.vertices,n=e.faces,o=e.uvs,s=[],l=[],h=[];e instanceof oe.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),i=e.matrix,r=(new ce).getNormalMatrix(i));for(var c=0,u=a.length;c<u;c++){var f=a[c].clone();i&&f.applyMatrix4(i),l.push(f)}for(c=0,u=n.length;c<u;c++){var p,d,m,g=n[c],v=g.vertexNormals,y=g.vertexColors;(p=g instanceof Pe?new Pe(g.a,g.b,g.c):new Ce(g.a,g.b,g.c,g.d)).normal.copy(g.normal),r&&p.normal.applyMatrix3(r).normalize();for(var A=0,x=v.length;A<x;A++)d=v[A].clone(),r&&d.applyMatrix3(r).normalize(),p.vertexNormals.push(d);p.color.copy(g.color);for(var A=0,x=y.length;A<x;A++)m=y[A],p.vertexColors.push(m.clone());p.materialIndex=g.materialIndex,p.centroid.copy(g.centroid),i&&p.centroid.applyMatrix4(i),s.push(p)}for(c=0,u=o.length;c<u;c++){for(var _=o[c],w=[],A=0,x=_.length;A<x;A++)w.push(new le(_[A].x,_[A].y));h.push(w)}if(t){var b=new oe.Entity(e.material);return b.vertices=l,b.faces=s,b.uvs=h,b.setPosition(0,0,0),b.setRotation(0,0,0),b.setScale(1,1,1),(M={}).vertices=l,M.faces=s,M.uvs=h,b.primitive=new oe.Primitive(M),b}e.vertices=l,e.faces=s,e.uvs=h,e.setPosition(0,0,0),e.setRotation(0,0,0),e.setScale(1,1,1);var M={};M.vertices=l,M.faces=s,M.uvs=h,e.primitive=new oe.Primitive(M);for(var c in i.elements)e._attachId+=i.elements[c];return e},Oe.mergeElements=function(e){var t,i,r,a,n,o,s,l=0,h=0,c=0;for(t=0;t<e.length;t++)l+=(r=e[t]).materialSize;var u=new oe.Entity(l),f={},p={},d=(new he(0,0,0),[]),m=[],g=[],v=[],y=new oe.ArrayMaterial;for(t=0;t<e.length;t++){for((r=e[t]).matrixAutoUpdate&&r.updateWorldMatrix(),a=r.worldMatrix.clone(),n=(new ce).getNormalMatrix(a),i=0;i<r.vertices.length;i++)o=r.vertices[i],d.push(o.clone().applyMatrix4(a));for(i=0;i<r.faces.length;i++){var A,x=r.faces[i];x.vertexNormals,x.vertexColors;(A=x instanceof Pe?new Pe(x.a+h,x.b+h,x.c+h):new Ce(x.a+h,x.b+h,x.c+h,x.d+h)).normal.copy(x.normal),n&&A.normal.applyMatrix3(n).normalize(),A.materialIndex=x.materialIndex+c,A.centroid.copy(x.centroid),a&&A.centroid.applyMatrix4(a),m.push(A)}for(i=0,s=r.uvs.length;i<s;i++){for(var _=r.uvs[i],w=[],b=0,M=_.length;b<M;b++)w.push(new le(_[b].x,_[b].y));g.push(w)}if(r.uv2s&&r.uv2s.length>0)for(i=0,s=r.uv2s.length;i<s;i++){for(var S=r.uv2s[i],P=[],b=0,M=S.length;b<M;b++)P.push(new le(S[b].x,S[b].y));v.push(P)}y.materials=y.materials.concat(r.material.materials),h+=r.vertices.length,c+=r.materialSize;for(var C in r.styleMap){var T=f[C];null==T&&(T=[]);var E=r.styleMap[C],z=!0;if(Oe.isArray(E))for(b=0;b<E.length;b++)T.push(E[t]),b>0&&E[b]!=E[b-1]&&(z=!1);else for(b=0;b<r.materialSize;b++)T.push(E);1!=p[C]&&null!=p[C]||(p[C]=z),f[C]=T}}for(var C in p)1==p[C]&&(f[C]=f[C][0]);return u.styleMap=f,u.material=y,u.vertices=d,u.faces=m,u.setUvs(g),u.uv2s=v,u.setUpdateFlags(!0),u},Oe.mergeBufferNodes=function(e){if(1===e.length)return e[0];var t=new se.BufferNode;return t.boundingBox=new se.BoundingBox,t._bufferNodes=e,e.forEach(function(e){e.matrix=t.matrix,e.worldMatrix=t.worldMatrix,e.boundingBox&&t.boundingBox.union(e.boundingBox)}),t},Oe.mergeElement=function(e,i,r){var a,n,o,s,l=e.vertices.length,h=(e.uvs.length,e.vertices),c=i.vertices,u=e.faces,f=i.faces,p=e.uvs,d=i.uvs,m=[],g=[],v=[];r===t&&(r=0),e instanceof oe.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),a=e.matrix,n=(new ce).getNormalMatrix(a)),i instanceof oe.Element&&(i.matrixAutoUpdate&&i.updateMatrix(),o=i.matrix,s=(new ce).getNormalMatrix(o));for(var y=0,A=h.length;y<A;y++){_=(x=h[y]).clone();a&&_.applyMatrix4(a),g.push(_)}for(var y=0,A=c.length;y<A;y++){var x=c[y],_=x.clone();o&&_.applyMatrix4(o),g.push(_)}for(y=0,A=u.length;y<A;y++){var w=(E=u[y]).vertexNormals,b=E.vertexColors;(P=E instanceof Pe?new Pe(E.a,E.b,E.c):new Ce(E.a,E.b,E.c,E.d)).normal.copy(E.normal),n&&P.normal.applyMatrix3(n).normalize();for(var M=0,S=w.length;M<S;M++)C=w[M].clone(),n&&C.applyMatrix3(n).normalize(),P.vertexNormals.push(C);P.color.copy(E.color);for(var M=0,S=b.length;M<S;M++)T=b[M],P.vertexColors.push(T.clone());P.materialIndex=E.materialIndex,P.centroid.copy(E.centroid),a&&P.centroid.applyMatrix4(a),m.push(P)}for(y=0,A=f.length;y<A;y++){var P,C,T,E=f[y],w=E.vertexNormals,b=E.vertexColors;(P=E instanceof Pe?new Pe(E.a+l,E.b+l,E.c+l):new Ce(E.a+l,E.b+l,E.c+l,E.d+l)).normal.copy(E.normal),s&&P.normal.applyMatrix3(s).normalize();for(var M=0,S=w.length;M<S;M++)C=w[M].clone(),s&&C.applyMatrix3(s).normalize(),P.vertexNormals.push(C);P.color.copy(E.color);for(var M=0,S=b.length;M<S;M++)T=b[M],P.vertexColors.push(T.clone());P.materialIndex=E.materialIndex+r,P.centroid.copy(E.centroid),o&&P.centroid.applyMatrix4(o),m.push(P)}for(y=0,A=p.length;y<A;y++){for(var z=[],M=0,S=(D=p[y]).length;M<S;M++)z.push(new le(D[M].x,D[M].y));v.push(z)}for(y=0,A=d.length;y<A;y++){for(var D=d[y],z=[],M=0,S=D.length;M<S;M++)z.push(new le(D[M].x,D[M].y));v.push(z)}return e.vertices=g,e.faces=m,e.uvs=v,e._position.set(0,0,0),e._rotation.set(0,0,0),e._scale.set(1,1,1),e},Oe.autoAdjustNetworkBounds=function(e,t,i,r,a,n){a=a||0,n=n||0,e.adjustBounds(t[i]-a,t[r]-n),!e._resizeFunction&&(e._resizeFunction=function(){e.adjustBounds(t[i]-a,t[r]-n,n,a)}),window.addEventListener("resize",e._resizeFunction,!0)},Oe.isEmptyObject=function(e){for(var t in e)return!1;return!0},Oe.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},Oe.isSame=function(e,t){if(e===t)return!0;if(null==e&&null!=t)return!1;if(null!=e&&null==t)return!1;if(typeof e!=typeof t)return!1;for(var i in e)if(e[i]!=t[i])return!1;for(var i in t)if(e[i]!=t[i])return!1;return!0},Oe.toString=function(e){if(e){var t="";for(var i in e)t+=i+":"+e[i];return t}},Oe.validateLicense=function(e){et=e,pt()},Oe.getLicense=function(){return et},Oe.getObjectCount=function(e){if(!e)return 0;var t=0;for(var i in e)t++;return t},Oe.isNaN=function(e){return""===e||null===e||isNaN(e)},Oe.getTransformVertices=function(e,t,i){null==i&&(i=[]);var r;if(e instanceof oe.Node||e instanceof oe.Billboard){for(a=0;a<e.vertices.length;a++)r=e.vertices[a].clone(),e instanceof oe.Billboard?(r.x*=e.rotation3d.x,r.y*=e.rotation3d.y,r.add(e.getPosition())):r.applyMatrix4(e.worldMatrix),i.push(r);for(var a=0;a<(e._childList?e._childList.size():0);a++){var n=e._childList.get(a);Oe.getTransformVertices(n,t,i)}}return i},Oe.getBoundingBox=function(e,t){var i,r,a;if(null==e)return null;i=e instanceof _e?e._as:Oe.isArray(e)?e:[e];var n=[];for(r=0;r<i.length;r++)a=i[r],Oe.getTransformVertices(a,t,n);var o=new oe.BoundingBox;return o.setFromPoints(n),o},Oe.mergeWrapMap=function(e){if(e instanceof Te&&!e.getWrapMap()){for(var t,i=[],r=(e.getMaterialMapping(),e.material.materials),a=0;a<r.length;a++)(t=r[a]).map&&-1==i.indexOf(t.map._image)&&i.push(t.map._image);e.setWrapMap(!0)}},Oe.setWrapMap=function(e,t,i,r){Oe.loadImages(t,function(a){var n=se.Utils.createWrapMapFromImages(a,i,r);n.__uniqueCode="";for(o=0;o<t.length;o++)n.__uniqueCode+=t[o].src;for(var o in i)n.__uniqueCode+=o+":"+i[o];if(Oe.isArray(e))for(o=0;o<e.length;o++)e[o].setStyle("m.texture.image",n),e[o].setClient("_originalImage",t),e[o].setClient("_wrapMapping",i);else e.setStyle("m.texture.image",n),e.setClient("_wrapMapping",i)})},Oe.loadImages=function(e,t){function i(){for(var i=0;i<e.length;i++)if(!e[i].loaded)return;t(e)}if(null!=e&&0!=e.length&&null!=t)for(var r=0;r<e.length;r++){var a=e[r];"string"==typeof a&&(e[r]=new Image,e[r].crossOrigin="",e[r].src=a),function(e){e.onload=function(){e.loaded=!0,i(),e.onload=null}}(a=e[r])}},Oe.createWrapMapFromImages=function(e,t,i,r,a){if(null==e||0==e.length)return null;if("six-each"==(i=(i||"six-each").toLowerCase())||"front-other"==i||"back-other"==i||"left-other"==i||"right-other"==i||"top-other"==i||"bottom-other"==i){null==t&&(t={0:"bottom",1:"top",2:"back",3:"left",4:"front",5:"right"});var n=document.createElement("canvas"),o=n.getContext("2d"),s=0,l=0;if("six-each"==i){var h={bottom:[0,0],top:[1/3,0],back:[2/3,0],left:[0,.5],front:[1/3,.5],right:[2/3,.5]};if(null==r||null==a)for(p=0;p<e.length;p++)s=Math.max(e[p].width,s),l=Math.max(e[p].height,l);l*=2,(s*=3)>1024&&(s=1024),l>1024&&(l=1024);var c,u=["front","back","right","left","top","bottom"],f=[];for(var p in t)"other"!==(g=t[p])?(f.push(g),u.splice(u.indexOf(g),1)):c=p;null!=c&&(t[c]=u),r=r||s,a=a||l,n.setAttribute("width",r),n.setAttribute("height",a);Math.min(e.length,6);for(p=0;p<6;p++)if(x=t[p]){var d=x;d=Oe.isArray(x)?x:-1!=x.indexOf(",")?x.split(","):[x];for(var m=0;m<d.length;m++){var g=d[m],v=h[g][0],y=h[g][1];o.drawImage(e[p],v*r,y*a,r/3,a/2)}}}else{var A=i.split("-")[0];if(null==r||null==a)for(p=0;p<e.length;p++)s+=e[p].width,l=Math.max(e[p].height,l);r=r||s,a=a||l,n.setAttribute("width",r),n.setAttribute("height",a);t[A],Math.min(e.length,2);for(p=0;p<2;p++){var x=t[p];x&&(x==A?o.drawImage(e[p],0,0,r/2,a):o.drawImage(e[p],r/2,0,r/2,a))}}return n}},Oe.getVectorAngles=function(e,t){var i=e;t&&(i=t.clone().sub(e)),i=i.normalize();var r=Math.asin(i.y)*Xe;return[Math.atan2(i.x,i.z)*Xe,r]},Oe.getPixelFromImage=function(e,t,i){var r;return fe.isCanvas(e)?r=e:((r=document.createElement("canvas")).width=e.width,r.height=e.height,r.getContext("2d").drawImage(e,0,0,e.width,e.height)),t-=Math.floor(t),i=1-(i-=Math.floor(i)),r.getContext("2d").getImageData(e.width*t,e.height*i,1,1).data},Oe.nextPowerOfTwo=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},Oe.createTextBillboard=function(e,t){var i=new se.Billboard;e=e||"",t=t||{};var r=Oe.createTextImage(e,t);return i.setStyle("m.texture.image",r),i.setScale(r.width,r.height,1),i},Oe.createTextImage=function(e,i){e=e||"";var r=i.font,a=i.color,n=i.background,o=i.powerOfTwo,s=i.canvas,l=i.drawFunction;s=s||document.createElement("canvas"),r=r||'20px "Dialog"',a=a||"white",n=n===t?"#0F90C4":n,o=o||!1;var h,c=i.textAlign||"center";h=Oe.isArray(e)?e:e.split("\n");var u=se.Utils.getMaxTextSize(h,r),f=i.ratio||u.width/u.height,p=s.realSize={width:u.width,height:u.height};o&&(u.width=se.Utils.nextPowerOfTwo(u.width),u.height=se.Utils.nextPowerOfTwo(u.height));var d=s.drawRect={width:p.width/p.height>f?p.width:p.height*f,height:p.width/p.height>f?p.width/f:p.height};Number.isNaN(d.width)&&console.log("debug -- b",p.width,p.height,f),d.width=Math.min(d.width,u.width),d.height=Math.min(d.height,u.height),s.width=u.width,s.height=u.height,Number.isNaN(d.width)&&console.log("debug -- a");var m=s.getContext("2d");if(n&&(m.fillStyle=n),l)l(m,s.width,s.height);else{n&&m.fillRect(0,0,s.width,s.height),m.font=r,m.fillStyle=a,m.strokeStyle="gray",m.textBaseline="middle",m.textAlign=c;for(var g,v=h.length,y=p.height/v,A=0;A<v;A++){Oe.isArray(a)&&(g=a[A])&&(m.fillStyle=g);var x=se.Utils.getTextSize(r,h[A]),_=(x.width,x.height,s.height,(d.width-p.width)/2);"center"===c?_=d.width/2:"right"===c&&(_=d.width);var w=(d.height-p.height)/2+y/2+A*y+(s.height-d.height);m.strokeText(h[A],_,w),m.fillText(h[A],_,w)}}return s},Oe.createTextImage2=function(e,i){e=e||"",e=String(e);var r=i.font,a=i.color,n=i.background,o=i.powerOfTwo,s=i.canvas,h=i.drawFunction;s=s||document.createElement("canvas"),r=r||'20px "Dialog"',a=a||"white",n=n===t?"#0F90C4":n,o=o||!1;i.align;var c=i.sizeScale||1,u=Oe.getMaxTextSize(e.split("\n"),r);s.realSize={width:u.width,height:u.height},u.width*=c,u.height*=c,o&&(u.width=Oe.nextPowerOfTwo(u.width),u.height=Oe.nextPowerOfTwo(u.height)),s.width=u.width,s.height=u.height;var f=s.getContext("2d");return n&&(f.fillStyle=n),h?h(f,s.width,s.height):(n&&f.fillRect(0,0,s.width,s.height),l(f,e,r,a,s,"center")),s},Oe.getMaxTextSize=function(e,t){if(e&&e.length>0){for(var i=e.length,r=ge.getTextSize(t,e[0]),a=r.width,n=r.height*i,o=0;o<i;o++){var s=ge.getTextSize(t,e[o]).width;a<s&&(a=s)}return{width:a,height:n}}return null},Oe.getTextSize=function(e,t){return ge.getTextSize(e,t)},Oe.playCameraAnimation=function(e,t,i,r,a){if(Oe.activeAnimates&&Oe.activeAnimates instanceof Array)for(var n=0;n<Oe.activeAnimates.length;n++)Oe.activeAnimates[n].stop();if(t=t||e.p(),i=i||e.getTarget(),t.equals(e.getPosition())&&i.equals(e.target))return a&&a(),null;var o=e.getPosition().sub(e.getTarget()),s=(new se.Vec3).addVectors(o,i);r=r||3e3;var l=se.Utils.getVectorAngles(i,s),h=se.Utils.getVectorAngles(i,t),c=h[0]-l[0];c>180?c-=360:c<-180&&(c+=360);var u=h[1]-l[1];u>180?u-=360:u<-180&&(u+=360);var f=e.getTarget(),p=i,d=e.getDistance(),m=(new se.Vec3).subVectors(t,i).length(),g=l[0],v=l[1],y=h[0],A=h[1],x=new se.Animate({from:0,to:1,repeat:1,dur:r/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(t){var i=y,r=v>A?v+u*t:A,a=p,n=d+(m-d)*t,o=new se.Vec3;o.x=a.x+n*Math.sin(i*Ge)*Math.cos(r*Ge),o.z=a.z+n*Math.cos(i*Ge)*Math.cos(r*Ge),o.y=a.y+n*Math.sin(r*Ge),e.p(o),e.lookAt(a)},onDone:function(){a&&a()},onStop:function(){}}),_=new se.Animate({from:0,to:1,repeat:1,dur:r/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(t){var i=g+c*t,r=v>A?v:A,a=p,n=d>m?d:m;if(A>=v)n=m;var o=new se.Vec3;o.x=a.x+n*Math.sin(i*Ge)*Math.cos(r*Ge),o.z=a.z+n*Math.cos(i*Ge)*Math.cos(r*Ge),o.y=a.y+n*Math.sin(r*Ge),e.p(o),e.lookAt(a)},onDone:function(){d=e.getDistance(),f=e.getTarget()},onStop:function(){this.isPlaying&&(delete this.isPlaying,A>=v?a&&a():x.play())}}),w=new se.Animate({from:0,to:1,dur:r/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(t){var i=g,r=v>A?v:v+u*t,a=(new se.Vec3).lerpVectors(f,p,t),n=d+(m-d)*t;d>m&&(0!=c||A<v)&&(n=d);var o=new se.Vec3;o.x=a.x+n*Math.sin(i*Ge)*Math.cos(r*Ge),o.z=a.z+n*Math.cos(i*Ge)*Math.cos(r*Ge),o.y=a.y+n*Math.sin(r*Ge),e.p(o),e.lookAt(a)},onDone:function(){},onStop:function(){this.isPlaying&&(delete this.isPlaying,0==c&&A>=v?a&&a():0!=c?_.play():x.play())}});return 0==c&&A>=v?(w.dur=r,w.finish=r):0==c?(x.dur=2*r/3,x.finish=2*r/3):A<v&&(_.dur=2*r/3,_.finish=2*r/3),w.play(),Oe.activeAnimates=[w,_,x],[w,_,x]},Oe.stopAnimate=function(e,t){te(e,t)},Oe.stopAllAnimates=function(e){ie(e)},oe.Utils=Oe,oe.NurbsUtils={findSpan:function(e,t,i){var r=i.length-e-1;if(t>=i[r])return r-1;if(t<=i[e])return e;for(var a=e,n=r,o=Math.floor((a+n)/2);t<i[o]||t>=i[o+1];)t<i[o]?n=o:a=o,o=Math.floor((a+n)/2);return o},calcBasisFunctions:function(e,t,i,r){var a=[],n=[],o=[];a[0]=1;for(var s=1;s<=i;++s){n[s]=t-r[e+1-s],o[s]=r[e+s]-t;for(var l=0,h=0;h<s;++h){var c=o[h+1],u=n[s-h],f=a[h]/(c+u);a[h]=l+c*f,l=u*f}a[s]=l}return a},calcBSplinePoint:function(e,t,i,r){for(var a=this.findSpan(e,r,t),n=this.calcBasisFunctions(a,r,e,t),o=new oe.Vec4(0,0,0,0),s=0;s<=e;++s){var l=i[a-e+s],h=n[s],c=l.w*h;o.x+=l.x*c,o.y+=l.y*c,o.z+=l.z*c,o.w+=l.w*h}return o},calcBasisFunctionDerivatives:function(e,t,i,r,a){for(var n=[],o=0;o<=i;++o)n[o]=0;for(var s=[],o=0;o<=r;++o)s[o]=n.slice(0);for(var l=[],o=0;o<=i;++o)l[o]=n.slice(0);l[0][0]=1;for(var h=n.slice(0),c=n.slice(0),u=1;u<=i;++u){h[u]=t-a[e+1-u],c[u]=a[e+u]-t;for(var f=0,p=0;p<u;++p){var d=c[p+1],m=h[u-p];l[u][p]=d+m;var g=l[p][u-1]/l[u][p];l[p][u]=f+d*g,f=m*g}l[u][u]=f}for(u=0;u<=i;++u)s[0][u]=l[u][i];for(p=0;p<=i;++p){for(var v=0,y=1,A=[],o=0;o<=i;++o)A[o]=n.slice(0);A[0][0]=1;for(S=1;S<=r;++S){var x=0,_=p-S,w=i-S;p>=S&&(A[y][0]=A[v][0]/l[w+1][_],x=A[y][0]*l[_][w]);for(var b=_>=-1?1:-_,M=p-1<=w?S-1:i-p,u=b;u<=M;++u)A[y][u]=(A[v][u]-A[v][u-1])/l[w+1][_+u],x+=A[y][u]*l[_+u][w];p<=w&&(A[y][S]=-A[v][S-1]/l[w+1][p],x+=A[y][S]*l[p][w]),s[S][p]=x;u=v;v=y,y=u}}for(var p=i,S=1;S<=r;++S){for(u=0;u<=i;++u)s[S][u]*=p;p*=i-S}return s},calcBSplineDerivatives:function(e,t,i,r,a){for(var n=a<e?a:e,o=[],s=this.findSpan(e,r,t),l=this.calcBasisFunctionDerivatives(s,r,e,n,t),h=[],c=0;c<i.length;++c){var u=(f=i[c].clone()).w;f.x*=u,f.y*=u,f.z*=u,h[c]=f}for(d=0;d<=n;++d){for(var f=h[s-e].clone().multiplyScalar(l[d][0]),p=1;p<=e;++p)f.add(h[s-e+p].clone().multiplyScalar(l[d][p]));o[d]=f}for(var d=n+1;d<=a+1;++d)o[d]=new oe.Vec4(0,0,0);return o},calcKoverI:function(e,t){for(var i=1,r=2;r<=e;++r)i*=r;for(var a=1,r=2;r<=t;++r)a*=r;for(r=2;r<=e-t;++r)a*=r;return i/a},calcRationalCurveDerivatives:function(e){for(var t=e.length,i=[],r=[],a=0;a<t;++a){var n=e[a];i[a]=new oe.Vec3(n.x,n.y,n.z),r[a]=n.w}for(var o=[],s=0;s<t;++s){for(var l=i[s].clone(),a=1;a<=s;++a)l.sub(o[s-a].clone().multiplyScalar(this.calcKoverI(s,a)*r[a]));o[s]=l.divideScalar(r[0])}return o},calcNURBSDerivatives:function(e,t,i,r,a){var n=this.calcBSplineDerivatives(e,t,i,r,a);return this.calcRationalCurveDerivatives(n)},calcSurfacePoint:function(e,t,i,r,a,n,o){for(var s=this.findSpan(e,n,i),l=this.findSpan(t,o,r),h=this.calcBasisFunctions(s,n,e,i),c=this.calcBasisFunctions(l,o,t,r),u=[],f=0;f<=t;++f){u[f]=new oe.Vec4(0,0,0,0);for(var p=0;p<=e;++p){var d=a[s-e+p][l-t+f].clone(),m=d.w;d.x*=m,d.y*=m,d.z*=m,u[f].add(d.multiplyScalar(h[p]))}}for(var g=new oe.Vec4(0,0,0,0),f=0;f<=t;++f)g.add(u[f].multiplyScalar(c[f]));return g.divideScalar(g.w),new oe.Vec3(g.x,g.y,g.z)}},oe.GLParameters=function(e,t,i){this.material=e,this.network=t,this.precision=t._precision,this.map=!!e.map,this.mapLoaded=!0,this.envMap=!!e.envMap,this.lightMap=!!e.lightMap,this.bumpMap=!!e.bumpMap&&"phong"===e._type,this.normalMap=!!e.normalMap&&"phong"===e._type,this.specularMap=!!e.specularMap,this.vertexColors=i instanceof se.BufferNode?i.attributes.color:e.vertexColors,this.wireframe=e.wireframe,this.clipPlane=e.clipPlane,this.rimLightColor=e.rimLightColor,this.fog=t._fog,this.useFog=e.fog,this.fogExp=this.fog instanceof oe.FogExp2,this.sizeAttenuation=e.sizeAttenuation,this.skinning=e.skinning,this.maxBones=e.maxBones,this.useVertexTexture=t._supportsBoneTextures&&i&&i.useVertexTexture,this.boneTextureWidth=i&&i.boneTextureWidth,this.boneTextureHeight=i&&i.boneTextureHeight,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.maxMorphTargets=4,this.maxMorphNormals=4,this.maxDirLights=t.maxLightCount.directional,this.maxPointLights=t.maxLightCount.point,this.maxSpotLights=t.maxLightCount.spot,this.maxHemiLights=t.maxLightCount.hemi,this.maxShadows=t.maxShadows,this.maxPointShadows=t.maxPointShadows,this.shadowMapEnable=t._shadowMapEnable&&i.receiveShadow&&this.maxShadows>0,this.pointShadowMapEnable=t._shadowMapEnable&&i.receiveShadow&&this.maxPointShadows>0,this.shadowMapType=t.shadowMapType,this.shadowMapDebug=t.shadowMapDebug,this.shadowMapCascade=t.shadowMapCascade,this.alphaTest=e.alphaTest,this.metal=e.metal,this.perPixel=e.perPixel,this.wrapAround=e.wrapAround,this.doubleSided=e.side===oe.DoubleSide&&!pe.isIE,this.flipSided=e.side===oe.BackSide,this.useSSAO=t.isSSAOEnable()&&t.pm.isLightMaterial(e),this.gammaInput=t.gammaInput,this.gammaOutput=t.gammaOutput,this.physicallyBasedShading=t.physicallyBasedShading,this.supportsVertexTextures=!1,this.shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC",this.shadowMapType===oe.PCFShadowMap?this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF":this.shadowMapType===oe.PCFSoftShadowMap&&(this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"),this.maxGrandient=Oe.getObjectCount(e.gradient)},oe.GLParameters.prototype.getShaders=function(e){e=e===t?"":e;var i=this;return[["precision "+i.precision+" float;",e,this.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"",i.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_POINT_SHADOWS "+i.maxPointShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.maxGrandient>0?"#define MAX_GRADIENT "+i.maxGrandient:"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.boneTextureWidth?"#define N_BONE_PIXEL_X "+i.boneTextureWidth.toFixed(1):"",i.boneTextureHeight?"#define N_BONE_PIXEL_Y "+i.boneTextureHeight.toFixed(1):"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnable?"#define USE_SHADOWMAP":"",i.shadowMapEnable||i.pointShadowMapEnable?"#define "+i.shadowMapTypeDefine:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),["precision "+this.precision+" float;",i.bumpMap||i.normalMap?"#extension GL_OES_standard_derivatives : enable":"",e,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_POINT_SHADOWS "+i.maxPointShadows,i.useSSAO?"#define USE_SSAO":"",i.wireframe?"#define USE_WIREFRAME":"",i.clipPlane?"#define USE_CLIP_PLANE":"",i.rimLightColor?"#define USE_RIM_LIGHT":"",i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",this.gammaInput?"#define GAMMA_INPUT":"",this.gammaOutput?"#define GAMMA_OUTPUT":"",this.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.maxGrandient>0?"#define MAX_GRADIENT "+i.maxGrandient:"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnable?"#define USE_SHADOWMAP":"",i.shadowMapEnable||i.pointShadowMapEnable?"#define "+i.shadowMapTypeDefine:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","#ifdef USE_CLIP_PLANE","uniform vec4 clipPlane;","#endif","#ifdef USE_RIM_LIGHT","uniform vec3 rimLightColor;","uniform float rimLightScale;","#endif",""].join("\n")]};var We={};We.setDepthTest=function(e,t){var i=t._gl;t._oldDepthTest!==e&&(e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),t._oldDepthTest=e)},We.setSmapleAlphaToCoverage=function(e,t){var i=t._gl;t._oldSmapleAlphaToCoverage!==e&&(e?i.enable(i.SAMPLE_ALPHA_TO_COVERAGE):i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),t._oldSmapleAlphaToCoverage=e)},We.setDepthWrite=function(e,t){var i=t._gl;t._oldDepthWrite!==e&&(i.depthMask(e),t._oldDepthWrite=e)},We.clear=function(e,i,r,a){var n=a._gl,o=0;(e===t||e)&&(o|=n.COLOR_BUFFER_BIT),(i===t||i)&&(o|=n.DEPTH_BUFFER_BIT),(r===t||r)&&(o|=n.STENCIL_BUFFER_BIT),a._gl.clear(o)},We.setPolygonOffset=function(e,t,i,r){var a=r._gl;r._oldPolygonOffset!==e&&(e?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL),r._oldPolygonOffset=e),!e||r._oldPolygonOffsetFactor===t&&r._oldPolygonOffsetUnits===i||(a.polygonOffset(t,i),r._oldPolygonOffsetFactor=t,r._oldPolygonOffsetUnits=i)},We.setBlending=function(e,t,i,r,a){var n=a._gl;e!==a._oldBlending&&(e===oe.NoBlending?n.disable(n.BLEND):e===oe.AdditiveBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE)):e===oe.SubtractiveBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.ONE_MINUS_SRC_COLOR)):e===oe.MultiplyBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.SRC_COLOR)):e===oe.CustomBlending?n.enable(n.BLEND):e===oe.NormalBlendingAlpha?(n.enable(n.BLEND),n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):(n.enable(n.BLEND),n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)),a._oldBlending=e),e===oe.CustomBlending?(t!==this._oldBlendEquation&&(n.blendEquation(Oe.paramToGL(t)),a._oldBlendEquation=t),i===a._oldBlendSrc&&r===a._oldBlendDst||(n.blendFunc(Oe.paramToGL(i),Oe.paramToGL(r)),a._oldBlendSrc=i,a._oldBlendDst=r)):(a._oldBlendEquation=null,a._oldBlendSrc=null,a._oldBlendDst=null)},We.enableStencil=function(e,t){e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.KEEP,e.REPLACE,e.REPLACE),t._setStencilMask(1),e.clearStencil(0),e.clear(e.STENCIL_BUFFER_BIT)},We.stencilTest=function(e,t){e.enable(e.STENCIL_TEST),e.stencilFunc(e.EQUAL,0,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),t._setStencilMask(0)},We.disableStencil=function(e){e.disable(e.STENCIL_TEST)},We.r=function(e,t,i,r,a,n,o){e._AK47(t,i,r,a,n,o)},We.g=function(e,t,i,r,a,n){e.renderGroup(t,i,r,a,n)},oe.GLUtils=We;var Ye=oe.GPU=function(e){var t=e._gl,i=e.webglVersion;this.network=e,this._glExtensionTextureFloat=i>1||t.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=i>1||t.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("Float textures not supported."),this._glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this._maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this._maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxAnisotropy=this._glExtensionTextureFilterAnisotropic?t.getParameter(this._glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._supportsVertexTextures=this._maxVertexTextures>0,this._supportsBoneTextures=this._supportsVertexTextures&&this._glExtensionTextureFloat,this._compressedTextureFormats=this._glExtensionCompressedTextureS3TC?t.getParameter(t.COMPRESSED_TEXTURE_FORMATS):[],this._vertexShaderPrecisionHighpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),this._vertexShaderPrecisionMediumpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT),this._vertexShaderPrecisionLowpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_FLOAT),this._fragmentShaderPrecisionHighpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),this._fragmentShaderPrecisionMediumpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT),this._fragmentShaderPrecisionLowpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_FLOAT),this._vertexShaderPrecisionHighpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_INT),this._vertexShaderPrecisionMediumpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_INT),this._vertexShaderPrecisionLowpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_INT),this._fragmentShaderPrecisionHighpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_INT),this._fragmentShaderPrecisionMediumpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_INT),this._fragmentShaderPrecisionLowpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_INT);var r=this._vertexShaderPrecisionHighpFloat&&this._vertexShaderPrecisionHighpFloat.precision>0&&this._fragmentShaderPrecisionHighpFloat&&this._fragmentShaderPrecisionHighpFloat.precision>0,a=this._vertexShaderPrecisionMediumpFloat&&this._vertexShaderPrecisionMediumpFloat.precision>0&&this._fragmentShaderPrecisionMediumpFloat&&this._fragmentShaderPrecisionMediumpFloat.precision>0,n=e._precision;"highp"!==n||r||(a?(n="mediump",console.log("highp not supported, using mediump")):(n="lowp",console.log("highp and mediump not supported, using lowp"))),"mediump"!==n||a||(n="lowp",console.log("mediump not supported, using lowp")),e._precision=n,this.initElementIndexUInt()};Ye.prototype.initElementIndexUInt=function(){var e=this.network;if(e.webglVersion>1)this.elementIndexUIntSupported=!0;else{var t=e._gl.getExtension("OES_element_index_uint");this.elementIndexUIntSupported=!!t,this.elementIndexUIntSupported||console.log("Element Index UInt not supported")}},Ye.prototype.initVertextArrayObject=function(){var e=this.network;if(!1!==e.parameters.enableVertexArrayObject)if(e.webglVersion>1)this.vertextArraySupported=!0;else{var t=e._gl,i=t.getExtension("OES_vertex_array_object");i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(e){return i.bindVertexArrayOES(e)},t.deleteVertexArray=function(e){return i.deleteVertexArrayOES(e)},this.vertextArraySupported=!0):console.log("Vertex Array not supported")}},Ye.prototype.initInstancedArray=function(){var e=this.network;if(e.webglVersion>1)this.instancedArraySupported=!0;else{var t=e._gl,i=t.getExtension("ANGLE_instanced_arrays");i?(t.drawArraysInstanced=function(e,t,r,a){return i.drawArraysInstancedANGLE(e,t,r,a)},t.drawElementsInstanced=function(e,t,r,a,n){return i.drawElementsInstancedANGLE(e,t,r,a,n)},t.vertexAttribDivisor=function(e,t){return i.vertexAttribDivisorANGLE(e,t)}):console.log("Instanced Array not supported")}};var je=se.VertexArrayObject=function(e,t){this.network=e,this.tempGroup=t,this.create()};je.prototype.create=function(){if(this.network.gpu.vertextArraySupported){this.tempGroup._vao=this,this.dirty=!0;var e=this.network._gl;return this.vao=e.createVertexArray()}},je.prototype.destory=function(){return this.tempGroup._vao=null,!!this.vao&&this.network._gl.deleteVertexArray(this.vao)},je.prototype.bind=function(e,t){return!!this.vao&&this.network._gl.bindVertexArray(this.vao)},je.prototype.unbind=function(){return!!this.vao&&this.network._gl.bindVertexArray(null)},oe.Program=function(e,t,i,r){this.entity=e,this.group=t,this.material=i,this.network=r},oe.Program.prototype.setEntity=function(){this.entity},oe.Program.prototype.buildGLProgram=function(){},oe.Uniform=function(e,i,r){this.id=e,this.type=i,this.value=r,this.location=t},oe.Uniform.prototype={constructor:oe.Uniform,setValue:function(e){this.value=e},getUniformLocation:function(e,t){return e.getUniformLocation(this.id)}},oe.ProgramManager=function(e){this.id=oe.ProgramManagerId++,this.network=e,this.gl=this.network._gl,this.gpu=this.network.gpu,this.programs=[],this.currentProgram=null,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.textureCount=0,this._lightNeedsUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},this.gammaInput=!1,this.textureCount=0,this.programMap={},this.textureMap={},this.textureUpdateFlags={},this.glTextureMap={},this.textureMaterialMap={},this.unLoadedImage={},this.materialMap={},this.materialUpdateFlags={},this.handleTextureChange=function(e){if("image"===e.property||"loaded"===e.property){t=e.source;this.changeTextureUpdateFlags(t,!0),delete this.unLoadedImage[t._image]}else if("disposed"===e.property){var t=e.source;this.deallocateTexture(t),t.removePropertyChangeListener(this.handleTextureChange),delete this.textureUpdateFlags[t.id],delete this.textureMap[t.id]}Oe.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()},this.handleMaterialChange=function(e){if("map"==e.property||e.property.endsWith("Map")||"needsUpdate"===e.property){t=e.source;this.materialUpdateFlags[t.id]=!0}else if("disposed"===e.property){var t=e.source;this.deallocateMaterial(t),t.removePropertyChangeListener(this.handleMaterialChange,this),delete this.materialUpdateFlags[t.id],delete this.materialMap[t.id],delete this.programMap[t.id]}Oe.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()}},oe.ProgramManager.prototype.addMaterial=function(e){null==this.materialMap[e.id]&&(this.materialMap[e.id]=e,e.addPropertyChangeListener(this.handleMaterialChange,this))},oe.ProgramManager.prototype.dispose=function(){for(var e in this.materialMap)this.materialMap[e].removePropertyChangeListener(this.handleMaterialChange,this);this.materialMap={};for(var e in this.textureMap)this.textureMap[e].removePropertyChangeListener(this.handleTextureChange,this);this.textureMap={}},oe.ProgramManager.prototype.needsUpdateMaterial=function(e){return this.materialUpdateFlags[e.id]===t||!0===this.materialUpdateFlags[e.id]||(e.map instanceof qe||e.map instanceof Ze)},oe.ProgramManager.prototype.changeMaterialUpdateFlags=function(e,t){this.materialUpdateFlags[e.id]=t},oe.ProgramManager.prototype.isLightMaterial=function(e){return e instanceof oe.LambertMaterial||e instanceof oe.PhongMaterial||e.lights||"lambert"===e._type||"phong"===e._type||"terrain"===e._type},oe.ProgramManager.prototype.changeAllMaterialUpdateFlags=function(e,t,i){for(var r in this.materialMap){var a=this.materialMap[r];(null==t||t.call(i,a))&&(this.materialUpdateFlags[a.id]=e)}},oe.ProgramManager.prototype.changeAllLightMaterialUpdateFlags=function(e){this.changeAllMaterialUpdateFlags(e,this.isLightMaterial,this)},oe.ProgramManager.prototype.addTexture=function(e){null!=e.id&&this.textureMap[e.id]===t&&(this.textureMap[e.id]=e,e.addPropertyChangeListener(this.handleTextureChange,this),e._image.loaded||(this.unLoadedImage[e._image]=1))},oe.ProgramManager.prototype.needsUpdateTexture=function(e){return this.textureUpdateFlags[e.id]===t||!0===this.textureUpdateFlags[e.id]},oe.ProgramManager.prototype.changeTextureUpdateFlags=function(e,t){this.textureUpdateFlags[e.id]=t;for(var i in this.materialMap){var r=this.materialMap[i];r.map!==e&&r.lightMap!==e&&r.envMap!==e&&r.bumpMap!==e&&r.normalMap!==e&&r.specularMap!==e||this.changeMaterialUpdateFlags(r,!0)}},oe.ProgramManager.prototype.buildProgram=function(e,t,i){i.shaderID||i.setupMaterialShader();var r,a,n,o=new oe.GLParameters(i,this.network,e),s=[];if(i.shaderID?s.push(i.shaderID):(s.push(i.vertexShader),s.push(i.fragmentShader)),i instanceof oe.ShaderMaterial);else for(vt in o)"material"!==vt&&"network"!==vt&&"node"!==vt&&"getShaders"!==vt&&(s.push(vt),s.push(o[vt]));for(n=s.join(),m=0,r=this.programs.length;m<r;m++)if(this.programs[m].code===n){i.program=this.programs[m].program,i.uniformsList=[];for(p in i.uniforms)i.uniformsList.push([i.uniforms[p],p]);return this.programs[m].usedTimes++,this.programs[m].program}a=this.gl.createProgram();var l=o.getShaders(),h=l[1],c=l[0];if(this.gl.attachShader(a,f("fragment",h+i.fragmentShader,this.gl)),this.gl.attachShader(a,f("vertex",c+i.vertexShader,this.gl)),this.gl.linkProgram(a),this.gl.getProgramParameter(a,this.gl.LINK_STATUS)||this.gl.isContextLost()||console.log("Could not initialise shader\nVALIDATE_STATUS: "+this.gl.getProgramParameter(a,this.gl.VALIDATE_STATUS)+", gl error ["+this.gl.getError()+"]"),!a)return a;a.uniforms={},a.attributes={},a.attributeSizes={};var u,p,d,m;u=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(p in i.uniforms)u.push(p);for(this.attachGLLocations(a,u,"uniform"),u=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],m=0;m<o.maxMorphTargets;m++)u.push("morphTarget"+m);for(m=0;m<o.maxMorphNormals;m++)u.push("morphNormal"+m);for(d in i.attributes)u.push(d);this.attachGLLocations(a,u,"attribute"),a.id=this.programs.length,this.programs.push({program:a,code:n,usedTimes:1}),this.info.memory.programCount=this.programs.length,i.program=a,i.uniformsList=[];for(p in i.uniforms)i.uniformsList.push([i.uniforms[p],p]);return a},oe.ProgramManager.prototype.enableAttribute=function(e,i){var r=this.gl,a=i.program.attributes;if(a.position>=0&&r.enableVertexAttribArray(a.position),a.color>=0&&r.enableVertexAttribArray(a.color),a.normal>=0&&r.enableVertexAttribArray(a.normal),i.attributes)for(var n in i.attributes)a[n]!==t&&a[n]>=0&&r.enableVertexAttribArray(a[n])};var He={5126:1,35664:2,35665:3,35666:4,35676:16};oe.ProgramManager.prototype.attachGLLocations=function(e,t,i){var r,a,n=this.gl;if("uniform"===i)for(s=0,r=t.length;s<r;s++)a=t[s],e.uniforms[a]=n.getUniformLocation(e,a);else if("attribute"===i)for(var o=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES),s=0;s<o;s++){var l=n.getActiveAttrib(e,s);l&&(e.attributeSizes[l.name]=He[l.type],e.attributes[l.name]=n.getAttribLocation(e,l.name))}},oe.ProgramManager.prototype.setProgram=function(e,t,i,r,a,n){if(this.textureCount=0,this.addMaterial(r),this.needsUpdateMaterial(r)){r.setupMaterialShader(),this.programMap[r.id]&&this.deallocateMaterial(r);var o=this.buildProgram(n,a,r);this.programMap[r.id]=o,this.changeMaterialUpdateFlags(r,!1)}var s=r._needRefreshUniform,l=this.programMap[r.id];if(!l)return l;var f=l.uniforms,d=r.uniforms;return l!=this.currentProgram&&(this.gl.useProgram(l),this.currentProgram=l,s=!0),r.id!==this.currentMaterialId&&(this.currentMaterialId=r.id,s=!0),(s||e!==this.network._currentCamera)&&(this.gl.uniformMatrix4fv(f.projectionMatrix,!1,e.projectionMatrix.elements),e!==this.network._currentCamera&&(this.network._currentCamera=e)),i&&r.fog&&i.refreshUniforms(d),(r.lights||"phong"===r._type||"lambert"===r._type||"terrain"===r._type)&&(this._lightNeedsUpdate&&(this.setupLights(l,t),this._lightNeedsUpdate=!1),p(d,this._lights)),s&&r.refreshUniforms(!1,{camera:this.network._camera,network:this.network}),n.receiveShadow&&!r._shadowPass&&this.network.isShadowable()&&(h(d,t),c(d,t)),s&&(this.loadUniformsGeneric(l,r.uniformsList,r),(r.skinning||"phong"===r._type||"lambert"===r._type||"terrain"===r._type||r instanceof oe.ShaderMaterial)&&null!==f.viewMatrix&&this.gl.uniformMatrix4fv(f.viewMatrix,!1,e.worldMatrixInverse.elements)),r.loadCameraPosition(f,e,this.gl),u(f,n,this.gl,this.network),null!=f.modelMatrix&&this.gl.uniformMatrix4fv(f.modelMatrix,!1,n.worldMatrix.elements),this.network._baseRender&&this.loadSSAOUniforms(f,r,s),r._needRefreshUniform=!1,l},oe.ProgramManager.prototype.loadSSAOUniforms=function(e,t,i){if(null!=e.mapSSAO&&this.network._sSAOEnable){var r=e.mapSSAO,a=i?this.getTextureUnit():t._ssaoSlot;this.gl.uniform1i(r,a),this.setTexture(this.network.finalSSAOTarget,a),t._ssaoSlot=a}},oe.ProgramManager.prototype.deallocateTexture=function(e){var t=this.gl,i=e.id,r=this.glTextureMap[i];if(r)delete this.glTextureMap[i],t.deleteTexture(r),this.info.memory.textures--;else if(e._image&&e._image.__webglTextureCube)t.deleteTexture(e._image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,t.deleteTexture(e.__webglTexture)}},oe.ProgramManager.prototype.setTextureParameters=function(e,t,i,r){var a=this.gl,n=this.gpu,o=oe.Utils.paramToGL;i&&!r?(a.texParameteri(e,a.TEXTURE_WRAP_S,o(t.wrapS,a)),a.texParameteri(e,a.TEXTURE_WRAP_T,o(t.wrapT,a)),a.texParameteri(e,a.TEXTURE_MAG_FILTER,o(t.magFilter,a)),a.texParameteri(e,a.TEXTURE_MIN_FILTER,o(t.minFilter,a))):(a.texParameteri(e,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(e,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(e,a.TEXTURE_MAG_FILTER,this.filterFallback(t.magFilter)),a.texParameteri(e,a.TEXTURE_MIN_FILTER,this.filterFallback(t.minFilter))),n._glExtensionTextureFilterAnisotropic&&t.type!==oe.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(a.texParameterf(e,n._glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,n._maxAnisotropy)),t.__oldAnisotropy=t.anisotropy)},oe.ProgramManager.prototype.setCubeTexture=function(e,i){var r=this.gl;this.addTexture(e);var a=e.id;if(6===e._image.length){if(!e._image.loaded)return;var n=oe.Utils.isPowerOfTwo,o=oe.Utils.paramToGL;if(this.needsUpdateTexture(e)){this.glTextureMap[a]===t&&(this.glTextureMap[a]=r.createTexture(),this.info.memory.texture++),this.changeTextureUpdateFlags(e,!1),r.activeTexture(r.TEXTURE0+i),r.bindTexture(r.TEXTURE_CUBE_MAP,this.glTextureMap[a]),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var s=e instanceof oe.CompressedTexture,l=[],h=0;h<6;h++)l[h]=e._image[h];var c=l[0],u=n(c.width)&&n(c.height),f=o(e.format,r),p=o(e.type,r);this.setTextureParameters(r.TEXTURE_CUBE_MAP,e,u);for(h=0;h<6;h++)if(s)for(var d,m=l[h].mipmaps,g=0,v=m.length;g<v;g++)d=m[g],r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,g,f,d.width,d.height,0,d.data);else r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,f,f,p,l[h]);e.generateMipmaps&&u&&r.generateMipmap(r.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else r.activeTexture(r.TEXTURE0+i),r.bindTexture(r.TEXTURE_CUBE_MAP,this.glTextureMap[a])}},oe.ProgramManager.prototype.setCubeTextureDynamic=function(e,t){var i=this.gl;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_CUBE_MAP,e.__webglTexture)},oe.ProgramManager.prototype.loadUniformsGeneric=function(e,i,r){var a,n,o,s,l,h,c,u,f,p,d,m=this.gl;for(f=0,p=i.length;f<p;f++)if(s=e.uniforms[i[f][1]])if(a=i[f][0],o=a.type,n=a.value,"i"===o)m.uniform1i(s,n);else if("f"===o)m.uniform1f(s,n);else if("v2"===o)m.uniform2f(s,n.x,n.y);else if("v3"===o)m.uniform3f(s,n.x,n.y,n.z);else if("v4"===o)m.uniform4f(s,n.x,n.y,n.z,n.w);else if("c"===o)m.uniform3f(s,n.r,n.g,n.b);else if("iv1"===o)m.uniform1iv(s,n);else if("iv"===o)m.uniform3iv(s,n);else if("fv1"===o)m.uniform1fv(s,n);else if("fv"===o)m.uniform3fv(s,n);else if("v2v"===o){for(a._array===t&&(a._array=new Float32Array(2*n.length)),c=0,u=n.length;c<u;c++)d=2*c,a._array[d]=n[c].x,a._array[d+1]=n[c].y;m.uniform2fv(s,a._array)}else if("v3v"===o){for(a._array===t&&(a._array=new Float32Array(3*n.length)),c=0,u=n.length;c<u;c++)d=3*c,n[c]instanceof oe.Color?(a._array[d]=n[c].r,a._array[d+1]=n[c].g,a._array[d+2]=n[c].b):(a._array[d]=n[c].x,a._array[d+1]=n[c].y,a._array[d+2]=n[c].z);m.uniform3fv(s,a._array)}else if("v4v"===o){for(a._array===t&&(a._array=new Float32Array(4*n.length)),c=0,u=n.length;c<u;c++)d=4*c,a._array[d]=n[c].x,a._array[d+1]=n[c].y,a._array[d+2]=n[c].z,a._array[d+3]=n[c].w;m.uniform4fv(s,a._array)}else if("m4"===o)a._array===t&&(a._array=new Float32Array(16)),n.flattenToArray(a._array),m.uniformMatrix4fv(s,!1,a._array);else if("m4v"===o){for(a._array===t&&(a._array=new Float32Array(16*n.length)),c=0,u=n.length;c<u;c++)n[c].flattenToArrayOffset(a._array,16*c);m.uniformMatrix4fv(s,!1,a._array)}else if("t"===o){if(l=n,h=this.getTextureUnit(),m.uniform1i(s,h),!l)continue;if(l._image instanceof Array&&6===l._image.length)this.setCubeTexture(l,h);else{g=l._image;this.setTexture(l,h,!g||!g.loaded)}}else if("tv"===o){for(a._array===t&&(a._array=[]),c=0,u=a.value.length;c<u;c++)a._array[c]=this.getTextureUnit();if(0==a._array.length)return;for(m.uniform1iv(s,a._array),c=0,u=a.value.length;c<u;c++)if(l=a.value[c],h=a._array[c],l){var g=l._image;l instanceof Ze?this.setCubeTextureDynamic(l,h):this.setTexture(l,h,!g||!g.loaded)}}},oe.ProgramManager.prototype.setTexture=function(e,i,r){(e.loaded||e._image&&e._image.loaded)&&(r=!1);var a=this.gl,n=oe.Utils.isPowerOfTwo,o=e.id;if(this.addTexture(e),!this.needsUpdateTexture(e)||e instanceof qe)a.activeTexture(a.TEXTURE0+i),e instanceof qe?a.bindTexture(a.TEXTURE_2D,e.__webglTexture):a.bindTexture(a.TEXTURE_2D,this.glTextureMap[o]);else{if(!e._image)return;this.glTextureMap[o]===t&&(this.glTextureMap[o]=a.createTexture(),this.info.memory.textures++),this.changeTextureUpdateFlags(e,!1),a.activeTexture(a.TEXTURE0+i),a.bindTexture(a.TEXTURE_2D,this.glTextureMap[o]),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!e.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,e.unpackAlignment);var s=oe.Utils.paramToGL,l=r?oe.ImageCache.Logo:e._image,h=n(l.width)&&n(l.height),c=s(e.format,a,this.network),u=s(e.type,a,this.network);this.setTextureParameters(a.TEXTURE_2D,e,h,r);var f,p=e.mipmaps;if(e instanceof oe.PixelsTexture)if(p.length>0&&h){for(var d=0,m=p.length;d<m;d++)f=p[d],a.texImage2D(a.TEXTURE_2D,d,c,f.width,f.height,0,c,u,f.data);e.generateMipmaps=!1}else a.texImage2D(a.TEXTURE_2D,0,c,l.width,l.height,0,c,u,l.data);else if(e instanceof oe.CompressedTexture)if(e.loaded)for(var d=0,m=p.length;d<m;d++)f=p[d],a.compressedTexImage2D(a.TEXTURE_2D,d,c,f.width,f.height,0,f.data);else a.texImage2D(a.TEXTURE_2D,0,c,c,u,l);else if(p.length>0&&h){for(var d=0,m=p.length;d<m;d++)f=p[d],a.texImage2D(a.TEXTURE_2D,d,c,c,u,f);e.generateMipmaps=!1}else a.texImage2D(a.TEXTURE_2D,0,c,c,u,l);e.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),e.onUpdate&&e.onUpdate()}},oe.ProgramManager.prototype.getTextureUnit=function(){var e=this.textureCount;return e>=this.gpu._maxTextures&&console.warn("Network3D: trying to use "+e+" texture units while this GPU supports only "+this.gpu._maxTextures),this.textureCount++,e},oe.ProgramManager.prototype.deallocateMaterial=function(e){var i=e.program;if(i!==t){return void(e.program=t)}},oe.ProgramManager.prototype.filterFallback=function(e){return e===oe.NearestFilter||e===oe.NearestMipMapNearestFilter||e===oe.NearestMipMapLinearFilter?this.gl.NEAREST:this.gl.LINEAR},oe.ProgramManager.prototype.setupLights=function(e,t){var i,r,a,n,o,s,l,h,c,u,f=0,p=0,g=0,v=this._lights,y=v.directional.colors,A=v.directional.positions,x=v.point.colors,_=v.point.positions,w=v.point.distances,b=v.spot.colors,M=v.spot.positions,S=v.spot.distances,P=v.spot.directions,C=v.spot.anglesCos,T=v.spot.exponents,E=v.hemi.skyColors,z=v.hemi.groundColors,D=v.hemi.positions,L=0,R=0,N=0,B=0,I=0,F=0,V=0,U=0,k=0,O=0,X=0,G=0,W=new oe.Vec3;for(i=0,r=t.size();i<r;i++)if(!(a=t.get(i)).onlyShadow)if(n=a.color,l=a.intensity*this.network.lightIntensityRatio,u=a.distance,a.updateWorldMatrix(!0),a instanceof oe.AmbientLight){if(!a._visible)continue;this.gammaInput?(f+=n.r*n.r,p+=n.g*n.g,g+=n.b*n.b):(f+=n.r,p+=n.g,g+=n.b)}else if(a instanceof oe.DirectionalLight){if(I+=1,!a._visible)continue;if(a.direction?W.copy(a.direction):(W.copy(a.worldMatrix.getPosition()),W.sub(a.target.worldMatrix.getPosition())),W.normalize(),0===W.x&&0===W.y&&0===W.z)continue;A[k=3*L]=W.x,A[k+1]=W.y,A[k+2]=W.z,this.gammaInput?m(y,k,n,l*l):d(y,k,n,l),L+=1}else if(a instanceof oe.PointLight){if(F+=1,!a._visible)continue;O=3*R,this.gammaInput?m(x,O,n,l*l):d(x,O,n,l),c=a.worldMatrix.getPosition(),_[O]=c.x,_[O+1]=c.y,_[O+2]=c.z,w[R]=u,R+=1}else if(a instanceof oe.SpotLight){if(V+=1,!a._visible)continue;X=3*N,this.gammaInput?m(b,X,n,l*l):d(b,X,n,l),c=a.worldMatrix.getPosition(),M[X]=c.x,M[X+1]=c.y,M[X+2]=c.z,S[N]=u,W.copy(c),W.sub(a.target.worldMatrix.getPosition()),W.normalize(),P[X]=W.x,P[X+1]=W.y,P[X+2]=W.z,C[N]=Math.cos(a.angle),T[N]=a.exponent,N+=1}else if(a instanceof oe.HemisphereLight){if(U+=1,!a._visible)continue;if(W.copy(a.worldMatrix.getPosition()),W.normalize(),0===W.x&&0===W.y&&0===W.z)continue;D[G=3*B]=W.x,D[G+1]=W.y,D[G+2]=W.z,o=a.color,s=a.groundColor,this.gammaInput?(m(E,G,o,h=l*l),m(z,G,s,h)):(d(E,G,o,l),d(z,G,s,l)),B+=1}for(i=3*L,r=Math.max(y.length,3*I);i<r;i++)y[i]=0;for(i=3*R,r=Math.max(x.length,3*F);i<r;i++)x[i]=0;for(i=3*N,r=Math.max(b.length,3*V);i<r;i++)b[i]=0;for(i=3*B,r=Math.max(E.length,3*U);i<r;i++)E[i]=0;for(i=3*B,r=Math.max(z.length,3*U);i<r;i++)z[i]=0;v.directional.length=L,v.point.length=R,v.spot.length=N,v.hemi.length=B,v.ambient[0]=f,v.ambient[1]=p,v.ambient[2]=g},oe.ProgramManagerId=0;var qe=function(e,i,r){this.width=e,this.height=i,r=r||{},this.wrapS=r.wrapS!==t?r.wrapS:oe.ClampToEdgeWrapping,this.wrapT=r.wrapT!==t?r.wrapT:oe.ClampToEdgeWrapping,this.magFilter=r.magFilter!==t?r.magFilter:oe.LinearFilter,this.minFilter=r.minFilter!==t?r.minFilter:oe.LinearMipMapLinearFilter,this.anisotropy=r.anisotropy!==t?r.anisotropy:1,this.offset=new oe.Vec2(0,0),this.repeat=new oe.Vec2(1,1),this.format=r.format!==t?r.format:oe.RGBAFormat,this.type=r.type!==t?r.type:oe.UnsignedByteType,this.depthBuffer=r.depthBuffer===t||r.depthBuffer,this.stencilBuffer=r.stencilBuffer===t||r.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null,this.flipY=!0};qe.prototype={constructor:qe,clone:function(){var e=new qe(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}};var Ze=function(e,t,i){qe.call(this,e,t,i),this.activeCubeFace=0};oe.extend(Ze,qe,{});var Qe=new se.Vec3,Ke=new se.Vec3(1,1,1),Je=new se.Quat;oe.Network3D=function(e,i,r,a){oe.Element.call(this);var n=this;this.id=oe.Network3DId++,this._interactionDispatcher=new oe.EventDispatcher,a=a||{},this.parameters=a,this.helperBox=new oe.DataBox,this.helperBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._rootView=fe.createView("hidden"),this._canvas=r=this.initCanvas(r),this._topCanvas=fe.createCanvas(this),this._bottomCanvas=fe.createCanvas(this);var o=this._canvas.parentNode;o&&(o.removeChild(this._canvas),o.appendChild(this._rootView),this.adjustRootViewBounds(0,0,this._canvas.width,this._canvas.height)),this._rootView.appendChild(this._bottomCanvas),this._rootView.appendChild(this._canvas),this._rootView.appendChild(this._topCanvas),this.setCanvasPropety(),this._camera=i||new oe.PerspectiveCamera,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this._clearColor=a.clearColor!==t?a.clearColor:new oe.Color(16777215),this._clearAlpha=a.clearAlpha!=t?a.clearAlpha:1,this._precision=a.precision!==t?a.precision:"mediump",this.__fog=new oe.FogExp2,this.devicePixelRatio=a.devicePixelRatio!==t?a.devicePixelRatio:window.devicePixelRatio!==t?window.devicePixelRatio:1,this._premultipliedAlpha=null==a.premultipliedAlpha||a.premultipliedAlpha,this.lightIntensityRatio=1,pe.isIOS||pe.isAndroid?(this._antialias=!1,this._preserveDrawingBuffer=!1,this.lightIntensityRatio=.1):(this._preserveDrawingBuffer=null==a.preserveDrawingBuffer||a.preserveDrawingBuffer,this._antialias=a.antialias==t||a.antialias),this._useWebgl2=a.useWebgl2||!1,this._handleWebglContextLost=function(e){console.log("webgl context lost"),e.preventDefault(),n._animateId&&((n._vrDisplay&&n._vrDisplay.isPresenting?n._vrDisplay:window).cancelAnimationFrame(n._animateId),n._animateId=null)},this._handleWebglRestored=function(e){console.log("webgl context restored"),n._currentProgram=null,n.billboardRenderer=null,n.pm.dispose(),_t.clear(),n._enabledAttributes={},n._currentGroupHash=null,n._oldLineWidth=null,n.gpu=new oe.GPU(n),n.pm=new oe.ProgramManager(n),n.setDefaultGLState(),n.dirtyNetwork(),n._clearNodeCache(),g(n)},r.addEventListener("webglcontextlost",this._handleWebglContextLost),r.addEventListener("webglcontextrestored",this._handleWebglRestored),this._gl=this.initGL(),this._currentProgram=null,this.overrideMaterial=null,this._maxLights=a.maxLights!==t?a.maxLights:4,this._projScreenMatrix=new ue,this._projScreenMatrixPS=new ue,this._frustum=new oe.Frustum,this._vector3=new he,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldBlending=null,this._oldBlendEquation=null,this._oldBlendSrc=null,this._oldBlendDst=null,this._currentCamera=null,this._enabledAttributes={},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.gpu=new oe.GPU(this),this.pm=new oe.ProgramManager(this),this.setDefaultGLState(),this.paintSortFunction=oe.Defaults.paintSortFunction,this.sortNodes=!0,this.sortOpaqueOrderByMaterial=!0,this.glNodeList=[],this.helperGLNodeList=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.projector=new oe.Projector,this.up=new oe.Vec3(0,1,0),this.position=new oe.Vec3(0,0,0),this.seletionMaterial=new oe.BasicMaterial,this.seletionMaterial.wireframe=!0,this.seletionMaterial.wireframeLinewidth=1,this.seletionMaterial.color=new oe.Color(65280),this.selectionCube=new Te,this.selectionCube.material=this.seletionMaterial,this.outlineMaterialMap={},this.selectionCube._modelViewMatrix=new ue,this.selectionCube._normalMatrix=new ce,this.selectionCube.name="select",this.alarmMaterial=new oe.BasicMaterial,this.alarmMaterial.wireframe=!0,this.alarmMaterial.wireframeLinewidth=1,this.alarmMaterial.color=new oe.Color(16711680),this.alarmCube=new Te,this.alarmCube.material=this.alarmMaterial,this.alarmCube._modelViewMatrix=new ue,this.alarmCube._normalMatrix=new ce,this.alarmCube.name="alarm";this._glowSurface=new oe.Plane(2,2),this._glowSurface2=new oe.Plane(512,512),this._glowSurface.target=new qe(512,512,{type:oe.UnsignedByteType}),this._glowSurface.target1=new qe(512,512,{type:oe.UnsignedByteType}),this._glowSurface.target2=new qe(512,512,{type:oe.UnsignedByteType}),this._glowSurfaceMaterial=new oe.BlurMaterial,this._glowSurfaceMaterial.blendMode=oe.NormalBlendingAlpha,this._blurMaterialH=new oe.BlurMaterial,this._blurMaterialH.orientation=1,this._blurMaterialV=new oe.BlurMaterial,this.deferredPostionMaterial=new oe.DeferredMaterial,this.deferredNormalMaterial=new oe.DeferredMaterial({isNormal:1}),this.ssaoMaterial=new oe.SSAOMaterial,this.ssaoMaterial.map2=new oe.Texture(we.ssaoNormalImage);this.deferredPostionTarget=new qe(1024,1024,{type:oe.FloatType,magFilter:oe.NearestFilter,minFilter:oe.NearestFilter}),this.deferredNormalTarget=new qe(1024,1024,{type:oe.FloatType,magFilter:oe.NearestFilter,minFilter:oe.NearestFilter,format:oe.RGBFormat}),this.ssaoTarget=new qe(1024,1024,{type:oe.FloatType,magFilter:oe.NearestFilter,minFilter:oe.NearestFilter}),this.ssaoTarget1=new qe(512,512,{type:oe.UnsignedByteType}),this.ssaoTarget2=new qe(512,512,{type:oe.UnsignedByteType}),this.finalSSAOTarget=null,this._interactions=null,this.billboardRenderer=null,this.flareRenderer=null,this._groupCounter=0,this.groupMap={},this.groupCountMap={},this.bufferNodeMap={},this.lineMap={},this.particleMap={},this.normalNodeMap={},this._pickingNodeMap={},this._animations=[],this._pickingTarget=new qe(512,512,{depthBuffer:!0,stencilBuffer:!1}),this._pickingTarget.generateMipmaps=!1,this.showAxis=!1,this.axisSize=20,this.axisPosition=new oe.Vec3(0,0,0),this.axis=new oe.Axis({size:this.axisSize}),this.alarmBillboards=[],this.areaPickingRect={},this.setDataBox(e==t?new oe.DataBox:e),this.renderCallback=null,this.beforeRenderFunction=null,this.dirtyNetwork(),this.prepareData(),this.autoUpdateCameraAspect=!0,this.shadowMapRenderer=null,this.shadowMapType=oe.PCFSoftShadowMap,this.shadowMapCullFace=oe.CullFaceFront,this.adjustBounds(this._canvas.width,this._canvas.height,0,0),this._handleMouseDown=function(e){n.handleMouseDown(e)},this._handleMouseClick=function(e){n.handleClick(e)},this.getRootView().addEventListener("mousedown",this._handleMouseDown),this.getRootView().addEventListener("mouseup",this._handleMouseClick),this.setInteractions([new oe.DefaultInteraction(this),new oe.SelectionInteraction(this)]),this.doubleClickToLookAtFunction=ke.doubleClickToLookAtFunction,g(this),this.initSurfaceGroup(),this.materialRenderListMap={},this._selectTransparencyThreshold=0,this._pickingTexturePixel=!0,this._dynamicBatchDraw=!1,this._dynamicBatchDrawCountLimit=1024,this.needSmoothNormalFunction=ke.needSmoothNormalFunction,this._annotationMap={},this._activeAnnotation=null},oe.extend(oe.Network3D,oe.Data,{___accessor:["shadowMapEnable","editableFunction","keyboardRemoveEnabled","selectTransparencyThreshold","pickingTexturePixel","dynamicBatchDraw","showFps"],setUseFog:function(e){this._useFog=e,this._useFog?this._fog=this.__fog:this._fog=null},setOverloadMaterial:function(e){this._overloadMaterial=e},setFogColor:function(e){this.__fog.color=e},setFogDensity:function(e){this.__fog.density=e},setDataBox:function(e){if(!e)throw"DataBox can not be null";if(this.dataBox!==e){var t=this.dataBox;t&&(this._clearDataBox(t),t.removeDataBoxChangeListener(this.handleDataBoxChange,this),t.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),t.getAlarmBox().removeDataBoxChangeListener(this.dirtyNetwork,this),t.getSelectionModel().removeSelectionChangeListener(this.dirtyNetwork,this)),this.dataBox=e,this.dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this.dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.dataBox.getAlarmBox().addDataBoxChangeListener(this.dirtyNetwork,this),this.dataBox.getSelectionModel().addSelectionChangeListener(this.dirtyNetwork,this),this.firePropertyChange("dataBox",t,this._box),this.glNodeList=[],this.dirtyNetwork(),this._clearNodeCache()}},setRenderCallback:function(e){this.renderCallback=e},setBeforeRenderFunction:function(e){this.beforeRenderFunction=e},getDataBox:function(){return this.dataBox},getClearColor:function(){return this._clearColor},setClearColor:function(e){3==arguments.length?(this._clearColor=new oe.Color,this._clearColor.setRGB(arguments[0],arguments[1],arguments[2])):(this._clearColor=e,this._clearColor instanceof oe.Color||(this._clearColor=new oe.Color(e))),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},setClearAlpha:function(e){this._clearAlpha=e,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},getClearAlpha:function(){return this._clearAlpha},getPrecision:function(){return this._precision},setPrecision:function(e){this._precesion=e},setSSAOBlur:function(e){this._ssaoBlur=e},setSSAOEnable:function(e){return!(e&&!this.isFloatTextureSupport())&&(this._sSAOEnable=e,this._dirty=!0,!0)},isSSAOEnable:function(){return this._sSAOEnable&&this._baseRender},setSSAOOccluderBias:function(e){this._occluderBias=e,this._dirty=!0},setSSAOSamplingRadius:function(e){this._samplingRadius=e,this._dirty=!0},setSSAOAttenuation:function(e){this._attenuation=e,this._dirty=!0},isFloatTextureSupport:function(){return null!=this._glExtensionTextureFloat},getCamera:function(){return this._camera},setCamera:function(e,t){if(this._camera!=e){var i=this._camera;if(i.removePropertyChangeListener(this.dirtyNetwork),this._camera=e,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this.autoUpdateCameraAspect){this._camera.setAspect&&this._camera.setAspect(i.aspect);var r=this.getDefaultInteraction();r&&(r.object=this._camera)}t&&(this._camera.p(i.p()),this._camera.lookAt(i.getTarget())),this.dirtyNetwork()}},isVisible:function(e){if(e){if(e instanceof oe.Link||e instanceof oe.PathLink){if(!e.isVisible())return!1;if(!this.isVisible(e._fromNode))return!1;if(!this.isVisible(e._toNode))return!1}if(!e.isVisible())return!1;if(e._parent&&!this.isVisible(e._parent))return!1;if(this.visibleFunction)return this.visibleFunction(e)}return!0},setCanvasPropety:function(){this._canvas&&(this._canvas.setAttribute("tabindex",this.id),this._canvas.style.outline="none",this._canvas.style.position="absolute")},initCanvas:function(e){return e==t?document.createElement("canvas"):("string"==typeof e&&(e=document.getElementById(e)),e)},initGL2:function(e){if(this._useWebgl2){var t=this._canvas.gl;if(!t)try{t=this._canvas.getContext("webgl2",e)||this._canvas.getContext("experimental-webgl2",e)}catch(e){console.log(e)}if(t)return this.webglVersion=2,t;this.webglVersion=1}},initGL:function(){var e={preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0},t=this.initGL2(e);if(t)return t;var i=this._canvas.gl;if(!i)try{i=this._canvas.getContext("webgl",e)||this._canvas.getContext("experimental-webgl",e)}catch(e){console.log(e)}if(this._initVR(),i||console.error("Can not init webgl context"),this._glExtensionTextureFloat=i.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=i.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("TGL.Network3D: Float textures not supported."),this._glExtensionStandardDerivatives||console.log("TGL.Network3D: Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("TGL.Network3D: Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("TGL.Network3D: S3TC compressed textures not supported."),i)return i;console.log("Error: Your browser does not support WebGL.")},resetRenderInfo:function(){this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this.info.currentMaterialId=-1},_clearDataBox:function(e,t){for(var i=null,r=(i=e===this.helperBox?this.helperGLNodeList:this.glNodeList).length-1;r>=0;r--){i[r];i.splice(r,1)}i=[],this.prepareData(),this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0);var a=this;(t=t||e.getDatas()).forEach(function(e){a._clearNodeCache(e)}),this.deleteCloneNode()},handleDataBoxChange:function(e){var t=e.kind,i=e.data,r=e.source,a=null;a=r===this.helperBox?this.helperGLNodeList:this.glNodeList,"add"===t?i instanceof oe.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):i instanceof oe.Annotation?this._createAnnotationDiv(i):(this.addNodeMaterials(i),this.addNode(i,a),i._alarmBillboard&&this.alarmBillboards.push(i._alarmBillboard)):"remove"===t?i instanceof oe.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):i instanceof oe.Annotation?this._removeAnnotationDiv(i):(this.removeNode(i,a),this.deleteCloneNode(i)):"clear"===t&&this._clearDataBox(r,e.datas),this.boundingBox=null,this.shadowMapRenderer&&this.shadowMapRenderer.handleDataBoxChange(e),this.dirtyNetwork()},removeNode:function(e,t){for(var i=t.length-1;i>=0;i--)t[i].node===e&&t.splice(i,1);this._clearNodeCache(e)},_clearNodeCache:function(e){if(e){if(e.attributes&&null!=e.attributes.id&&delete this.bufferNodeMap[e.attributes.id],delete this._pickingNodeMap[e._pickingId],e._animation&&this._animations.splice(this._animations.indexOf(e),1),e.oldGroups=e.groups||e.oldGroups,null!=e.oldGroups)for(var t in e.oldGroups){var i=e.oldGroups[t],r=this.groupCountMap[i.id];null!=r&&(--r<=0?(delete this.groupCountMap[i.id],delete this.groupMap[i.id]):this.groupCountMap[i.id]=r)}for(var a=0;a<this.alarmBillboards.length;a++)this.alarmBillboards[a].getParent()===e&&(this.alarmBillboards.splice(a,1),a--);e instanceof oe.Annotation?this._removeAnnotationDiv(e):this._clearNodeMaterial(e)}else{for(var n in this.groupMap){var o=this.groupMap[n]._nodeId;this.helperBox.containsById(o)||delete this.groupMap[n]}this.alarmBillboards.splice(0),this.glNodeList=[]}for(var n in this._annotationMap)this._removeAnnotationDiv(n)},_clearNodeMaterial:function(e){var t=e.material;if(t)if(t.materials)for(var i=t.materials,r=i.length,a=0;a<r;a++)this._clearMaterial(i[a]);else this._clearMaterial(t)},_clearMaterial:function(e){e.map&&se.TexturePool.unUseTexture(e.map),e.lightMap&&se.TexturePool.unUseTexture(e.lightMap),e.specularMap&&se.TexturePool.unUseTexture(e.specularMap),e.bumpMap&&se.TexturePool.unUseTexture(e.bumpMap),e.normalMap&&se.TexturePool.unUseTexture(e.normalMap),e.envMap&&se.TexturePool.unUseTexture(e.envMap),se.MaterialPool.unUseMaterial(e)},addNode:function(e,t){for(var i=this.addWebGLNode(t,e),r=0;r<i.length;r++){var a=i[r];this.updateWebGLNode(a)}e._animation&&this._animations.push(e),this._pickingNodeMap[e._pickingId]=e},addNodeMaterials:function(e){var t,i=e.material;if(i instanceof oe.Material)this.addMaterial(i);else if(i instanceof oe.ArrayMaterial){var r=i.materials,a=r.length;for(t=0;t<a;t++)this.addMaterial(r[t])}},addMaterial:function(e){this.pm.addMaterial(e),e.map&&this.pm.addTexture(e.map)},handleDataPropertyChange:function(e){var t=e.source,i=e.property;if(t instanceof oe.Node){if(t.isSizeChangedProperty(i)||i===oe.Styles.MaterailType||i===oe.Styles.NormalType){if(t instanceof oe.Line){t.verticesNeedUpdate=!0;n=this.lineMap[t._id];this.initLineBuffers(t),ve.buildLineBufferData(t,this._gl.DYNAMIC_DRAW,this._gl,n)}else if(t.groups){t.verticesNeedUpdate=!0,i!==oe.Styles.MaterailType&&i!==oe.Styles.NormalType||(t.normalsNeedUpdate=!0);for(var r in t.groups){var a=t.groups[r],n=this.groupMap[a.id],o=ve.getMaterial(t,a.materialIndex);t.normalsNeedUpdate&&this.initGroupBuffer(t,a,n,!0),ve.buildGroupBufferData(a,t,this._gl.DYNAMIC_DRAW,!t.dynamic,o,this._gl,n,this)}}}else if("materialMapping"===i)this._currentGroupHash=null,this.removeNode(t,this.glNodeList),this.addNode(t,this.glNodeList);else if("alarmBillboard"===i){var s=e.oldValue,l=e.newValue;this._addNodeAlarmBillboard(t,s,l)}this.addNodeMaterials(t)}else if(t instanceof oe.Light)this.pm._lightNeedsUpdate=!0;else if(t instanceof oe.BufferNode&&"alarmBillboard"===i){var s=e.oldValue,l=e.newValue;this._addNodeAlarmBillboard(t,s,l)}(t.isSizeChangedProperty&&t.isSizeChangedProperty(i)||"parent"==i||t.isSpaceChangedProperty(i))&&(this.deleteCloneNode(t),this.boundingBox=null),this.shadowMapRenderer&&this.shadowMapRenderer.handleDataPropertyChange(e),this.dirtyNetwork()},deleteCloneNode:function(e){if(e){var t=e.getId?e.getId():e,i=this.normalNodeMap[t];if(null!=i){i.setParent(null);for(var r in i.groups){var a=i.groups[r];delete this.groupMap[a.id]}}delete this.normalNodeMap[t]}else for(var t in this.normalNodeMap)this.deleteCloneNode(t)},setBlurAmount:function(e){this._blurAmount=e},setBlurScale:function(e){this._blurScale=e},setBlurStrength:function(e){this._blurStrength=e},setBlurGlobalAlpha:function(e){this._blurGlobalAlpha=e},dirtyNetwork:function(e){this.dataBox.batch||(this._dirty=!0)},dirtyShadowMap:function(e){this.shadowMapRenderer&&this.shadowMapRenderer.dirtyShadowMap()},_addNodeAlarmBillboard:function(e,i,r){if(r===t&&(r=e._alarmBillboard),null!=i&&-1!==this.alarmBillboards.indexOf(i)){var a=this.alarmBillboards.indexOf(i);this.alarmBillboards.splice(a,1),i.removePropertyChangeListener(this.dirtyNetwork,this)}r&&-1===this.alarmBillboards.indexOf(r)&&(this.alarmBillboards.push(r),r.addPropertyChangeListener(this.dirtyNetwork,this))},initWebGLNodes:function(e,t){var i,r,a=e.getNodes();for(i=0,r=a.size();i<r;i++){var n=a.get(i);n.renderSelected=!1,this.addWebGLNode(t,n)}for(i=0,r=t.length;i<r;i++)this.updateWebGLNode(t[i])},updateWebGLNode:function(e){var t,i,r=e.node;if(r instanceof oe.Entity){for(var a in r.groups)if(t=r.groups[a],i=ve.getMaterial(r,t.materialIndex),r.buffersNeedUpdate){n=this.groupMap[t.id];this.initGroupBuffer(r,t,n),ve.buildGroupBufferData(t,r,this._gl.DYNAMIC_DRAW,!r.dynamic,i,this._gl,n,this)}r.setUpdateFlags(!1),r.buffersNeedUpdate=!1}else if(r instanceof oe.BufferNode)this.setBufferNodeData(r,this._gl.DYNAMIC_DRAW,!r.dynamic);else if(r instanceof oe.Line){n=this.lineMap[r._id];ve.buildLineBufferData(r,this._gl.DYNAMIC_DRAW,this._gl,n)}else if(r instanceof oe.Particle){var n=this.particleMap[r._id];Ae(r,this._gl.DYNAMIC_DRAW,this._gl,n,this)}},addWebGLNode:function(e,i){var r,a,n,o,s=[];if(this._addNodeAlarmBillboard(i),i._modelViewMatrix=new ue,i._normalMatrix=new ce,i instanceof oe.Entity){i.groups==t&&ye(i,this.gpu.elementIndexUIntSupported);for(r in i.groups){(a=i.groups[r]).id=a.id===t?oe.Network3D.GroupCache._groupCounter++:a.id;var l=this.groupCountMap[a.id]||0;l++,this.groupCountMap[a.id]=l,this.groupMap[a.id]===t&&(this.groupMap[a.id]={}),(h=this.groupMap[a.id])._nodeId=i.getId(),h.__webglVertexBuffer||(this.createGroupBuffer(a,h),this.initGroupBuffer(i,a,h),i.setUpdateFlags(!0))}}else if(i instanceof oe.Line)null==this.lineMap[i._id]&&(this.lineMap[i._id]={}),(h=this.lineMap[i._id])._nodeId=i.getId(),h.__webglVertexBuffer||(this.createLineBuffers(i),this.initLineBuffers(i),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0);else if(i instanceof oe.Particle){null==this.particleMap[i._id]&&(this.particleMap[i._id]={});var h=this.particleMap[i._id];h._nodeId=i.getId(),h.__webglVertexBuffer||(this.createParticleBuffers(i),this.initParticleBuffers(i),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0)}else i instanceof oe.BufferNode?this.initBufferNode(i):i instanceof oe.Annotation&&this._createAnnotationDiv(i);if(i instanceof oe.Entity){for(r in i.groups)o={group:a=i.groups[r],node:i,opaque:(n=ve.getMaterial(i,a.materialIndex)).transparent?null:n,transparent:n.transparent?n:null},e.push(o),s.push(o);i.groups}else i instanceof oe.Line||i instanceof oe.LensFlare?(o={group:i,node:i,opaque:(n=i.material).transparent?null:n,transparent:n.transparent?n:null},e.push(o),s.push(o)):i instanceof oe.Particle?(o={group:i,node:i,opaque:(n=i.material).transparent?null:n,transparent:n.transparent?n:null},e.push(o),s.push(o)):i instanceof oe.BufferNode&&(o={group:i,node:i,opaque:(n=i.material instanceof oe.ArrayMaterial?i.material.materials[0]:i.material).transparent?null:n,transparent:n.transparent?n:null},e.push(o),s.push(o));return i.glActive=!0,s},onElementDispose:function(e){var t=e.target;t.removeEventListener("dispose",this.onElementDispose),this.deallocateElement(t),this.info.memory.geometries--},deallocateElement:function(e){},_AK47:function(e,i,r,a,n,o){this._fog;e.parent===t&&e.updateWorldMatrix(!0,!1),!this._isPresenting&&e.worldMatrixInverse.getInverse(e.worldMatrix),this._projScreenMatrix.multiply(e.projectionMatrix,e.worldMatrixInverse),this._frustum.setFromMatrix(this._projScreenMatrix),0===r.length&&(this.initWebGLNodes(i,r),this.prepareData());var s,l,h,c;if(!o)for(s=0,l=r.length;s<l;s++)(c=(h=r[s]).node).renderSelected=!1,h.render=!1,this.isVisible(c)&&(this.unrollBufferMaterial(h),this.setupMatrices(c,e),(c instanceof oe.Entity||c instanceof oe.Particle)&&c.frustumCulled&&!this._frustum.intersectsObject(c)||(h.render=!0,this.sortNodes&&(c.worldMatrix.getPosition(this._vector3),this._vector3.applyProjection(this._projScreenMatrix),null!=c.renderDepth?h.z=c.renderDepth+this._vector3.z:h.z=this._vector3.z)));var u=new _e;if(u.addAll(a),!n&&!o){for(var f=this.alarmBillboards.length-1;f>=0;f--)null==this.alarmBillboards[f].getParent()&&this.alarmBillboards.splice(f,1);u.addAll(this.alarmBillboards)}var p=this;!o&&u.forEach(function(e){e.renderDepth?e.z=e.renderDepth:(e.worldMatrix.getPosition(p._vector3),p._vector3.applyProjection(p._projScreenMatrix),e.z=p._vector3.z)}),u.size()>0&&!o&&null==this.billboardRenderer&&(this.billboardRenderer=new oe.BillboardRenderer),i.getLensFlares().size()>0&&!o&&null==this.flareRenderer&&(this.flareRenderer=new oe.FlareRenderer);var d=[].concat(r).concat(u._as),m=this.sortNodesFunc(d);this.setBlending(oe.NoBlending),this.renderNodes(m,!1,"opaque",e,i.getLights(),!1,null,o,this.sortOpaqueOrderByMaterial),this.renderNodes(m,!0,"transparent",e,i.getLights(),!0,null,o),this.setDepthTest(!0),this.setDepthWrite(!0)},unrollBufferMaterial:function(e){var t,i,r,a=e.node,n=e.group;(r=a.material)instanceof oe.ArrayMaterial?(i=n.materialIndex||0,(t=r.materials[i]).transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=r)&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null))},renderLicense:function(){},isShadowable:function(){return this.isShadowMapEnable()&&(this.maxShadows>0||this.maxPointShadows>0)},_handleAnimation:function(e){var t=this;t._animations.length&&(e=e||0,t._animations.forEach(function(t){t._animation.channels.forEach(function(t){var i,r,a,n,o=t.sampler.input,s=t.sampler.splitOutput||t.sampler.output,l=e/1e3%o[o.length-1];o.some(function(e,t){return 0!==t&&e>l&&(i=o[t-1],r=e,a=s[t-1],n=s[t],!0)});var h=(l-i)/(r-i),c=t.node,u=c._info;if("rotation"===t.path)se.Quat.slerp(a,n,u.rotation,h);else if("translation"===t.path)u.translation.lerpVectors(a,n,h);else if("scale"===t.path)u.scale.lerpVectors(a,n,h);else if("weights"===t.path)for(var f=1-h,p=u.weights,d=0;d<a.length;d++)p[d]=f*a[d]+h*n[d];"weights"!==t.path&&(c.matrix.fromRotationTranslationScale(u.rotation||Je,u.translation||Qe,u.scale||Ke),c.setMatrix(c.matrix))})}),t.dataBox._nodeList.forEach(function(e){e._skin&&e._skin.update()}),t._dirty=!0)},render:function(e){if(this._dirty&&(this.resetRenderInfo(),this._dirty=!1,this._handleAnimation(e),null!=this.beforeRenderFunction&&this.beforeRenderFunction.call(this),!this.isShadowable()||(this.shadowMapRender(),this.setRenderTarget(t),!this.debugPointLight))){if(dt.twm(this),this.paintBottom(this._bottomCanvas),this.getShowFps()&&(this.__time=(new Date).getTime()),this.innerRender(this._camera,!0),this.renderAnnotations(this._camera),this.extendRender(this._camera),this.paintTopCanvas(),this.getShowFps()){this._tpf=(new Date).getTime()-this.__time;var i=this._topCanvas.getContext("2d"),r=(1e3/this._tpf).toFixed(0);r>500&&(r="> 500");l="FPS:"+r+",TPF:"+this._tpf+" ms";i.font="20px Arial sans-serif",i.fontWeight="bold",i.lineWith=2,i.fillStyle="rgba(0, 0, 0, 1)",i.fillText(l,10,25)}if(this._xyz!=t){var a,n=this._xyz,o=n.markText,s=n.type,l=(n.expired,n.innerHTML),h=0,c=0,i=(this._topCanvas.getBoundingClientRect(),this._topCanvas.getContext("2d"));o!=t&&null!=o&&""!=o||"2"==s?(i.font="24px Arial sans-serif",a=ge.getTextSize(i.font,l),i.fillStyle="red",h=this._canvas.width-a.width-20,c=this._canvas.height-a.height-10):(i.font="15px Arial sans-serif",i.fillStyle="rgba(240, 120, 25, 0.6)",a=ge.getTextSize(i.font,l),h=this._canvas.width-a.width-20,c=this._canvas.height-a.height-10),i.fillText(l,h,c)}null!=this.renderCallback&&this.renderCallback.call(this)}},getTextSize:function(e,t){return ge.getTextSize(e,t)},shadowMapRender:function(){null==this.shadowMapRenderer&&(this.shadowMapRenderer=new bt,this.shadowMapRenderer.init(this)),0===this.glNodeList.length&&(this.initWebGLNodes(this.dataBox,this.glNodeList),this.prepareData()),this.shadowMapRenderer.render(this.dataBox,this._camera)},handleMouseDown:function(e){var t=e.target;this.lastX=e.clientX,this.lastY=e.clientY,"tgl_annotation"==t.getAttribute("class")&&"1"==t.style.opacity&&(e.stop=!0,e.stopPropagation())},handleClick:function(e){var t=e.clientX-this.lastX,i=e.clientY-this.lastY;if(Math.abs(t)<.1&&Math.abs(i)<.1){var r=e.target;if("tgl_annotation"!=r.getAttribute("clazz"))this._activeAnnotation&&(this._activeAnnotation=null,this.dirtyNetwork());else if("1"==r.style.opacity){var a=r.getAttribute("id"),n=this.getDataBox().getDataById(a),o=this._annotationMap[a];this.handleDefaultAnnotationClick(n,o),this.handleAnnotationClick(n,o),this.dirtyNetwork()}}},handleDefaultAnnotationClick:function(e,t){this._activeAnnotation==e||(this._activeAnnotation=e)},handleAnnotationClick:function(e,t){},renderAnnotations:function(e){var t=this.dataBox.getAnnotations(),i=this;if(t&&(t.forEach(function(t){i.renderAnnotation(e,t)}),this._createAnnotationStyle()),this._activeAnnotation){this._createAnnotationToolTipDiv();var r=this._annotationToolTipDiv;r.innerHTML=this._activeAnnotation.getText();var a=this._annotationMap[this._activeAnnotation.getId()];r.parentNode!=a&&a.appendChild(r),r.style.opacity=a.style.opacity}},getAnnotationDiv:function(e){return this._annotationMap[e.getId()]},renderAnnotation:function(e,t){var i=this._annotationMap[t.getId()];null==i&&(i=this._createAnnotationDiv(t)),i.innerHTML=t._label,t.updateWorldMatrix();var r=t.worldMatrix.getPosition(),a=t.getStyle("annotation.class");i.setAttribute("class",a);var n=this.getViewPosition(r);this._annotationToolTipDiv;i.style.left=n.x+"px",i.style.top=n.y+"px",i.style.opacity="1";var o=r.distanceTo(e.getPosition()),s=this.getElementByScreenPoint(n,!1);s&&s.length>0&&s[0].distance<o&&(i.style.opacity="0.03")},_addCSSRule:function(e,t,i,r){r=r||(e.cssRules||e.rules).length,e.insertRule?e.insertRule(t+"{"+i+"}",r):e.addRule&&e.addRule(t,i,r)},_createAnnotationStyle:function(){if(!this._annotationStyle){var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e);var t=e.sheet;this._addCSSRule(t,".tgl_annotation","position:absolute;width:16px;height:16px;border-radius:10px;text-align:center;border : 2px solid gray;"),this._addCSSRule(t,".tgl_annotation:hover","border : 2px solid black;"),this._annotationStyle=e}},_removeAnnotationDiv:function(e){var t=e.getId?e.getId():e,i=this._annotationMap[t];null!=i&&this.getRootView().removeChild(i)},_createAnnotationDiv:function(e){var t=document.createElement("div"),i=e.getStyle("annotation.class");return t.setAttribute("id",e.getId()),t.setAttribute("class",i),t.setAttribute("clazz","tgl_annotation"),this._annotationMap[e.getId()]=t,this.getRootView().appendChild(t),t},_createAnnotationToolTipDiv:function(){if(null==this._annotationToolTipDiv){var e=document.createElement("div");e.setAttribute("class","tgl_annotation_tooltip");var t=document.createElement("style");t.appendChild(document.createTextNode("")),document.head.appendChild(t);var i=t.sheet,r="position: absolute;border: 3px solid #333; background-color: #ccd; padding: 3px;text-align: left;width: 220px;height: 'auto';border-radius: 10px;bottom:35px;left:-13px;";this._addCSSRule(i,".tgl_annotation_tooltip",r),r="content: ' ';position: absolute;top: 100%; border: 1px solid;",this._addCSSRule(i,".tgl_annotation_tooltip:after, .tgl_annotation_tooltip:before",r),r="border-color: #333 transparent transparent transparent;border-width: 16px 17px 0 7px;left: 10px;",this._addCSSRule(i,".tgl_annotation_tooltip:before",r),r="border-color: #ccd transparent transparent transparent;border-width: 12px 11px 0 4px;left: 14px;",this._addCSSRule(i,".tgl_annotation_tooltip:after",r),this._annotationToolTipDiv=e}},extendRender:function(e){},innerRender:function(e,i){if(e===t&&(e=this._camera),null!==e){if(this.debug&&console.log("inner Render"),(!this._vrDisplay||!this._vrDisplay.isPresenting)&&this.autoClear){var r=this._clearColor;this._gl.clearColor(r.r,r.g,r.b,this._clearAlpha),We.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil,this)}if(i)for(var a=0;a<this._interactions.length;a++){var n=this._interactions[a];n.update&&n.update()}if(this.billboardRenderer&&this.billboardRenderer.disable(),this.flareRenderer&&this.flareRenderer.disable(),this._vrDisplay||this._gl.viewport(0,0,this._canvas.width,this._canvas.height),this._sSAOEnable){this.linearDepth=e.far-e.near,this.ssaoing=!0,this._renderDeferredTarget(e,this.deferredPostionMaterial,this.deferredPostionTarget),this._renderDeferredTarget(e,this.deferredNormalMaterial,this.deferredNormalTarget),this._setSSAOMaterial(),this._overloadMaterial=null,this._renderSurface(e,this.ssaoTarget,this.ssaoMaterial);u=this._canvas.width/this._canvas.height;this._ssaoBlur?(this._renderBlurTarget(e,this._blurMaterialH,this.ssaoTarget,this.ssaoTarget1,u),this._renderBlurTarget(e,this._blurMaterialV,this.ssaoTarget1,this.ssaoTarget2,u),this.finalSSAOTarget=this.ssaoTarget2):this.finalSSAOTarget=this.ssaoTarget,this.setRenderTarget(t),this.ssaoing=!1}if(this.renderOutline=!1,this.renderOutlineGlow=!1,We.enableStencil(this._gl,this),this._baseRender=!0,We.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards()),this._baseRender=!1,We.stencilTest(this._gl,this),this.renderOutline&&We.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"stencil"),this.renderOutlineGlow){var o=this._glowSurface.target,s=this._glowSurface.target1,l=this._glowSurface.target2;We.disableStencil(this._gl),this.setRenderTarget(o),o._id=o._id||(new Date).getTime()+"0",s._id=s._id||(new Date).getTime()+"1",l._id=l._id||(new Date).getTime()+"2",this._gl.viewport(0,0,o.width,o.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.colorMask(!1,!1,!1,!1),We.r(this,e,this.dataBox,this.glNodeList,[],!1,"glow.unselect"),this._gl.colorMask(!0,!0,!0,!0),We.r(this,e,this.dataBox,this.glNodeList,[],!1,"glow.select");var h,c;this.setRenderTarget(s),this._gl.viewport(0,0,s.width,s.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(o);u=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new le(o.width,o.height/u),this._blurMaterialH.blurAmount=this._blurAmount||5,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=1;for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._blurMaterialH,c,this._glowSurface2);this.setRenderTarget(l),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(s),this._blurMaterialV.texelSize=new le(s.width,s.height/u),this._blurMaterialV.blurAmount=this._blurAmount||5,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=0;for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._blurMaterialV,c,this._glowSurface2);this.setRenderTarget(t),this._glowSurface._modelViewMatrix=new ue,this._glowSurface._normalMatrix=new ce,this.setupMatrices(this._glowSurface,e),this._glowSurfaceMaterial.setMap(l),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,We.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._glowSurfaceMaterial,c,this._glowSurface);this.setRenderTarget(s),this._gl.viewport(0,0,s.width,s.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(o);var u=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new le(o.width,o.height/u),this._blurMaterialH.blurAmount=this._blurAmount||10,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=0;for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._blurMaterialH,c,this._glowSurface2);this.setRenderTarget(l),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(s),this._blurMaterialV.texelSize=new le(s.width,s.height/u),this._blurMaterialV.blurAmount=this._blurAmount||10,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=1;for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._blurMaterialV,c,this._glowSurface2);this.setRenderTarget(t),this._glowSurface._modelViewMatrix=new ue,this._glowSurface._normalMatrix=new ce,this.setupMatrices(this._glowSurface,e),this._glowSurfaceMaterial.setMap(l),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,We.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._glowSurfaceMaterial,c,this._glowSurface);this._gl.clearColor(0,0,0,0)}We.disableStencil(this._gl),this.renderHelper(e)}else console.log(" no camera")},_renderDeferredTarget:function(e,t,i,r){r=r||new oe.Vec4(0,0,0,0,0),t.linearDepth=this.linearDepth,this.setRenderTarget(i),this._overloadMaterial=t,this._gl.clearColor(r.x,r.y,r.z,r.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),We.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards())},_renderBlurTarget:function(e,t,i,r,a){this.setRenderTarget(r),this._gl.viewport(0,0,r.width,r.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),t.setMap(i),t.texelSize=new le(i.width,i.height/a),t.blurAmount=this._blurAmount||5,t.blurScale=this._blurScale||1,t.blurStrength=this._blurStrength||1;var n,o;for(n in this._glowSurface.groups)o=this._glowSurface.groups[n],this.renderGroup(e,[],t,o,this._glowSurface2)},_setSSAOMaterial:function(){this.ssaoMaterial.map=this.deferredPostionTarget,this.ssaoMaterial.map1=this.deferredNormalTarget,this.ssaoMaterial.attenuation=this._attenuation||new le(1,.02),this.ssaoMaterial.occluderBias=this._occluderBias||.5,this.ssaoMaterial.samplingRadius=this._samplingRadius||20,this.ssaoMaterial.texelSize=new le(1/this.deferredPostionTarget.width,1/this.deferredPostionTarget.height)},_renderSurface:function(e,t,i,r){r=r||new oe.Vec4(1,1,1,1),this.setRenderTarget(t),this._gl.clearColor(r.x,r.y,r.z,r.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._glowSurface._modelViewMatrix=new ue,this._glowSurface._normalMatrix=new ce,this.setupMatrices(this._glowSurface,e);var a,n;for(n in this._glowSurface.groups)a=this._glowSurface.groups[n],this.renderGroup(e,[],i,a,this._glowSurface)},renderHelper:function(e){We.r(this,e,this.helperBox,this.helperGLNodeList,this.helperBox.getBillboards(),"stencil")},initSurfaceGroup:function(){this._glowSurface.setUpdateFlags(!0),ye(this._glowSurface,this.gpu.elementIndexUIntSupported);for(var e in this._glowSurface.groups){(i=this._glowSurface.groups[e]).id=i.id===t?oe.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===t&&(this.groupMap[i.id]={});r=this.groupMap[i.id];this.createGroupBuffer(i,r),this.initGroupBuffer(this._glowSurface,i,r),ve.buildGroupBufferData(i,this._glowSurface,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,r,this)}this._glowSurface2.setUpdateFlags(!0),ye(this._glowSurface2,this.gpu.elementIndexUIntSupported);for(var e in this._glowSurface2.groups){var i=this._glowSurface2.groups[e];i.id=i.id===t?oe.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===t&&(this.groupMap[i.id]={});var r=this.groupMap[i.id];this.createGroupBuffer(i,r),this.initGroupBuffer(this._glowSurface2,i,r),ve.buildGroupBufferData(i,this._glowSurface2,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,r,this)}},getOutlineMaterial:function(e,t){var i=(t.getStyle("select.width")||1)+1+" "+new oe.Color(t.getStyle("select.color")).getUniqueCode()+e,r=this.outlineMaterialMap[i];return null==r&&(r=new oe.EntityMaterial,"outline.normal"==e?(r._type="outline",r.outline=t.getStyle("select.width")||1):"outline.glow"==e?r._type="basic":(r.wireframe=!0,r.wireframeLinewidth=(t.getStyle("select.width")||1)+1),r.color=new oe.Color(t.getStyle("select.color")),this.outlineMaterialMap[i]=r),r},renderNodes:function(e,t,i,r,a,n,o,s,l){if("glow.unselect"!==s||!n){var h,c,u,f,p,d,m;t?(p=e.length-1,d=-1,m=-1):(p=0,d=e.length,m=1);for(var g=p;g!==d;g+=m)if(h=e[g],f=h.node?h.transparent||h.opaque:h.material){this._overloadMaterial&&(f=this._overloadMaterial);var v=this.getOverLoadMaterial(h.node?h.node:h,f);if(v&&v!==f){var y=v.getUniqueCode(),A=_t.getMaterial(y);A?f=A:(_t.setMaterial(y,v),f=v)}if(!("opaque"==i&&1==f.transparent||"transparent"==i&&0==f.transparent)){if(n?(We.setBlending(f.blendMode,f.blendEquation,f.blendSrc,f.blendDst,this),We.setDepthWrite(!1,this)):We.setDepthWrite(f.depthMask,this),h instanceof oe.Billboard)i==(h.material.transparent?"transparent":"opaque")&&this.billboardRenderer.render(this,[h],r,2*this._canvas.width,2*this._canvas.height,v);else if(h.render){if(this.billboardRenderer&&this.billboardRenderer.disable(),this.flareRenderer&&this.flareRenderer.disable(),c=h.node,u=h.group,We.setDepthTest(f.depthTest,this),We.setPolygonOffset(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits,this),this.setGLFaces(f),c instanceof oe.Particle){if(c.verticesNeedUpdate||c.colorsNeedUpdate||c.sortParticles){var x=this.particleMap[c._id];Ae(c,this._gl.DYNAMIC_DRAW,this._gl,x,this)}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1}var _=this.getSelectStyle(c);if("outline"==_&&(_="outline.normal"),s?"glow.unselect"===s&&(c.isSelected()||(c instanceof oe.BufferNode?this.renderBufferNode(r,a,f,u,c):We.g(this,r,a,f,u,c))):(!c.isSelected()||"outline.normal"!==_&&"outline.wireframe"!==_&&"outline.glow"!==_?this.setStencilTest(!1):(this.setStencilTest(!0),"outline.glow"===_?this.renderOutlineGlow=!0:this.renderOutline=!0),this._setStencilMask(this._oldStencilTest?1:0),c instanceof oe.BufferNode?this.renderBufferNode(r,a,f,u,c):We.g(this,r,a,f,u,c)),c.isSelected()&&this.renderSelect(c))if("outline.normal"===_||"outline.wireframe"===_||"outline.glow"===_){if(null!=s&&"glow.unselect"!=s)if("outline.normal"===_){if(!1===c.renderSelected){M=this.getOutlineMaterial(_,c);if(c instanceof oe.BufferNode)this.renderBufferNode(r,a,M,c,c);else{if(null==(w=this.normalNodeMap[c.getId()])){var w=this.cloneNode(c,M);this.normalNodeMap[c.getId()]=w}this.setupMatrices(w,r);for(var b in w.groups)We.g(this,r,a,M,w.groups[b],w)}c.renderSelected=!0}}else if("outline.normal"!==_){var M=this.getOutlineMaterial(_,c);c instanceof oe.BufferNode?this.renderBufferNode(r,a,M,c,c):We.g(this,r,a,M,u,c)}}else!1===c.renderSelected&&(this.renderNodeSelection(r,a,c),c.renderSelected=!0);c instanceof oe.LensFlare&&this.flareRenderer&&this.flareRenderer.render(this,[h],r,2*this._canvas.width,2*this._canvas.height),c.getAlarmState().getPropagateSeverity()&&this.renderAlarmBorder(c)&&this.renderNodeAlarm(r,a,c)}c&&c.setUpdateFlags&&c.setUpdateFlags(!1)}}}},cloneNode:function(e,t){var i,r,a=new oe.Entity,n={vertices:[],uvs:[],faces:[]};for(i=0,r=e.vertices.length;i<r;i++)n.vertices.push(e.vertices[i].clone());for(i=0,r=e.faces.length;i<r;i++)n.faces.push(e.faces[i].clone());for(i=0,r=e.uvs.lenght;i<r;i++){for(var o=e.uvs[i],s=[],l=0;l<o;l++)s.push(o[l].clone());n.uvs.push(s)}return oe.Node.prototype.mergeVertices.call(n),oe.Node.prototype.computeFaceNormals.call(n),oe.Node.prototype.computeVertexNormals.call(n,!0),a.setPosition(e.getPosition()),a.setScale(e.getScale()),a.setRotation(e.getRotation()),a.setParent(e.getParent()),a._modelViewMatrix=new ue,a._normalMatrix=new ce,a.data=n,a.vertices=n.vertices,a.uvs=n.uvs,a.faces=n.faces,a.material=t,a.primitive=new oe.Primitive(n),a.setUpdateFlags(!0),ye(a,this.gpu.elementIndexUIntSupported),this.buildNodeBufferData(a),a},buildNodeBufferData:function(e){for(var i in e.groups){var r=e.groups[i];r.id=r.id===t?oe.Network3D.GroupCache._groupCounter++:r.id,this.groupMap[r.id]===t&&(this.groupMap[r.id]={});var a=this.groupMap[r.id];this.createGroupBuffer(r,a),this.initGroupBuffer(e,r,a),ve.buildGroupBufferData(r,e,this._gl.DYNAMIC_DRAW,!1,e.material,this._gl,a,this)}},needSmoothNormal:function(e,i){var r=i.normalType;return r!=t?r===oe.NormalTypeSmooth:!!this.needSmoothNormalFunction&&this.needSmoothNormalFunction(e)},renderNodeSelection:function(e,i,r){r.createSelectionCube(this.selectionCube),this.setupMatrices(this.selectionCube,e);var a=this.selectionCube.groups;this.selectionCube.material.needsUpdate=!0;for(var n in a){var o=a[n];o.id=o.id===t?oe.Network3D.GroupCache._groupCounter++:o.id,this.groupMap[o.id]===t&&(this.groupMap[o.id]={});var s=this.groupMap[o.id];s.__webglVertexBuffer||(this.createGroupBuffer(o,s),this.initGroupBuffer(this.selectionCube,o,s)),this.selectionCube.setUpdateFlags(!0),ve.buildGroupBufferData(o,this.selectionCube,this._gl.DYNAMIC_DRAW,!1,this.selectionCube.material,this._gl,s,this),this.renderGroup(e,[],this.selectionCube.material,o,this.selectionCube)}},renderNodeAlarm:function(e,i,r){r.createPropagateAlarmCube(this.alarmCube),this.setupMatrices(this.alarmCube,e);var a=this.alarmCube.groups;this.alarmCube.material.needsUpdate=!0;for(var n in a){var o=a[n];o.id=o.id===t?oe.Network3D.GroupCache._groupCounter++:o.id,this.groupMap[o.id]===t&&(this.groupMap[o.id]={});var s=this.groupMap[o.id];s.__webglVertexBuffer||(this.createGroupBuffer(o,s),this.initGroupBuffer(this.alarmCube,o,s)),this.alarmCube.setUpdateFlags(!0),ve.buildGroupBufferData(o,this.alarmCube,this._gl.DYNAMIC_DRAW,!1,this.alarmCube.material,this._gl,s,this),this.renderGroup(e,[],this.alarmCube.material,o,this.alarmCube)}},renderBufferNode:function(e,t,i,r,a,n){if(!1!==i.visible&&a.computed){var o,s,l=this;o=this.pm.setProgram(e,t,this._fog,i,r,a),s=o.attributes;var h=a,c=!1,u=i.wireframe?1:0,f=16777215*r.attributes.id+2*o.id+u;(f!==this._currentGroupHash||n)&&(this._currentGroupHash=f,c=!0),c&&this.disableAttributes();var p=this._gl,d=h.attributes.index,m=this.bufferNodeMap[a.attributes.id];if(d)c&&(Object.keys(h.attributes).forEach(function(e){if("index"!==e&&"id"!==e){var t=o.attributeSizes[e];if(t){var i=h.attributes[e];p.bindBuffer(p.ARRAY_BUFFER,m[e]),l.enableAttribute(s[e]),p.vertexAttribPointer(s[e],t,i.type||p.FLOAT,!1,i.stride||0,0)}}}),a._info&&a._info.weights&&p.uniform1fv(o.uniforms.morphTargetInfluences,a._info.weights),a._skin&&p.uniformMatrix4fv(o.uniforms.boneGlobalMatrices,!1,a._skin.jointMatrix),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,m.index)),p.drawElements(p[a.mode],d.array.length,d.element_type,0),this.info.render.calls++,this.info.render.vertices+=d.array.length,this.info.render.faces+=d.array.length/3;else{c&&Object.keys(h.attributes).forEach(function(e){if("index"!==e&&"id"!==e){var t=o.attributeSizes[e];if(t){var i=h.attributes[e];p.bindBuffer(p.ARRAY_BUFFER,m[e]),l.enableAttribute(s[e]),p.vertexAttribPointer(s[e],t,i.type||p.FLOAT,!1,i.stride||0,0)}}});var g=h.attributes.position;p.drawArrays(p[a.mode],0,g.array.length/3),this.info.render.calls++,this.info.render.vertices+=g.array.length/3,this.info.render.faces+=g.array.length/3/3}}},getOverLoadMaterial:function(e,t){return null},renderGroup:function(e,t,i,r,a){if(null==i&&console.log("material is null"),!1!==i.visible){var n,o=this._gl;if(a instanceof oe.Entity?n=this.groupMap[r.id]:a instanceof oe.Line?n=this.lineMap[r._id]:a instanceof oe.Particle&&(n=this.particleMap[r._id]),null!=n){var s,l,h,c,u,f;if(s=this.pm.setProgram(e,t,this._fog,i,r,a)){l=s.attributes;var p,d=!1,m=i.wireframe?1:0;if((p=null!=r.id?16777215*r.id+2*s.id+m:r._id+""+(2*s.id+m))!==this._currentGroupHash&&(this._currentGroupHash=p,d=!0),d&&this.disableAttributes(),d&&(n._vao&&n._vao.bind(),!n._vao||n._vao.dirty)){if(l.position>=0&&d&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglVertexBuffer),this.enableAttribute(l.position),o.vertexAttribPointer(l.position,3,o.FLOAT,!1,0,0)),n.__webglCustomAttributesList)for(u=0,f=n.__webglCustomAttributesList.length;u<f;u++)l[(c=n.__webglCustomAttributesList[u]).buffer.belongsToAttribute]>=0&&(o.bindBuffer(o.ARRAY_BUFFER,c.buffer),this.enableAttribute(l[c.buffer.belongsToAttribute]),o.vertexAttribPointer(l[c.buffer.belongsToAttribute],c.size,o.FLOAT,!1,0,0));l.color>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglColorBuffer),this.enableAttribute(l.color),o.vertexAttribPointer(l.color,3,o.FLOAT,!1,0,0)),l.normal>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglNormalBuffer),this.enableAttribute(l.normal),o.vertexAttribPointer(l.normal,3,o.FLOAT,!1,0,0)),l.uv>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglUVBuffer),this.enableAttribute(l.uv),o.vertexAttribPointer(l.uv,2,o.FLOAT,!1,0,0)),l.uv2>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglUV2Buffer),this.enableAttribute(l.uv2),o.vertexAttribPointer(l.uv2,2,o.FLOAT,!1,0,0)),l.lineDistance>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglLineDistanceBuffer),this.enableAttribute(l.lineDistance),o.vertexAttribPointer(l.lineDistance,1,o.FLOAT,!1,0,0)),n._vao&&(n._vao.dirty=!1)}if(a instanceof oe.Entity){var g=n.elementIndexUInt?o.UNSIGNED_INT:o.UNSIGNED_SHORT;i.wireframe?(this.setLineWidth(i.wireframeLinewidth),this._gl.lineJoin="round",d&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),o.drawElements(o.LINES,n.__webglLineCount,g,0)):(d&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),o.drawElements(o.TRIANGLES,n.__webglFaceCount,g,0)),this.info.render.calls++,this.info.render.vertices+=n.__webglFaceCount,this.info.render.faces+=n.__webglFaceCount/3}else a instanceof oe.Line?(h=a.type===oe.LineStrip?o.LINE_STRIP:o.LINES,this.setLineWidth(i.linewidth),o.drawArrays(h,0,n.__webglLineCount),this.info.render.calls++):a instanceof oe.Particle?(o.drawArrays(o.POINTS,0,n.__webglParticleCount),this.info.render.calls++,this.info.render.points+=n.__webglParticleCount):a instanceof oe.Ribbon&&(o.drawArrays(o.TRIANGLE_STRIP,0,r.__webglVertexCount),this.info.render.calls++);n._vao&&n._vao.unbind()}}else this.debug&&console.error("tempGroup for id:"+(r.id||r._id)+" is null,please check")}},prepareData:function(){this.maxLightCount=this.dataBox.allocateLights(this._maxLights),this.maxShadows=this.dataBox.allocateShadows(),this.maxPointShadows=this.dataBox.allocatePointShadows()},wrapBillboardMaterial:function(e){e instanceof oe.Billboard&&e.material&&(e.opaque=e.material.transparent?null:e.material,e.transparent=e.material.transparent?e.material:null)},sortNodesFunc:function(e){if(this.sortNodes&&(null!==this.paintSortFunction||this.sortOpaqueOrderByMaterial)){var t=this;this.sortOpaqueOrderByMaterial?null==this.__st&&(this.__st=function(e,i){t.wrapBillboardMaterial(e),t.wrapBillboardMaterial(e);if(e.opaque&&i.opaque)return e.opaque.id-i.opaque.id;if(!e.opaque&&i.opaque)return-1;if(e.opaque&&!i.opaque)return 1;if(e.transparent&&i.transparent)return e.transparent.id-i.transparent.id;var r=e.node?e.node:e,a=i.node?i.node:i;return r.z=e.z,a.z=i.z,t.paintSortFunction?t.paintSortFunction(r,a):void 0}):null==this.__st&&(this.__st=function(e,i){if(e.transparent||i.transparent)return e.transparent&&i.transparent?e.transparent.id-i.transparent.id:e.transparent?-1:1;var r=e.node?e.node:e,a=i.node?i.node:i;return r.z=e.z,a.z=i.z,t.paintSortFunction?t.paintSortFunction(r,a):void 0}),e.sort(this.__st)}return e},paintTopCanvas:function(){var e=this._topCanvas.getContext("2d");e.clearRect(0,0,this._topCanvas.width,this._topCanvas.height);var t=this.areaPickingRect;t&&(e.beginPath(),e.lineStyle="#FFffff",e.rect(t.x,t.y,t.w,t.h),e.stroke()),this.renderLicense()},setBackgroundImage:function(e){if("string"==typeof e){var t=new Image;e.startsWith("data:image")||(t.crossOrigin="use-credentials"),t.src=e,this._backgroundImage=t;var i=this;t.onload=function(){i.dirtyNetwork()}}else this._backgroundImage=e,this.dirtyNetwork()},paintBottom:function(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var i=this._backgroundImage;i instanceof Image&&i.height&&t.drawImage(i,0,0,e.width,e.height)},initBufferNode:function(e){if(null==e.attributes.id&&(e.attributes.id=oe.Network3D.GroupCache._groupCounter++),!this.bufferNodeMap[e.attributes.id]){var t={};this.bufferNodeMap[e.attributes.id]=t;var i,r,a,n=this._gl;for(i in e.attributes)"id"!==i&&(a="index"===i?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER,r=e.attributes[i],t[i]=n.createBuffer(),n.bindBuffer(a,t[i]),n.bufferData(a,r.array,n.STATIC_DRAW))}},setBufferNodeData:function(e,i,r){var a=this.bufferNodeMap[e.attributes.id],n=e.attributes,o=n.index,s=n.position,l=n.normal,h=n.uv,c=n.color,u=(n.tangent,this._gl);if(e.elementsNeedUpdate&&o!==t&&(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.index),u.bufferData(u.ELEMENT_ARRAY_BUFFER,o.array,i)),e.verticesNeedUpdate&&s!==t&&(u.bindBuffer(u.ARRAY_BUFFER,a.position),u.bufferData(u.ARRAY_BUFFER,s.array,i)),e.normalsNeedUpdate&&l!==t&&(u.bindBuffer(u.ARRAY_BUFFER,a.normal),u.bufferData(u.ARRAY_BUFFER,l.array,i)),e.uvsNeedUpdate&&h!==t&&(u.bindBuffer(u.ARRAY_BUFFER,a.uv),u.bufferData(u.ARRAY_BUFFER,h.array,i)),e.colorsNeedUpdate&&c!==t&&(u.bindBuffer(u.ARRAY_BUFFER,a.color),u.bufferData(u.ARRAY_BUFFER,c.array,i)),r)for(var f in e.attributes);},initGroupBuffer:function(e,t,i,r){var a=this._gl,n=t.faces3,o=t.faces4,s=3*n.length+4*o.length,l=1*n.length+2*o.length,h=3*n.length+4*o.length,c=ve.getMaterial(e,t.materialIndex?t.materialIndex:0),u=c.needUV(),f=c.getNormalType(),p=c.isVertexColor(),d=c.isGradientColor();if(i.__vertexArray=new Float32Array(3*s),f&&(i.__normalArray=new Float32Array(3*s)),!r){p&&(i.__colorArray=new Float32Array(3*s)),d&&(i.__color2Array=new Float32Array(6)),u&&(i.__uvArray=new Float32Array(2*s),e.uv2s&&(i.__uv2Array=new Float32Array(2*s))),i.elementIndexUInt?(i.__faceArray=new Uint32Array(3*l),i.__lineArray=new Uint32Array(2*h)):(i.__faceArray=new Uint16Array(3*l),i.__lineArray=new Uint16Array(2*h));var m,g;if(t.numMorphTargets)for(i.__morphTargetsArrays=[],m=0,g=t.numMorphTargets;m<g;m++)i.__morphTargetsArrays.push(new Float32Array(3*s));if(t.numMorphNormals)for(i.__morphNormalsArrays=[],m=0,g=t.numMorphNormals;m<g;m++)i.__morphNormalsArrays.push(new Float32Array(3*s));if(i.__webglFaceCount=3*l,i.__webglLineCount=2*h,c.attributes){i.__webglCustomAttributesList=[];for(var v in c.attributes){var y=c.attributes[v],A={};for(var x in y)A[x]=y[x];if(!A.__webglInitialized||A.createUniqueBuffers){A.__webglInitialized=!0;var _=1;"v2"===A.type?_=2:"v3"===A.type?_=3:"v4"===A.type?_=4:"c"===A.type&&(_=3),A.size=_,A.array=new Float32Array(s*_),A.buffer=a.createBuffer(),A.buffer.belongsToAttribute=v,y.needsUpdate=!0,A.__original=y,A.value=e.data[A.ref]}i.__webglCustomAttributesList.push(A)}}i.__inittedArrays=!0}},createLineBuffers:function(e){null==this.lineMap[e._id]&&(this.lineMap[e._id]={});var t=this.lineMap[e._id],i=this._gl;t.__webglVertexBuffer=i.createBuffer(),t.__webglColorBuffer=i.createBuffer(),t.__webglLineDistanceBuffer=i.createBuffer(),this.info.memory.geometries++},initLineBuffers:function(e){null==this.lineMap[e._id]&&(this.lineMap[e._id]={});var t=this.lineMap[e._id],i=e.vertices.length;t.__vertexArray=new Float32Array(3*i),t.__colorArray=new Float32Array(3*i),t.__color2Array=new Float32Array(6),t.__lineDistanceArray=new Float32Array(1*i),t.__webglLineCount=i},createParticleBuffers:function(e){null==this.particleMap[e._id]&&(this.particleMap[e._id]={});var t=this.particleMap[e._id],i=this._gl;t.__webglVertexBuffer=i.createBuffer(),t.__webglColorBuffer=i.createBuffer(),t.__webglNormalBuffer=i.createBuffer(),this.info.memory.geometries++},initParticleBuffers:function(e){null==this.particleMap[e._id]&&(this.particleMap[e._id]={});var t=this.particleMap[e._id],i=e.vertices.length;t.__vertexArray=new Float32Array(3*i),t.__colorArray=new Float32Array(3*i),t.__normalArray=new Float32Array(3*i),t.__sortArray=[],t.__webglParticleCount=i},createGroupBuffer:function(e,t){var i=this._gl;t.__webglVertexBuffer=i.createBuffer(),t.__webglNormalBuffer=i.createBuffer(),t.__webglColorBuffer=i.createBuffer(),t.__webglColor2Buffer=i.createBuffer(),t.__webglUVBuffer=i.createBuffer(),t.__webglUV2Buffer=i.createBuffer(),t.__webglFaceBuffer=i.createBuffer(),t.__webglLineBuffer=i.createBuffer(),new je(this,t),t.elementIndexUInt=e.elementIndexUInt,this.info.memory.geometries++},setRenderTarget:function(e){var i=e instanceof Ze,r=this._gl;if(e&&!e.__webglFramebuffer){e.depthBuffer===t&&(e.depthBuffer=!0),e.stencilBuffer===t&&(e.stencilBuffer=!0),e.__webglTexture=r.createTexture(),this.info.memory.textures++;var a=Oe.isPowerOfTwo,n=a(e.width)&&a(e.height),o=Oe.paramToGL(e.format,r),s=Oe.paramToGL(e.type,r);e.type,oe.FloatType;var l=o;if(i){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],r.bindTexture(r.TEXTURE_CUBE_MAP,e.__webglTexture),this.pm.setTextureParameters(r.TEXTURE_CUBE_MAP,e,n);for(var h=0;h<6;h++)e.__webglFramebuffer[h]=r.createFramebuffer(),e.__webglRenderbuffer[h]=r.createRenderbuffer(),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,l,e.width,e.height,0,o,s,null),this.setupFrameBuffer(e.__webglFramebuffer[h],e,r.TEXTURE_CUBE_MAP_POSITIVE_X+h),this.setupRenderBuffer(e.__webglRenderbuffer[h],e);n&&e.generateMipmaps&&r.generateMipmap(r.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=r.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=r.createRenderbuffer(),r.bindTexture(r.TEXTURE_2D,e.__webglTexture),this.pm.setTextureParameters(r.TEXTURE_2D,e,n),r.texImage2D(r.TEXTURE_2D,0,l,e.width,e.height,0,o,s,null),this.setupFrameBuffer(e.__webglFramebuffer,e,r.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e.__webglRenderbuffer):this.setupRenderBuffer(e.__webglRenderbuffer,e),n&&e.generateMipmaps&&r.generateMipmap(r.TEXTURE_2D);i?r.bindTexture(r.TEXTURE_CUBE_MAP,null):r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null)}var c,u,f,p,d;e?(c=i?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,u=e.width,f=e.height,p=0,d=0):(c=null,u=this._viewportWidth,f=this._viewportHeight,p=this._viewportX,d=this._viewportY),c!==this._currentFramebuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,c),r.viewport(p,d,u,f),this._currentFramebuffer=c),this._currentWidth=u,this._currentHeight=f},setupFrameBuffer:function(e,t,i){var r=this._gl;r.bindFramebuffer(r.FRAMEBUFFER,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,i,t.__webglTexture,0)},setupRenderBuffer:function(e,t){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e)):i.renderbufferStorage(i.RENDERBUFFER,i.RGBA4,t.width,t.height)},setLineWidth:function(e){if(e!==this._oldLineWidth){try{this._gl.lineWidth&&this._gl.lineWidth(e)}catch(e){}this._oldLineWidth=e}},setupMatrices:function(e,t){e.fixSize(t),e.updateWorldMatrix(),e._modelViewMatrix.multiplyMatrices(t.worldMatrixInverse,e.worldMatrix),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)},setDefaultGLState:function(){var e=this._gl,t=new oe.Color(this._clearColor);e.clearColor(t.r,t.g,t.b,this._clearAlpha),e.clearDepth(1),pe.isIE||e.clearStencil(0),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),e.enable(e.CULL_FACE),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},clear:function(e,i,r){var a=this._gl,n=0;(e===t||e)&&(n|=a.COLOR_BUFFER_BIT),(i===t||i)&&(n|=a.DEPTH_BUFFER_BIT),(r===t||r)&&(n|=a.STENCIL_BUFFER_BIT),a.clear(n)},setGLFaces:function(e){var t=this._gl,i=e.side===oe.DoubleSide,r=e.side===oe.BackSide;this._oldDoubleSided!==i&&(i?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),this._oldDoubleSided=i),this._oldFlipSided!==r&&(r?t.frontFace(t.CW):t.frontFace(t.CCW),this._oldFlipSided=r)},getView:function(){return this._canvas},getRootView:function(){return this._rootView},setBlending:function(e,t,i,r){We.setBlending(e,t,i,r,this)},setDepthTest:function(e){We.setDepthTest(e,this)},setStencilTest:function(e){this._oldStencilTest!=e&&(e?this._gl.enable(this._gl.STENCIL_TEST):this._gl.disable(this._gl.STENCIL_TEST),this._oldStencilTest=e)},_setStencilMask:function(e){this._oldStencilMask!==e&&(this._gl.stencilMask(e),this._oldStencilMask=e)},setDepthWrite:function(e){We.setDepthWrite(e,this)},getLineWidthRange:function(){var e=this._gl;return e.getParameter(e.ALIASED_LINE_WIDTH_RANGE)},setTexture:function(e,t){this.pm.setTexture(e,t)},disableAttributes:function(){for(var e in this._enabledAttributes)this._enabledAttributes[e]&&(this._gl.disableVertexAttribArray(e),this._enabledAttributes[e]=!1)},enableAttribute:function(e){this._enabledAttributes[e]||(this._gl.enableVertexAttribArray(e),this._enabledAttributes[e]=!0)},adjustRootViewBounds:function(e,t){var i=this._rootView;i.style.width=e+"px",i.style.height=t+"px"},adjustCanvasBounds:function(e,t,i,r,a){e.width=t*this.devicePixelRatio,e.height=i*this.devicePixelRatio,r&&(e.style.left=r+"px"),a&&(e.style.top=a+"px"),e.style.margin="0px",e.style.padding="0px",e.style.width=t+"px",e.style.height=i+"px"},adjustBounds:function(e,t,i,r){var a=this.getView();if(this._w=e,this._h=t,this.adjustRootViewBounds(e,t,i,r),this.adjustCanvasBounds(a,e,t,i,r),this.adjustCanvasBounds(this._topCanvas,e,t,i,r),this.adjustCanvasBounds(this._bottomCanvas,e,t,i,r),this.adjustCallback(e,t,i,r),this.setViewport(0,0,a.width,a.height),this.autoUpdateCameraAspect&&0!==t){var n=this._camera;n.aspect=e/t,n.updateProjectionMatrix(),this._currentCamera=null}this.dirtyNetwork()},adjustCallback:function(){},setViewport:function(e,i,r,a){var n=this.getView();this._viewportX=e!==t?e:0,this._viewportY=i!==t?i:0,this._viewportWidth=r!==t?r:n.width,this._viewportHeight=a!==t?a:n.height,this._gl.viewport(this._viewportX,this._viewportY,this._viewportWidth,this._viewportHeight)},setShowAxis:function(e){this.showAxis!==e&&(this.showAxis=e,this.showAxis?this.helperBox.contains(this.axis)||this.helperBox.addByDescendant(this.axis):this.helperBox.removeByDescendant(this.axis),this.dirtyNetwork())},setShowAxisText:function(e){this.axis.showAxisText(e),this.dirtyNetwork()},setAxisSize:function(e){this.axis.setSize(e)},onSelect:function(e){null!=this.onSelectFunction&&this.onSelectFunction(e)},setOnSelectFunction:function(e){this.onSelectFunction=e},isSelectable:function(e){return!!e.isSelectable()&&(!this.selectableFunction||this.selectableFunction(e))},setSelectableFunction:function(e){this.selectableFunction=e},setRenderSelectFunction:function(e){this.renderSelectFunction=e},renderSelect:function(e){return!this.renderSelectFunction||this.renderSelectFunction(e)},renderAlarmBorder:function(e){return!this.renderAlarmBorderFunction||this.renderAlarmBorderFunction(e)},selectable:function(e){return this.isVisible(e.element)&&this.isSelectable(e.element)&&this.getDataBox().getSelectionModel().isSelectable(e.element)},editable:function(e){var t=this.selectable(e);return t&&null!=this.editableFunction?this.editableFunction(e.element):t},getFirstSelectElement:function(e){if(null==e)return null;for(var t,i=0;i<e.length;){var r=e[i];if(this.selectable(r)){t=r.element;break}i++}return t},getFirstEditElement:function(e){if(null==e)return null;for(var t,i=0;i<e.length;){var r=e[i];if(this.editable(r)){t=r.element;break}i++}return t},toImageData:function(e,t,i,r){return this.dirtyNetwork(),this.render(),(e=e||"PNG").toUpperCase(),"PNG"===e?de.saveAsPNG(this.getView(),t,!1,i,r):"JPEG"===e?de.saveAsJPEG(this.getView(),t,!1,i,r):"BMP"===e?de.saveAsBMP(this.getView(),t,!1,i,r):void console.log("Not surport type "+e)},getPickingByEvent:function(e){var t=this._camera,i={},r=this.getView().getBoundingClientRect(),a=e.clientX,n=e.clientY;e.touches&&e.touches.length&&(a=e.touches[0].pageX,n=e.touches[0].pageY);var o=(a-r.left)/r.width,s=(n-r.top)/r.height;i.x=2*o-1,i.y=2*-s+1;var l=new oe.Vec3(i.x,i.y,.5);this.projector.unprojectVector(l,t);var h=null;if(t instanceof oe.PerspectiveCamera)h=new oe.Picking(t._position,l.sub(t._position).normalize(),t.up,null,null,this);else{var c=l.clone().sub(t._position),u=t.getTarget().clone().sub(t.p()).normalize(),f=u.multiplyScalar(c.clone().dot(u)),p=c.sub(f),d=(new he).addVectors(t._position,p);h=new oe.Picking(d,l.sub(d).normalize(),t.up,null,null,this)}return h},getElementsByMouseEvent:function(e,t,i){var r=this.getPickingByEvent(e),a=new _e;return a.addAll(this.dataBox.getNodes()),a.addAll(this.dataBox.getBillboards()),i&&a.addAll(new _e(this.alarmBillboards)),r.intersectObjects(a.toArray(),!1,t)},getElementByColorPicking:function(e,t){var i=this,r=i._gl,a=i.getView().getBoundingClientRect(),n=(e.touches?e.touches[0]:e).clientX-a.left,o=(e.touches?e.touches[0]:e).clientY-a.top,s=i._pickingTarget.width,l=i._pickingTarget.height,h=new Uint8Array(4),c=i._pickingProgram;if(i.pm.currentProgram=null,i.setRenderTarget(i._pickingTarget),!i._pickingProgram){var u=r.createProgram(),f=r.createShader(r.FRAGMENT_SHADER),p=r.createShader(r.VERTEX_SHADER);r.shaderSource(f,"precision highp float;uniform vec4 u_color; void main () { gl_FragColor = u_color; }"),r.shaderSource(p,"precision highp float;attribute vec3 a_position;uniform mat4 u_viewProjectMatrix;uniform mat4 u_modelMatrix;void main () { gl_Position = u_viewProjectMatrix * u_modelMatrix * vec4(a_position, 1.0); }"),r.compileShader(f),r.compileShader(p),r.attachShader(u,f),r.attachShader(u,p),r.linkProgram(u),u._u_color=r.getUniformLocation(u,"u_color"),u._u_viewProjectMatrix=r.getUniformLocation(u,"u_viewProjectMatrix"),u._u_modelMatrix=r.getUniformLocation(u,"u_modelMatrix"),c=i._pickingProgram=u}this._oldDoubleSided=this._oldFlipSided=null,r.useProgram(c),r.viewport(0,0,s,l),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.uniformMatrix4fv(c._u_viewProjectMatrix,!1,i._projScreenMatrix.elements),i._currentGroupHash=null,i.glNodeList.forEach(function(e){var a=e.node,n=e.opaque||e.transparent;if(!(!i.isVisible(a)||!n.visible||n.transparent&&0===n.opacity||t&&!t(a))){r.uniformMatrix4fv(c._u_modelMatrix,!1,a.worldMatrix.elements);var o=a._pickingColor;if(r.uniform4f(c._u_color,o[0],o[1],o[2],o[3]),a instanceof se.BufferNode){if(a.computed){var s=i.bufferNodeMap[a.attributes.id];s&&s.position&&(r.bindBuffer(r.ARRAY_BUFFER,s.position),r.enableVertexAttribArray(0),r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0),s.index?(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s.index),r.drawElements(r[a.mode],a.attributes.index.array.length,a.attributes.index.element_type,0)):r.drawArrays(r[a.mode],0,a.attributes.position.array.length/3))}}else{var l=i.groupMap[e.group.id];if(l){i.setGLFaces(n),r.bindBuffer(r.ARRAY_BUFFER,l.__webglVertexBuffer),r.enableVertexAttribArray(0),r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,l.__webglFaceBuffer);var h=l.elementIndexUInt?r.UNSIGNED_INT:r.UNSIGNED_SHORT;r.drawElements(r.TRIANGLES,l.__webglFaceCount,h,0)}}}}),i._currentGroupHash=null,r.readPixels(Math.floor(n*s/i._w),Math.floor(l-o*l/i._h),1,1,r.RGBA,r.UNSIGNED_BYTE,h),i.setRenderTarget();var d=i._pickingNodeMap[(h[0]<<24)+(h[1]<<16)+(h[2]<<8)+h[3]];if(d){if(d instanceof oe.BufferNode){var m,g,v,y,A;return g=new he,v=new he,m=new ue,A={x:n,y:o},m.multiplyMatrices(i._projScreenMatrix,d.worldMatrix),m.getInverse(m),A.x=A.x/i._w*2-1,A.y=1-A.y/i._h*2,g.set(A.x,A.y,-1),g.applyMatrix4(m),v.set(A.x,A.y,1),v.applyMatrix4(m),v.sub(g),v.normalize(),y=d.intersect(g,v),y?(y.point.applyMatrix4(d.worldMatrix),{point:y.point,element:d,object:d,distance:y.distance}):null}var x=i.getPickingByEvent(e).intersectObjects([d],!1,!1);return d=x&&x[0]}return null},getElementByScreenPoint:function(e,t,i){var r={},a=this.getView(),n=this._camera,o=a.getBoundingClientRect();e.x&&(i=t,t=e.y,e=e.x),e/=o.width,t/=o.height,r.x=2*e-1,r.y=2*-t+1;var s=new oe.Vec3(r.x,r.y,.5);this.projector.unprojectVector(s,n);var l=new oe.Picking(n._position,s.sub(n._position).normalize(),n.up,null,null,this),h=new _e;return h.addAll(this.dataBox.getNodes()),h.addAll(this.dataBox.getBillboards()),l.intersectObjects(h.toArray(),!1,i)},getFirstElementByMouseEvent:function(e,t,i,r){var a=this.getElementsByMouseEvent(e,t,r);if(a.length)for(var n=0;n<a.length;n++){var o=a[n],s=o.element;if(null==i||i.call(null,s))return o}return null},getUnProjectVector:function(e){var t={},i=this.getView().getBoundingClientRect(),r=e.x/i.width,a=e.y/i.height;t.x=2*r-1,t.y=2*-a+1;var n=new oe.Vec3(t.x,t.y,.5);return this.projector.unprojectVector(n,this._camera),n},getFrustumByBounding:function(e){var t=e,i=this.getUnProjectVector(new le(t.x,t.y)),r=this.getUnProjectVector(new le(t.x+t.w,t.y)),a=this.getUnProjectVector(new le(t.x,t.y+t.h)),n=this.getUnProjectVector(new le(t.x+t.w,t.y+t.h)),o=this.getNearFarPoints(i),s=this.getNearFarPoints(r),l=this.getNearFarPoints(a),h=this.getNearFarPoints(n),c=new oe.math.Plane,u=new oe.math.Plane,f=new oe.math.Plane,p=new oe.math.Plane,d=new oe.math.Plane,m=new oe.math.Plane;c.setFromCoplanarPoints(o[0],s[0],l[0]),u.setFromCoplanarPoints(o[0],o[1],s[0]),f.setFromCoplanarPoints(o[0],l[0],o[1]),p.setFromCoplanarPoints(s[0],s[1],h[0]),d.setFromCoplanarPoints(l[0],h[0],l[1]),m.setFromCoplanarPoints(o[1],l[1],s[1]);var g=new oe.Frustum(c,u,f,p,d,m);return g.setPoints([o[0],s[0],l[0],h[0],o[1],s[1],l[1],h[1]]),g},getNearFarPoints:function(e){var t=this._camera,i=e.sub(t._position).normalize(),r=t.target.clone().sub(t._position),a=i.angleTo(r),n=t.getNear()/Math.acos(a),o=t.getFar()/Math.acos(a);return[t._position.clone().add(i.clone().multiplyScalar(n)),t._position.clone().add(i.clone().multiplyScalar(o))]},getSpacePointOnPlane:function(e,t){var i={},r=this.getView(),a=this._camera,n=r.getBoundingClientRect(),o=e.clientX,s=e.clientY;e.touches&&e.touches.length&&(o=e.touches[0].pageX,s=e.touches[0].pageY);var l=(o-n.left)/n.width,h=(s-n.top)/n.height;i.x=2*l-1,i.y=2*-h+1;var c=new oe.Vec3(i.x,i.y,.5);this.projector.unprojectVector(c,a);var u=a._position;if(a instanceof se.OrthoCamera){var f=new oe.Vec3(0,0,.5);this.projector.unprojectVector(f,a),u=u.clone().sub(f.sub(c))}var p=c.sub(u).normalize(),d=new oe.Ray(u,p),m=d.distanceToPlane(t);return m<0||Math.abs(m)<oe.Picking.prototype.precision?null:d.at(m)},getElementsByBounding:function(e,t,i){var r=new _e;r.addAll(this.dataBox.getNodes()),r.addAll(this.dataBox.getBillboards());var a,n=this.getFrustumByBounding(e),o=[],s=new he,l=this._camera;return r.forEach(function(e){if(e instanceof oe.Billboard){s.setFromMatrixPosition(e.worldMatrix);var t=e.material,r=t.alignment;a=new oe.Plane(1,1),(r.x||r.y)&&(a.setPosition(r.x,r.y,0),a=oe.Utils.transformElement(a,!0)),a.setPosition(s);var h=(new he).getScaleFromMatrix(e.worldMatrix);a.setScale(h.x,h.y,1);var c=l.getTarget().clone(),u=l.getPosition();c.sub(u);var f=a.getPosition().clone();t&&t.vertical&&(c.y=0),f.sub(c),a.lookAt(f),a.updateWorldMatrix(!0),n.intersectsObjectAccurate(a,i)&&o.push({element:e})}else oe.Line,n.intersectsObjectAccurate(e,i)&&o.push({element:e})}),o},getViewPosition:function(e){var t=new he;return(t=this.projector.projectVector(e,this._camera,t)).x=t.x/2+.5,t.y=-t.y/2+.5,{x:this._canvas.width*t.x/this.devicePixelRatio,y:this._canvas.height*t.y/this.devicePixelRatio,h:this._canvas.height}},setInteractions:function(e){var t,i=this._interactions;if(i)for(t=0;t<i.length;t++)i[t].tearDown();if(this._interactions=e,e)for(t=0;t<e.length;t++)e[t].setUp()},getDefaultInteraction:function(){if(this._interactions&&this._interactions.length>0)for(var e=0;e<this._interactions.length;e++){var t=this._interactions[e];if(t instanceof oe.DefaultInteraction)return t}return null},getInteractions:function(){return this._interactions},fireInteractionEvent:function(e){this._interactionDispatcher.fire(e)},addInteractionListener:function(e,t,i){this._interactionDispatcher.add(e,t,i)},removeInteractionListener:function(e,t){this._interactionDispatcher.remove(e,t)},dispose:function(){this._animateId&&((this._vrDisplay&&this._vrDisplay.isPresenting?this._vrDisplay:window).cancelAnimationFrame(this._animateId),this._animateId=null),this.__timeOutFunc=null,this.setInteractions(null),this.pm.dispose(),this._resizeFunction&&window.removeEventListener("resize",this._resizeFunction,!0),this._canvas.removeEventListener("webglcontextlost",this._handleWebglContextLost),this._canvas.removeEventListener("webglcontextrestored",this._handleWebglRestored),this.getRootView().removeEventListener("mousedown",this._handleMouseDown),this.getRootView().removeEventListener("mouseup",this._handleMouseClick)},setRenderInterval:function(e){(Oe.isNaN(e)||e<=5)&&(e=5),this._renderInterval=e},_computeNetworkBoundingBox:function(){function e(e,t){e.applyMatrix4(t),s.push(e)}var t,i,r,a,n=this.getDataBox().size(),o=this.getDataBox().getDatas(),s=[];for(t=0;t<n;t++)if((i=o.get(t))instanceof oe.Node){r=i.getBoundingBox(),a=i.worldMatrix;var l=r.min,h=r.max;e(l.clone(),a),e(h.clone(),a),e(new he(l.x,l.y,h.z),a),e(new he(l.x,h.y,l.z),a),e(new he(h.x,l.y,l.z),a),e(new he(h.x,h.y,l.z),a),e(new he(h.x,l.y,h.z),a),e(new he(l.x,h.y,h.z),a)}if(s.length<=1)return null;var c=new oe.BoundingBox;return c.setFromPoints(s),c},getNetworkBoundingBox:function(){return null==this.boundingBox&&(this.boundingBox=this._computeNetworkBoundingBox()),this.boundingBox},getSelectStyle:function(e){return e.getSelectStyle()},setZoomStandard:function(e){this._zoomStandard=e},getZoomStandard:function(){return this._zoomStandard},zoom:function(e,t){t=t||this._zoomStandard,this._camera.zoom(e,t)},zoomIn:function(e){this.zoom(.9,e)},zoomOut:function(e){this.zoom(1.1,e)},move:function(e,t){new se.Vec3(-e,-t,0);var i=this._camera.t(),r=this._camera.p();this._camera.translateX(-e),this._camera.translateY(-t);var a=this._camera.p();i.add(a.clone().sub(r)),this._camera.lookAt(i)},moveLeft:function(e){e=e||50,this.move(-e,0)},moveRight:function(e){e=e||50,this.move(e,0)},moveUp:function(e){e=e||30,this.move(0,e)},moveDown:function(e){e=e||30,this.move(0,-e)},zoomEstimateOverview:function(e){var t=this.getNetworkBoundingBox();if(null!=t){var i=t.center(),r=new he(0,t.max.y-t.min.y,t.max.z-t.min.z),a=new he(t.max.x-t.min.x,0,0,0),n=r.clone();n.length()<a.length()&&(n=a.clone());var o;if(e){var s=r.length();r.y=r.z*Math.tan(e/180*Math.PI),r.setLength(s)}o=(new he).addVectors(i,r.multiplyScalar(.5));var l=this._camera.fov,h=(this._camera.aspect,n.length()/2/Math.tan(l*Math.PI/180));o.add(r.normalize().multiplyScalar(h)),this._camera.setPosition(o),this._camera.lookAt(i),this._overviewDistance=this._camera.getDistance()}},_onVRRequestPresent:function(){var e=this,t=e._canvas,i=e._vrDisplay;if(i){e._oldCamera=e._camera;var r=new se.VRCamera(e,e._oldCamera.near,e._oldCamera.far);r.setPosition(e._camera.getPosition()),e.setCamera(r),i.requestPresent([{source:t}]).then(function(){e._isPresenting=!0,e.onEnterVR()},function(e){console.log("requestPresent failed.",e)})}},onEnterVR:function(){},onExitVR:function(){},_onVRExitPresent:function(){var e=this,t=e._vrDisplay;t&&t.isPresenting&&t.exitPresent().then(function(){e._isPresenting=!1,e.onExitVR(),e.setCamera(e._oldCamera),e._oldCamera=null},function(){console.log("exitPresent failed.")})},enterVR:function(){this._onVRRequestPresent()},_initVR:function(){var e,t=this,i=t._canvas;t._vrDisplay||navigator.getVRDisplays&&navigator.getVRDisplays().then(function(r){r&&r.length&&((e=t._vrDisplay=r[0]).depthNear=t._camera.near,e.depthFar=t._camera.far,t.onVRRequestPresent||(t.onVRRequestPresent=function(e){t._onVRRequestPresent()}),t.onVRExitPresent||(t.onVRExitPresent=function(e){t._onVRExitPresent()}),t.onVRPresentChange||(t.onVRPresentChange=function(r){if(e.isPresenting){var a=e.getEyeParameters("left"),n=e.getEyeParameters("right");i.width=2*Math.max(a.renderWidth,n.renderWidth),i.height=Math.max(a.renderHeight,n.renderHeight)}else t.adjustBounds(t._rootView.clientWidth,t._rootView.clientHeight)}),window.addEventListener("vrdisplaypresentchange",t.onVRPresentChange,!1),window.addEventListener("vrdisplayactivate",t.onVRRequestPresent,!1),window.addEventListener("vrdisplaydeactivate",t.onVRExitPresent,!1))})},exitVR:function(){this._onVRExitPresent()},toggleVR:function(){this._isPresenting?this.exitVR():this.enterVR()},s:function(e){this.setStyle(e)},setStyle:function(e){var t=this;if(e){if(e.parentDom&&e.parentDom.appendChild(t.getRootView()),e.width&&e.height&&t.adjustBounds(e.width,e.height),e.autoAdjustBounds&&se.Utils.autoAdjustNetworkBounds(t,document.documentElement,"clientWidth","clientHeight"),e.camera){var i=t.getCamera(),r=e.camera;null!=r.near&&i.setNear(r.near),null!=r.far&&i.setFar(r.far),null!=r.fov&&i.setFov&&i.setFov(r.fov),null!=r.width&&i.setWidth&&i.setWidth(r.width),null!=r.position&&i.setPosition(r.position),null!=r.target&&i.lookAt(r.target)}if(e.lights){var a=t.getDataBox();e.lights.forEach(function(e){var t;"directional"===e.type&&(t=new se.DirectionalLight(e.color,e.intensity),e.direction&&t.setDirection(e.direction)),"point"===e.type&&(t=new se.PointLight(e.color,e.intensity,e.distance),e.position&&t.setPosition(e.position)),"ambient"===e.type&&(t=new se.AmbientLight(e.color)),"spot"===e.type&&(t=new se.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent)),t&&a.add(t)})}if(e.interactions){var n,o,s,l;t.getInteractions().forEach(function(e){e instanceof se.DefaultInteraction&&(n=e),e instanceof se.EditInteraction&&(o=e),e instanceof se.SelectionInteraction&&(s=e)}),e.interactions.forEach(function(e){"default"===e.type&&(n||(n=new se.DefaultInteraction(t)),l=n),"edit"===e.type&&(o||(o=new se.EditInteraction(t)),l=o),"selection"===e.type&&(s||(s=new se.SelectionInteraction(t)),l=s),Object.keys(e).forEach(function(t){"type"!==t&&(l[t]=e[t])})});var h=[];n&&h.push(n),o&&h.push(o),s&&h.push(s),t.setInteractions(h)}}}}),oe.Network3DId=0,oe.Network3D.GroupCache={_groupCounter:0};oe.Projector=function(){function e(){if(c===w){var e=new oe.RenderObject;return _.push(e),w++,c++,e}return _[c++]}function i(){if(f===M){var e=new oe.RenderVertex;return b.push(e),M++,f++,e}return b[f++]}function r(){if(d===P){var e=new oe.RenderFace3;return S.push(e),P++,d++,e}return S[d++]}function a(){if(m===T){var e=new oe.RenderFace4;return C.push(e),T++,m++,e}return C[m++]}function n(){if(v===z){var e=new oe.RenderLine;return E.push(e),z++,v++,e}return E[v++]}function o(){if(A===L){var e=new oe.RenderableParticle;return D.push(e),L++,A++,e}return D[A++]}function s(e,t){return t.z-e.z}function l(e,t){var i=0,r=1,a=e.z+e.w,n=t.z+t.w,o=-e.z+e.w,s=-t.z+t.w;return a>=0&&n>=0&&o>=0&&s>=0||!(a<0&&n<0||o<0&&s<0)&&(a<0?i=Math.max(i,a/(a-n)):n<0&&(r=Math.min(r,a/(a-n))),o<0?i=Math.max(i,o/(o-s)):s<0&&(r=Math.min(r,o/(o-s))),!(r<i)&&(e.lerp(t,i),t.lerp(e,1-r),!0))}var h,c,u,f,p,d,m,g,v,y,A,x,_=[],w=0,b=[],M=0,S=[],P=0,C=[],T=0,E=[],z=0,D=[],L=0,R={objects:[],sprites:[],lights:[],elements:[]},N=new oe.Vec3,B=new oe.Vec4,I=new oe.BoundingBox(new oe.Vec3(-1,-1,-1),new oe.Vec3(1,1,1)),F=new oe.BoundingBox,V=new Array(3),U=new Array(4),k=new oe.Mat4,O=new oe.Mat4,X=new oe.Mat4,G=new oe.Mat3,W=new oe.Mat3,Y=new oe.Vec3,j=new oe.Frustum,H=new oe.Vec4,q=new oe.Vec4;this.projectVector=function(e,i,r){return i.worldMatrixInverse.getInverse(i.worldMatrix),O.multiplyMatrices(i.projectionMatrix,i.worldMatrixInverse),r===t?e.applyProjection(O):(r.copy(e),r.applyProjection(O))},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),O.multiplyMatrices(t.worldMatrix,t.projectionMatrixInverse),e.applyProjection(O)},this.pickingRay=function(e,t){e.z=-1;var i=new oe.Vec3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(i,t),i.sub(e).normalize(),new oe.Picking(e,i)};var Z=function(t,i){c=0,R.objects.length=0,R.sprites.length=0,R.lights.length=0;var r=function(t){for(var i,a=0,n=(i=(i=t instanceof oe.DataBox?t.getRoots():t.getChildren()).toList()).size();a<n;a++)(o=i.get(a)).isSelected()&&o instanceof oe.Node&&(i.add(o.createCanvasSelectionCube(),a),a++);for(var a=0,n=i.size();a<n;a++){var o=i.get(a);!1!==o._visible&&(o instanceof oe.Light?R.lights.push(o):o instanceof oe.Entity||o instanceof oe.Line?!1!==o.frustumCulled&&!0!==j.intersectsObject(o)||((h=e()).object=o,null!==o.renderDepth?h.z=o.renderDepth:(N.copy(o.worldMatrix.getPosition()),N.applyProjection(O),h.z=N.z),R.objects.push(h)):o instanceof oe.Billboard||o instanceof oe.Particle?((h=e()).object=o,null!==o.renderDepth?h.z=o.renderDepth:(N.copy(o.worldMatrix.getPosition()),N.applyProjection(O),h.z=N.z),R.sprites.push(h)):((h=e()).object=o,null!==o.renderDepth?h.z=o.renderDepth:(N.copy(o.worldMatrix.getPosition()),N.applyProjection(O),h.z=N.z),R.objects.push(h)),r(o))}};return r(t),!0===i&&R.objects.sort(s),R};this.projectDataBox=function(e,h,c,_){var w,M,S,P,C,T,E,z,D,L,N,Q,K,J,$,ee,te,ie,re,ae,ne,se,le,he=!1;d=0,m=0,v=0,A=0,R.elements.length=0;for(var ce=0;ce<e.getRoots().size();ce++)e.getRoots().get(ce).updateWorldMatrix();for(h.parent===t&&h.updateWorldMatrix(!0,!1),k.copy(h.worldMatrixInverse.getInverse(h.worldMatrix)),O.multiplyMatrices(h.projectionMatrix,k),W.getInverse(k),W.transpose(),j.setFromMatrix(O),w=0,M=(R=Z(e,c)).objects.length;w<M;w++)if(N=R.objects[w].object,x=N.worldMatrix,f=0,N instanceof oe.Entity){for(K=(Q=N).vertices,J=Q.faces,te=Q.uvs,G.getInverse(x),G.transpose(),le=!0===(se=N.material instanceof oe.ArrayMaterial)?N.material:null,S=0,P=K.length;S<P;S++)(u=i()).positionWorld.copy(K[S]).applyMatrix4(x),u.positionScreen.copy(u.positionWorld).applyMatrix4(O),u.positionScreen.x/=u.positionScreen.w,u.positionScreen.y/=u.positionScreen.w,u.positionScreen.z/=u.positionScreen.w,u.visible=!(u.positionScreen.x<-1||u.positionScreen.x>1||u.positionScreen.y<-1||u.positionScreen.y>1||u.positionScreen.z<-1||u.positionScreen.z>1);for(C=0,T=J.length;C<T;C++){$=J[C];var ue=!0===se?le.materials[$.materialIndex]:N.material;if(ue!==t){var fe=ue.side;if($ instanceof oe.Face3){if(ie=b[$.a],re=b[$.b],ae=b[$.c],V[0]=ie.positionScreen,V[1]=re.positionScreen,V[2]=ae.positionScreen,!0!==ie.visible&&!0!==re.visible&&!0!==ae.visible&&!I.isIntersectionBox(F.setFromPoints(V)))continue;if(he=(ae.positionScreen.x-ie.positionScreen.x)*(re.positionScreen.y-ie.positionScreen.y)-(ae.positionScreen.y-ie.positionScreen.y)*(re.positionScreen.x-ie.positionScreen.x)<0,fe!==oe.DoubleSide&&he!==(fe===oe.FrontSide))continue;(p=r()).v1.copy(ie),p.v2.copy(re),p.v3.copy(ae)}else if($ instanceof oe.Face4){if(ie=b[$.a],re=b[$.b],ae=b[$.c],ne=b[$.d],U[0]=ie.positionScreen,U[1]=re.positionScreen,U[2]=ae.positionScreen,U[3]=ne.positionScreen,!0!==ie.visible&&!0!==re.visible&&!0!==ae.visible&&!0!==ne.visible&&!I.isIntersectionBox(F.setFromPoints(U)))continue;if(he=(ne.positionScreen.x-ie.positionScreen.x)*(re.positionScreen.y-ie.positionScreen.y)-(ne.positionScreen.y-ie.positionScreen.y)*(re.positionScreen.x-ie.positionScreen.x)<0||(re.positionScreen.x-ae.positionScreen.x)*(ne.positionScreen.y-ae.positionScreen.y)-(re.positionScreen.y-ae.positionScreen.y)*(ne.positionScreen.x-ae.positionScreen.x)<0,fe!==oe.DoubleSide&&he!==(fe===oe.FrontSide))continue;(p=a()).v1.copy(ie),p.v2.copy(re),p.v3.copy(ae),p.v4.copy(ne)}for(p.normalModel.copy($.normal),!1!==he||fe!==oe.BackSide&&fe!==oe.DoubleSide||p.normalModel.negate(),p.normalModel.applyMatrix3(G).normalize(),p.normalModelView.copy(p.normalModel).applyMatrix3(W),p.centroidModel.copy($.centroid).applyMatrix4(x),E=0,z=(ee=$.vertexNormals).length;E<z;E++){var pe=p.vertexNormalsModel[E];pe.copy(ee[E]),!1!==he||fe!==oe.BackSide&&fe!==oe.DoubleSide||pe.negate(),pe.applyMatrix3(G).normalize(),p.vertexNormalsModelView[E].copy(pe).applyMatrix3(W)}p.vertexNormalsLength=ee.length;var de=te[C];for(D=0,L=de.length;D<L;D++)p.uvs[0][D]=de[D];p.color=$.color,p.material=ue,Y.copy(p.centroidModel).applyProjection(O),p.z=Y.z,R.elements.push(p)}}}else if(N instanceof oe.Line){X.multiplyMatrices(O,x),K=N.vertices,(ie=i()).positionScreen.copy(K[0]).applyMatrix4(X);var me=N.type===oe.LinePieces?2:1;for(S=1,P=K.length;S<P;S++)(ie=i()).positionScreen.copy(K[S]).applyMatrix4(X),(S+1)%me>0||(re=b[f-2],H.copy(ie.positionScreen),q.copy(re.positionScreen),!0===l(H,q)&&(H.multiplyScalar(1/H.w),q.multiplyScalar(1/q.w),(g=n()).v1.positionScreen.copy(H),g.v2.positionScreen.copy(q),g.z=Math.max(H.z,q.z),g.material=N.material,R.elements.push(g)))}for(w=0,M=R.sprites.length;w<M;w++)N=R.sprites[w].object,x=N.worldMatrix,N instanceof oe.Particle&&(B.set(x.elements[12],x.elements[13],x.elements[14],1),B.applyMatrix4(O),B.z/=B.w,B.z>0&&B.z<1&&((y=o()).object=N,y.x=B.x/B.w,y.y=B.y/B.w,y.z=B.z,y.rotation=N.rotation.z,y.scale.x=N.scale.x*Math.abs(y.x-(B.x+h.projectionMatrix.elements[0])/(B.w+h.projectionMatrix.elements[12])),y.scale.y=N.scale.y*Math.abs(y.y-(B.y+h.projectionMatrix.elements[5])/(B.w+h.projectionMatrix.elements[13])),y.material=N.material,R.elements.push(y)));return!0===_&&R.elements.sort(s),R}},oe.Billboard=function(e){null!=e&&null!=e.id?this._id=e.id:this._id=e,oe.Element.call(this,this._id),this.material=new oe.BillboardMaterial,this.rotation3d=this._rotation,this.rotation=0,this.vertices=[new he(-.5,-.5,0),new he(.5,-.5,0),new he(.5,.5,0),new he(-.5,.5,0)]},oe.extend(oe.Billboard,oe.Element,{constructor:oe.Billboard,className:"TGL.Billboard",updateMatrix:function(){this.matrix.setPosition(this._position),this.rotation=this._rotation.z,this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this._scale.x&&1===this._scale.y||this.matrix.scale(this._scale),this.matrixWorldNeedsUpdate=!0},invalidateTexture:function(){var e=this.material;e instanceof oe.BillboardMaterial&&this._dirtyMaterialTexture(e)},clone:function(e){return e===t&&(e=new oe.Billboard),e.material=this.material.clone(),oe.Element.prototype.clone.call(this,e),e},clonePrefab:function(){return this.clone()},setMaterialStyle:function(e,t){var i=this.material.clone();e=e.substr(e.indexOf(".")+1),this._A97(i,e,t);var r=i.getUniqueCode(),a=_t.getMaterial(r);null!=a?(_t.unUseMaterial(this.material),this.material=a,_t.useMaterial(a)):(_t.unUseMaterial(this.material),_t.setMaterial(r,i),this.material=i)}}),oe.BillboardRenderer=function(){function e(e,i,r){var a=t.createProgram(),n=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER),s="precision "+r+" float;\n";return t.shaderSource(n,s+i),t.shaderSource(o,s+e),t.compileShader(n),t.compileShader(o),t.attachShader(a,n),t.attachShader(a,o),t.linkProgram(a),a}var t,i,r,a={},n=(new oe.Billboard,new oe.BillboardMaterial({color:255}));this.init=function(n){this.enable=!0,n._currentGroupHash=null,t=n._gl,i=n,r=n.getPrecision(),a.vertices=new Float32Array(16),a.faces=new Uint16Array(6),a.lines=new Uint16Array(8);var o=0;a.vertices[o++]=-.5,a.vertices[o++]=-.5,a.vertices[o++]=0,a.vertices[o++]=0,a.vertices[o++]=.5,a.vertices[o++]=-.5,a.vertices[o++]=1,a.vertices[o++]=0,a.vertices[o++]=.5,a.vertices[o++]=.5,a.vertices[o++]=1,a.vertices[o++]=1,a.vertices[o++]=-.5,a.vertices[o++]=.5,a.vertices[o++]=0,a.vertices[o++]=1,o=0,a.faces[o++]=0,a.faces[o++]=1,a.faces[o++]=2,a.faces[o++]=0,a.faces[o++]=2,a.faces[o++]=3,o=0,a.lines[o++]=0,a.lines[o++]=1,a.lines[o++]=0,a.lines[o++]=3,a.lines[o++]=1,a.lines[o++]=2,a.lines[o++]=2,a.lines[o++]=3,a.vertexBuffer=t.createBuffer(),a.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,a.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a.faces,t.STATIC_DRAW),a.program=e("uniform int useScreenCoordinates;\nuniform int sizeAttenuation;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nuniform bool vertical;\nuniform float fixedSize;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\n\nvoid main() {\n  vec4 finalPosition;\n  finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  vUV = uvOffset + uv * uvScale;\n  vec2 finalScale;\n  if(fixedSize != 0.0){\n    finalScale = scale  * length(finalPosition.xyz) / fixedSize;\n  }else{\n    finalScale = scale;\n  }\n  vec2 alignedPosition = (position + alignment) * finalScale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n  vec4 upPosition;\n  vec4 rightPosition = vec4(finalScale.x,0.0,0.0,1.0);\n  if(vertical){\n    upPosition =  modelViewMatrix * vec4( 0.0, 1.0, 0.0, 1.0 ) - finalPosition;\n    normalize(upPosition);\n  }\n  if(vertical){\n    finalPosition.xyz += (rotatedPosition.x * rightPosition.xyz / finalScale.x) + (rotatedPosition.y * upPosition.xyz / scale.y);\n  }else{\n    finalPosition.xy += rotatedPosition;\n  }\n  finalPosition = projectionMatrix * finalPosition;\n  gl_Position = finalPosition;\n}","uniform vec3 color;\nuniform int useMap;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\n\nvoid main() {\n  if(useMap > 0){\n    vec4 texture = texture2D( map, vUV );\n    if ( texture.a < alphaTest ) {\n      discard;\n    }\n    gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n  } else {\n    gl_FragColor = vec4( color, 1.0);\n  }\n  if ( fogType > 0 ) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = 0.0;\n    if ( fogType == 1 ) {\n      fogFactor = smoothstep( fogNear, fogFar, depth );\n    } else {\n      const float LOG2 = 1.442695;\n      float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n      fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n    }\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n  }\n}",r),a.attributes={},a.uniforms={},a.attributes.position=t.getAttribLocation(a.program,"position"),a.attributes.uv=t.getAttribLocation(a.program,"uv"),a.uniforms.uvOffset=t.getUniformLocation(a.program,"uvOffset"),a.uniforms.uvScale=t.getUniformLocation(a.program,"uvScale"),a.uniforms.rotation=t.getUniformLocation(a.program,"rotation"),a.uniforms.scale=t.getUniformLocation(a.program,"scale"),a.uniforms.alignment=t.getUniformLocation(a.program,"alignment"),a.uniforms.color=t.getUniformLocation(a.program,"color"),a.uniforms.useMap=t.getUniformLocation(a.program,"useMap"),a.uniforms.map=t.getUniformLocation(a.program,"map"),a.uniforms.opacity=t.getUniformLocation(a.program,"opacity"),a.uniforms.vertical=t.getUniformLocation(a.program,"vertical"),a.uniforms.fixedSize=t.getUniformLocation(a.program,"fixedSize"),a.uniforms.useScreenCoordinates=t.getUniformLocation(a.program,"useScreenCoordinates"),a.uniforms.sizeAttenuation=t.getUniformLocation(a.program,"sizeAttenuation"),a.uniforms.screenPosition=t.getUniformLocation(a.program,"screenPosition"),a.uniforms.modelViewMatrix=t.getUniformLocation(a.program,"modelViewMatrix"),a.uniforms.projectionMatrix=t.getUniformLocation(a.program,"projectionMatrix"),a.uniforms.fogType=t.getUniformLocation(a.program,"fogType"),a.uniforms.fogDensity=t.getUniformLocation(a.program,"fogDensity"),a.uniforms.fogNear=t.getUniformLocation(a.program,"fogNear"),a.uniforms.fogFar=t.getUniformLocation(a.program,"fogFar"),a.uniforms.fogColor=t.getUniformLocation(a.program,"fogColor"),a.uniforms.alphaTest=t.getUniformLocation(a.program,"alphaTest"),this.inited=!0};var o,s,l;this.render=function(e,r,h,c,u,f){this.inited||this.init(e);var p=new _e(r),d=p.size();if(d){var m=a.attributes,g=a.uniforms;o=.5*c,s=.5*u,l=u;var v=!1;e.pm.currentProgram!=a.program&&(t.useProgram(a.program),e.pm.currentProgram=a.program,e._currentGroupHash=null,t.enableVertexAttribArray(m.position),t.enableVertexAttribArray(m.uv),t.disable(t.CULL_FACE),t.bindBuffer(t.ARRAY_BUFFER,a.vertexBuffer),t.vertexAttribPointer(m.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(m.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),this.enable=!0,v=!0),v&&t.uniformMatrix4fv(g.projectionMatrix,!1,h.projectionMatrix.elements),v&&t.activeTexture(t.TEXTURE0),v&&t.uniform1i(g.map,0);var y=0,A=0,x=e.fog;x?(t.uniform3f(g.fogColor,x.color.r,x.color.g,x.color.b),x instanceof oe.Fog?(t.uniform1f(g.fogNear,x.near),t.uniform1f(g.fogFar,x.far),t.uniform1i(g.fogType,1),y=1,A=1):x instanceof oe.FogExp2&&(t.uniform1f(g.fogDensity,x.density),t.uniform1i(g.fogType,2),y=2,A=2)):(y=0,A=0);var _,w,b;for(_=0;_<d;_++)w=p.get(_),b=f||w.material,i.isVisible(w)&&0!==b.opacity&&(w.updateWorldMatrix(!0,!1),b.useScreenCoordinates?w.z=-w.position.z:(w._modelViewMatrix=new oe.Mat4,w._modelViewMatrix.multiplyMatrices(h.worldMatrixInverse,w.worldMatrix),w.z=-w._modelViewMatrix.elements[14]));for(_=0;_<d;_++)w=p.get(_),this.renderBillboard(w,g,e,y,A,null,f),w._selected&&(w._scale.x=1.01*w._scale.x,w._scale.y=1.01*w._scale.y,w.material.clone(n),n.map=null,n.color.set(65280),this.renderBillboard(w,g,e,y,A,n),w._scale.x=w._scale.x/1.01,w._scale.y=w._scale.y/1.01)}},this.disable=function(){if(this.enable){var e=a.attributes;a.uniforms;t.disableVertexAttribArray(e.position),t.disableVertexAttribArray(e.uv),i._oldDoubleSided||t.enable(t.CULL_FACE),i._oldBlending===oe.NoBlending&&t.disable(t.BLEND),We.setDepthWrite(!0,i),this.enable=!1,this.lastMaterialId=null,i.pm.currentProgram=null}},this.renderBillboard=function(e,r,n,h,c,u,f){var p,d,m,g=[],v=new he;if(p=u||(f||e.material),i.isVisible(e)&&0!==p.opacity){var y=!(p.id==this.lastMaterialId);y&&t.uniform1f(r.alphaTest,p.alphaTest),y&&(!0===p.useScreenCoordinates?(t.uniform1i(r.useScreenCoordinates,1),t.uniform3f(r.screenPosition,(e.position.x*i.devicePixelRatio-o)/o,(s-e.position.y*i.devicePixelRatio)/s,Math.max(0,Math.min(1,e.position.z)))):(t.uniform1i(r.useScreenCoordinates,0),t.uniform1i(r.sizeAttenuation,p.sizeAttenuation?1:0))),!0===p.useScreenCoordinates?(g[0]=i.devicePixelRatio,g[1]=i.devicePixelRatio):(t.uniformMatrix4fv(r.modelViewMatrix,!1,e._modelViewMatrix.elements),g[0]=1,g[1]=1),h!==(m=n.fog&&p.fog?c:0)&&(t.uniform1i(r.fogType,m),h=m),d=1/(p.scaleByViewport?l:1),v.getScaleFromMatrix(e.worldMatrix),g[0]*=d*v.x,g[1]*=d*v.y,y&&(t.uniform2f(r.uvScale,p.repeat.x,p.repeat.y),t.uniform2f(r.uvOffset,p.offset.x,p.offset.y),t.uniform2f(r.alignment,p.alignment.x,p.alignment.y),t.uniform1f(r.opacity,p.opacity),t.uniform1i(r.vertical,p.vertical),t.uniform1f(r.fixedSize,p.fixedSize),t.uniform3f(r.color,p.color.r,p.color.g,p.color.b),t.uniform1f(r.rotation,e.rotation)),t.uniform2fv(r.scale,g),y&&(i.setBlending(p.blending,p.blendEquation,p.blendSrc,p.blendDst),i.setDepthTest(p.depthTest),i.setDepthWrite(p.depthMask)),p.map&&p.map._image&&i.pm.addTexture(p.map),y=y||p.map&&i.pm.needsUpdateTexture(p.map),p.map&&p.map._image&&p.map._image.width?(y&&i.setTexture(p.map,0),y&&t.uniform1i(r.useMap,1)):y&&t.uniform1i(r.useMap,0),u?(y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),y&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,a.lines,t.STATIC_DRAW),y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),t.drawElements(t.LINES,8,t.UNSIGNED_SHORT,0)):(y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),y&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,a.faces,t.STATIC_DRAW),y&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)),this.lastMaterialId=p.id}}},oe.ShaderFlare={flare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},oe.FlareRenderer=function(){var e,t,i,r,a,n,o,s,l,h;this.init=function(c){this.enable=!0,s=c._gl,l=c,h=c.getPrecision();var u=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),f=new Uint16Array([0,1,2,0,2,3]);e=s.createBuffer(),t=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,e),s.bufferData(s.ARRAY_BUFFER,u,s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),s.bufferData(s.ELEMENT_ARRAY_BUFFER,f,s.STATIC_DRAW),n=s.createTexture(),o=s.createTexture(),s.bindTexture(s.TEXTURE_2D,n),s.texImage2D(s.TEXTURE_2D,0,s.RGB,16,16,0,s.RGB,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.bindTexture(s.TEXTURE_2D,o),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,16,16,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),i=this.createProgram(oe.ShaderFlare.flare),r={vertex:s.getAttribLocation(i,"position"),uv:s.getAttribLocation(i,"uv")},a={renderType:s.getUniformLocation(i,"renderType"),map:s.getUniformLocation(i,"map"),occlusionMap:s.getUniformLocation(i,"occlusionMap"),opacity:s.getUniformLocation(i,"opacity"),color:s.getUniformLocation(i,"color"),scale:s.getUniformLocation(i,"scale"),rotation:s.getUniformLocation(i,"rotation"),screenPosition:s.getUniformLocation(i,"screenPosition")},this.inited=!0},this.render=function(h,c,u,f,p){if(this.inited||this.init(h),l=h,0!==c.length){var d=new he,m=p/f,g=.5*f,v=.5*p,y=16/p,A=new le(y*m,y),x=new he(1,1,0),_=new le(1,1),w=new oe.Box2;if(w.min.set(0,0),w.max.set(f-16,p-16),h.pm.currentProgram!=i){s.useProgram(i),h.pm.currentProgram=i,h._currentGroupHash=null,s.enableVertexAttribArray(r.vertex),s.enableVertexAttribArray(r.uv),s.uniform1i(a.occlusionMap,0),s.uniform1i(a.map,1),s.bindBuffer(s.ARRAY_BUFFER,e),s.vertexAttribPointer(r.vertex,2,s.FLOAT,!1,16,0),s.vertexAttribPointer(r.uv,2,s.FLOAT,!1,16,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),s.disable(s.CULL_FACE),this.enable=!0;for(var b=0,M=c.length;b<M;b++){y=16/p,A.set(y*m,y);var S=c[b].node;if(d.set(S.worldMatrix.elements[12],S.worldMatrix.elements[13],S.worldMatrix.elements[14]),d.applyMatrix4(u.worldMatrixInverse),d.applyMatrix4(u.projectionMatrix),x.copy(d),_.x=0+x.x*g+g-8,_.y=0+x.y*v+v-8,!0===w.containsPoint(_)){s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGB,_.x/2,_.y/2,16,16,0),s.uniform1i(a.renderType,0),s.uniform2f(a.scale,A.x,A.y),s.uniform3f(a.screenPosition,x.x,x.y,x.z),s.disable(s.BLEND),s.enable(s.DEPTH_TEST),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),s.uniform1i(a.renderType,1),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,o),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,_.x/2,_.y/2,16,16,0),s.uniform1i(a.renderType,1),s.disable(s.DEPTH_TEST),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),S.positionScreen=x,S.customUpdateCallback?S.customUpdateCallback(S):S.updateLensFlares(),s.uniform1i(a.renderType,2),s.enable(s.BLEND);for(var P=0,C=S.lensFlares.length;P<C;P++){var T=S.lensFlares[P];T.opacity>.001&&T.scale>.001&&(x.x=T.x,x.y=T.y,x.z=T.z,y=T.size*T.scale/p,A.x=y*m,A.y=y,s.uniform3f(a.screenPosition,x.x,x.y,x.z),s.uniform2f(a.scale,A.x,A.y),s.uniform1f(a.rotation,T.rotation),s.uniform1f(a.opacity,T.opacity),s.uniform3f(a.color,T.color.r,T.color.g,T.color.b),l.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,T.texture),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0))}}}s.enable(s.CULL_FACE),s.enable(s.DEPTH_TEST)}}},this.createProgram=function(e){var t=s.createProgram(),i=s.createShader(s.FRAGMENT_SHADER),r=s.createShader(s.VERTEX_SHADER),a="precision "+h+" float;\n";return s.shaderSource(i,a+e.fragmentShader),s.shaderSource(r,a+e.vertexShader),s.compileShader(i),s.compileShader(r),s.attachShader(t,i),s.attachShader(t,r),s.linkProgram(t),t},this.disable=function(){this.enable&&(s.disableVertexAttribArray(r.vertex),s.disableVertexAttribArray(r.uv),l._oldDoubleSided||s.enable(s.CULL_FACE),l._oldBlending===oe.NoBlending&&s.disable(s.BLEND),We.setDepthWrite(!0,l),this.enable=!1,this.lastMaterialId=null,l.pm.currentProgram=null)}};var $e,et="l=1.0\ntype=1\ngis=0\n3d=1\nstart=2019-03-20\nend=2019-07-01\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=0fb96ee93f37a6603252b338dcfbc35b78dbdfb1d072b66079fd1800f014a4e3d15bbd8affdd14a45bd9862b55484b09a3df758496502263f578707ad37442d97d62f6c8c97650dcc38beb07816764fc1cec5843583d636374b87eece9a11fce13805836df7498bb0d21f93646d68d8654ebb84b79507f8922d00f0cd45927721fa174a8632db5abf8d2f2a39cf1ed508663d9885af1558c8642100fb17d3d0e4dc90e372b1b92ea9c3fe5b1ecc4823f1988786a4402c7b80d37e9c8c5cb5c0a8b72f055b424a376ba154e1e497b0d575c87da57415698fc1167dfbe1c5f983d0b168e66b3db682d3a145ab5d4d41c8459ea89bca91c0c8f90d8402d734821e73d73385330b79822a760dc9f5c0c443093797bc6e56be454d6479c04ccee7bfcf233d49474f64ab3e24a62f66548e4544c8c3f6cf4bfda4160d4d8fa09e3f8c33dd235886095c02030e89896459c1d9bb126ea122511ba48925dd3cdb5da83294418340f1035b81d539959f8baa02c6144bfa0389e899e34e4499e8be034c764528b60ef1f214c3a1ed5bb973e2e61d2a72b3a77aa9522c34995f8f4c859ee183392950aee78b02a58694850b8973f2e3b3d68abe81ba051d39cc2334319cb40b992a72d73cd09fde604f23586337dd07888138082cbe13995750f510e7c135651297afad43d426d855efc1381f9a560132e397f9055b27b5448d5290e078f782cd449a7c41b04d246b989b14bb9370c146e15e39c9a0ba04009a73899567b4b4aabcc992dbd8dd6ceff451cc4f729a4c4c007c21811b6c0967042bc4484a23f734909caed88644eb48f4f20cc24f7163c82305e9313f25965d7086c33ef55cd4bcc916102008cf9337f864060b0d3e013f09f065415cfac2fcd13c59cc30d57";"Microsoft Internet Explorer"==navigator.appName?(v.prototype.am=function(e,t,i,r,a,n){for(var o=32767&t,s=t>>15;--n>=0;){var l=32767&this[e],h=this[e++]>>15,c=s*l+h*o;a=((l=o*l+((32767&c)<<15)+i[r]+(1073741823&a))>>>30)+(c>>>15)+s*h+(a>>>30),i[r++]=1073741823&l}return a},$e=30):"Netscape"!=navigator.appName?(v.prototype.am=function(e,t,i,r,a,n){for(;--n>=0;){var o=t*this[e++]+i[r]+a;a=Math.floor(o/67108864),i[r++]=67108863&o}return a},$e=26):(v.prototype.am=function(e,t,i,r,a,n){for(var o=16383&t,s=t>>14;--n>=0;){var l=16383&this[e],h=this[e++]>>14,c=s*l+h*o;a=((l=o*l+((16383&c)<<14)+i[r]+a)>>28)+(c>>14)+s*h,i[r++]=268435455&l}return a},$e=28),v.prototype.DB=$e,v.prototype.DM=(1<<$e)-1,v.prototype.DV=1<<$e;v.prototype.FV=Math.pow(2,52),v.prototype.F1=52-$e,v.prototype.F2=2*$e-52;var tt,it,rt="0123456789abcdefghijklmnopqrstuvwxyz",at=new Array;for(tt="0".charCodeAt(0),it=0;it<=9;++it)at[tt++]=it;for(tt="a".charCodeAt(0),it=10;it<36;++it)at[tt++]=it;for(tt="A".charCodeAt(0),it=10;it<36;++it)at[tt++]=it;b.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},b.prototype.revert=function(e){return e},b.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},b.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},b.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},M.prototype.convert=function(e){var t=y();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(v.ZERO)>0&&this.m.subTo(t,t),t},M.prototype.revert=function(e){var t=y();return e.copyTo(t),this.reduce(t),t},M.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var i=32767&e[t],r=i*this.mpl+((i*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[i=t+this.m.t]+=this.m.am(0,r,e,t,0,this.m.t);e[i]>=e.DV;)e[i]-=e.DV,e[++i]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},M.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},M.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},v.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},v.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},v.prototype.fromString=function(e,t){var i;if(16==t)i=4;else if(8==t)i=3;else if(256==t)i=8;else if(2==t)i=1;else if(32==t)i=5;else{if(4!=t)return void this.fromRadix(e,t);i=2}this.t=0,this.s=0;for(var r=e.length,a=!1,n=0;--r>=0;){var o=8==i?255&e[r]:x(e,r);o<0?"-"==e.charAt(r)&&(a=!0):(a=!1,0==n?this[this.t++]=o:n+i>this.DB?(this[this.t-1]|=(o&(1<<this.DB-n)-1)<<n,this[this.t++]=o>>this.DB-n):this[this.t-1]|=o<<n,(n+=i)>=this.DB&&(n-=this.DB))}8==i&&0!=(128&e[0])&&(this.s=-1,n>0&&(this[this.t-1]|=(1<<this.DB-n)-1<<n)),this.clamp(),a&&v.ZERO.subTo(this,this)},v.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},v.prototype.dlShiftTo=function(e,t){var i;for(i=this.t-1;i>=0;--i)t[i+e]=this[i];for(i=e-1;i>=0;--i)t[i]=0;t.t=this.t+e,t.s=this.s},v.prototype.drShiftTo=function(e,t){for(var i=e;i<this.t;++i)t[i-e]=this[i];t.t=Math.max(this.t-e,0),t.s=this.s},v.prototype.lShiftTo=function(e,t){var i,r=e%this.DB,a=this.DB-r,n=(1<<a)-1,o=Math.floor(e/this.DB),s=this.s<<r&this.DM;for(i=this.t-1;i>=0;--i)t[i+o+1]=this[i]>>a|s,s=(this[i]&n)<<r;for(i=o-1;i>=0;--i)t[i]=0;t[o]=s,t.t=this.t+o+1,t.s=this.s,t.clamp()},v.prototype.rShiftTo=function(e,t){t.s=this.s;var i=Math.floor(e/this.DB);if(i>=this.t)t.t=0;else{var r=e%this.DB,a=this.DB-r,n=(1<<r)-1;t[0]=this[i]>>r;for(var o=i+1;o<this.t;++o)t[o-i-1]|=(this[o]&n)<<a,t[o-i]=this[o]>>r;r>0&&(t[this.t-i-1]|=(this.s&n)<<a),t.t=this.t-i,t.clamp()}},v.prototype.subTo=function(e,t){for(var i=0,r=0,a=Math.min(e.t,this.t);i<a;)r+=this[i]-e[i],t[i++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;i<this.t;)r+=this[i],t[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<e.t;)r-=e[i],t[i++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[i++]=this.DV+r:r>0&&(t[i++]=r),t.t=i,t.clamp()},v.prototype.multiplyTo=function(e,t){var i=this.abs(),r=e.abs(),a=i.t;for(t.t=a+r.t;--a>=0;)t[a]=0;for(a=0;a<r.t;++a)t[a+i.t]=i.am(0,r[a],t,a,0,i.t);t.s=0,t.clamp(),this.s!=e.s&&v.ZERO.subTo(t,t)},v.prototype.squareTo=function(e){for(var t=this.abs(),i=e.t=2*t.t;--i>=0;)e[i]=0;for(i=0;i<t.t-1;++i){var r=t.am(i,t[i],e,2*i,0,1);(e[i+t.t]+=t.am(i+1,2*t[i],e,2*i+1,r,t.t-i-1))>=t.DV&&(e[i+t.t]-=t.DV,e[i+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(i,t[i],e,2*i,0,1)),e.s=0,e.clamp()},v.prototype.divRemTo=function(e,t,i){var r=e.abs();if(!(r.t<=0)){var a=this.abs();if(a.t<r.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=y());var n=y(),o=this.s,s=e.s,l=this.DB-w(r[r.t-1]);l>0?(r.lShiftTo(l,n),a.lShiftTo(l,i)):(r.copyTo(n),a.copyTo(i));var h=n.t,c=n[h-1];if(0!=c){var u=c*(1<<this.F1)+(h>1?n[h-2]>>this.F2:0),f=this.FV/u,p=(1<<this.F1)/u,d=1<<this.F2,m=i.t,g=m-h,A=null==t?y():t;for(n.dlShiftTo(g,A),i.compareTo(A)>=0&&(i[i.t++]=1,i.subTo(A,i)),v.ONE.dlShiftTo(h,A),A.subTo(n,n);n.t<h;)n[n.t++]=0;for(;--g>=0;){var x=i[--m]==c?this.DM:Math.floor(i[m]*f+(i[m-1]+d)*p);if((i[m]+=n.am(0,x,i,g,0,h))<x)for(n.dlShiftTo(g,A),i.subTo(A,i);i[m]<--x;)i.subTo(A,i)}null!=t&&(i.drShiftTo(h,t),o!=s&&v.ZERO.subTo(t,t)),i.t=h,i.clamp(),l>0&&i.rShiftTo(l,i),o<0&&v.ZERO.subTo(i,i)}}},v.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return t=t*(2-(15&e)*t)&15,t=t*(2-(255&e)*t)&255,t=t*(2-((65535&e)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t},v.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},v.prototype.exp=function(e,t){if(e>4294967295||e<1)return v.ONE;var i=y(),r=y(),a=t.convert(this),n=w(e)-1;for(a.copyTo(i);--n>=0;)if(t.sqrTo(i,r),(e&1<<n)>0)t.mulTo(r,a,i);else{var o=i;i=r,r=o}return t.revert(i)},v.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var i,r=(1<<t)-1,a=!1,n="",o=this.t,s=this.DB-o*this.DB%t;if(o-- >0)for(s<this.DB&&(i=this[o]>>s)>0&&(a=!0,n=A(i));o>=0;)s<t?(i=(this[o]&(1<<s)-1)<<t-s,i|=this[--o]>>(s+=this.DB-t)):(i=this[o]>>(s-=t)&r,s<=0&&(s+=this.DB,--o)),i>0&&(a=!0),a&&(n+=A(i));return a?n:"0"},v.prototype.negate=function(){var e=y();return v.ZERO.subTo(this,e),e},v.prototype.abs=function(){return this.s<0?this.negate():this},v.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var i=this.t;if(0!=(t=i-e.t))return t;for(;--i>=0;)if(0!=(t=this[i]-e[i]))return t;return 0},v.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+w(this[this.t-1]^this.s&this.DM)},v.prototype.mod=function(e){var t=y();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(v.ZERO)>0&&e.subTo(t,t),t},v.prototype.modPowInt=function(e,t){var i;return i=e<256||t.isEven()?new b(t):new M(t),this.exp(e,i)},v.ZERO=_(0),v.ONE=_(1),D.prototype.convert=L,D.prototype.revert=L,D.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i)},D.prototype.sqrTo=function(e,t){e.squareTo(t)},R.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=y();return e.copyTo(t),this.reduce(t),t},R.prototype.revert=function(e){return e},R.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},R.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},R.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var nt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ot=(1<<26)/nt[nt.length-1];v.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},v.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),i=Math.pow(e,t),r=_(i),a=y(),n=y(),o="";for(this.divRemTo(r,a,n);a.signum()>0;)o=(i+n.intValue()).toString(e).substr(1)+o,a.divRemTo(r,a,n);return n.intValue().toString(e)+o},v.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var i=this.chunkSize(t),r=Math.pow(t,i),a=!1,n=0,o=0,s=0;s<e.length;++s){var l=x(e,s);l<0?"-"==e.charAt(s)&&0==this.signum()&&(a=!0):(o=t*o+l,++n>=i&&(this.dMultiply(r),this.dAddOffset(o,0),n=0,o=0))}n>0&&(this.dMultiply(Math.pow(t,n)),this.dAddOffset(o,0)),a&&v.ZERO.subTo(this,this)},v.prototype.fromNumber=function(e,t,i){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,i),this.testBit(e-1)||this.bitwiseTo(v.ONE.shiftLeft(e-1),P,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(v.ONE.shiftLeft(e-1),this);else{var r=new Array,a=7&e;r.length=1+(e>>3),t.nextBytes(r),a>0?r[0]&=(1<<a)-1:r[0]=0,this.fromString(r,256)}},v.prototype.bitwiseTo=function(e,t,i){var r,a,n=Math.min(e.t,this.t);for(r=0;r<n;++r)i[r]=t(this[r],e[r]);if(e.t<this.t){for(a=e.s&this.DM,r=n;r<this.t;++r)i[r]=t(this[r],a);i.t=this.t}else{for(a=this.s&this.DM,r=n;r<e.t;++r)i[r]=t(a,e[r]);i.t=e.t}i.s=t(this.s,e.s),i.clamp()},v.prototype.changeBit=function(e,t){var i=v.ONE.shiftLeft(e);return this.bitwiseTo(i,t,i),i},v.prototype.addTo=function(e,t){for(var i=0,r=0,a=Math.min(e.t,this.t);i<a;)r+=this[i]+e[i],t[i++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;i<this.t;)r+=this[i],t[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<e.t;)r+=e[i],t[i++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[i++]=r:r<-1&&(t[i++]=this.DV+r),t.t=i,t.clamp()},v.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},v.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},v.prototype.multiplyLowerTo=function(e,t,i){var r=Math.min(this.t+e.t,t);for(i.s=0,i.t=r;r>0;)i[--r]=0;var a;for(a=i.t-this.t;r<a;++r)i[r+this.t]=this.am(0,e[r],i,r,0,this.t);for(a=Math.min(e.t,t);r<a;++r)this.am(0,e[r],i,r,0,t-r);i.clamp()},v.prototype.multiplyUpperTo=function(e,t,i){--t;var r=i.t=this.t+e.t-t;for(i.s=0;--r>=0;)i[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)i[this.t+r-t]=this.am(t-r,e[r],i,0,0,this.t+r-t);i.clamp(),i.drShiftTo(1,i)},v.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,i=this.s<0?e-1:0;if(this.t>0)if(0==t)i=this[0]%e;else for(var r=this.t-1;r>=0;--r)i=(t*i+this[r])%e;return i},v.prototype.millerRabin=function(e){var t=this.subtract(v.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var r=t.shiftRight(i);(e=e+1>>1)>nt.length&&(e=nt.length);for(var a=y(),n=0;n<e;++n){a.fromInt(nt[Math.floor(Math.random()*nt.length)]);var o=a.modPow(r,this);if(0!=o.compareTo(v.ONE)&&0!=o.compareTo(t)){for(var s=1;s++<i&&0!=o.compareTo(t);)if(0==(o=o.modPowInt(2,this)).compareTo(v.ONE))return!1;if(0!=o.compareTo(t))return!1}}return!0},v.prototype.clone=function(){var e=y();return this.copyTo(e),e},v.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},v.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},v.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},v.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},v.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var i,r=this.DB-e*this.DB%8,a=0;if(e-- >0)for(r<this.DB&&(i=this[e]>>r)!=(this.s&this.DM)>>r&&(t[a++]=i|this.s<<this.DB-r);e>=0;)r<8?(i=(this[e]&(1<<r)-1)<<8-r,i|=this[--e]>>(r+=this.DB-8)):(i=this[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&i)&&(i|=-256),0==a&&(128&this.s)!=(128&i)&&++a,(a>0||i!=this.s)&&(t[a++]=i);return t},v.prototype.equals=function(e){return 0==this.compareTo(e)},v.prototype.min=function(e){return this.compareTo(e)<0?this:e},v.prototype.max=function(e){return this.compareTo(e)>0?this:e},v.prototype.and=function(e){var t=y();return this.bitwiseTo(e,S,t),t},v.prototype.or=function(e){var t=y();return this.bitwiseTo(e,P,t),t},v.prototype.xor=function(e){var t=y();return this.bitwiseTo(e,C,t),t},v.prototype.andNot=function(e){var t=y();return this.bitwiseTo(e,T,t),t},v.prototype.not=function(){for(var e=y(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},v.prototype.shiftLeft=function(e){var t=y();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},v.prototype.shiftRight=function(e){var t=y();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},v.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+E(this[e]);return this.s<0?this.t*this.DB:-1},v.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,i=0;i<this.t;++i)e+=z(this[i]^t);return e},v.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},v.prototype.setBit=function(e){return this.changeBit(e,P)},v.prototype.clearBit=function(e){return this.changeBit(e,T)},v.prototype.flipBit=function(e){return this.changeBit(e,C)},v.prototype.add=function(e){var t=y();return this.addTo(e,t),t},v.prototype.subtract=function(e){var t=y();return this.subTo(e,t),t},v.prototype.multiply=function(e){var t=y();return this.multiplyTo(e,t),t},v.prototype.divide=function(e){var t=y();return this.divRemTo(e,t,null),t},v.prototype.remainder=function(e){var t=y();return this.divRemTo(e,null,t),t},v.prototype.divideAndRemainder=function(e){var t=y(),i=y();return this.divRemTo(e,t,i),new Array(t,i)},v.prototype.modPow=function(e,t){var i,r,a=e.bitLength(),n=_(1);if(a<=0)return n;i=a<18?1:a<48?3:a<144?4:a<768?5:6,r=a<8?new b(t):t.isEven()?new R(t):new M(t);var o=new Array,s=3,l=i-1,h=(1<<i)-1;if(o[1]=r.convert(this),i>1){var c=y();for(r.sqrTo(o[1],c);s<=h;)o[s]=y(),r.mulTo(c,o[s-2],o[s]),s+=2}var u,f,p=e.t-1,d=!0,m=y();for(a=w(e[p])-1;p>=0;){for(a>=l?u=e[p]>>a-l&h:(u=(e[p]&(1<<a+1)-1)<<l-a,p>0&&(u|=e[p-1]>>this.DB+a-l)),s=i;0==(1&u);)u>>=1,--s;if((a-=s)<0&&(a+=this.DB,--p),d)o[u].copyTo(n),d=!1;else{for(;s>1;)r.sqrTo(n,m),r.sqrTo(m,n),s-=2;s>0?r.sqrTo(n,m):(f=n,n=m,m=f),r.mulTo(m,o[u],n)}for(;p>=0&&0==(e[p]&1<<a);)r.sqrTo(n,m),f=n,n=m,m=f,--a<0&&(a=this.DB-1,--p)}return r.revert(n)},v.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return v.ZERO;for(var i=e.clone(),r=this.clone(),a=_(1),n=_(0),o=_(0),s=_(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),t?(a.isEven()&&n.isEven()||(a.addTo(this,a),n.subTo(e,n)),a.rShiftTo(1,a)):n.isEven()||n.subTo(e,n),n.rShiftTo(1,n);for(;r.isEven();)r.rShiftTo(1,r),t?(o.isEven()&&s.isEven()||(o.addTo(this,o),s.subTo(e,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);i.compareTo(r)>=0?(i.subTo(r,i),t&&a.subTo(o,a),n.subTo(s,n)):(r.subTo(i,r),t&&o.subTo(a,o),s.subTo(n,s))}return 0!=r.compareTo(v.ONE)?v.ZERO:s.compareTo(e)>=0?s.subtract(e):s.signum()<0?(s.addTo(e,s),s.signum()<0?s.add(e):s):s},v.prototype.pow=function(e){return this.exp(e,new D)},v.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),i=e.s<0?e.negate():e.clone();if(t.compareTo(i)<0){var r=t;t=i,i=r}var a=t.getLowestSetBit(),n=i.getLowestSetBit();if(n<0)return t;for(a<n&&(n=a),n>0&&(t.rShiftTo(n,t),i.rShiftTo(n,i));t.signum()>0;)(a=t.getLowestSetBit())>0&&t.rShiftTo(a,t),(a=i.getLowestSetBit())>0&&i.rShiftTo(a,i),t.compareTo(i)>=0?(t.subTo(i,t),t.rShiftTo(1,t)):(i.subTo(t,i),i.rShiftTo(1,i));return n>0&&i.lShiftTo(n,i),i},v.prototype.isProbablePrime=function(e){var t,i=this.abs();if(1==i.t&&i[0]<=nt[nt.length-1]){for(t=0;t<nt.length;++t)if(i[0]==nt[t])return!0;return!1}if(i.isEven())return!1;for(t=1;t<nt.length;){for(var r=nt[t],a=t+1;a<nt.length&&r<ot;)r*=nt[a++];for(r=i.modInt(r);t<a;)if(r%nt[t++]==0)return!1}return i.millerRabin(e)},v.prototype.square=function(){var e=y();return this.squareTo(e),e},N.prototype.init=function(e){var t,i,r;for(t=0;t<256;++t)this.S[t]=t;for(i=0,t=0;t<256;++t)i=i+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[i],this.S[i]=r;this.i=0,this.j=0},N.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var st,lt,ht,ct=256;if(null==lt){lt=new Array,ht=0;var ut;if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&window.crypto){var ft=window.crypto.random(32);for(ut=0;ut<ft.length;++ut)lt[ht++]=255&ft.charCodeAt(ut)}for(;ht<ct;)ut=Math.floor(65536*Math.random()),lt[ht++]=ut>>>8,lt[ht++]=255&ut;ht=0,F()}U.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=V()};X.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},X.prototype.setPublic=function(e,t){this.n=k(e,16),this.e=parseInt(t,16)},X.prototype.encrypt=function(e){var t=O(e,this.n.bitLength()+7>>3);if(null==t)return null;var i=this.doPrivate(t);if(null==i)return null;var r=i.toString(16);return 0==(1&r.length)?r:"0"+r},X.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),i=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(i)<0;)t=t.add(this.p);return t.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)},X.prototype.setPrivate=function(e,t,i){this.n=k(e,16),this.e=parseInt(t,16),this.d=k(i,16)},X.prototype.setPrivateEx=function(e,t,i,r,a,n,o,s){this.n=k(e,16),this.e=parseInt(t,16),this.d=k(i,16),this.p=k(r,16),this.q=k(a,16),this.dmp1=k(n,16),this.dmq1=k(o,16),this.coeff=k(s,16)},X.prototype.decrypt=function(e){var t=k(e,16),i=this.doPublic(t);return null==i?null:G(i,this.n.bitLength()+7>>3)};var pt=function(){dt.v(et)},dt={},mt="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",gt="10001",vt="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047";dt.cross=function(e){if(e){for(var t="",i=0;i<e.length;)i+1<e.length?(t+=e[i+1],t+=e[i]):t+=e[i],i+=2;return t}return null},dt.reverse=function(e){if(e){for(var t="",i=e.length;i>0;i--)t+=e[i-1];return t}return null},dt.v=function(e){if(e){var t=dt;if(t.start=null,t.beginDate=null,t.end=null,t.endDate=null,t.gis=null,t["3D"]=null,t["3d"]=null,t.l=null,t.__li__=null,e.indexOf("signature=")>0){var i=e.split("signature="),r=i[0],a=i[1],n=new X;n.setPublic(mt,gt);for(var o=a,s=o.length,l=0,h="",c="";l<s;)h=o.substr(l,256),c+=n.decrypt(h),l+=256;if(c===r)return t.i(e),!0}}return!1},dt.i=function(e){var i=dt;i.__li__=e;var r,a,n,o,s=e.split("\n");for(r=0;r<s.length;r++)a=(o=s[r].split("="))[0],n=o[1],i[a]=n;i.start!=t&&(i.beginDate=new Date(Date.parse(i.start.replace(/-/g,"/")))),i.end!=t&&(i.endDate=new Date(Date.parse(i.end.replace(/-/g,"/"))));var l=i.gis;l!=t&&(l=parseInt(l)),l&&(i._isPermissionGIS=!0);var h=i["3D"]||i["3d"];h!=t&&(h=parseInt(h)),h&&(i._isPermission3D=!0),i.l!=t&&(i.version=i.l)};var yt=function(e){return e.__li__!==t&&e._isPermission3D},At=function(e){if(!yt(e))return!0;var t=new Date;return null!=e.beginDate&&e.beginDate.getTime()-t.getTime()>=0||null!=e.endDate&&e.endDate.getTime()-t.getTime()<=0};dt.$z=function(e){var t=new X;t.setPublic(mt,gt);for(var i=e,r=i.length,a=0,n="",o="";a<r;)n=i.substr(a,256),o+=t.decrypt(n),a+=256;return o},dt.twm=function(e){var i=dt,r=i.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),a=this.type,n=this.markText;e[i.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341")]=i.__li__;var o=e;if(o._xyz=null,"3"!==a||At(dt)||n!==t){e.DEBUG&&(console.log("license: "+dt.__li__),console.log("license Type : "+a),console.log("beginDate: "+dt.beginDate),console.log("endDate: "+dt.endDate),console.log("mark: "+n)),e.__liLabel==t&&(e.__liLabel=document.createElement("div")),i.startDate===t&&(i.startDate=new Date);var s=(new Date).getTime()-i.startDate.getTime(),l="2"===a?7200:300;if(!(s<1e3*l)){var h=At(i)&&s>1e3*l,c=n;if(h?c=i.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=a||c!==t&&""!=c?"1"!=a||n||(c=r):c=i.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),c!==t){var u=o.__liLabel;u.innerHTML=c,u.type=a,u.mark=n,u.expired=h,o._xyz=u,h&&(o.getView().style.opacity=.1)}}}},Oe.validateLicense(et),oe.Material=function(e){oe.PropertyChangeDispatcher.call(this),this.id=oe.MaterialIdCount++,this.type="basic",this.shaderID="",this.uniforms=t,this.vertexShader="",this.fragmentShader="",this.alarmColor=null,this.name="",this.side=oe.FrontSide,this.fog=!0,this.normalType=t,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecolor=new oe.Color(16777215),this.wireframeLineopacity=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=2,this.gradientColors=3,this.blendMode=oe.NormalBlending,this.blendSrc=oe.SrcAlphaFactor,this.blendDst=oe.OneMinusSrcAlphaFactor,this.blendEquation=oe.AddEquation,this.depthTest=!0,this.depthMask=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.transparent=!1,this.opacity=1,this.visible=!0,this.needsUpdate=!0,this.setValues(e),this.useCount=0,this.styleMap={},this.offset=new le(0,0),this.repeat=new le(1,1),this.gradient={},this.gradientType=1,this.gradientCenter=new le(.5,.5),this.outline=0},oe.extend(oe.Material,oe.PropertyChangeDispatcher,{generateKey:function(){},setMap:function(e,t){if(null==t&&(t="map"),this[t]!==e){var i=this[t];this[t]=e,this.firePropertyChange(t,i,e),this.onMapChanged(i,e)}},handleTextureChange:function(e){if("image"===e.property){this.firePropertyChange("needsUpdate",!1,!0)}else e.property},onPropertyChange:function(e,t,i){},onMapChanged:function(e,t){if(oe.TexturePool.useTexture(t),oe.TexturePool.unUseTexture(e),t){var i=t.getUniqueCode();null==oe.TexturePool.getTexture(i)&&oe.TexturePool.setTexture(i,t)}},setColor:function(e){if(this.color!==e){var t=this.color.clone();e instanceof oe.Color?this.color.copy(e):this.color.set(e),this.firePropertyChange("color",t,e)}},setPropertyValue:function(e,t){if(this[e]!==t){var i=this[e];if(i instanceof oe.Color)null!=t&&(i=i.clone(),t instanceof oe.Color?this[e].copy(t):this[e].set(t));else if("gradient"==e){var r={};for(var a in t)t[a]instanceof oe.Color?r[a]=t[a]:r[a]=new oe.Color(t[a]);this[e]=r}else this[e]=t;this._uniqueCode=null,this.onPropertyChange(e,i,t),this.firePropertyChange(e,i,t)}},isTextureStyle:function(e){return"terrain"===this._type?e.startsWith("texture1.")||e.startsWith("texture2.")||e.startsWith("textureb.")||e.startsWith("texturen.")||e.startsWith("texturebp."):e.startsWith("texture.")||e.startsWith("lightmap")||e.startsWith("envmap")||e.startsWith("normalmap")||e.startsWith("texturebp")||e.startsWith("specularmap")},setNeedsUpdate:function(e){},getShaderID:function(){return this instanceof oe.BasicMaterial&&(this.shaderID="basic"),this.shaderID},setupMaterialShader:function(){var e=this.getShaderID(),t=oe.ShaderLib[e];t&&(this.uniforms=oe.UniformsUtils.clone(t.uniforms),this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader)},refreshUniforms:function(e,t){this.refreshUniformsCommon(e,t),this.refreshUniformsSpecific(e,t)},loadCameraPosition:function(e,t,i){if((this instanceof oe.ShaderMaterial||this instanceof oe.PhongMaterial||this.envMap||"phong"===this._type)&&null!=e.cameraPosition){var r=t.worldMatrix.getPosition();i.uniform3f(e.cameraPosition,r.x,r.y,r.z)}},loadViewMatrix:function(e,t,i){("lambert"===this.type||"phong"===this.type||this.skinning)&&null!==e.viewMatrix&&i.uniformMatrix4fv(e.viewMatrix,!1,t.worldMatrixInverse.elements)},refreshUniformsSpecific:function(e){},refreshUniformsGradient:function(){var e=this.uniforms;if(Oe.getObjectCount(this.gradient)>0){var t=[],i=[];for(var r in this.gradient)t.push(r);t.sort();for(var a=0;a<t.length;a++)i.push(this.gradient[t[a]]);e.gradientColor.value=i,e.gradientStop.value=t,e.gradientType.value=this.gradientType}},refreshUniformsCommon:function(e){var i=this.uniforms,r=this;i.opacity.value=r.opacity,i.wireframeLinecolor.value=r.wireframeLinecolor,i.wireframeLineopacity.value=r.wireframeLineopacity,r.clipPlane&&i.clipPlane.value.set(r.clipPlane.x,r.clipPlane.y,r.clipPlane.z,r.clipPlane.w),r.rimLightColor&&(i.rimLightColor.value=r.rimLightColor,i.rimLightScale.value=r.rimLightScale),e?i.diffuse.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.color):i.diffuse.value=this.alarmColor?this.alarmColor:this.color,this.refreshUniformsGradient(),i.map.value=r.map,i.lightMap.value=r.lightMap,i.specularMap.value=r.specularMap,i.bumpMap&&r.bumpMap&&(i.bumpMap.value=r.bumpMap,i.bumpScale.value=r.bumpScale),r.normalMap&&"phong"===r._type&&(i.normalMap.value=r.normalMap,i.normalScale.value.copy(r.normalScale));var a;if(r.map?a=r.map:r.specularMap?a=r.specularMap:r.normalMap&&"phong"===r._type?a=r.normalMap:r.bumpMap&&"phong"===r._type&&(a=r.bumpMap),a!=t){var n=this.offset,o=this.repeat;i.offsetRepeat.value.set(n.x,n.y,o.x,o.y),i.flipX.value=a.flipX?1:0,a instanceof oe.CompressedTexture?i.flipY.value=a.flipY?0:1:i.flipY.value=0,i.mapLoaded.value=1,a._image&&!a._image.loaded&&i.offsetRepeat.value.set(0,0,1,1)}i.envMap.value=r.envMap,i.flipEnvMap.value=1,i.reflectivity.value=e?r.reflectRatio*r.reflectRatio:r.reflectRatio,i.refractionRatio.value=r.refractionRatio,i.combine.value=r.combine,i.useRefract.value=r.envMap&&r.envMap.mapping instanceof oe.CubeRefractionMapping},loadGeneralUniforms:function(){},getNormalType:function(){return this&&this.normalType!==t&&this.normalType===oe.NormalTypeSmooth?oe.SmoothShading:oe.FlatShading},isVertexColor:function(){return!!this.vertexColors&&this.vertexColors},isGradientColor:function(){return!!this.gradientColors&&this.gradientColors},needUV:function(){return this.map||this.lightMap||this.bumpMap||this.normalMap||this.specularMap,!0},setValues:function(e){if(e!==t)for(var i in e){var r=e[i];if(r!==t){if(i in this){var a=this[i];a instanceof oe.Color&&r instanceof oe.Color?a.copy(r):a instanceof oe.Color?a.set(r):a instanceof oe.Vec3&&r instanceof oe.Vec3?a.copy(r):this[i]=r}}else console.warn("TGL.Material: '"+i+"' parameter is undefined.")}},isCustomAttributesNeedUpdate:function(){if(!this.attributes)return!1;for(var e in this.attributes)if(this.attributes[e].needsUpdate)return!0;return!1},clearCustomAttributes:function(){if(this.attributes)for(var e in this.attributes)this.attributes[e].needsUpdate=!1},clone:function(e){return e===t&&(e=new oe.Material),e.name=this.name,e.side=this.side,e.blendMode=this.blendMode,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthMask=this.depthMask,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.transparent=this.transparent,e.opacity=this.opacity,e.visible=this.visible,e.normalType=this.normalType,e.wireframe=this.wireframe,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecolor=this.wireframeLinecolor.clone(),e.wireframeLineopacity=this.wireframeLineopacity,e.gradient=this.gradient,e.gradientType=this.gradientType,e.outline=this.outline,e},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),oe.MaterialIdCount=0,oe.EntityMaterial=function(e){oe.Material.call(this),this._type="basic",this.color=new oe.Color(16777215),this.map=null,this.ambient=new oe.Color(16777215),this.emissive=new oe.Color(0),this.specular=new oe.Color(1118481),this.specularStrength=1,this.shininess=30,this.wrapAround=!1,this.wrapRGB=new oe.Vec3(1,1,1),this.lightMap=null,this.specularMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new oe.Vec2(1,1),this.envMap=null,this.combine=oe.MultiplyOperation,this.reflectRatio=1,this.refractionRatio=.98,this.fog=!0,this.shading=oe.SmoothShading,this.skinning=!1,this.maxBones=0,this.morphTargets=!1,this.morphNormals=!1,this.metal=!1,this.perPixel=!0,this.map1=null,this.map2=null,this.blendMap=null,this.detailMap=null,this.specularMap=null,this.blendRange=new le(0,1),this.setValues(e),this.bakeLightMap=!1,this.metalness=0,this.roughness=0},oe.extend(oe.EntityMaterial,oe.Material,{getShaderID:function(){return this.getType()},getUniqueCode:function(){if(null!=this._uniqueCode)return this._uniqueCode;var e=this._type+" "+this.color.r+this.color.g+this.color.b+" "+this.ambient.getUniqueCode()+" "+this.emissive.getUniqueCode()+this.specular.getUniqueCode()+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth+" "+this.wireframeLinecolor+" "+this.wireframeLineopacity+" "+this.polygonOffset+" "+this.polygonOffsetFactor+" "+this.polygonOffsetUnits+" "+this.overdraw+" "+this.shininess+" "+this.metal+" "+this.specularStrength;if(this.clipPlane&&(e+=" "+this.clipPlane+" "),this.rimLightColor&&(e+=" "+this.rimLightColor.getUniqueCode()+" "+this.rimLightScale+" "),this.alphaTest&&(e+=this.alphaTest),e+=" "+this.normalType+" ",e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,e+=" "+this.blendRange.x+" "+this.blendRange.y,e+=" "+this.normalScale.x+" "+this.normalScale.y,e+=" "+this.bumpScale,e+=" "+this.reflectRatio,this.map&&(e+=this.map.getUniqueCode()),this.map1&&(e+=this.map1.getUniqueCode()),this.map2&&(e+=this.map2.getUniqueCode()),this.blendMap&&(e+=this.blendMap.getUniqueCode()),this.bumpMap&&(e+=this.bumpMap.getUniqueCode()),this.normalMap&&(e+=this.normalMap.getUniqueCode()),this.lightMap&&(e+=this.lightMap.getUniqueCode()),this.envMap&&(e+=this.envMap.getUniqueCode()),this.specularMap&&(e+=this.specularMap.getUniqueCode()),this.alarmColor&&(e+=" "+this.alarmColor.getUniqueCode()),this.roughness&&(e+=" "+this.roughness),this.metalness&&(e+=" "+this.metalness),this.skinning&&(e+="skinning "+this.maxBones),this.morphTargets&&(e+="morphTargets"),this.morphNormals&&(e+="morphNormals"),this.gradient)for(var t in this.gradient)e+=" "+t+":"+this.gradient[t].getUniqueCode();return e+=" "+this.gradientType,e+=" "+this.outline,e+=this.combine,e+=this.bakeLightMap?" bakeLightMap ":"",this._uniqueCode=e,e},loadViewMatrix:function(e,t,i){("lambert"===this._type||"phong"===this._type||this.skinning)&&null!==e.viewMatrix&&i.uniformMatrix4fv(e.viewMatrix,!1,t.worldMatrixInverse.elements)},setType:function(e){if(this._type!==e){var t=this._type;this._type=e,this.firePropertyChange("type",t,e),this.onTypeChanged(t,e)}},onTypeChanged:function(){},getType:function(){return this._type},setStyle:function(e,t){if(null!=e){null==this.styleMap&&(this.styleMap={});var i=this.styleMap[e];return null==t?delete this.styleMap[e]:this.styleMap[e]=t,this.firePropertyChange(oe.Styles.PREFIX_STYLE+e,i,t),this.onStyleChanged(e,i,t),this}},getStyle:function(e,t){null==t&&(t=!0);var i;return null!=this.styleMap&&(i=this.styleMap[e]),null==i&&t&&(i=oe.Styles.getStyle(e)),i},clone:function(e){return e=e||new oe.EntityMaterial,oe.Material.prototype.clone.call(this,e),e._type=this._type,e.color.copy(this.color),e.wireframeLinecolor.copy(this.wireframeLinecolor),this.clipPlane&&(e.clipPlane=this.clipPlane.clone()),this.rimLightColor&&(e.rimLightColor=this.rimLightColor.clone(),e.rimLightScale=this.rimLightScale),e.map=this.map,e.map1=this.map1,e.map2=this.map2,e.blendMap=this.blendMap,e.normalMap=this.normalMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalScale.copy(this.normalScale),e.combine=this.combine,e.reflectRatio=this.reflectRatio,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.skinning=this.skinning,e.maxBones=this.maxBones,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e.specularStrength=this.specularStrength,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.blendRange.copy(this.blendRange),e.metalness=this.metalness,e.roughness=this.roughness,e},refreshUniformsSpecific:function(e){var t=this.uniforms;"lambert"===this._type?(e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive),this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)):"phong"===this._type?(t.shininess.value=this.shininess,e?(t.ambient.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.ambient),t.emissive.value.copyGammaToLinear(this.emissive),t.specular.value.copyGammaToLinear(this.specular)):(t.ambient.value=this.alarmColor?this.alarmColor:this.ambient,t.emissive.value=this.emissive,t.specular.value=this.specular),t.uspecularStrength.value=this.specularStrength,this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)):"physic"===this._type&&(t.metalness.value=this.metalness,t.roughness.value=this.roughness)},refreshUniformsCommon:function(e){if("terrain"===this._type)(t=this.uniforms).enableDiffuse1.value=this.map?1:0,t.tDiffuse1.value=this.map,t.enableDiffuse2.value=this.map1?1:0,t.tDiffuse2.value=this.map1,t.enableDiffuse3.value=this.map2?1:0,t.tDiffuse3.value=this.map2,t.enableDisplacement.value=this.blendMap?1:0,t.tDisplacement.value=this.blendMap,t.uRepeatOverlay.value=this.repeat,null==this.blendRangeArray&&(this.blendRangeArray=[0,1]),this.blendRangeArray[0]=this.blendRange.x,this.blendRangeArray[1]=this.blendRange.y,t.blendRange.value=this.blendRangeArray,t.uOpacity.value=this.opacity;else if("outline"===this._type){var t=this.uniforms;t.diffuse.value=this.color,t.outline_offset.value=this.outline}else oe.Material.prototype.refreshUniformsCommon.call(this,e)}}),oe.BlurMaterial=function(){oe.Material.call(this),this.orientation=0,this.blurAmount=5,this.blurScale=1,this.blurStrength=1,this.useBlur=1,this.texelSize=new le(512,512),this.blurGlobalAlpha=1},oe.extend(oe.BlurMaterial,oe.Material,{refreshUniformsCommon:function(e){var t=this.uniforms;t.map.value=this.map,t.orientation.value=this.orientation,t.blurAmount.value=this.blurAmount,t.blurScale.value=this.blurScale,t.blurStrength.value=this.blurStrength,t.useBlur.value=this.useBlur,t.texelSize.value=this.texelSize,t.blurGlobalAlpha.value=this.blurGlobalAlpha},getShaderID:function(){return"blur"}}),oe.DeferredMaterial=function(e){e=e||{},oe.Material.call(this,e),this.linearDepth=30,this.isNormal=e.isNormal!==t?e.isNormal:0},oe.extend(oe.DeferredMaterial,oe.Material,{getShaderID:function(){return"deferred"},refreshUniformsCommon:function(e){var t=this.uniforms;t.linearDepth.value=this.linearDepth,t.isNormal.value=this.isNormal}}),oe.SSAOMaterial=function(e){oe.Material.call(this),this.map1=null,this.map2=null,this.occluderBias=.05,this.samplingRadius=20,this.attenuation=new le(1,.02),this.texelSize=new le(1/512,1/512)},oe.extend(oe.SSAOMaterial,oe.Material,{getShaderID:function(){return"ssao"},refreshUniformsCommon:function(e){var t=this.uniforms;t.map0.value=this.map,t.map1.value=this.map1,t.map2.value=this.map2,t.occluderBias.value=this.occluderBias,t.samplingRadius.value=this.samplingRadius,t.attenuation.value=this.attenuation,t.texelSize.value=this.texelSize}}),oe.BasicMaterial=function(e){oe.Material.call(this),this._type="basic",this.color=new oe.Color(16777215),this.map=null,this.setValues(e),this.offset=new le(0,0),this.repeat=new le(1,1)},oe.extend(oe.BasicMaterial,oe.Material,{getShaderID:function(){return"basic"},clone:function(){var e=new oe.BasicMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e},getUniqueCode:function(){var e=this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(e+=this.map.getUniqueCode()),e}}),oe.LambertMaterial=function(e){oe.Material.call(this),this._type="basic",this.color=new oe.Color(16777215),this.ambient=new oe.Color(16777215),this.emissive=new oe.Color(0),this.wrapAround=!1,this.wrapRGB=new oe.Vec3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=oe.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=oe.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=oe.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},oe.extend(oe.LambertMaterial,oe.Material,{clone:function(){var e=new oe.LambertMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},getShaderID:function(){return"lambert"},refreshUniformsSpecific:function(e){var t=this.uniforms;e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive),this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)}}),oe.PhongMaterial=function(e){oe.Material.call(this),this._type="basic",this.color=new oe.Color(16777215),this.ambient=new oe.Color(16777215),this.emissive=new oe.Color(0),this.specular=new oe.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new oe.Vec3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new oe.Vec2(1,1),this.specularMap=null,this.envMap=null,this.combine=oe.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=oe.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=oe.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e),this.offset=new le(0,0),this.repeat=new le(1,1)},oe.extend(oe.PhongMaterial,oe.Material,{getUniqueCode:function(){var e="phong "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(e+=this.map.getUniqueCode()),e},clone:function(){var e=new oe.PhongMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},getShaderID:function(){return"phong"},refreshUniformsSpecific:function(e){var t=this.uniforms;t.shininess.value=this.shininess,e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive),t.specular.value.copyGammaToLinear(this.specular)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive,t.specular.value=this.specular),this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)}}),oe.LineMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.dashed=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.skyY=0,this.horizonY=0,this.earthY=0,this.skyColor=new oe.Color(16777215),this.horizonColor=new oe.Color(16777215),this.earthColor=new oe.Color(16777215),this.vertexColors=!1,this.gradientColors=!0,this.fog=!0,this.setValues(e)},oe.extend(oe.LineMaterial,oe.Material,{getUniqueCode:function(){if(null!=this._uniqueCode)return this._uniqueCode;var e=this.color.getUniqueCode()+" "+this.linewidth+" "+this.dashed+" "+this.visible;return e+=this.transparent+" "+this.opacity,e+=this.skyY+" "+this.horizonY+" "+this.earthY,e+=this.skyColor.getUniqueCode(),e+=this.horizonColor.getUniqueCode(),e+=this.earthColor.getUniqueCode(),this._uniqueCode=e,e},clone:function(){var e=new oe.LineMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.dashed=this.dashed,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},getShaderID:function(){return this.dashed?"dashed":"basic"},refreshUniforms:function(e){W(this.uniforms,this),this.dashed&&Y(this.uniforms,this)}}),oe.LineXMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.side=oe.DoubleSide,this.attributes={positionPrev:{type:"v3",ref:"verticesPrev"},positionNext:{type:"v3",ref:"verticesNext"},offset:{type:"f",ref:"offset"},lineDistances:{type:"f",ref:"lineDistances"}},this.useVertexColor=!1,this.totalSize=0,this.dashSize=0,this.map=null,this.transparent=!1,this.opacity=1,this.repeat=new le(1,1),this.offset=new le(0,0)},oe.extend(oe.LineXMaterial,oe.Material,{getUniqueCode:function(){if(!this._uniqueCode){var e=this.color.getUniqueCode()+this.visible;if(e+=this.transparent+" "+this.opacity,e+=this.side,e+=this.useVertexColor,this.totalSize&&(e+=this.totalSize),this.dashSize&&(e+=this.dashSize),this.map&&(e+=this.map.getUniqueCode()),e+=this.transparent,e+=this.opacity,e+=this.repeat.x+" "+this.repeat.y,e+=this.offset.x+" "+this.offset.y,this.gradient)for(var t in this.gradient)e+=" "+t+":"+this.gradient[t].getUniqueCode();e+=" "+this.gradientType,this._uniqueCode=e}return this._uniqueCode},clone:function(){var e=new oe.LineXMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.useVertexColor=this.useVertexColor,e.dashSize=this.dashSize,e.totalSize=this.totalSize,e.transparent=this.transparent,e.opacity=this.opacity,e.repeat.copy(this.repeat),e.offset.copy(this.offset),e.map=this.map,e.gradient=this.gradient,e.gradientType=this.gradientType,e},getShaderID:function(){return"linex"},refreshUniforms:function(e,t){if(this.uniforms.lineColor.value=this.color,this.uniforms.opacity.value=this.opacity,t.network){var i=t.network.getView();this.uniforms.viewport.value=new oe.Vec4(0,0,i.width,i.height)}if(t.camera&&(this.uniforms.near.value=t.camera.near||1),this.uniforms.useVertexColor.value=this.useVertexColor?1:0,this.uniforms.dashSize.value=this.dashSize,this.uniforms.totalSize.value=this.totalSize,this.map){this.uniforms.map.value=this.map;var r=this.offset,a=this.repeat;this.uniforms.offsetRepeat.value.set(r.x,r.y,a.x,a.y)}this.refreshUniformsGradient()}}),oe.SurfaceMaterial=function(e){oe.EntityMaterial.call(this),this.skyY=0,this.horizonY=0,this.earthY=0,this.skyColor=new oe.Color(16777215),this.horizonColor=new oe.Color(16777215),this.earthColor=new oe.Color(16777215)},oe.extend(oe.SurfaceMaterial,oe.EntityMaterial,{getUniqueCode:function(){var e=oe.EntityMaterial.prototype.getUniqueCode.call(this);return this.skyColor&&(e+=" "+this.skyColor.getUniqueCode()),this.horizonColor&&(e+=" "+this.horizonColor.getUniqueCode()),this.earthColor&&(e+=" "+this.earthColor.getUniqueCode()),e+=" "+this.skyY,e+=" "+this.horizonY,e+=" "+this.earthY,this._uniqueCode=e,e},clone:function(){var e=new oe.SurfaceMaterial;return oe.EntityMaterial.prototype.clone.call(this,e),e.skyY=this.skyY,e.horizonY=this.horizonY,e.earthY=this.earthY,e.skyColor=this.skyColor,e.horizonColor=this.horizonColor,e.earthColor=this.earthColor,e},refreshUniforms:function(e){oe.EntityMaterial.prototype.refreshUniforms.call(this,e),j(this.uniforms,this)}}),oe.ArrayMaterial=function(e){this.materials=e||[]},oe.extend(oe.ArrayMaterial,Object,{clone:function(){for(var e=new oe.ArrayMaterial,t=0;t<this.materials.length;t++){var i=this.materials[t],r=this.materials.indexOf(i);null!=e.materials[r]?e.materials.push(e.materials[r]):e.materials.push(i.clone())}return e}}),oe.BillboardMaterial=function(e){oe.Material.call(this),this.alignment=oe.BillboardAlignment.center.clone(),this.fog=!1,this.color=new oe.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.offset=new oe.Vec2(0,0),this.repeat=new oe.Vec2(1,1),this.transparent=!0,this.setValues(e),this.depthMask=!0,this.vertical=!1,this.fixedSize=0,this.alphaTest=0},oe.extend(oe.BillboardMaterial,oe.Material,{clone:function(e){return e=e||new oe.BillboardMaterial,oe.Material.prototype.clone.call(this,e),e.alignment.copy(this.alignment),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.fog=this.fog,e.vertical=this.vertical,e.transparent=this.transparent,e.alphaTest=this.alphaTest,e.blendMode=this.blendMode,e.fixedSize=this.fixedSize,e},getUniqueCode:function(){if(!this._uniqueCode){var e="Billboard "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;e+=this.vertical+" "+this.alphaTest+" "+this.alignment.x+" "+this.alignment.y,e+=this.fixedSize,e+=this.repeat.x+" "+this.repeat.y,e+=this.offset.x+" "+this.offset.y,e+=" "+this.blendMode,this.map&&(e+=this.map.getUniqueCode()),this._uniqueCode=e}return this._uniqueCode}}),oe.BillboardAlignment={},oe.BillboardAlignment.topLeft=new oe.Vec2(.5,-.5),oe.BillboardAlignment.topCenter=new oe.Vec2(0,-.5),oe.BillboardAlignment.topRight=new oe.Vec2(-.5,-.5),oe.BillboardAlignment.centerLeft=new oe.Vec2(.5,0),oe.BillboardAlignment.center=new oe.Vec2(0,0),oe.BillboardAlignment.centerRight=new oe.Vec2(-.5,0),oe.BillboardAlignment.bottomLeft=new oe.Vec2(.5,.5),oe.BillboardAlignment.bottomCenter=new oe.Vec2(0,.5),oe.BillboardAlignment.bottomRight=new oe.Vec2(-.5,.5);var xt=function(e){oe.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms=e&&e.uniforms||{},this.defines={},this.attributes=null,this._type="shader",this.shading=oe.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=oe.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)};oe.ShaderMaterial=xt,oe.extend(oe.ShaderMaterial,oe.Material,{clone:function(){var e=new oe.ShaderMaterial;return oe.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=oe.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},setupMaterialShader:function(){},needUV:function(){return!0},getShaderID:function(){return this.shaderID},refreshUniformsCommon:function(e,t){var i=this.uniforms;for(var r in i)i[r].value=this[r]},onPropertyChange:function(e,t,i){this._needRefreshUniform=!0}}),oe.TransformGizmoMaterial=function(e){oe.BasicMaterial.call(this),this.depthTest=!1,this.depthMask=!1,this.side=oe.DoubleSide,this.transparent=!0,this.setValues(e)},oe.extend(oe.TransformGizmoMaterial,oe.BasicMaterial,{getUniqueCode:function(){var e=this.id+"TransformGizmo "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return this.map&&(e+=this.map.getUniqueCode()),e}});var _t={pools:{},useTimes:{},size:0,getMaterial:function(e){return _t.pools[e]},setMaterial:function(e,t){e&&(_t.size++,_t.pools[e]=t)},useMaterial:function(e){if(e){var t=e.id,i=_t.useTimes[t]||0;i++,_t.useTimes[t]=i}},unUseMaterial:function(e){if(e){var t=e.id,i=_t.useTimes[t]||0;if(i--,_t.useTimes[t]=i,i<=0){var r=e.getUniqueCode&&e.getUniqueCode();delete _t.pools[r],delete _t.useTimes[t],_t.size--,e.dispose()}}},clear:function(){this.pools={},this.useTimes={},this.size=0}};oe.MaterialPool=_t,_t.DefaultMaterial=new oe.EntityMaterial,_t.TestMaterial=new oe.EntityMaterial,_t.DefaultBillBoardMaterial=new oe.BillboardMaterial,_t.DefaultLineMaterial=new oe.LineMaterial,oe.ParticleMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.map=null,this.size=2,this.sizeAttenuation=!1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},oe.extend(oe.ParticleMaterial,oe.Material,{clone:function(){var e=new oe.ParticleMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},getShaderID:function(){return this.shaderID="particle_basic",this.shaderID},getUniqueCode:function(){if(null!=this._uniqueCode)return this._uniqueCode;var e=this.color.getUniqueCode(),t=this.map;return e+=t?t.getUniqueCode():"",e+=" "+this.size,e+=" "+this.fog,e+=" "+this.sizeAttenuation,e+=" "+this.transparent,e+=" "+this.opacity,e+=" "+this.depthTest,e+=" "+this.alphaTest,this._uniqueCode=e,e},refreshUniforms:function(e){H(this.uniforms,this)}}),oe.Light=function(e,t){oe.Element.call(this,t),this.color=new oe.Color(e),this.ambient=new oe.Color,this.diffuse=new oe.Color,this.specular=new oe.Color,this.castShadow=!1,this.onlyShadow=!1},oe.extend(oe.Light,oe.Element,{__accessor:["color","ambient","diffuse","specular"],constructor:oe.Light,className:"TGL.Light",setCastShadow:function(e){this.castShadow=e},setOnlyShadow:function(e){this.onlyShadow=e},refreshShadowUniforms:function(e,t){var i=this;if(e.shadowMatrix&&i.castShadow&&(i instanceof oe.SpotLight||i instanceof oe.DirectionalLight&&!i.shadowCascade))return e.shadowMap.value[t]=i.shadowMap,e.shadowMapSize.value[t]=i.shadowMapSize,e.shadowMatrix.value[t]=i.shadowMatrix,e.shadowDarkness.value[t]=i.shadowDarkness,e.shadowBias.value[t]=i.shadowBias,!0},refreshUniformsPointShadow:function(e,t){var i=this;if(e.pShadowMap&&i.castShadow&&i instanceof oe.PointLight)return e.pShadowMap.value[t]=i.shadowMap,e.pShadowMapSize.value[t]=i.shadowMapSize,e.pShadowDarkness.value[t]=i.shadowDarkness||.5,e.pPosition.value[t]=i.getPosition(),e.pShadowRadius.value[t]=i.shadowRadius||1,e.shadowCameraNear.value=i.shadowCameraNear,e.shadowCameraFar.value=i.shadowCameraFar,e.pShadowBias.value[t]=i.shadowBias,!0}}),oe.PointLight=function(e,i,r,a){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var n=arguments[0];e=n.hex,i=n.intensity,r=n.distance,a=n.id}oe.Light.call(this,e,a),this.position=new oe.Vec3(0,0,0),this.intensity=i!==t?i:1,this.distance=r!==t?r:0,this.shadowCameraNear=10,this.shadowCameraFar=1e3,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowDarkness=.5,this.shadowBias=0},oe.extend(oe.PointLight,oe.Light,{constructor:oe.PointLight,className:"TGL.PointLight",__accessor:["intensity","distance"]}),oe.SpotLight=function(e,i,r,a,n){oe.Light.call(this,e),this._position=new oe.Vec3(0,1,0),this.target=new oe.Element,this.intensity=i!==t?i:1,this.distance=r!==t?r:0,this.angle=a!==t?a:Math.PI/2,this.exponent=n!==t?n:10,this.shadowCameraNear=100,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},oe.extend(oe.SpotLight,oe.Light,{__accessor:["color","ambient","diffuse","specular","intensity","distance","angle","exponent"],constructor:oe.SpotLight,className:"TGL.SpotLight"}),oe.DirectionalLight=function(e,i,r){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var a=arguments[0];e=a.hex,i=a.intensity,r=a.id}oe.Light.call(this,e,r),this.direction=new oe.Vec3(0,1,0),this.position=new oe.Vec3(0,1,0),this.target=new oe.Element,this.intensity=i!==t?i:1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new oe.Vec3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},oe.extend(oe.DirectionalLight,oe.Light,{className:"TGL.DirectionalLight",__accessor:["direction"]}),oe.AmbientLight=function(e,t){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var i=arguments[0];e=i.hex,t=i.id}oe.Light.call(this,e,t)},oe.extend(oe.AmbientLight,oe.Light,{constructor:oe.AmbientLight,className:"TGL.AmbientLight",clone:function(){var e=new oe.AmbientLight;return oe.Light.prototype.clone.call(this,e),e}}),oe.Camera=function(){oe.Element.call(this),this.projectionMatrix=new oe.Mat4,this.projectionMatrixInverse=new oe.Mat4,this.worldMatrixInverse=new oe.Mat4,this.target=new oe.Vec3,this.setPosition(0,0,500),this.lookat=this.lookAt},oe.extend(oe.Camera,oe.Element,{constructor:oe.Camera,updateCameraMatrix:function(e){var t=this.matrix.clone();this.matrix.lookAt(this._position,this.target,this.up),this.rotationAutoUpdate&&this._rotation.setEulerFromRotationMatrix(this.matrix),!t.equals(this.matrix)&&e&&this.firePropertyChange("matrix",t,this.matrix)},lookAt:function(e,i){3===arguments.length&&e.x===t?(e=new se.Vec3(arguments[0],arguments[1],arguments[2]),i=t):4===arguments.length&&e.x===t&&(e=new se.Vec3(arguments[0],arguments[1],arguments[2]),i=arguments[4]),i===t&&(i=!0),this.target=e,this.updateCameraMatrix(i)},look:function(e){3===arguments.length&&e.x===t&&(e=new se.Vec3(arguments[0],arguments[1],arguments[2])),this.lookAt(e,!0)},onUpChanged:function(e,t){this.updateCameraMatrix()},getTarget:function(){return this.target},t:function(){return this.getTarget()},getDistance:function(){return(new he).subVectors(this._position,this.target).length()},setDistance:function(e){var t=this.getDistance();this.zoom(e/t)},lookAtElement:function(e,t,i){t instanceof he?(i=t,t=this.getDistance()):i=i||new he(0,0,1),e instanceof oe.Element&&(t=t||this.getDistance(),this.setPosition(e.worldPosition(i,t)),this.look(e.getWorldPosition()))},zoomOut:function(e){this.zoom(1.1,e)},zoomIn:function(e){this.zoom(.9,e)},zoom:function(e,t){if(e>0){var i=t||this.getDistance();i*=e;var r=(new he).addVectors(this.target,(new he).subVectors(this._position,this.target).setLength(i));this.setPosition(r)}}}),oe.OrthoCamera=function(e,t,i,r){oe.Camera.call(this),this.width=e||1,this.aspect=t||1,this.near=i||.1,this.far=r||1e4,this.updateProjectionMatrix()},oe.extend(oe.OrthoCamera,oe.Camera,{constructor:oe.OrthoCamera,className:"TGL.OrthoCamera",__accessor:["width","aspect","near","far"],updateProjectionMatrix:function(){var e=this.getDistance(),t=e*this.width/2,i=-t,r=e/this.aspect*this.width/2,a=-r;this.projectionMatrix.makeOrthographic(i,t,r,a,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()},updateCameraMatrix:function(e){oe.Camera.prototype.updateCameraMatrix.call(this,e),this.updateProjectionMatrix()}}),oe.PerspectiveCamera=function(e,i,r,a){oe.Camera.call(this),this.fov=e!==t?e:50,this.aspect=i!==t?i:1,this.near=r!==t?r:1,this.far=a!==t?a:5e4,this.updateProjectionMatrix()},oe.extend(oe.PerspectiveCamera,oe.Camera,{constructor:oe.PerspectiveCamera,className:"TGL.PerspectiveCamera",__accessor:["fov","aspect","near","far"],updateProjectionMatrix:function(){this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()}}),oe.VRCamera=function(e,i,r){oe.Camera.call(this),this.network=e,this.vrDisplay=e._vrDisplay,this.near=i!==t?i:.01,this.far=r!==t?r:1e4,this.orientation=[0,0,0,1],this.leftPm=new ue,this.rightPm=new ue,this.leftVm=new ue,this.leftVmInverse=new ue,this.rightVm=new ue,this.rightVmInverse=new ue,this.speed=.01,this.lockY=!1,this.updateProjectionMatrix()},oe.extend(oe.VRCamera,oe.Camera,{constructor:oe.VRCamera,className:"TGL.VRCamera",__accessor:["near","far","lockY","speed"],updateCameraMatrix:function(e){},updateMatrix:function(){},updateWorldMatrix:function(e,t){},updateProjectionMatrix:function(){function e(){if(t=null,i=null,r=null,navigator.getGamepads)for(var e=navigator.getGamepads(),a=0;a<e.length;a++){var n=e[a];n&&n.pose&&("right"===n.hand?i=n:t=n,n.buttons.some(function(e,t){if(e.pressed)return r=n,!0}))}}var t,i,r,a=new ue,n=new ue,o=new ue,s=new he,l=new ue,h=[0,1.65,0],c=new se.Quat,u=new se.Quat;return function(){var f=this,p=f.leftVm,d=f.rightVm,m=f.leftVmInverse,g=f.rightVmInverse,v=f.leftPm,y=f.rightPm,A=f._frameData,x=f.vrDisplay;if(x){x.depthNear=f.near,x.depthFar=f.far,A||(A=f._frameData=new window.VRFrameData),x.getFrameData(A),e(),x.stageParameters?l.set(x.stageParameters.sittingToStandingTransform):(l.identity(),l.translate(h));var _=-1;if(r&&(r.buttons.some(function(e,t){if(e.pressed)return _=t,!0}),2===_)){s.set(0,0,-f.speed),u.setFromRotationMatrix(l);var w=r.pose.orientation;c.set(w[0],w[1],w[2],w[3]),c.multiplyQuaternions(u,c),s.applyQuaternion(c),f.lockY&&s.setY(0),f.getPosition(!1).add(s)}f.network.onGamepadChanged&&f.network.onGamepadChanged(t,i,r,_),a.identity(),a.setPosition(f.getPosition()),a.multiplyMatrices(a,l),n.getInverse(a),o.set(A.leftViewMatrix),m.multiplyMatrices(o,n),p.getInverse(m),o.set(A.rightViewMatrix),g.multiplyMatrices(o,n),d.getInverse(g),v.set(A.leftProjectionMatrix),y.set(A.rightProjectionMatrix)}}}(),onPropertyChange:function(){this.updateProjectionMatrix()}}),oe.CameraHelper=function(e){function i(e,t,i){r(e,i),r(t,i)}function r(e,i){a.vertices.push(new oe.Vec3),a.colors.push(new oe.Color(i)),o[e]===t&&(o[e]=[]),o[e].push(a.vertices.length-1)}var a=new oe.Entity,n=new oe.LineMaterial({color:16777215,vertexColors:oe.FaceColors}),o={};i("n1","n2",16755200),i("n2","n4",16755200),i("n4","n3",16755200),i("n3","n1",16755200),i("f1","f2",16755200),i("f2","f4",16755200),i("f4","f3",16755200),i("f3","f1",16755200),i("n1","f1",16755200),i("n2","f2",16755200),i("n3","f3",16755200),i("n4","f4",16755200),i("p","n1",16711680),i("p","n2",16711680),i("p","n3",16711680),i("p","n4",16711680),i("u1","u2",43775),i("u2","u3",43775),i("u3","u1",43775),i("c","t",16777215),i("p","c",3355443),i("cn1","cn2",3355443),i("cn3","cn4",3355443),i("cf1","cf2",3355443),i("cf3","cf4",3355443),oe.Line.call(this,a.vertices,a.colors,n,oe.LinePieces),this.camera=e,this.worldMatrix=e.worldMatrix,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},oe.CameraHelper.prototype=Object.create(oe.Line.prototype),oe.CameraHelper.prototype.update=function(){var e=new oe.Vec3,i=new oe.Camera,r=new oe.Projector;return function(){function a(a,o,s,l){e.set(o,s,l),r.unprojectVector(e,i);var h=n.pointMap[a];if(h!==t)for(var c=0,u=h.length;c<u;c++)n.vertices[h[c]].copy(e)}var n=this;i.projectionMatrix.copy(this.camera.projectionMatrix),a("c",0,0,-1),a("t",0,0,1),a("n1",-1,-1,-1),a("n2",1,-1,-1),a("n3",-1,1,-1),a("n4",1,1,-1),a("f1",-1,-1,1),a("f2",1,-1,1),a("f3",-1,1,1),a("f4",1,1,1),a("u1",.7,1.1,-1),a("u2",-.7,1.1,-1),a("u3",0,2,-1),a("cf1",-1,0,1),a("cf2",1,0,1),a("cf3",0,-1,1),a("cf4",0,1,1),a("cn1",-1,0,-1),a("cn2",1,0,-1),a("cn3",0,-1,-1),a("cn4",0,1,-1),this.verticesNeedUpdate=!0}}();var wt=function(){oe.Element.call(this)};(wt.prototype=Object.create(oe.Element.prototype)).updateworldMatrix=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this._parent?(this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrix.decompose(this.translationWorld,this.QuatWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.QuatObject,this.scaleObject),this.worldMatrix.compose(this.translationWorld,this.QuatObject,this.scaleWorld)):this.worldMatrix.copy(this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(var t=0,i=this.getChildren().size();t<i;t++)this.getChildren().get(t).updateworldMatrix(e)},wt.prototype.translationWorld=new oe.Vec3,wt.prototype.translationObject=new oe.Vec3,wt.prototype.QuatWorld=new oe.Quat,wt.prototype.QuatObject=new oe.Quat,wt.prototype.scaleWorld=new oe.Vec3,wt.prototype.scaleObject=new oe.Vec3;var bt=function(){function e(e,t){var i=new oe.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var r=i.pointsWorld,a=i.pointsFrustum,n=0;n<8;n++)r[n]=new oe.Vec3,a[n]=new oe.Vec3;var o=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return a[0].set(-1,-1,o),a[1].set(1,-1,o),a[2].set(-1,1,o),a[3].set(1,1,o),a[4].set(-1,-1,s),a[5].set(1,-1,s),a[6].set(-1,1,s),a[7].set(1,1,s),i}function i(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t],n=i.pointsFrustum;n[0].z=r,n[1].z=r,n[2].z=r,n[3].z=r,n[4].z=a,n[5].z=a,n[6].z=a,n[7].z=a}function r(e,t){var i=t.shadowCamera,r=t.pointsFrustum,a=t.pointsWorld;d.set(1/0,1/0,1/0),m.set(-1/0,-1/0,-1/0);for(var n=0;n<8;n++){var o=a[n];o.copy(r[n]),bt.__projector.unprojectVector(o,e),o.applyMatrix4(i.worldMatrixInverse),o.x<d.x&&(d.x=o.x),o.x>m.x&&(m.x=o.x),o.y<d.y&&(d.y=o.y),o.y>m.y&&(m.y=o.y),o.z<d.z&&(d.z=o.z),o.z>m.z&&(m.z=o.z)}i.left=d.x,i.right=m.x,i.top=m.y,i.bottom=d.y,i.updateProjectionMatrix()}function a(e){return e.material instanceof oe.ArrayMaterial?e.material.materials[0]:e.material}var n,o,s,l,h,c,u,f=new oe.Frustum,p=new oe.Mat4,d=new oe.Vec3,m=new oe.Vec3,g=new oe.Vec3;this.init=function(e){n=e._gl,o=e;var t=oe.ShaderLib.depthRGBA,i=oe.UniformsUtils.clone(t.uniforms);s=new xt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i}),l=new xt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,refreshUniformsCommon:function(e){this.uniforms.isCube.value=1,this.uniforms.nearDistance.value=this.nearDistance,this.uniforms.farDistance.value=this.farDistance,this.uniforms.referencePosition.value=this.referencePosition}}),h=new xt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0}),c=new xt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,skinning:!0}),u=new xt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),s._shadowPass=!0,h._shadowPass=!0,c._shadowPass=!0,u._shadowPass=!0};var v=[new se.Vec3(1,0,0),new se.Vec3(-1,0,0),new se.Vec3(0,0,1),new se.Vec3(0,0,-1),new se.Vec3(0,1,0),new se.Vec3(0,-1,0)],y=[new se.Vec3(0,1,0),new se.Vec3(0,1,0),new se.Vec3(0,1,0),new se.Vec3(0,1,0),new se.Vec3(0,0,1),new se.Vec3(0,0,-1)],A=[new se.Vec4,new se.Vec4,new se.Vec4,new se.Vec4,new se.Vec4,new se.Vec4];this.dirty=!0,this.dirtyShadowMap=function(){this.dirty=!0},this.render=function(e,t){o._shadowMapEnable&&this.update(e,t)},this.handleDataPropertyChange=function(e){var t=e.source,i=e.property;(t.isSizeChangedProperty&&t.isSizeChangedProperty(i)||"parent"==i||t.isSpaceChangedProperty(i))&&this.dirtyShadowMap()},this.handleDataBoxChange=function(e){this.dirtyShadowMap()},this.update=function(d,m){if(this.dirty){this.dirty=!1;var x,_,w,b,M,S,P,C,T,E,z,D,L,R,N=[],B=0;n.clearColor(1,1,1,1),n.disable(n.BLEND),n.enable(n.CULL_FACE),n.frontFace(n.CCW),o.shadowMapCullFace===oe.CullFaceFront?n.cullFace(n.FRONT):n.cullFace(n.BACK),o.setDepthTest(!0);var I=d.getLights();for(x=0,_=I.size();x<_;x++)if((L=I.get(x)).castShadow)if(L instanceof oe.DirectionalLight&&L.shadowCascade)for(M=0;M<L.shadowCascadeCount;M++){var F;if(L.shadowCascadeArray[M])F=L.shadowCascadeArray[M];else{(F=e(L,M)).originalCamera=m;var V=new wt;V.position=L.shadowCascadeOffset,V.add(F),V.add(F.target),m.add(V),L.shadowCascadeArray[M]=F}i(L,M),N[B]=F,B++}else N[B]=L,B++;for(x=0,_=N.length;x<_;x++){var U=(L=N[x])instanceof oe.PointLight,k=U?6:1;if(!L.shadowMap){var O=oe.NearestFilter;o.shadowMapType===oe.PCFSoftShadowMap&&(O=oe.NearestFilter);var X={minFilter:O,magFilter:O,format:oe.RGBAFormat},G=new se.Vec2(L.shadowMapWidth,L.shadowMapHeight);if(U){var W=G.x,Y=G.y;A[0].set(2*W,Y,W,Y),A[1].set(0,Y,W,Y),A[2].set(3*W,Y,W,Y),A[3].set(W,Y,W,Y),A[4].set(3*W,0,W,Y),A[5].set(W,0,W,Y),G.x*=4,G.y*=2,L.shadowMap=new qe(G.x,G.y,X),L.shadowMapSize=new le(G.x,G.y),L.shadowMatrix=new oe.Mat4}else L.shadowMap=new qe(L.shadowMapWidth,L.shadowMapHeight,X),L.shadowMapSize=new le(L.shadowMapWidth,L.shadowMapHeight),L.shadowMatrix=new oe.Mat4}if(!L.shadowCamera){if(L instanceof oe.SpotLight)L.shadowCamera=new oe.PerspectiveCamera(L.shadowCameraFov,L.shadowMapWidth/L.shadowMapHeight,L.shadowCameraNear,L.shadowCameraFar);else if(L instanceof oe.DirectionalLight)L.shadowCamera=new oe.OrthoCamera(L.shadowCameraLeft,L.shadowMapWidth/L.shadowMapHeight,L.shadowCameraNear,L.shadowCameraFar);else{if(!(L instanceof oe.PointLight)){console.error("Unsupported light type for shadow");continue}L.shadowCamera=new oe.PerspectiveCamera(90,1,L.shadowCameraNear,L.shadowCameraFar)}L.shadowCamera.updateWorldMatrix();for(var j=d.getRoots(),H=j.size(),q=0;q<H;q++)j.get(q).updateWorldMatrix()}L.shadowCameraVisible&&!L.cameraHelper&&(L.cameraHelper=new oe.CameraHelper(L.shadowCamera),L.shadowCamera.addChild(L.cameraHelper),L.shadowCamera.updateWorldMatrix(!0),o.helperBox.add(L.shadowCamera),o.helperBox.add(L.cameraHelper)),L.isVirtual&&F.originalCamera==m&&r(m,L);new he(1,0,0),new he(-1,0,0),new he(0,1,0),new he(0,-1,0),new he(0,0,1),new he(0,0,-1);S=L.shadowMap,P=L.shadowMatrix,C=L.shadowCamera,o.debugPointLight==t&&o.setRenderTarget(S),o.clear();for(B=0;B<k;B++)if(null==L.debugFace||B==L.debugFace){if(C._position.setFromMatrixPosition(L.worldMatrix),L.target?(g.setFromMatrixPosition(L.target.worldMatrix),C.lookAt(g),C.updateWorldMatrix(!0)):g=C.p().clone().add(v[B]),C.worldMatrixInverse.getInverse(C.worldMatrix),L.cameraHelper&&(L.cameraHelper.visible=L.shadowCameraVisible),L.shadowCameraVisible&&L.cameraHelper.update(),U){P.translate(C._position.clone().negate()),C.setUp(y[B]),C.lookAt(g),C.updateWorldMatrix(!0),C.setNear(L.shadowCameraNear),C.setFar(L.shadowCameraFar),l.nearDistance=L.shadowCameraNear,l.farDistance=L.shadowCameraFar,l.referencePosition=C._position.clone();var Z=A[B];C.worldMatrixInverse.getInverse(C.worldMatrix),o.setViewport(Z.x,Z.y,Z.z,Z.w)}else P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(C.projectionMatrix),P.multiply(C.worldMatrixInverse);for(p.multiplyMatrices(C.projectionMatrix,C.worldMatrixInverse),f.setFromMatrix(p),w=0,b=(R=o.glNodeList).length;w<b;w++)D=(z=R[w]).node,z.render=!1,D._visible&&D.castShadow&&((D instanceof oe.Node||D instanceof oe.Particle)&&D.frustumCulled&&!f.intersectsObject(D)||(D._modelViewMatrix.multiplyMatrices(C.worldMatrixInverse,D.worldMatrix),z.render=!0));var Q,K;for(w=0,b=R.length;w<b;w++)(z=R[w]).render&&(D=z.node,T=z.group,a(D),Q=!1,K=!1,E=D.customDepthMaterial?D.customDepthMaterial:K?Q?u:c:Q?h:1==k?s:l,D instanceof oe.BufferNode||o.renderGroup(C,d.getLights(),E,T,D))}}var J=o.getClearColor(),$=o.getClearAlpha();n.clearColor(J.r,J.g,J.b,$),n.enable(n.BLEND),o.shadowMapCullFace===oe.CullFaceFront&&n.cullFace(n.BACK)}}};bt.__projector=new oe.Projector,oe.Picking=function(e,t,i,r,a,n){this.network=n,this.origin=e,this.cameraUp=i,this.direction=t,this.near=r||0,this.far=a||1/0,this.ray=new oe.Ray(e,t),this.ray.direction.length>0&&this.ray.direction.normalize()},oe.Picking.testPlane=new oe.Plane(1,1),oe.Picking.prototype={constructor:oe.Picking,precision:1e-4,linePrecision:2,matrixPosition:new oe.Vec3,set:function(e,t){this.origin=e,this.direction=t,this.ray.set(e,t),this.ray.direction.length>0&&this.ray.direction.normalize()},intersectObject:function(e,t,i){var r=[];return!0===t&&Q(e,this,r,i),Z(e,this,r,i),r.sort(q),r},intersectObjects:function(e,t,i){e._as&&(e=e._as);for(var r=[],a=0,n=e.length;a<n;a++)Z(e[a],this,r,i,this.network),!0===t&&Q(e[a],this,r,i,this.network);return r.sort(q),r}};var Mt=new oe.Ray,St=new oe.Mat4,Pt=new oe.math.Plane,Ct=new oe.Vec3,Tt=new oe.BoundingSphere;oe.AreaPicking=function(e,t){this.network=e,this.bounding=t,this.cache={}},oe.extend(oe.AreaPicking,Object,{intersectObjects:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];this.intersectObject(r,t)}return t},getViewPoint:function(e,t){var i=t.vertices[e].clone(),r=this.cache[t.getId()][i.x+" "+i.y+" "+i.z];return r||(i.applyMatrix4(t.worldMatrix),r=this.network.getViewPosition(i),r.y=r.h-r.y,r)},intersectObject:function(e,t){if(e instanceof oe.Entity){this.cache[e.getId()]={};for(var i=0;i<e.vertices.length;i++){var r=e.vertices[i].clone();r.applyMatrix4(e.worldMatrix);var a=this.network.getViewPosition(r);if(a.y=a.h-a.y,this.cache[e.getId()][r.x+" "+r.y+" "+r.z]=a,a.x>this.bounding.x&&a.y>this.bounding.y&&a.x<this.bounding.x+this.bounding.w&&a.y<this.bounding.y+this.bounding.h){var n={element:e};return void t.push(n)}}}}}),oe.BaseInteraction=function(e){this.network=e,this.view=e.getView()||document},oe.addEventListener=function(e,t,i,r){var a="_"+e+"_";if(!r[a]){var n=function(e){r[t](e)};r[a]=n,i.addEventListener(e,n,!1)}},oe.removeEventListener=function(e,t,i){var r="_"+e+"_",a=i[r];a&&(t.removeEventListener(e,a,!1),delete i[r])},oe.extend(oe.BaseInteraction,Object,{onPropertyChange:function(){},firePropertyChange:function(){},setUp:function(){},tearDown:function(){},update:function(){},addListener:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];oe.addEventListener(t,"handle_"+t,this.network.getRootView(),this)}},removeListener:function(){for(var e=0;e<arguments.length;e++){arguments[e];oe.removeEventListener(arguments[e],this.network.getRootView(),this)}},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},isFinished:function(){return!0}}),oe.DefaultInteraction=function(e){oe.BaseInteraction.call(this,e),this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=this.screen.width/4,this.domElement=this.network.getRootView(),this.rotateSpeed=1,this.zoomSpeed=10,this.panSpeed=3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.easing=!0,this.easingRotateMinValue=1e-4,this.easingZoomMinValue=.001,this.dynamicDampingFactor=.05,this.timeInterval=2e3,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.lastPosition=new oe.Vec3;var t,i,r=this.STATE.NONE,a=(this.STATE.NONE,new oe.Vec3),n=new oe.Vec3,o=new oe.Vec3,s=new oe.Vec2,l=new oe.Vec2,h=0,c=0,u=new oe.Vec2,f=new oe.Vec2;this.object=this.network._camera,this.object.target||(this.object.target=new oe.Vec3),this.movementSpeed=1,this.lookSpeed=.005,this.verticalLookRatio=.1,this.keyboardEnable=!0,this.lookVertical=!0,this.autoForward=!1,this.fpsMode=!1,this.dragMode=!0,this.activeLook=!1,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalFixed=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.lastX=0,this.lastY=0,this.touchSeq=[1,2,3],this.fpsMinDistance=100,this.network.getRootView().addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.yRistrict=!0,this.yLowerLimitAngle=-Math.PI/2,this.yUpLimitAngle=Math.PI/2,this.updateIntervalTime=0;var p=null;this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleResize(),this.handle_mousedown=function(e){if(!fe.isCtrlDown(e)){if(e.preventDefault(),this.fpsMode){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.lastX=e.pageX,this.lastY=e.pageY,this.mouseDragOn=!0}else r===this.STATE.NONE&&(r=e.button),r!==this.STATE.ROTATE||this.noRotate?this.state!==this.STATE.ZOOM||this.noZoom?r!==this.STATE.PAN||this.noPan||(u=f=this.getMouseOnScreen(e.clientX,e.clientY)):s=l=this.getMouseOnScreen(e.clientX,e.clientY):(n=o=this.getMouseProjectionOnBall(e.clientX,e.clientY),t=i=this.getRotateY(e.clientX,e.clientY));this.beforeUpdate(),this.addListener("mousemove","mouseup")}},this.handle_mousemove=function(e){if(!e.stop){e.preventDefault(),this.fpsMode?this.dragMode?this.mouseDragOn?(this.mouseX=300*(e.pageX-this.lastX),this.mouseY=300*(e.pageY-this.lastY),this.lastX=e.pageX,this.lastY=e.pageY):(this.mouseX=0,this.mouseY=0):this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY):r!==this.STATE.ROTATE||this.noRotate?r!==this.STATE.ZOOM||this.noZoom?r!==this.STATE.PAN||this.noPan||(f=this.getMouseOnScreen(e.clientX,e.clientY)):l=this.getMouseOnScreen(e.clientX,e.clientY):(o=this.getMouseProjectionOnBall(e.clientX,e.clientY),i=this.getRotateY(e.clientX,e.clientY));var t=(new Date).getTime();if(null==this._lt)this.update();else{if(t-this._lt<this.updateIntervalTime)return;this.update()}this._lt=t}},this.handle_mouseup=function(e){if(e.preventDefault(),this.fpsMode){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.lastX=0,this.lastY=0,this.dragMode&&(this.mouseX=0,this.mouseY=0),this.mouseDragOn=!1}else r=this.STATE.NONE;this.removeListener("mousemove","mouseup"),this.update(),this.afterHandleMouseup()},this.afterHandleMouseup=function(){},this.handle_touchstart=function(e){if(!1!==this.enabled){switch(e.touches.length){case this.touchSeq[0]:r=this.STATE.TOUCH_ROTATE,n=this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY),t=i=this.getRotateY(e.touches[0].pageX,e.touches[0].pageY),o.copy(n);break;case this.touchSeq[1]:r=this.STATE.TOUCH_ZOOM;var a=e.touches[0].pageX-e.touches[1].pageX,s=e.touches[0].pageY-e.touches[1].pageY;c=h=Math.sqrt(a*a+s*s);break;case this.touchSeq[2]:r=this.STATE.TOUCH_PAN,u.copy(this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)),f.copy(u);break;default:r=this.STATE.NONE}this.update()}},this.handle_touchmove=function(e){if(!1!==this.enabled){switch(e.preventDefault(),e.touches.length){case this.touchSeq[0]:o=this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,o),i=this.getRotateY(e.touches[0].pageX,e.touches[0].pageY);break;case this.touchSeq[1]:var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY;c=Math.sqrt(t*t+a*a);break;case this.touchSeq[2]:f=this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,f);break;default:r=this.STATE.NONE}this.update()}},this.handle_touchend=function(e){if(!1!==this.enabled){switch(e.touches.length){case this.touchSeq[0]:n.copy(this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,o));break;case this.touchSeq[1]:h=c=0;break;case this.touchSeq[2]:f.copy(this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)),u.copy(f)}r=this.STATE.NONE,this.update()}},this.handle_DOMMouseScroll=function(e){this.handle_mousewheel(e)},this.handle_mousewheel=function(e){e.preventDefault();var t=0;e.wheelDelta?t=e.wheelDelta%120==0?e.wheelDelta/40:Math.abs(e.wheelDelta)>=100?e.wheelDelta/40:e.wheelDelta:e.detail&&(t=-e.detail/3),t&&(s.y+=1/t*.01),this.mouseMoving=!0,this.update()},this.handle_dblclick=function(e){if(this.isCtrlDown(e)){var t=this.network.getElementsByMouseEvent(e);t.length>0&&(p=t[0]),this.update()}},this.getMouseOnScreen=function(e,t){return new oe.Vec2((e-this.screen.offsetLeft)/this.radius*.5,(t-this.screen.offsetTop)/this.radius*.5)},this.getRotateY=function(e,t){if(this.yRistrict)return(.5*this.screen.height+this.screen.offsetTop-t)/this.screen.height*2},this.handle_keydown=function(e){if(this.keyboardEnable){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}this.update()}},this.handle_keyup=function(e){if(this.keyboardEnable){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}this.update()}},this.getMouseProjectionOnBall=function(e,t){if(this.yRistrict)return(r=(i=new oe.Vec3((e-.5*this.screen.width-this.screen.offsetLeft)/(.5*this.screen.width),0,0)).length())>1?i.normalize():i.z=Math.sqrt(1-r*r),i.normalize();var i=new oe.Vec3((e-.5*this.screen.width-this.screen.offsetLeft)/this.radius,(.5*this.screen.height+this.screen.offsetTop-t)/this.radius,0),r=i.length();r>1?i.normalize():i.z=Math.sqrt(1-r*r),a.copy(this.object._position).sub(this.object.target);var n=this.object.up.clone().setLength(i.y);return n.add(this.object.up.clone().cross(a).setLength(i.x)),n.add(a.setLength(i.z)),n},this.rotateSpeedFunction=function(){return this.rotateSpeed},this.rotateCamera=function(){var e=n.dot(o)/n.length()/o.length(),r=Math.acos(e),s=!this.easing||Math.abs(r)<this.easingRotateMinValue,l=!1,h=this.rotateSpeedFunction();if(r){var c=(new oe.Vec3).crossVectors(n,o).normalize(),u=new oe.Quat;u.setFromAxisAngle(c,-r*this.dynamicDampingFactor*h),s?(u.setFromAxisAngle(c,-r*h),a.applyQuaternion(u),this.object.up.applyQuaternion(u),n.copy(o)):(u.setFromAxisAngle(c,-r*this.dynamicDampingFactor*h),a.applyQuaternion(u),this.object.up.applyQuaternion(u),u.setFromAxisAngle(c,r*this.dynamicDampingFactor),n.applyQuaternion(u),l=!0)}var s=!this.easing||Math.abs(i-t)<this.easingRotateMinValue,f=(i-t)*a.length();Oe.isNaN(f)||(s?(f&&this.yRistrict&&this.limitY(f),t=i):((f=f*this.dynamicDampingFactor)&&this.yRistrict&&this.limitY(f),t+=(i-t)*this.dynamicDampingFactor,l=!0)),l&&this.network.dirtyNetwork()},this.limitY=function(e){var t=a.length();Math.abs(a.x)<=.1*t&&Math.abs(a.z)<=.1*t&&(a.x=.1*t);var i=a.x,r=a.z,n=Math.sqrt(i*i+r*r),o=Math.tan(this.yLowerLimitAngle)*n,s=Math.tan(this.yUpLimitAngle)*n;a.y-=e,a.y>s?a.y=s:a.y<o&&(a.y=o)},this.getValueByTime=function(e,t){var i=(new Date).getTime()-this._timeStart;return i>this.timeInterval?t:e+(t-e)*i/this.timeInterval},this.zoomCamera=function(){if(r===this.STATE.TOUCH_ZOOM){t=h/c;h=c,a.multiplyScalar(t)}else{var e=this.zoomSpeed;this.easing||(e*=5);var t;1!==(t=1+(l.y-s.y)*e)&&t>0&&(a.multiplyScalar(t),!this.easing||Math.abs(l.y-s.y)<this.easingZoomMinValue?s.copy(l):(s.y+=(l.y-s.y)*this.dynamicDampingFactor,this.network.dirtyNetwork()))}},this.panCamera=function(){var e=f.clone().sub(u);if(e.lengthSq()){e.multiplyScalar(a.length()*this.panSpeed);var t=a.clone().cross(this.object.up).setLength(e.x),i=(new ue).extractRotation(this.object.matrix),r=this.object.up.clone().applyMatrix4(i);t.add(r.setLength(e.y));var n=this.object.p().add(t);this.object.checkPosition(n)&&(this.object.p(n),this.object.target.add(t)),u=f,this.network.dirtyNetwork()}},this.checkAngles=function(){},this.checkDistances=function(){this.noZoom&&this.noPan||(a.lengthSq()>this.maxDistance*this.maxDistance&&this.object._position.addVectors(this.object.target,a.setLength(this.maxDistance)),a.lengthSq()<this.minDistance*this.minDistance&&this.object._position.addVectors(this.object.target,a.setLength(this.minDistance)))},this.updateFPS=function(){if(!this.freeze){if(this.heightSpeed){var e=oe.Math.clamp(this.object._position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*this.heightCoef*2}else this.autoSpeedFactor=0;var t=2*this.movementSpeed;if(this.moveForward||this.autoForward&&!this.moveBackward){s=this.object._position.clone();this.object.translateZ(-(t+this.autoSpeedFactor));var i=this.object.target;this.verticalFixed&&this.object.setY(s.y);var r=this.object._position,n=new he,o=new he;n.subVectors(r,i),o.subVectors(s,i),n.z*o.z<=this.minDistance*this.minDistance&&this.object.target.subVectors(this.object._position,a)}if(this.moveBackward){var s=this.object._position.clone();this.object.translateZ(t),this.verticalFixed&&this.object.setY(s.y)}this.moveLeft&&(this.object.translateX(this.fpsMode?t:-t),this.object.target.subVectors(this.object._position,a)),this.moveRight&&(this.object.translateX(this.fpsMode?-t:t),this.object.target.subVectors(this.object._position,a)),this.moveUp&&(this.object.translateY(t),this.object.target.subVectors(this.object._position,a)),this.moveDown&&(this.object.translateY(-t),this.object.target.subVectors(this.object._position,a));var l=2*this.lookSpeed;this.activeLook||this.dragMode||(l=0);var h=this.verticalLookRatio;if(this.constrainVertical&&(h=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*l,this.dragMode&&(this.mouseX=0),this.lookVertical&&(this.lat-=this.mouseY*l*h),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=oe.Math.degToRad(90-this.lat),this.theta=oe.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=oe.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),this.fpsMode){var c=this.object.target,u=(r=this.object._position).clone().sub(c).length();u=u<this.fpsMinDistance?this.fpsMinDistance:u,c.x=r.x+u*Math.sin(this.phi)*Math.sin(this.theta),c.y=r.y+u*Math.cos(this.phi),c.z=r.z-u*Math.sin(this.phi)*Math.cos(this.theta),this.object.look(c)}}},this.setCameraTarget=function(e){this.Object.p()},this.update=function(){if(a.subVectors(this.object._position,this.object.target),this.noRotate||this.fpsMode||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.fpsMode||this.panCamera(),p&&p.element&&this.network.doubleClickToLookAtFunction(p.element)){this.object.target=p.point;var e=this.object._position.distanceTo(this.object.target),t=p.face.normal.clone();(t=t.applyMatrix4((new oe.Mat4).extractRotation(p.element.worldMatrix))).normalize(),a=t.multiplyScalar(e),p=null}this.object.setPosition(this.object._position.clone().addVectors(this.object.target,a)),this.updateFPS(),this.fpsMode||(this.checkDistances(),this.object.look(this.object.target)),this.lastPosition.distanceToSquared(this.object._position)>0&&this.lastPosition.copy(this.object._position)},this.handleCameraChange=function(e){var t=this.object;if(t){var i=t.p(),r=t.target;if(this.fpsMode){var a=Oe.getVectorAngles(r,i);this.lat=-a[1],this.lon=-a[0]}}}},oe.extend(oe.DefaultInteraction,oe.BaseInteraction,{STATE:{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},__accessor:["rotateSpeed","zoomSpeed","panSpeed","yLowerLimitAngle","yUpLimitAngle","minDistance","maxDistance","easing","touchSeq"],__bool:["noRotate","noPan","noZoom","fpsMode","yRistrict","keyboardEnable"],setUp:function(){this.addListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup"),this.object&&this.object.addPropertyChangeListener(this.handleCameraChange,this)},tearDown:function(){this.removeListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup"),this.object&&this.object.removePropertyChangeListener(this.handleCameraChange,this)},beforeUpdate:function(){},setUpdateIntervalTime:function(e){this.updateIntervalTime=e}}),oe.SelectionInteraction=function(e){oe.BaseInteraction.call(this,e),this.selectUnVisible=!0,this.ctrlDown=!1,this.deleteTimeoutId=null,this._areaPickingLevel=1},oe.extend(oe.SelectionInteraction,oe.BaseInteraction,{constructor:oe.SelectionInteraction,setAreaPickingLevel:function(e){this._areaPickingLevel=e},getAreaPickingLevel:function(){return this._areaPickingLevel},setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},setFocus:function(e){if(document.activeElement!==e){var t,i,r,a=document.documentElement;document.body;a&&(pe.isIE||pe.isOpera||a.scrollLeft||a.scrollTop)&&(t=a.scrollLeft,i=a.scrollTop,r=a),e.focus(),r&&(r.scrollLeft=t,r.scrollTop=i)}},handle_mousedown:function(e){if(1!=e.stop&&!fe.isRightClick(e)){this.setFocus(this.network.getView()),this.isCtrlDown(e)?(this.addListener("mousemove","mouseup"),this.ctrlDownEvent=e):this.network.getDataBox().clearSelection();var t=this.network.getElementByColorPicking(e);!(t=t&&t.element)||this.network.isSelectable(t)&&this.network.getDataBox().getSelectionModel().isSelectable(t)||(t=null),this.network.getDataBox().getSelectionModel().appendSelection(t),this.network.onSelect(t)}},handle_mousemove:function(e){var t=this.getBoundingByMouseEvent(e,this.ctrlDownEvent,this.network.devicePixelRatio);this.mousemoved=!0,this.network.areaPickingRect=t,this.network.paintTopCanvas()},handle_mouseup:function(e){this.network.areaPickingRect=null,this.network.paintTopCanvas();var t=this.getBoundingByMouseEvent(e,this.ctrlDownEvent);if(this.removeListener("mousemove","mouseup"),this.ctrlDownEvent=null,t&&this.mousemoved){var i=this.network.getElementsByBounding(t,!0,this._areaPickingLevel),r=new _e;if(i.length>0)for(var a=0;a<i.length;a++){var n=i[a].element;this.network.selectable(i[a])&&r.add(n)}r.size()>0&&this.network.getDataBox().getSelectionModel().appendSelection(r)}},getBoundingByMouseEvent:function(e,t,i){if(e&&t){var r=this.network.getView().getBoundingClientRect(),a=e.clientX-r.left,n=e.clientY-r.top,o=t.clientX-r.left,s=t.clientY-r.top,l=i||1,h=Math.min(a,o)*l,c=Math.min(n,s)*l,u=Math.abs(a-o)*l,f=Math.abs(n-s)*l;return 0===u&&0===f?null:{x:h,y:c,w:u,h:f}}}}),oe.TransformGizmo=function(){var e=new oe.TransformGizmoMaterial({color:16711680}),i=new oe.TransformGizmoMaterial({color:65280}),r=new oe.TransformGizmoMaterial({color:255});this.handleGizmos={X:[new oe.Cylinder(e,.005,.005,1,4,1,!1,!1),new he(.5,0,0),new he(0,0,-Math.PI/2)],Y:[new oe.Cylinder(i,.005,.005,1,4,1,!1,!1),new he(0,.5,0)],Z:[new oe.Cylinder(r,.005,.005,1,4,1,!1,!1),new he(0,0,.5),new he(Math.PI/2,0,0)]};this.showHelpers=!0,this.showable=!0,this.init=function(){oe.Element.call(this),this.handles=new oe.Element,this.pickers=new oe.Element,this.planes=new oe.Element,this.addChild(this.handles),this.addChild(this.pickers),this.addChild(this.planes);var e=new oe.BasicMaterial({wireframe:!1,color:65535,side:oe.DoubleSide}),t=(new oe.Plane(e,5e4,5e4,2,2),{XY:new oe.Plane(e,5e4,5e4,2,2),YZ:new oe.Plane(e,5e4,5e4,2,2),XZ:new oe.Plane(e,5e4,5e4,2,2),XYZE:new oe.Plane(e,5e4,5e4,2,2)});t.YZ._rotation.set(0,Math.PI/2,0),t.XZ._rotation.set(-Math.PI/2,0,0);for(var i in t)t[i].name=i,this.planes.addChild(t[i]),this.planes[i]=t[i],t[i]._visible=!0;for(var i in this.handleGizmos){var r=this.handleGizmos[i][0];if(r.name=i,this.handleGizmos[i][1]&&r._position.set(this.handleGizmos[i][1].x,this.handleGizmos[i][1].y,this.handleGizmos[i][1].z),this.handleGizmos[i][2]&&r._rotation.set(this.handleGizmos[i][2].x,this.handleGizmos[i][2].y,this.handleGizmos[i][2].z),r.mode=this.mode,this.handles.addChild(r),this.pickerGizmos&&this.pickerGizmos[i]){a=this.pickerGizmos[i][0];this.pickerGizmos[i][1]&&a._position.set(this.pickerGizmos[i][1].x,this.pickerGizmos[i][1].y,this.pickerGizmos[i][1].z),this.pickerGizmos[i][2]&&a._rotation.set(this.pickerGizmos[i][2].x,this.pickerGizmos[i][2].y,this.pickerGizmos[i][2].z)}else var a=r.clone();a.mode=this.mode,a.name=i,this.pickers.addChild(a)}this.iterator(function(e){e instanceof oe.Entity&&oe.Utils.transformElement(e)})},this.hide=function(){this.handles.getChildren().forEach(function(e){e._visible=!1}),this.pickers.getChildren().forEach(function(e){e._visible=!1}),this.planes.getChildren().forEach(function(e){e._visible=!1})},this.show=function(){var e=this;this.handles.getChildren().forEach(function(t){t._visible=e.showHelpers&&e.showable}),this.pickers.getChildren().forEach(function(e){e._visible=!1}),this.activePlane&&(this.activePlane._visible=!1)},this.highlight=function(e){var i;for(var r in this.handleGizmos)(i=this.handleGizmos[r][0]).oldColor&&(i.material instanceof oe.ArrayMaterial?(i.material.materials[0].color.copy(i.oldColor),i.material.materials[0].opacity=i.oldOpacity):(i.material.color.copy(i.oldColor),i.material.opacity=i.oldOpacity),i.oldColor=null);this.handleGizmos[e]&&((i=this.handleGizmos[e][0]).material instanceof oe.ArrayMaterial?(i.oldColor=i.oldColor||i.material.materials[0].color.clone(),i.oldOpacity=i.oldOpacit!==t?i.oldOpacity:i.material.materials[0].opacity,i.material.materials[0].opacity=1):(i.oldColor=i.oldColor||i.material.color.clone(),i.oldOpacity=i.material.opacity,i.setStyle("material.opacity",1)))},this.init()},oe.TransformGizmo.prototype=Object.create(oe.Element.prototype),oe.TransformGizmo.prototype.update=function(e,t){for(var i=new he(0,0,0),r=new he(0,1,0),a=new ue,n=0;n<this.getChildren().size();n++)for(var o=0;o<this.getChildren().get(n).getChildren().size();o++){var s=this.getChildren().get(n).getChildren().get(o);-1!=s.name.search("E")?(s.quaternion.setFromRotationMatrix(a.lookAt(t,i,r)),s._rotation.setEulerFromQuaternion(s.quaternion)):(s.quaternion.setFromEuler(e),s._rotation.setEulerFromQuaternion(s.quaternion))}},oe.TransformGizmoTranslate=function(){oe.TransformGizmo.call(this);var e=new oe.TransformGizmoMaterial({color:16711680,opacity:.2}),t=new oe.TransformGizmoMaterial({color:65280,opacity:.2}),i=new oe.TransformGizmoMaterial({color:255,opacity:.2}),r=new oe.Arrow(e,1,.03,.2,.05,30),a=new oe.Arrow(t,1,.03,.2,.05,30),n=new oe.Arrow(i,1,.03,.2,.05,30),o=new oe.TransformGizmoMaterial({color:255,opacity:.5}),s=new oe.TransformGizmoMaterial({color:16711680,opacity:.5}),l=new oe.TransformGizmoMaterial({color:65280,opacity:.5}),h=new oe.TransformGizmoMaterial({color:16777215,opacity:.5}),c=new oe.Circle(o,.5,10,0,Math.PI/2),u=new oe.Circle(s,.5,10,0,Math.PI/2),f=new oe.Circle(l,.5,10,0,Math.PI/2),p=new oe.Octahedron(h,1e-4,0);this.handleGizmos={X:[r,new he(1.6,0,0),new he(0,0,-Math.PI/2)],Y:[a,new he(0,1.6,0)],Z:[n,new he(0,0,1.6),new he(Math.PI/2,0,0)],XYZ:[p],XY:[c,new he(0,0,0)],YZ:[u,new he(0,0,0),new he(Math.PI/2,Math.PI/2,0)],XZ:[f,new he(0,0,0),new he(Math.PI/2,0,0)]};var h=new oe.TransformGizmoMaterial({color:16711680,opacity:.25}),d=new oe.TransformGizmoMaterial({color:65280,opacity:.25}),m=new oe.TransformGizmoMaterial({color:255,opacity:.25}),g=new oe.Cylinder(h,.075,0,1.2,4,1,!1),v=new oe.Cylinder(d,.075,0,1.2,4,1,!1),y=new oe.Cylinder(m,.075,0,1.2,4,1,!1),p=new oe.Octahedron(h,1e-4,0);this.pickerGizmos={X:[g,new he(1.6,0,0),new he(0,0,-Math.PI/2)],Y:[v,new he(0,1.6,0)],Z:[y,new he(0,0,1.6),new he(Math.PI/2,0,0)],XYZ:[p]},this.setActivePlane=function(e,t){var i=new ue;t.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),"XY"==e&&(this.activePlane=this.planes.XY),"YZ"==e&&(this.activePlane=this.planes.YZ),"XZ"==e&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},oe.TransformGizmoTranslate.prototype=Object.create(oe.TransformGizmo.prototype),oe.TransformGizmoTranslate.prototype.mode="translate",oe.TransformGizmoRotate=function(){oe.TransformGizmo.call(this);var e=new oe.TransformGizmoMaterial({color:16711680,opacity:.2}),t=new oe.TransformGizmoMaterial({color:65280,opacity:.2}),i=new oe.TransformGizmoMaterial({color:255,opacity:.2}),r=new oe.TransformGizmoMaterial({color:16776960}),a=new oe.TransformGizmoMaterial({color:7895160,opacity:.25}),a=new oe.TransformGizmoMaterial({color:16711680}),n=new oe.Torus(e,1,.02,4,32,Math.PI),o=new oe.Torus(t,1,.02,4,32,Math.PI),s=new oe.Torus(i,1,.02,4,32,Math.PI);new oe.Torus(r,1.25,.01,4,64),new oe.Torus(a,1,.01,4,64);this.handleGizmos={X:[n,new he(0,0,0),new he(0,-Math.PI/2,-Math.PI/2)],Y:[o,new he(0,0,0),new he(Math.PI/2,0,0)],Z:[s,new he(0,0,0),new he(0,0,-Math.PI/2)]};var l=new oe.TransformGizmoMaterial({color:16711680,opacity:.25}),h=new oe.TransformGizmoMaterial({color:65280,opacity:.25}),c=new oe.TransformGizmoMaterial({color:255,opacity:.25}),u=new oe.TransformGizmoMaterial({color:983040,opacity:.25}),f=new oe.Torus(l,1,.05,4,12,Math.PI),p=new oe.Torus(h,1,.05,4,12,Math.PI),d=new oe.Torus(c,1,.05,4,12,Math.PI);new oe.Torus(u,1,.05,2,24);this.pickerGizmos={X:[f,new he(0,0,0),new he(0,-Math.PI/2,-Math.PI/2)],Y:[p,new he(0,0,0),new he(Math.PI/2,0,0)],Z:[d,new he(0,0,0),new he(0,0,-Math.PI/2)]},this.setActivePlane=function(e){"E"==e&&(this.activePlane=this.planes.XYZE),"X"==e&&(this.activePlane=this.planes.YZ),"Y"==e&&(this.activePlane=this.planes.XZ),"Z"==e&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){oe.TransformGizmo.prototype.update.apply(this,arguments);var i={handles:this.handles,pickers:this.pickers},r=new ue,a=new oe.Euler(0,0,1),n=new oe.Quat,o=new he(1,0,0),s=new he(0,1,0),l=new he(0,0,1),h=new oe.Quat,c=new oe.Quat,u=new oe.Quat,f=t.clone();a.copy(this.planes.XY._rotation),n.setFromEuler(a),r.makeRotationFromQuaternion(n).getInverse(r),f.applyProjection(r);for(var p in i)for(var d=0;d<i[p].getChildren().size;d++){var m=i[p].getChildren().get(d);n.setFromEuler(a),"X"==m.name&&(h.setFromAxisAngle(o,Math.atan2(-f.y,f.z)),n.multiplyQuaternions(n,h),m.quaternion.copy(n)),"Y"==m.name&&(c.setFromAxisAngle(s,Math.atan2(f.x,f.z)),n.multiplyQuaternions(n,c),m.quaternion.copy(n)),"Z"==m.name&&(u.setFromAxisAngle(l,Math.atan2(f.y,f.x)),n.multiplyQuaternions(n,u),m.quaternion.copy(n))}},this.init()},oe.TransformGizmoRotate.prototype=Object.create(oe.TransformGizmo.prototype),oe.TransformGizmoRotate.prototype.mode="rotate",oe.TransformGizmoScale=function(){oe.TransformGizmo.call(this);var e=new oe.TransformGizmoMaterial({color:11184810,opacity:1}),t=new oe.TransformGizmoMaterial({color:16711680,opacity:.2}),i=new oe.TransformGizmoMaterial({color:65280,opacity:.2}),r=new oe.TransformGizmoMaterial({color:255,opacity:.2}),a=new oe.Cube(e,.25,.25,.25),n=new oe.Cylinder(null,.1,.1,1,4,1,!1),o=new oe.Cube(e,.225,.225,.225);(s=new oe.Cylinder(null,.1,0,1,20,1,!0))._position.y=.05;var s=oe.Utils.createElement(n,s,t),l=(oe.Utils.createElement(n,s,i),oe.Utils.createElement(n,s,r),new oe.Cylinder(t,.08,0,1,4,1,!1)),h=new oe.Cylinder(i,.08,0,1,4,1,!1),c=new oe.Cylinder(r,.08,0,1,4,1,!1),u=new oe.Element;u.material=new oe.BasicMaterial;var f=new oe.Element;f.material=new oe.BasicMaterial;var p=new oe.Element;p.material=new oe.BasicMaterial,this.handleGizmos={X:[l,new he(.5,0,0),new he(0,0,-Math.PI/2)],Y:[h,new he(0,.5,0)],Z:[c,new he(0,0,.5),new he(Math.PI/2,0,0)],XY:[u],YZ:[f],XZ:[p],XYZ:[a]};var d=new oe.TransformGizmoMaterial({color:16711680,opacity:.25}),m=new oe.TransformGizmoMaterial({color:65280,opacity:.25}),g=new oe.TransformGizmoMaterial({color:255,opacity:.25}),v=new oe.Cylinder(d,.125,0,1,4,1,!1),y=new oe.Cylinder(m,.125,0,1,4,1,!1),A=new oe.Cylinder(g,.125,0,1,4,1,!1);this.pickerGizmos={X:[v,new he(.6,0,0),new he(Math.PI/4,0,-Math.PI/2)],Y:[y,new he(0,.6,0),new he(0,Math.PI/4,0)],Z:[A,new he(0,0,.6),new he(Math.PI/2,Math.PI/4,0)],XYZ:[o]},this.setActivePlane=function(e,t){var i=new ue;t.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==e?(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)):"Y"==e?(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)):"Z"==e?(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)):this.activePlane="XYZ"==e?this.planes.XYZE:this.planes[e],this.hide(),this.show()},this.init()},oe.TransformGizmoScale.prototype=Object.create(oe.TransformGizmo.prototype),oe.TransformGizmoScale.prototype.mode="scale",oe.EditInteraction=function(e){function i(t){if(g.network._keyboardRemoveEnabled&&46==t.keyCode&&e.getDataBox().getSelectionModel().size()>0){window.confirm("Delete?")&&e.getDataBox().removeSelection()}}function r(e){1===e.touches.length&&(g.deleteTimeoutId=setTimeout(function(){var t=g.network.getElementsByMouseEvent(e,g.selectUnVisible);if(t.length>0){var i=t[0];window.confirm("Delete?")&&g.network.getDataBox().remove(i.element)}},1e3))}function a(e){clearTimeout(g.deleteTimeoutId)}function n(e){clearTimeout(g.deleteTimeoutId)}function o(e){g.update()}function s(e){if(g.object&&!v){e.preventDefault(),e.stopPropagation();var t=f(e.touches?e.touches[0]:e,g.filterIntersectPicker(g.pickers));if(t)g.axis=t.object.name,g.setMode(t.object.mode);else{var i=c(e);i===g.object||null!=i&&i.editTransformToParent&&i.isDescendantOf(g.object)?(g.axis=g.getAxis(),g.setMode(g.getMode())):g.axis=!1}g.update(!0)}}function l(i){if(!i.stop)if(q.set(i.clientX,i.clientY),g.showHelpers&&g.axis||(u(i),s(i)),g.object&&!v){i.preventDefault(),i.stopPropagation();var r=i.touches?i.touches[0]:i;if(0===r.button||r.button==t){var a=f(r,g.filterIntersectPicker(g.pickers)),n=c(i);if(a||(n===g.object||null!=n&&n.editTransformToParent&&n.isDescendantOf(g.object))&&g.getDefaultPickers()&&(a={object:g.getDefaultPickers()}),a){g.axis=a.object.name,S.copy(Y).sub(X).normalize(),g.gizmo[y].setActivePlane(g.axis,S);var o=f(r,[g.gizmo[y].activePlane]);if(!o&&n&&(o=f(r,[n])),o){F.copy(g.object._position),V.copy(g.object._scale),U.extractRotation(g.object.matrix),W.extractRotation(g.object.worldMatrix);var l=g.object.getParent();l==t&&(l=e),k.extractRotation(l.worldMatrix),O.getScaleFromMatrix(P.getInverse(l.worldMatrix)),x.copy(o.point)}}}g.update(!0),v=!0}else g.network.dirtyNetwork()}function h(t){if(g.object&&g.axis&&v){t.preventDefault(),t.stopPropagation(),t.stop=!0;var i=t.touches?t.touches[0]:t,r=f(i,[g.gizmo[y].activePlane]);if(r||(r=f(i,[g.object])),r){if(g.moving?e.fireInteractionEvent({kind:"liveMoveBetween",event:gt}):(e.fireInteractionEvent({kind:"liveMoveStart",event:gt}),g.moving=!0),A.copy(r.point),"translate"==y&&g.translateable){if(A.sub(x),A.multiply(O),"local"==g.space&&(A.applyMatrix4(P.getInverse(W)),-1==g.axis.search("X")&&(A.x=0),-1==g.axis.search("Y")&&(A.y=0),-1==g.axis.search("Z")&&(A.z=0),A.applyMatrix4(U),g.object.setPosition(F.clone().add(A))),"world"==g.space||-1!=g.axis.search("XYZ")){-1==g.axis.search("X")&&(A.x=0),-1==g.axis.search("Y")&&(A.y=0),-1==g.axis.search("Z")&&(A.z=0),A.applyMatrix4(P.getInverse(k)),g.object._position.copy(F);var a=g.object._position.clone().add(A);g.snap&&(-1!=g.axis.search("X")&&(a.x=Math.round(g.object._position.x/g.snap)*g.snap),-1!=g.axis.search("Y")&&(a.y=Math.round(g.object._position.y/g.snap)*g.snap),-1!=g.axis.search("Z")&&(a.z=Math.round(g.object._position.z/g.snap)*g.snap)),g.object.setPosition(a)}}else if("scale"==y&&g.scaleable){A.sub(x),A.multiply(O);var n=g.object._scale.clone(),o=(g.scaleRate||1)/10;if("XYZ"==g.axis)c=1+A.y*o,n.x=V.x*c,n.y=V.y*c,n.z=V.z*c;else if("XY"===g.axis){var s=1+A.x*o,l=1+A.y*o;if(g.forceSameScale){c=Math.max(s,l);n.x=V.x*c,n.y=V.y*c}else n.x=V.x*s,n.y=V.y*l}else if("YZ"===g.axis){var h=1+A.z*o,l=1+A.y*o;if(g.forceSameScale){c=Math.max(h,l);n.z=V.z*c,n.y=V.y*c}else n.z=V.z*h,n.y=V.y*l}else if("XZ"===g.axis){var s=1+A.x*o,h=1+A.z*o;if(g.forceSameScale){var c=Math.max(s,l);n.x=V.x*c,n.z=V.z*c}else n.x=V.x*s,n.z=V.z*h}else A.applyMatrix4(P.getInverse(W)),"X"==g.axis&&(n.x=V.x*(1+A.x*o)),"Y"==g.axis&&(n.y=V.y*(1+A.y*o)),"Z"==g.axis&&(n.z=V.z*(1+A.z*o));g.object.setScale(n)}else if("rotate"==y&&g.rotateable)if(A.sub(X),A.multiply(O),C.copy(x).sub(X),C.multiply(O),"E"==g.axis)A.applyMatrix4(P.getInverse(M)),C.applyMatrix4(P.getInverse(M)),_.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),w.set(Math.atan2(C.z,C.y),Math.atan2(C.x,C.z),Math.atan2(C.y,C.x)),T.setFromRotationMatrix(P.getInverse(k)),I.setFromAxisAngle(S,_.z-w.z),L.setFromRotationMatrix(W),T.multiplyQuaternions(T,I),T.multiplyQuaternions(T,L),g.object.quaternion.copy(T);else if("XYZE"==g.axis)I.setFromEuler(A.clone().cross(C).normalize()),T.setFromRotationMatrix(P.getInverse(k)),R.setFromAxisAngle(I,-A.clone().angleTo(C)),L.setFromRotationMatrix(W),T.multiplyQuaternions(T,R),T.multiplyQuaternions(T,L),g.object.quaternion.copy(T);else if("local"==g.space)A.applyMatrix4(P.getInverse(W)),C.applyMatrix4(P.getInverse(W)),_.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),w.set(Math.atan2(C.z,C.y),Math.atan2(C.x,C.z),Math.atan2(C.y,C.x)),L.setFromRotationMatrix(U),R.setFromAxisAngle(E,_.x-w.x),N.setFromAxisAngle(z,_.y-w.y),B.setFromAxisAngle(D,_.z-w.z),"X"==g.axis&&L.multiplyQuaternions(L,R),"Y"==g.axis&&L.multiplyQuaternions(L,N),"Z"==g.axis&&L.multiplyQuaternions(L,B),g.object.quaternion.copy(L),(u=g.object._rotation.clone()).setEulerFromQuaternion(L),g.object.setRotation(u);else if("world"==g.space){_.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),w.set(Math.atan2(C.z,C.y),Math.atan2(C.x,C.z),Math.atan2(C.y,C.x)),T.setFromRotationMatrix(P.getInverse(k)),R.setFromAxisAngle(E,_.x-w.x),N.setFromAxisAngle(z,_.y-w.y),B.setFromAxisAngle(D,_.z-w.z),L.setFromRotationMatrix(W),"X"==g.axis&&T.multiplyQuaternions(T,R),"Y"==g.axis&&T.multiplyQuaternions(T,N),"Z"==g.axis&&T.multiplyQuaternions(T,B),T.multiplyQuaternions(T,L),g.object.quaternion.copy(T);var u=g.object._rotation.clone();u.setEulerFromQuaternion(T),g.object.setRotation(u)}g.changed=!0}g.update(!0),g.updateTextNote(t,g.object)}}function c(t){var i=g.network.getElementsByMouseEvent(t);return e.getFirstEditElement(i)}function u(t){if(null===H&&(H=new le),H.set(t.clientX,t.clientY),e.getDataBox().clearEditing(),0===H.distanceTo(q)){var i=g.network.getElementsByMouseEvent(t),r=e.getFirstEditElement(i);r&&(g.object,g.object=r,g.translateable&&g.gizmo.translate.show(),g.rotateable&&g.gizmo.rotate.show(),g.scaleable&&g.gizmo.scale.show()),r||(g.gizmo[y].hide(),g.gizmo.translate.hide(),g.gizmo.rotate.hide(),g.gizmo.scale.hide(),g.object=null)}else g.changed&&g.onElementPropertyChanged&&(g.changed=!1,g.moving=!1,g.onElementPropertyChanged(t,g.object),e.fireInteractionEvent({kind:"liveMoveEnd",event:{e:t,source:g.object,time:(new Date).getTime()}}));g.axis=!1,v=!1,g.update(!0),g.hideTextNote()}function f(e,t){if(!t)return null;var i=g.network.getPickingByEvent(e).intersectObjects(t,!0,!0);return!!i[0]&&i[0]}oe.BaseInteraction.call(this,e);var p=new oe.Element,d=e.getCamera(),m=e.getRootView();m=m!==t?m:document,this.domElement=m,this.gizmo={},this.gizmo.translate=new oe.TransformGizmoTranslate,this.gizmo.rotate=new oe.TransformGizmoRotate,this.gizmo.scale=new oe.TransformGizmoScale,p.addChild(this.gizmo.translate),p.addChild(this.gizmo.rotate),p.addChild(this.gizmo.scale),this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.object=!1,this.snap=!1,this.space="local",this.size=1,this.axis=!1;var g=this;this.scaleable=!0,this.rotateable=!0,this.translateable=!0,this.setShowHelpers(!0);var v=!1,y="translate",A=(new oe.Picking,new oe.Projector,new he,new he),x=new he,_=new he,w=new he,b=1,M=new ue,S=new he,P=new ue,C=new he,T=new oe.Quat,E=new he(1,0,0),z=new he(0,1,0),D=new he(0,0,1),L=new oe.Quat,R=new oe.Quat,N=new oe.Quat,B=new oe.Quat,I=new oe.Quat,F=new he,V=new he,U=new ue,k=new ue,O=new he,X=new he,G=new oe.Euler,W=new ue,Y=new he,j=new oe.Euler;this.showNote=!0,this.handleDataBoxChange=function(e){"remove"==e.kind?e.data==g.object&&(g.gizmo.translate.hide(),g.gizmo.rotate.hide(),g.gizmo.scale.hide()):"clear"==e.kind&&(g.gizmo.translate.hide(),g.gizmo.rotate.hide(),g.gizmo.scale.hide())},this.network.getDataBox().addDataBoxChangeListener(this.handleDataBoxChange,this),this.network.addPropertyChangeListener(function(e){if("dataBox"==e.property){var t=e.oldValue,i=e.value;t.removeDataBoxChangeListener(this.handleDataBoxChange),i.addDataBoxChangeListener(this.handleDataBoxChange,this)}}),this.defaultMode="TranslateXY",this.pickers=[],this.gizmo.translate.pickers.getChildren().forEach(function(e){g.pickers.push(e)}),this.gizmo.rotate.pickers.getChildren().forEach(function(e){g.pickers.push(e)}),this.gizmo.scale.pickers.getChildren().forEach(function(e){g.pickers.push(e)}),this.attach=function(e){g.object=e,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.gizmo[y].show(),g.update()},this.detach=function(e){g.object=!1,this.axis=!1,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide()},this.setMode=function(e){y=e||y,this.update()},this.setUp=function(){m.addEventListener("mousedown",l,!1),m.addEventListener("touchstart",l,!1),m.addEventListener("mousemove",s,!1),m.addEventListener("touchmove",s,!1),m.addEventListener("mousemove",h,!1),m.addEventListener("touchmove",h,!1),m.addEventListener("mouseup",u,!1),m.addEventListener("mouseout",u,!1),m.addEventListener("touchend",u,!1),m.addEventListener("touchcancel",u,!1),m.addEventListener("touchleave",u,!1),m.addEventListener("keydown",i,!1),m.addEventListener("touchstart",r,!1),m.addEventListener("touchmove",a,!1),m.addEventListener("touchend",n,!1),m.addEventListener("mousewheel",o,!1),g.network.helperBox.addByDescendant(p)},this.tearDown=function(){m.removeEventListener("mousedown",l,!1),m.removeEventListener("touchstart",l,!1),m.removeEventListener("mousemove",s,!1),m.removeEventListener("touchmove",s,!1),m.removeEventListener("mousemove",h,!1),m.removeEventListener("touchmove",h,!1),m.removeEventListener("mouseup",u,!1),m.removeEventListener("mouseout",u,!1),m.removeEventListener("touchend",u,!1),m.removeEventListener("touchcancel",u,!1),m.removeEventListener("touchleave",u,!1),m.removeEventListener("keydown",i,!1),m.removeEventListener("touchstart",r,!1),m.removeEventListener("touchmove",a,!1),m.removeEventListener("touchend",n,!1),m.removeEventListener("mousewheel",o,!1),g.gizmo.translate.hide(),g.gizmo.rotate.hide(),g.gizmo.scale.hide(),g.network.helperBox.removeByDescendant(p)},this.setSnap=function(e){g.snap=e},this.setSize=function(e){g.size=e,this.update()},this.setSpace=function(e){g.space=e,this.update()},this.update=function(e){g.object&&(g.object.updateWorldMatrix(),X.getPositionFromMatrix(g.object.worldMatrix),G.setFromRotationMatrix(P.extractRotation(g.object.worldMatrix)),d.updateWorldMatrix(),Y.getPositionFromMatrix(d.worldMatrix),j.setFromRotationMatrix(P.extractRotation(d.worldMatrix)),b=X.distanceTo(Y)/12*g.size,p.setPosition(X),p.setScale(b,b,b),S.copy(Y).sub(X).normalize(),this.gizmo.scale.update(G,S),"local"==g.space?(this.gizmo.translate.update(G,S),this.gizmo.rotate.update(G,S)):(this.gizmo.translate.update(new oe.Euler,S),this.gizmo.rotate.update(new oe.Euler,S)),this.gizmo.translate.highlight(null),this.gizmo.rotate.highlight(null),this.gizmo.scale.highlight(null),this.gizmo[y].highlight(g.axis),p.updateWorldMatrix(!0),e&&g.network.dirtyNetwork())},this.getDefaultPickers=function(){return"TranslateX"===this.defaultMode?g.gizmo.translate.pickers.getChildren().get(0):"TranslateY"===this.defaultMode?g.gizmo.translate.pickers.getChildren().get(1):"TranslateZ"===this.defaultMode?g.gizmo.translate.pickers.getChildren().get(2):"TranslateXY"===this.defaultMode?g.gizmo.translate.pickers.getChildren().get(4):"TranslateYZ"===this.defaultMode?g.gizmo.translate.pickers.getChildren().get(5):"TranslateXZ"===this.defaultMode?g.gizmo.translate.pickers.getChildren().get(6):"TranslateXYZ"===this.defaultMode?g.gizmo.translate.pickers.getChildren().get(3):"RotateX"===this.defaultMode?g.gizmo.rotate.pickers.getChildren().get(0):"RotateY"===this.defaultMode?g.gizmo.rotate.pickers.getChildren().get(1):"RotateZ"===this.defaultMode?g.gizmo.rotate.pickers.getChildren().get(2):"ScaleX"===this.defaultMode?g.gizmo.scale.pickers.getChildren().get(0):"ScaleY"===this.defaultMode?g.gizmo.scale.pickers.getChildren().get(1):"ScaleZ"===this.defaultMode?g.gizmo.scale.pickers.getChildren().get(2):"ScaleXYZ"===this.defaultMode?g.gizmo.scale.pickers.getChildren().get(6):"ScaleXY"===this.defaultMode?g.gizmo.scale.pickers.getChildren().get(3):"ScaleYZ"===this.defaultMode?g.gizmo.scale.pickers.getChildren().get(4):"ScaleXZ"===this.defaultMode?g.gizmo.scale.pickers.getChildren().get(5):null},this.getMode=function(){var e=this.defaultMode;return e.startsWith("Translate")?"translate":e.startsWith("Rotate")?"rotate":e.startsWith("Scale")?"scale":"translate"},this.getAxis=function(){var e=this.defaultMode;return e.endsWith("XYZ")?"XYZ":e.endsWith("XY")?"XY":e.endsWith("YZ")?"YZ":e.endsWith("XZ")?"XZ":e.endsWith("Y")?"X":e.endsWith("Y")?"Y":e.endsWith("Z")?"Z":""};var H=null,q=new le;this.filterIntersectPicker=function(e){var t=[];if(!this.showHelpers)return t;for(var i=0;i<e.length;i++){var r=e[i];r.getParent()===this.gizmo.translate.pickers&&this.translateable&&t.push(r),r.getParent()===this.gizmo.rotate.pickers&&this.rotateable&&t.push(r),r.getParent()===this.gizmo.scale.pickers&&this.scaleable&&t.push(r)}return t}},oe.extend(oe.EditInteraction,oe.BaseInteraction,{setShowHelpers:function(e){this.showHelpers=e,this.gizmo.translate.showHelpers=e,this.gizmo.rotate.showHelpers=e,this.gizmo.scale.showHelpers=e,this.resetHelpers()},onElementPropertyChanged:function(e,t){},resetHelpers:function(){this.showHelpers&&this.translateable&&this.object?this.gizmo.translate.show():this.gizmo.translate.hide(),this.showHelpers&&this.rotateable&&this.object?this.gizmo.rotate.show():this.gizmo.rotate.hide(),this.showHelpers&&this.scaleable&&this.object?this.gizmo.scale.show():this.gizmo.scale.hide(),this.update(!0)},setShowNote:function(e){this.showNote=e},setScaleable:function(e){this.scaleable=e,this.gizmo.scale.showable=e,this.resetHelpers()},setRotateable:function(e){this.rotateable=e,this.gizmo.rotate.showable=e,this.resetHelpers()},setTranslateable:function(e){this.translateable=e,this.gizmo.translate.showable=e,this.resetHelpers()},setDefaultMode:function(e){this.defaultMode=e},setScaleRate:function(e){this.scaleRate=e||1},setForceSameScale:function(e){this.forceSameScale=e},setSpaceMode:function(e){this.space="world"==e?"world":"local",this.update()},createTextNote:function(){this.textNote=document.createElement("div"),this.textNote.style.position="relative",this.textNote.style.color="black",this.textNote.style.height="0px",this.textNote.style.zIndex="1000",this.domElement.appendChild(this.textNote);var e=document.createElement("table");this.noteTable=e,this.textNote.appendChild(this.noteTable);e.createTHead();e.style.borderLeft="1px solid #ffa500",e.style.borderTop="1px solid #ffa500",e.style.fontSize="14px",e.style.backgroundColor="rgba(255, 170, 13, 0.5)",e.setAttribute("border",0),e.setAttribute("cellspacing",0),e.setAttribute("cellpadding",0);for(var t=0;t<4;t++){for(var i=document.createElement("tr"),r=0;r<4;r++){var a=document.createElement("td");a.style.borderRight="1px solid #ffa500",a.style.borderBottom="1px solid #ffa500",a.style.paddingLeft="5px",a.style.paddingRight="5px",a.style.paddingTop="2px",a.style.paddingBottom="2px",0==t&&r>0||t>0&&0==r?(a.style.textAlign="center",a.style.fontWeight="bold"):a.style.textAlign="right",i.appendChild(a)}e.appendChild(i)}},showTextNote:function(){this.showNote&&(null==this.textNote&&this.createTextNote(),this.textNote.style.display="")},hideTextNote:function(){this.textNote&&(this.textNote.style.display="none")},updateTextNote:function(e,t){if(null!=t&&this.showNote){var i=this.network.getRootView().getBoundingClientRect();this.showTextNote(),this.textNote.style.top=e.clientY-i.top+20+"px",this.textNote.style.left=e.clientX-i.left+20+"px";for(var r=t.getRotation(),a=t.getPosition(),n=t.getScale(),o=[[" ","x","y","z"],["p",a.x,a.y,a.z],["r",r.x,r.y,r.z],["s",n.x,n.y,n.z]],s=this.noteTable,l=0;l<4;l++)for(var h=0;h<4;h++){var c=o[l][h];l>0&&h>0&&(c=2==l?(180*c/Math.PI).toFixed(0)+"&deg;":c.toFixed(2)),s.rows[l].cells[h].innerHTML=""+c}}}});oe.CSG=function(e){var t,i,r,a,n,o,s=[];if(!(e instanceof oe.Element)){if(e instanceof Dt)return this.tree=e,this.matrix=new ue,this;throw"TGL.CSG: Given geometry is unsupported"}for(e.computeNodeData&&e.computeNodeData(),e.updateWorldMatrix(!0),this.matrix=e.worldMatrix.clone(),h=0,t=e.faces.length;h<t;h++){if(i=e.faces[h],a=e.uvs[h],n=e.uv2s[h],o=new Et,i instanceof Pe)r=e.vertices[i.a],(r=new zt(r.x,r.y,r.z,i.vertexNormals[0],new le(a[0].x,a[0].y),n[0].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.b],(r=new zt(r.x,r.y,r.z,i.vertexNormals[1],new le(a[1].x,a[1].y),n[1].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.c],(r=new zt(r.x,r.y,r.z,i.vertexNormals[2],new le(a[2].x,a[2].y),n[2].clone())).applyMatrix4(this.matrix),r.materialIndex=i.materialIndex,o.vertices.push(r);else{if(!(i instanceof Ce))throw"Invalid face type at index "+h;r=e.vertices[i.a],(r=new zt(r.x,r.y,r.z,i.vertexNormals[0],new le(a[0].x,a[0].y),n[0].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.b],(r=new zt(r.x,r.y,r.z,i.vertexNormals[1],new le(a[1].x,a[1].y),n[1].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.c],(r=new zt(r.x,r.y,r.z,i.vertexNormals[2],new le(a[2].x,a[2].y),n[2].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.d],(r=new zt(r.x,r.y,r.z,i.vertexNormals[3],new le(a[3].x,a[3].y),n[3].clone())).applyMatrix4(this.matrix),r.materialIndex=i.materialIndex,o.vertices.push(r)}isNaN(o.calculateProperties().w)||s.push(o)}if(this.tree=new Dt(s),this.tree.materialSize=e.getMaterialSize?e.getMaterialSize():0,e.material instanceof oe.ArrayMaterial)this.tree.material=e.material;else{var l=new oe.ArrayMaterial;this.tree.material=l;for(var h=0;h<this.tree.materialSize;h++)l.push(e.material)}},oe.CSG.prototype.substract=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.sumMateriaSize(i),t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),t=new oe.CSG(t),t.matrix=this.matrix,t},oe.CSG.prototype.union=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.sumMateriaSize(i),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t=new oe.CSG(t),t.matrix=this.matrix,t},oe.CSG.prototype.intersect=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.sumMateriaSize(i),t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),t=new oe.CSG(t),t.matrix=this.matrix,t},oe.CSG.prototype.inverse=function(){var e=this.tree.clone();return e.polygons.map(function(e){e.flip()}),e=new oe.CSG(e)},oe.CSG.prototype.toGeometry=function(e){(new ue).getInverse(this.matrix);var t,i,r,a,n,o,s,l,h,c,u,f=new oe.Entity(this.tree.material,e),p=this.tree.allPolygons(),d=p.length,m={};for(t=0;t<d;t++)for(a=(r=p[t]).vertices.length,i=2;i<a;i++){c=[],u=[],l=r.vertices[0],c.push(new le(l.uv.x,l.uv.y)),u.push(l.uv2.clone());var g=l.materialIndex;void 0!==m[(l=new he(l.x,l.y,l.z)).x+","+l.y+","+l.z]?n=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),n=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),l=r.vertices[i-1],c.push(new le(l.uv.x,l.uv.y)),u.push(l.uv2.clone()),void 0!==m[(l=new he(l.x,l.y,l.z)).x+","+l.y+","+l.z]?o=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),o=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),l=r.vertices[i],c.push(new le(l.uv.x,l.uv.y)),u.push(l.uv2.clone()),void 0!==m[(l=new he(l.x,l.y,l.z)).x+","+l.y+","+l.z]?s=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),s=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),(h=new Pe(n,o,s,new he(r.normal.x,r.normal.y,r.normal.z))).materialIndex=g||0,f.faces.push(h),f.uvs.push(c),f.uv2s.push(u)}return f},oe.CSG.prototype.toMesh=function(e){var t=this.toGeometry(e);return t.computeBoundingBox(),t};var Et=function(e,i,r){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=t};Et.prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],i=this.vertices[2],r=t.clone().subtract(e),a=i.clone().subtract(e);return this.normal=r.cross(a).normalize(),this.w=this.normal.clone().dot(e),this},Et.prototype.clone=function(){var e,t,i=new Et;for(e=0,t=this.vertices.length;e<t;e++)i.vertices.push(this.vertices[e].clone());return i.calculateProperties(),i},Et.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this},Et.prototype.classifyVertex=function(e){var t=this.normal.dot(e)-this.w;return t<-1e-5?2:t>1e-5?1:0},Et.prototype.classifySide=function(e){var t,i,r,a=0,n=0,o=e.vertices.length;for(t=0;t<o;t++)i=e.vertices[t],1===(r=this.classifyVertex(i))?a++:2===r&&n++;return a>0&&0===n?1:0===a&&n>0?2:0===a&&0===n?0:3},Et.prototype.splitPolygon=function(e,t,i,r,a){var n=this.classifySide(e);if(0===n)(this.normal.dot(e.normal)>0?t:i).push(e);else if(1===n)r.push(e);else if(2===n)a.push(e);else{var o,s,l,h,c,u,f,p,d,m=[],g=[];for(s=0,o=e.vertices.length;s<o;s++)l=(s+1)%o,u=e.vertices[s],f=e.vertices[l],h=this.classifyVertex(u),c=this.classifyVertex(f),2!=h&&m.push(u),1!=h&&g.push(u),3==(h|c)&&(p=(this.w-this.normal.dot(u))/this.normal.dot(f.clone().subtract(u)),d=u.interpolate(f,p),m.push(d),g.push(d));m.length>=3&&r.push(new Et(m).calculateProperties()),g.length>=3&&a.push(new Et(g).calculateProperties())}},oe.CSG.Polygon=Et;var zt=function(e,t,i,r,a,n){this.x=e,this.y=t,this.z=i,this.normal=r||new he,this.uv=a||new le,this.uv2=n||new le};zt.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},zt.prototype.clone=function(){var e=new zt(this.x,this.y,this.z,this.normal.clone(),this.uv.clone(),this.uv2.clone());return e.materialIndex=this.materialIndex,e},zt.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},zt.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},zt.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},zt.prototype.cross=function(e){var t=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-i*e.x,this},zt.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},zt.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},zt.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this.uv2.add(e.uv2.clone().sub(this.uv2).multiplyScalar(t)),this},zt.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},zt.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12],this.y=a[1]*t+a[5]*i+a[9]*r+a[13],this.z=a[2]*t+a[6]*i+a[10]*r+a[14],this},oe.CSG.Vertex=zt;var Dt=function(e){var i,r,a=[],n=[];if(this.polygons=[],this.front=this.back=t,e instanceof Array&&0!==e.length){for(this.divider=e[0].clone(),i=0,r=e.length;i<r;i++)this.divider.splitPolygon(e[i],this.polygons,this.polygons,a,n);a.length>0&&(this.front=new Dt(a)),n.length>0&&(this.back=new Dt(n))}};Dt.isConvex=function(e){var t,i;for(t=0;t<e.length;t++)for(i=0;i<e.length;i++)if(t!==i&&2!==e[t].classifySide(e[i]))return!1;return!0},Dt.prototype.build=function(e){var t,i,r=[],a=[];for(this.divider||(this.divider=e[0].clone()),t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],this.polygons,this.polygons,r,a);r.length>0&&(this.front||(this.front=new Dt),this.front.build(r)),a.length>0&&(this.back||(this.back=new Dt),this.back.build(a))},Dt.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},Dt.prototype.clone=function(){var e=new Dt;if(this.divider&&(e.divider=this.divider.clone()),e.polygons=this.polygons.map(function(e){return e.clone()}),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.materialSize=this.materialSize,e.material=new oe.ArrayMaterial,this.material)for(var t=0;t<this.material.materials.length;t++)e.material.materials.push(this.material.materials[t]);return e},Dt.prototype.invert=function(){var e,t,i;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider&&this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),i=this.front,this.front=this.back,this.back=i,this},Dt.prototype.clipPolygons=function(e){var t,i,r,a;if(!this.divider)return e.slice();for(r=[],a=[],t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],r,a,r,a);return this.front&&(r=this.front.clipPolygons(r)),a=this.back?this.back.clipPolygons(a):[],r.concat(a)},Dt.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},Dt.prototype.sumMateriaSize=function(e){e.changeMaterialIndex(this.materialSize),this.materialSize=this.materialSize+e.materialSize;for(var t=0;t<e.material.materials.length;t++)this.material.materials.push(e.material.materials[t])},Dt.prototype.changeMaterialIndex=function(e){for(var t=0;t<this.polygons.length;t++)for(var i=this.polygons[t],r=0;r<i.vertices.length;r++){var a=i.vertices[r];a.materialIndex=a.materialIndex+e}this.front&&this.front.changeMaterialIndex(e),this.back&&this.back.changeMaterialIndex(e)},oe.CSG.Node=Dt,oe.XmlSerializer=function(e,t,i){this.dataBox=e,this.settings=t||new oe.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},oe.extend(oe.XmlSerializer,Object,{serialize:function(){return this.xmlString="<TGL version='"+oe.version+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</TGL>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this)},isSerializable:function(e){return!!this.dataBox.contains(e)&&!(this.filterFunction&&!this.filterFunction(e))},getPropertyType:function(e,t){var i=this.settings.getPropertyType(t);return i||e.__SizePropeties&&-1!=e.__SizePropeties.indexOf(t)&&(i="number"),i},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),i=this.refMap[e.getId()];this.xmlString+="<data class='"+e.getClassName()+"' ref='"+i+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+e.getId()+"'"),this.xmlString+=">\n",e.serializeXml(this,t),this.xmlString+="</data>\n"}e.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(e,t,i){var r=this.getPropertyType(e,t);if(r){var a=oe.getValue(e,t,r),n=oe.getValue(i,t,r);a!==n&&this.serializeValue("p",t,a,n,r)}},serializeStyleXml:function(e,t,i){var r=this.settings.getStyleType(t);if(r){var a=e.getStyle(t),n=i.getStyle(t);a!=n&&this.serializeValue("s",t,a,n,r)}},serializeClientXml:function(e,t,i){var r=this.settings.getClientType(t);if(null!=r){var a=e.getClient(t),n=i.getClient(t);a!=n&&this.serializeValue("c",t,a,n,r)}},serializeValue:function(e,t,i,r,a){if("s"===e&&(i=this.flattenArray(i))instanceof Array&&"string"!==a&&"color"!==a&&"number"!==a&&(a="list."+a,i=new _e(i)),null==i)this.xmlString+="\t<"+e+" n='"+t+"' none=''/>\n";else if("cdata"===a)this.xmlString+="\t<"+e+" n='"+t+"'><![CDATA["+i+"]]></"+e+">\n";else if("data"===a){var n=this.refMap[i.getId()];null!=n&&(this.xmlString+="\t<"+e+" n='"+t+"' ref='"+n+"'/>\n")}else"vec2"===a?r&&i.x===r.x&&i.y===r.y||(this.xmlString+="\t<"+e+" n='"+t+"' x='"+i.x+"' y='"+i.y+"'/>\n"):"vec3"===a?r&&i.x===r.x&&i.y===r.y&&i.z==r.z||(this.xmlString+="\t<"+e+" n='"+t+"' x='"+i.x+"' y='"+i.y+"' z='"+i.z+"'/>\n"):"list.vec2"===a?(this.xmlString+="\t<"+e+" n='"+t+"'>\n",i instanceof Array&&(i=new _e(i)),i.forEach(function(t){if(t instanceof Array){this.xmlString+="\t<"+e+">\n";for(var i=0;i<t.length;i++){var r=t[i];this.xmlString+="\t\t<p x='"+r.x+"' y='"+r.y+"'/>\n"}this.xmlString+="\t</"+e+">\n"}else this.xmlString+="\t\t<p x='"+t.x+"' y='"+t.y+"'/>\n"},this),this.xmlString+="\t</"+e+">\n"):"list.vec3"===a?(this.xmlString+="\t<"+e+" n='"+t+"'>\n",i instanceof Array&&(i=new _e(i)),i.forEach(function(t){if(t instanceof Array){this.xmlString+="\t<"+e+">\n";for(var i=0;i<t.length;i++){var r=t[i];this.xmlString+="\t<"+e+"' x='"+r.x+"' y='"+r.y+"' z='"+r.z+"'/>\n"}this.xmlString+="\t</"+e+">\n"}else this.xmlString+="\t\t<"+e+"' x='"+t.x+"' y='"+t.y+"' z='"+t.z+"'/>\n"},this),this.xmlString+="\t</"+e+">\n"):"list.string"===a||"list.number"===a||"list.color"===a?(this.xmlString+="\t<"+e+" n='"+t+"'>\n",i.forEach(function(e){this.xmlString+="\t\t<s>"+e+"</s>\n"},this),this.xmlString+="\t</"+e+">\n"):this.xmlString+="\t<"+e+" n='"+t+"'>"+i+"</"+e+">\n"},flattenArray:function(e){if(e instanceof Array){for(var t=0;t<e.length-1;t++)if(e[t]!=e[t+1]){if(!e[t]||!e[t].equals)return e;if(!e[t].equals(e[t+1]))return e}return e[0]}return e},deserialize:function(e,t){oe.isDeserializing=!0,this.xmlString=e;var i=oe.xml(e).documentElement;this.refMap={},this.idMap={};var r,a,n,o=new _e,s=new _e,l=i.getElementsByTagName("data"),h=l.length;for(n=0;n<h;n++){var c=(a=l[n]).getAttribute("class"),u=this.settings.getPropertyType("id");if(u&&a.hasAttribute("id")){var f=null;if("string"===u)f=a.getAttribute("id");else if("int"===u)f=parseInt(a.getAttribute("id"));else{if("number"!==u)throw"Unsupported id type '"+u+"'";f=parseFloat(a.getAttribute("id"))}if("remove"===a.getAttribute("action")){this.dataBox.removeById(f);continue}(r=this.dataBox.getDataById(f))||(r=oe.newInstance(c,f))}else r=oe.newInstance(c);if(a.hasAttribute("ref")){var p=a.getAttribute("ref");this.refMap[p]=r}o.add(r),s.add(a),this.idMap[r.getId()]=r}for(this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),h=o.size(),n=0;n<h;n++)r=o.get(n),this.dataBox.containsById(r.getId())||(t&&!r.getParent()&&r.setParent(t),this.dataBox.add(r));for(n=0;n<h;n++)r=o.get(n),a=s.get(n),r.deserializeXml(this,a);this.settings.isDataBoxSerializable&&1===i.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,i.getElementsByTagName("dataBox")[0]),oe.isDeserializing=!1},deserializePropertyXml:function(e,t,i){var r=this.getPropertyType(e,i);r&&oe.setValue(e,i,this.deserializeValue(t,r))},deserializeStyleXml:function(e,t,i){var r=this.settings.getStyleType(i);r&&e.setStyle(i,this.deserializeValue(t,r))},deserializeClientXml:function(e,t,i){var r=this.settings.getClientType(i);r&&e.setClient(i,this.deserializeValue(t,r))},deserializePoint:function(e){var t=e.getAttribute("x")?parseFloat(e.getAttribute("x")):null,i=e.getAttribute("a")?parseFloat(e.getAttribute("a")):null;if(null!=t){var r=e.getAttribute("y")?parseFloat(e.getAttribute("y")):null,a=e.getAttribute("z")?parseFloat(e.getAttribute("z")):null,n=e.getAttribute("w")?parseFloat(e.getAttribute("w")):null;return null!=n?new oe.Vec4(t,r,a,n):null!=a?new oe.Vec3(t,r,a):new oe.Vec2(t,r)}if(null!=i){var o=e.getAttribute("b")?parseFloat(e.getAttribute("b")):null,s=e.getAttribute("c")?parseFloat(e.getAttribute("c")):null,l=e.getAttribute("d")?parseFloat(e.getAttribute("d")):null;return null!=l?new oe.Face4(i,o,s,l):new oe.Face3(i,o,s)}return null},arrayStyleValue:function(e,t){var i=[];if(e.indexOf(",")){if(i=e.split(","),"string"===t)return i;if("number"===t){for(var r=[],a=0;a<i.length;a++)r.push(parseFloat(i[a]));return r}if("color"===t){for(var n=[],a=0;a<i.length;a++)n.push(new oe.Color(i[a]));return n}}},deserializeValue:function(e,t,i){if(e.hasAttribute("@none"))return null;var r="s"===e.nodeName,a=r&&-1!==e.textContent.indexOf(",");if("string"===t)return a?this.arrayStyleValue(e.textContent,t):e.textContent;if("color"===t)return a?this.arrayStyleValue(e.textContent,t):e.textContent;if("number"===t)return a?this.arrayStyleValue(e.textContent,t):parseFloat(e.textContent);if("boolean"===t)return"true"===e.textContent;if("int"===t)return parseInt(e.textContent);if("point"===t)return this.deserializePoint(e);if("vec2"===t){var n=parseFloat(e.getAttribute("x")),o=parseFloat(e.getAttribute("y"));if(!isNaN(n)&&!isNaN(o)||!r)return new oe.Vec2(n,o);t="list.point"}if("vec3"===t){var n=parseFloat(e.getAttribute("x")),o=parseFloat(e.getAttribute("y")),s=parseFloat(e.getAttribute("z"));return new oe.Vec3(n,o,s)}if("data"===t){var l=e.getAttribute("ref"),h=this.refMap[l];return h||this.idMap[l]}var c,u,f,p;if("list.point"===t){var d=new _e,m=e.getElementsByTagName("p");for(c=m.length,p=0;p<c;p++){var g=m[p];d.add(this.deserializePoint(g))}return r?d._as:d}if("list.string"===t){var v=new _e;for(c=(f=e.getElementsByTagName("s")).length,p=0;p<c;p++)v.add(f[p].textContent);return v}if("list.number"===t){for(u=new _e,c=(f=e.getElementsByTagName("s")).length,p=0;p<c;p++)u.add(parseFloat(f[p].textContent));return u}if("array.string"===t)return e.textContent.split(",");if("array.number"===t){for(c=(u=e.textContent.split(",")).length,p=0;p<c;p++)u[p]=parseFloat(u[p]);return u}return"rectangle"===t?{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),width:parseFloat(e.getAttribute("w")),height:parseFloat(e.getAttribute("h"))}:e.textContent}}),oe.addMethod(oe.Data,{serializeXml:function(e,t){if(this.__SizePropeties&&this.__SizePropeties.length){var i,r;for(i=0,r=this.__SizePropeties.length;i<r;i++)this.serializePropertyXml(e,this.__SizePropeties[i],t)}else this.serializePropertyXml(e,"materialSize",t),this.vertices&&this.vertices.length&&this.serializePropertyXml(e,"vertices",t),this.faces&&this.faces.length&&this.serializePropertyXml(e,"faces",t),this.uvs&&this.uvs.length&&this.serializePropertyXml(e,"uvs",t);if(e.settings.isClientSerializable&&this._clientMap)for(var a in this._clientMap)this.serializeClientXml(e,a,t);this.serializePropertyXml(e,"name",t),this.serializePropertyXml(e,"parent",t)},serializePropertyXml:function(e,t,i){e.serializePropertyXml(this,t,i)},serializeClientXml:function(e,t,i){e.serializeClientXml(this,t,i)},deserializeXml:function(e,t){var i,r,a,n,o=t.getElementsByTagName("p"),s=o.length;for(i=0;i<s;i++)(r=o[i]).hasAttribute("n")&&this.deserializePropertyXml(e,r,r.getAttribute("n"));if(e.settings.isClientSerializable)for(s=(a=t.getElementsByTagName("c")).length,i=0;i<s;i++)(n=a[i]).hasAttribute("n")&&this.deserializeClientXml(e,n,n.getAttribute("n"))},deserializePropertyXml:function(e,t,i){e.deserializePropertyXml(this,t,i)},deserializeClientXml:function(e,t,i){e.deserializeClientXml(this,t,i)}}),oe.addMethod(oe.Element,{serializeXml:function(e,t){if(e.settings.isStyleSerializable&&this.styleMap)for(var i in this.styleMap)this.isSideStyle(i)||this.serializeStyleXml(e,i,t);this.serializePropertyXml(e,"position",t),this.serializePropertyXml(e,"rotation",t),this.serializePropertyXml(e,"scale",t),oe.Element.superClass.serializeXml.call(this,e,t),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===e.settings.getPropertyType("alarmState")&&(e.xmlString+="\t<p n='alarmState'>\n",oe.AlarmSeverity.forEach(function(t){var i=this.getNewAlarmCount(t);i>0&&(e.xmlString+="\t\t<n n='"+t.name+"' c='"+i+"'/>\n")},this._alarmState),oe.AlarmSeverity.forEach(function(t){var i=this.getAcknowledgedAlarmCount(t);i>0&&(e.xmlString+="\t\t<a n='"+t.name+"' c='"+i+"'/>\n")},this._alarmState),e.xmlString+="\t</p>\n")},serializeStyleXml:function(e,t,i){e.serializeStyleXml(this,t,i)},deserializeXml:function(e,t){if(oe.Element.superClass.deserializeXml.call(this,e,t),e.settings.isStyleSerializable){var i,r,a=t.getElementsByTagName("s"),n=a.length;for(i=0;i<n;i++)(r=a[i]).hasAttribute("n")&&this.deserializeStyleXml(e,r,r.getAttribute("n"))}},deserializeStyleXml:function(e,t,i){e.deserializeStyleXml(this,t,i)},deserializePropertyXml:function(e,t,i){if("alarmState"===i){if("alarmstate"===e.settings.getPropertyType("alarmState")){var r,a,n,o=t.getElementsByTagName("n");for(a=0;a<o.length;a++)n=o[a],r=se.AlarmSeverity.getByName(n.getAttribute("n")),this._alarmState.setNewAlarmCount(r,parseInt(n.getAttribute("c")));for(o=t.getElementsByTagName("a"),a=0;a<o.length;a++)n=o[a],r=se.AlarmSeverity.getByName(n.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(r,parseInt(n.getAttribute("c")))}}else oe.Element.superClass.deserializePropertyXml.call(this,e,t,i)}}),oe.addMethod(oe.DataBox,{serializeXml:function(e,t){if(e.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(e,i,t);this.serializePropertyXml(e,"name",t)},serializePropertyXml:function(e,t,i){e.serializePropertyXml(this,t,i)},serializeClientXml:function(e,t,i){e.serializeClientXml(this,t,i)},deserializeXml:function(e,t){var i,r,a,n,o=t.getElementsByTagName("p"),s=o.length;for(i=0;i<s;i++)(r=o[i]).hasAttribute("n")&&this.deserializePropertyXml(e,r,r.getAttribute("n"));if(e.settings.isClientSerializable)for(s=(a=t.getElementsByTagName("c")).length,i=0;i<s;i++)(n=a[i]).hasAttribute("n")&&this.deserializeClientXml(e,n,n.getAttribute("n"))},deserializePropertyXml:function(e,t,i){e.deserializePropertyXml(this,t,i)},deserializeClientXml:function(e,t,i){e.deserializeClientXml(this,t,i)}}),oe.JsonSerializer=function(e,t,i){this.dataBox=e,this.settings=t||new oe.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},oe.extend(oe.JsonSerializer,Object,{constructor:oe.JsonSerializer,className:"TGL.JsonSerializer",serialize:function(){return this.jsonObject={v:oe.version,platform:"html5"},this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var e={class:this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=e,this.dataBox.serializeJson(this,this.dataBox.newInstance(),e),Oe.isEmptyObject(e.p)&&delete e.p,Oe.isEmptyObject(e.s)&&delete e.s,Oe.isEmptyObject(e.c)&&delete e.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){if(this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this),e instanceof oe.ComboNode)for(var t=0;t<e.combos.length;t++){var i=e.combos[t];this.refMap[i.getId()]||(this.refMap[i.getId()]=this.ref++)}},isSerializable:function(e){return!!this.dataBox.contains(e)&&!(this.filterFunction&&!this.filterFunction(e))},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),i=this.refMap[e.getId()],r={class:e.getClassName(),ref:i,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=e.getId()),this.jsonObject.datas.push(r),e.serializeJson(this,t,r),Oe.isEmptyObject(r.p)&&delete r.p,Oe.isEmptyObject(r.s)&&delete r.s,Oe.isEmptyObject(r.c)&&delete r.c}e.getChildren().forEach(this.serializeData,this)},serializeDataValue:function(e){var t=e.newInstance(),i=this.refMap[e.getId()],r={class:e.getClassName(),ref:i,p:{},s:{},c:{}};return e.serializeJson(this,t,r),Oe.isEmptyObject(r.p)&&delete r.p,Oe.isEmptyObject(r.s)&&delete r.s,Oe.isEmptyObject(r.c)&&delete r.c,r},getPropertyType:function(e,t){var i=this.settings.getPropertyType(t);return i||(e.__bool&&-1!=e.__bool.indexOf(t)?i="boolean":e.__SizePropeties&&-1!=e.__SizePropeties.indexOf(t)&&(i="number")),i},getStyleType:function(e,t){return e.isSideStyle(t)&&(t=t.substr(t.indexOf(".")+1)),this.settings.getStyleType(t)},serializePropertyJson:function(e,t,i,r){var a=this.getPropertyType(e,t);if(a){var n=oe.getValue(e,t,a),o=oe.getValue(i,t,a);n!==o&&(n&&n.equals?!n.equals(o)&&this.serializeValue(t,n,o,a,r.p):this.serializeValue(t,n,o,a,r.p))}},serializeStyleJson:function(e,t,i,r){var a=this.getStyleType(e,t);if(a){var n=e.getStyle(t),o=i.getStyle(t);t.startsWith("m.")&&(n=this.flattenArray(n),o=this.flattenArray(o)),t.endsWith(".image")&&(n=this.encodeURI(n),o=this.encodeURI(o)),n!=o&&(n&&n.equals?!n.equals(o)&&this.serializeValue(t,n,o,a,r.s):this.serializeValue(t,n,o,a,r.s))}},serializeClientJson:function(e,t,i,r){var a=this.settings.getClientType(t);if(null!=a){var n=e.getClient(t),o=i.getClient(t);n!=o&&(n&&n.equals?!n.equals(o)&&this.serializeValue(t,n,o,a,r.c):this.serializeValue(t,n,o,a,r.c))}},serializeValue:function(e,t,i,r,a){if(null==t)a[e]=null;else if(t instanceof _e)a[e]=t._as;else if("data"===r){var n=this.refMap[t.getId()];null!=n&&(a[e]=n)}else if("data.list"===r){for(var o=[],s=0;s<t.length;s++)o.push(this.serializeDataValue(t[s]));a[e]=o}else if("serializeabe.list"===r){for(var o=[],s=0;s<t.length;s++)o.push(t[s].serializeJsonValue());a[e]=o}else t.serializeJsonValue?a[e]=t.serializeJsonValue():a[e]=t},deserialize:function(e,t){oe.isDeserializing=!0,this.jsonObject=JSON.parse(e),this.refMap={},this.idMap={};var i,r=new _e,a=new _e,n=this.jsonObject.datas.length;null!=this.deserializeStartCreateData&&this.deserializeStartCreateData(n);for(var o=0;o<n;o++){var s=this.jsonObject.datas[o],l=s.class;if(this.settings.getPropertyType("id")&&null!=s.id){if("remove"===s.action){this.dataBox.removeById(s.id);continue}(i=this.dataBox.getDataById(s.id))||(i=oe.newInstance(l,s.id))}else{i=oe.newInstance(l)}null!=s.ref&&(this.refMap[s.ref]=i),r.add(i),a.add(s),this.idMap[i.getId()]=i,this.deserializeCreateData&&this.deserializeCreateData(o,n)}for(this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),n=r.size(),this.deserializeStartFillData&&this.deserializeStartFillData(n),o=0;o<n;o++)(i=r.get(o)).deserializeJson(this,a.get(o)),this.deserializeFillData&&this.deserializeFillData(o,n);for(this.deserializeStartAddData&&this.deserializeStartAddData(n),o=0;o<n;o++)i=r.get(o),this.dataBox.containsById(i.getId())||(t&&!i.getParent()&&i.setParent(t),"TGL.Entity"===i.getClassName()&&(i.computed=!1,i.computeNodeData()),this.dataBox.add(i),this.deserializeAddData&&this.deserializeAddData(o,n));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),oe.isDeserializing=!1},deserializePropertyJson:function(e,t,i){var r=this.getPropertyType(e,i);r&&oe.setValue(e,i,this.deserializeValue(t,r))},deserializeStyleJson:function(e,t,i){var r=this.getStyleType(e,i);if(r){var a=this.deserializeValue(t,r);a._as&&(a=a._as),e.setStyle(i,a)}},deserializeClientJson:function(e,t,i){var r=this.settings.getClientType(i);r&&e.setClient(i,this.deserializeValue(t,r))},getClassName:function(e){if(null!=e)return e.class?e.class:e.w!==t&&e.x!==t&&e.y!==t&&e.z!==t?"TGL.Vec4":e.x!==t&&e.y!==t&&e.z!==t?"TGL.Vec3":e.x!==t&&e.y!==t?"TGL.Vec2":e.a!==t&&e.b!==t&&e.c!==t&&e.d!==t?"TGL.Face4":e.a!==t&&e.b!==t&&e.c!==t?"TGL.Face3":void 0},translateJson:function(e){if(null!=e){if(null!=this.getClassName(e)){var t=oe.newInstance(this.getClassName(e));if(t.deserializeJsonValue)t.deserializeJsonValue(e);else for(var i in e)t[i]=e[i];return t}if(e instanceof Array)for(var r=0;r<e.length;r++)e[r]=this.translateJson(e[r]);return e}},isChinese:function(e){return e=e||"",window.escape(e).indexOf("%u")>0},encodeURI:function(e){if(e instanceof Array){for(var t=0;t<e.length;t++)e[t]=this.encodeURI(e[t]);return e}return"string"==typeof e&&this.isChinese(e)?encodeURI(e):e},flattenArray:function(e){if(e instanceof Array){for(var t=0;t<e.length-1;t++)if(e[t]!=e[t+1]){if(!e[t]||!e[t].equals)return e;if(!e[t].equals(e[t+1]))return e}return e[0]}return e},deserializeValue:function(e,i){if("data"===i){var r=this.refMap[e];return r||this.idMap[e]}if("data.list"===i){for(var a,n,o=[],s=0;s<e.length;s++)a=e[s],n=oe.newInstance(a.class),null!=a.ref&&(this.refMap[a.ref]=n),n.deserializeJson(this,a),o.push(n);return o}if("color"===i&&e.r!=t){var l=new oe.Color;return l.setRGB(e.r,e.g,e.b),l}if("TGL.Path"===e.class){var h=new oe.Path;return h.deserializeJsonValue(e),h}if(e instanceof Array){for(s=0;s<e.length;s++)e[s]=this.translateJson(e[s]);return e}return null!=this.getClassName(e)?this.translateJson(e):e}}),oe.addMethod(oe.DataBox,{serializeJson:function(e,t,i){if(e.settings.isClientSerializable&&this._clientMap)for(var r in this._clientMap)this.serializeClientJson(e,r,t,i);this.serializePropertyJson(e,"name",t,i)},serializePropertyJson:function(e,t,i,r){e.serializePropertyJson(this,t,i,r)},serializeClientJson:function(e,t,i,r){e.serializeClientJson(this,t,i,r)},deserializeJson:function(e,t){var i;for(i in t.p)this.deserializePropertyJson(e,t.p[i],i);if(e.settings.isClientSerializable)for(i in t.c)this.deserializeClientJson(e,t.c[i],i)},deserializePropertyJson:function(e,t,i){e.deserializePropertyJson(this,t,i)},deserializeClientJson:function(e,t,i){e.deserializeClientJson(this,t,i)}}),oe.addMethod(oe.Data,{serializeJson:function(e,t,i){if(!this.__SizePropeties||!this.__SizePropeties.length||this instanceof oe.Entity)this.materialSize&&this.serializePropertyJson(e,"materialSize",t,i),this instanceof oe.Entity&&(this.vertices&&this.vertices.length&&this.serializePropertyJson(e,"vertices",t,i),this.faces&&this.faces.length&&this.serializePropertyJson(e,"faces",t,i),this.uvs&&this.uvs.length&&this.serializePropertyJson(e,"uvs",t,i),this.uv2s&&this.uv2s.length&&this.serializePropertyJson(e,"uv2s",t,i));else{var r,a;for(r=0,a=this.__SizePropeties.length;r<a;r++)this.serializePropertyJson(e,this.__SizePropeties[r],t,i)}if(e.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientJson(e,n,t,i);this.serializePropertyJson(e,"name",t,i),this.serializePropertyJson(e,"parent",t,i)},serializePropertyJson:function(e,t,i,r){e.serializePropertyJson(this,t,i,r)},serializeClientJson:function(e,t,i,r){e.serializeClientJson(this,t,i,r)},deserializeJson:function(e,t){var i;for(i in t.p)this.deserializePropertyJson(e,t.p[i],i);if(e.settings.isClientSerializable)for(i in t.c)this.deserializeClientJson(e,t.c[i],i)},deserializePropertyJson:function(e,t,i){e.deserializePropertyJson(this,t,i)},deserializeClientJson:function(e,t,i){e.deserializeClientJson(this,t,i)}}),oe.addMethod(oe.Element,{serializeJson:function(e,t,i){if(e.settings.isStyleSerializable&&this.styleMap)for(var r in this.styleMap)this.isSideStyle(r)||this.serializeStyleJson(e,r,t,i);if(oe.Element.superClass.serializeJson.call(this,e,t,i),this.serializePropertyJson(e,"position",t,i),this.serializePropertyJson(e,"rotation",t,i),this.serializePropertyJson(e,"scale",t,i),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===e.settings.getPropertyType("alarmState")){var a={n:{},a:{}};i.p.alarmState=a,oe.AlarmSeverity.forEach(function(e){var t=this.getNewAlarmCount(e);t>0&&(a.n[e.name]=t)},this._alarmState),oe.AlarmSeverity.forEach(function(e){var t=this.getAcknowledgedAlarmCount(e);t>0&&(a.a[e.name]=t)},this._alarmState),Oe.isEmptyObject(a.n)&&delete a.n,Oe.isEmptyObject(a.a)&&delete a.a,Oe.isEmptyObject(a)&&delete i.p.alarmState}},serializeStyleJson:function(e,t,i,r){e.serializeStyleJson(this,t,i,r)},deserializeJson:function(e,t){if(oe.Element.superClass.deserializeJson.call(this,e,t),e.settings.isStyleSerializable)for(var i in t.s)this.deserializeStyleJson(e,t.s[i],i)},deserializeStyleJson:function(e,t,i){e.deserializeStyleJson(this,t,i)},deserializePropertyJson:function(e,t,i){if("alarmState"===i){if("alarmstate"===e.settings.getPropertyType("alarmState")){var r;for(r in t.n)this._alarmState.setNewAlarmCount(se.AlarmSeverity.getByName(r),t.n[r]);for(r in t.a)this._alarmState.setAcknowledgedAlarmCount(se.AlarmSeverity.getByName(r),t.a[r])}}else oe.Element.superClass.deserializePropertyJson.call(this,e,t,i)}}),oe.addMethod(oe.Light,{serializeJson:function(e,t,i){if(oe.Light.superClass.serializeJson.call(this,e,t,i),this.serializePropertyJson(e,"color",t,i),this.serializePropertyJson(e,"ambient",t,i),this.serializePropertyJson(e,"diffuse",t,i),this.serializePropertyJson(e,"specular",t,i),this.serializePropertyJson(e,"castShadow",t,i),this.serializePropertyJson(e,"onlyShadow",t,i),t.__accessor&&t.__accessor.length)for(var r=0;r<t.__accessor.length;r++)this.serializePropertyJson(e,t.__accessor[r],t,i)}});var Lt=oe.Animate=function(e){var t=this;t.type=null==e.type?"number":e.type,t.delay=null==e.delay?0:e.delay,t.dur=null==e.dur?1e3:e.dur,t.interval=null==e.interval?0:e.interval,t.finish=null==e.finish?t.delay+t.dur+t.interval:e.finish,t.repeat=null==e.repeat?1:e.repeat,t.reverse=null==e.reverse||e.reverse,t.easing=null==e.easing?"easeNone":e.easing,t.onUpdate=e.onUpdate,t.onDone=e.onDone,t.onStop=e.onStop,t.onPlay=e.onPlay,t.attr=e.attr,t.source=e.source,t.filter=e.filter,t.from=e.from,t.to=e.to,t.start=null,t.time=0,t.total=0,t.count=0,t.started=!1,t.stopped=!1,t.id=Nt++};oe.extend(oe.Animate,Object,{play:function(){return J(this)},stop:function(e){return te(this,e)},clone:function(){return new Lt(this)},chain:function(e){var t,i=this;return i.onDone?(t=i.onDone,i.onDone=function(){t.call(i),e.play()}):i.onDone=function(){e.play()},i}});var Rt={},Nt=1,Bt=!1;if(function e(t){requestAnimationFrame(e),Bt&&(Bt=!1,re(t))}(0),!window.make){var It={},Ft={},Vt=[],Ut={};(kt=window.make={}).Default={path:"./",resPath:"",getImagePath:function(e){return this.path+this.resPath+"res/images/"+(e||"")},register:function(e,t,i){(i=i||{}).name=i.name||e,i.modelDefaultParameters=i.modelDefaultParameters||{},i.description=i.description||i.name,It[e]&&console.log(e," already exist"),It[e]=t;var r=i.category||"",a=Ft[r]||{};a[e]=t,Ft[r]=a,Ut[e]=i,-1==Vt.indexOf(r)&&Vt.push(r),this.checkModelDefaultParameters(i.modelDefaultParameters)},checkModelDefaultParameters:function(e){if(e)for(var i in e){var r=e[i];r instanceof Object||(r={value:r},e[i]=r),r.propertyName=i,r.hidden=!!r.hidden,r.propertyType=r.propertyType||kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,r.type=r.type||kt.Default.PARAMETER_TYPE_STRING,r.category=r.category||kt.Default.PARAMETER_CATEGORY_DETAIL,r.editable=r.editable===t||!!r.editable,r.index=r.index===t?100:parseInt(r.index)}},remove:function(e){if(It[e]){It[e]=t,delete It[e];var i=kt.Default.getCategory(e),r=Ft[i];delete r[e];var a=0;for(var n in r)n&&a++;if(0==a)for(n=0;n<Vt.length;n++){var o=Vt.indexOf(i);o>=0&&Vt.splice(o,1)}delete Ut[e]}else console.log(e," not exist")},getCategories:function(){return Vt},getCreatorsForCategory:function(e){return Ft[e]},getCreator:function(e){return It[e]},getIds:function(e){var t=[];for(var i in It)(!e||e&&e(this.getParameters(i)))&&t.push(i);return t},getModelDefaultParameters:function(e){return this.getParameters(e).modelDefaultParameters},getDescription:function(e){return this.getParameters(e).description},getName:function(e){return this.getParameters(e).name},getIcon:function(e){var t=this.getParameters(e);return this.path+t.icon},isAsync:function(e){return this.getParameters(e).async},isCombo:function(e){return this.getParameters(e).combo},getCategory:function(e){return this.getParameters(e).category},getOrder:function(e){return this.getParameters(e).order||0},getType:function(e){return this.getParameters(e).type},getOtherParameter:function(e,t){return this.getParameters(e)[t]},registerIcon:function(e,t){var i=this.getParameters(e);if(i)return i.icon=t,i.icon},registerDescription:function(e,t){var i=this.getParameters(e);return i.description=t,i.description},registerName:function(e,t){var i=this.getParameters(e);return i.name=t,i.name},registerOther:function(e,t,i){var r=a[t],a=this.getParameters(e);return a[t]=i,"modelDefaultParameters"===t&&(console.warn("rewrite modelDefaultParameters: id={0}, oldValue={}, newValue={}",e,r,i),this.checkModelDefaultParameters(i)),r},appendModelDefaultParameter:function(e,t,i,r,a,n,o){},getParameters:function(e){return Ut[e]||{}},load:function(e,t,i){var r,a=(i=i||{}).isRelation;if(t){var n=t;t=function(t){a&&e instanceof Array&&e.length>1&&t instanceof Array&&t.length>1&&this._relation(e,t),n(t)}}if(e instanceof Array){var o={};if(t){var s=function(i,r){var a=e.length;return function(e){i.datas=i.datas||[],i.datas.push(e),i._total===a&&t(i.datas)}(r)};o._total=0;for(l=0;l<e.length;l++){h=e[l];this.load(h,function(e){o._total++,s(o,e)})}return null}r=[];for(var l=0;l<e.length;l++){var h=e[l],c=this.load(h);c&&r.push(c)}}else{var u={};"string"==typeof e?u.id=e:u=e,u=this.filterJson(u),t?this._load(u,t):r=this._load(u)}return a&&r instanceof Array&&r.length>1&&this._relation(e,r),r},_relation:function(e,t){var i={};t.forEach(function(e){e.getId&&(i[e.getId()]=e)}),e.forEach(function(e){e.objectId&&e.parentId&&i[e.objectId]&&i[e.parentId]&&i[e.objectId].setParent&&i[e.objectId].setParent(i[e.parentId])})},_load:function(e,t){var i=e.id,r=this.getCreator(i);if(!r)return console.log("unknown id: ",i),null;if(!t){var a=r(e);return kt.Default._setObjectClientId(a,i),a}r(e,function(e){kt.Default._setObjectClientId(e,i),t&&t(e)})},_setObjectClientId:function(e,t){e&&e.setClient&&e.setClient("id",t)},copyArray:function(e,t,i){if(t=[],e)for(var r,a=0,n=e.length;a<n;a++)r={},this.copyProperties(e[a],r),t.push(r);return t},copyProperties:function(e,i,r){if(e&&i)for(var a in e)r&&r.indexOf(a)>=0||0==a.indexOf("_")||(i[a]===t&&(e[a]instanceof Array?i[a]=[]:e[a]instanceof Function?i[a]=e[a]:e[a]instanceof Object?i[a]={}:i[a]=e[a]),!(e[a]instanceof Function)&&e[a]instanceof Object&&i[a]instanceof Object&&kt.Default.copyProperties(e[a],i[a]))},getModelDefaultParametersValues:function(e,t){var i=this.getModelDefaultParameters(e),r={};for(var a in i){var n=i[a];t&&t(n)||(n.propertyType==kt.Default.PARAMETER_PROPERTY_TYPE_CLIENT?(r.client=r.client||{},r.client[a]=n.value):n.propertyType==kt.Default.PARAMETER_PROPERTY_TYPE_STYLE?(r.style=r.style||{},r.style[a]=n.value):r[a]=n.value)}return r},getModelDefaultParameterProperties:function(e,t){var i=this,r=[],a=this.getModelDefaultParameters(e);if(!a)return r;t&&!a.id&&(a.id={propertyName:"id",name:"模型ID",category:kt.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:kt.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-2}),t&&!a.objectId&&(a.objectId={propertyName:"objectId",name:"实例ID",category:kt.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:kt.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-1});for(var n in a)r.push(a[n]);return r.sort(function(e,t){return e.index-t.index}),r=r.map(function(e){return i.modelParameterToProperty(e)})},_getNameFromPropertyName:function(e){for(var t=e.split("."),i="",r=0;r<t.length;r++)t[r].length>0&&(i+=t[r].substring(0,1).toUpperCase()+t[r].substring(1,t[r].length)),r<t.length-1&&(i+=" ");return i},modelParameterToProperty:function(e){var t=new window.twaver.Property;return t.setCategoryName(e.category),e.name||(e.name=this._getNameFromPropertyName(e.propertyName)),t.setName(e.name),t.setEditable(e.editable),t.setPropertyType(e.propertyType),t.setPropertyName(e.propertyName),t.setValueType(e.type),t.setEnumInfo(e.enumInfo),t.isVisible=function(){return!e.hidden},t},filterJson:function(e){var i=this.getModelDefaultParameters(e.id);for(var r in i){var a=i[r].propertyType||"client",n=i[r].value;a==kt.Default.PARAMETER_PROPERTY_TYPE_STYLE?e.style&&e.style[r]!==t||(e.style=e.style||{},e.style[r]=n):a==kt.Default.PARAMETER_PROPERTY_TYPE_CLIENT?e.client&&e.client[r]!==t||(e.client=e.client||{},e.client[r]=n):e[r]===t&&(e[r]=n)}return e},UNIT_HEIGHT:4.445,EQUIPMENT_WIDTH:45.5,RACK_OFFSET_X:7.25,RACK_OFFSET_Y:6.655,RACK_WIDTH:60,getUnitHeight:function(){return this.UNIT_HEIGHT},getEquipmentWidth:function(){return this.EQUIPMENT_WIDTH},getEquipmentHeight:function(e){return parseInt(e)>0||console.error("method getEquipmentHeight's first argument scale value is zero"),this.UNIT_HEIGHT*e},getRackWidth:function(){return this.RACK_WIDTH},getRackHeight:function(e){return parseInt(e)>0||console.error("method getRackHeight's first argument scale value is zero"),this.RACK_OFFSET_Y+this.UNIT_HEIGHT*parseInt(e)+this.RACK_OFFSET_Y}},kt.Default.toJson=function(e,t){if(e&&e.getClient){var i=e.getClient("id"),r=kt.Default.getModelDefaultParameters(i),a={},n=null,o=null;for(var s in r)if(!1!==r[s].exportable){var l=r[s].propertyType,o=r[s].value;l==kt.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR?(n=e[window._twaver.getter(s)](),kt.Default.equals(n,o)||(a[s]=n)):l==kt.Default.PARAMETER_PROPERTY_TYPE_FIELD?(n=e[s],kt.Default.equals(n,o)||(a[s]=n)):l==kt.Default.PARAMETER_PROPERTY_TYPE_STYLE?(n=e.getStyle(s),kt.Default.equals(n,o)||(a.style=a.style||{},a.style[s]=n)):l==kt.Default.PARAMETER_PROPERTY_TYPE_CLIENT&&(n=e.getClient(s),kt.Default.equals(n,o)||(a.client=a.client||{},a.client[s]=n))}return a.id=i,kt.Default.EXPORT_OBJECT_ID&&(a.objectId=e.getId()),t&&(a=t(a)),a}return t&&(e=t(e)),e},kt.Default.copy=function(e,i,r,a,n){!function(e,i,r,a,n){n=n||{};var o={},s={},l=kt.Default.getParameters(i);if(l=kt.Default.clone(l),kt.Default.copyProperties(l,s),a instanceof Function?o=a(s)||{}:kt.Default.copyProperties(a,o),n.copyDefaultParamCoverage&&delete s.modelDefaultParameters,n.copyParamCoverage||kt.Default.copyProperties(s,o),n.defaultValue&&o.modelDefaultParameters)for(var h in n.defaultValue)o.modelDefaultParameters[h]!==t&&(o.modelDefaultParameters[h]instanceof Object?o.modelDefaultParameters[h].value=n.defaultValue[h]:o.modelDefaultParameters[h]=n.defaultValue[h]);kt.Default.register(e,function(e,t){var a={id:i};return r instanceof Function?r(e):kt.Default.copyProperties(r,a),kt.Default.copyProperties(e,a),kt.Default.load(a,t)},o)}(e,i,r,a,n)},kt.Default.PARAMETER_CATEGORY_BASIC="BASIC",kt.Default.PARAMETER_CATEGORY_DETAIL="Detail",kt.Default.PARAMETER_TYPE_STRING="string",kt.Default.PARAMETER_TYPE_BOOLEAN="boolean",kt.Default.PARAMETER_TYPE_COLOR="color",kt.Default.PARAMETER_TYPE_INT="int",kt.Default.PARAMETER_TYPE_NUMBER="number",kt.Default.PARAMETER_TYPE_IMAGE="image",kt.Default.PARAMETER_TYPE_ARRAY_STRING="array.string",kt.Default.PARAMETER_TYPE_ARRAY_NUMBER="array.number",kt.Default.PARAMETER_TYPE_ARRAY_INT="array.int",kt.Default.PARAMETER_PROPERTY_TYPE_FIELD="field",kt.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR="accessor",kt.Default.PARAMETER_PROPERTY_TYPE_STYLE="style",kt.Default.PARAMETER_PROPERTY_TYPE_CLIENT="client",String.prototype.replaceAll=function(e,t,i){return RegExp.prototype.isPrototypeOf(e)?this.replace(e,t):this.replace(new RegExp(e,i?"gi":"g"),t)},String.prototype.format=function(e){var t=this;if(arguments.length>1){for(var i=[],r=0;r<arguments.length;r++)i.push(arguments[r]);e=i}if(e){if(e instanceof Array)e.forEach(function(e,i){e instanceof Object&&(e=JSON.stringify(e)),t=t.replaceAll("{"+i+"}",e)});else{if(!(e instanceof Object))return t.replaceAll("{}",e);for(var a in e){var n=e[a];n instanceof Object&&(n=JSON.stringify(n)),t=t.replaceAll("{"+a+"}",n)}}}return t},kt.Default.getId=function(e){return e.getClient("id")},kt.Default.objectWrapper=function(e,t,i,r){Object.defineProperty(e,t,{get:function(){var r=e["___"+t];return i&&(r=i.call(e,r,e,t)),r},set:function(i){var a=e[t];r&&(i=r.call(e,i,e,t)),a!==i&&(e["___"+t]=i,this.firePropertyChange&&this.firePropertyChange(t,a,i))}})},kt.Default.equals=function(e,t){return e instanceof Object&&t instanceof Object?JSON.stringify(e)==JSON.stringify(t):e==t},kt.Default.clone=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){throw console.error(t,e),t}},kt.Default.EXPORT_OBJECT_ID=!0}var kt=window.make;se.Element.prototype.direction2=function(e){var t=e.applyMatrix4((new se.Mat4).extractRotation(this.matrix));return t.normalize(),t},kt.Utils3D={positionFloor:"floor-top",_objMap:{},_objObject:{},_envMaps:{envmap:"envmap.jpg",envmap1:"envmap1.jpg",envmap2:"envmap2.jpg",envmap3:"envmap3.jpg",envmap4:"envmap4.jpg",envmap5:"envmap5.jpg",envmap6:"envmap6.jpg"},getEnvMap:function(e){var t=kt.Default.getImagePath()+kt.Default._envMaps[e];return[t,t,t,t,t,t]},getOBjPath:function(e){return e?e.indexOf("http")>=0?e:this.path+e:this.path+"obj/"},createFloorForWall:function(e){var t={type:"twaver.floor",data:e.getClient("data")};this.getCreator(t.type)&&this.loadData(t).setParent(e)},createCombo:function(e,t){var i=[],r=[],a=[],n=[];!e||e instanceof Array||(e=[e]);for(var o=0;o<e.length;o++){var s=e[o],l=s.op||"+",h=s.style,c=s.client,u=s.position||[0,0,0],f=s.rotation||[0,0,0],p=s.scale||[1,1,1],d=null;if("cube"===s.type&&(d=this.createCube(s)),"cylinder"===s.type&&(d=this.createCylinder(s)),"sphere"===s.type&&(d=this.createSphere(s)),"polygon"===s.type&&(d=this.createPolygon(s)),"torus"===s.type&&(d=this.createTorus(s)),"path"===s.type&&(d=this.createPathCube(s)),"pathNode"===s.type&&(d=this.createPathNode(s)),"shapeNode"===s.type&&(d=this.createShapeNode(s)),d){if(f&&!s.rotationAnchor&&d.setRotation(f[0],f[1],f[2]),s.rotationAnchor){var m=d.getPosition();u=[u[0]+m.x,u[1]+m.y,u[2]+m.z]}d.setPosition(u[0],u[1],u[2]),d.setScale(p[0],p[1],p[2]),h&&d.s(h),c&&d.c(c),s.op?(d.getChildren().size()>0&&(i=i.concat(d.getChildren().toArray())),i.push(d),d.getChildren().size()>0?d.getChildren().forEach(function(){a.push(l)}):i.length>1&&a.push(l),n.push(d.getId())):r.push(d)}}if(i.length>0){var g;return(g=t?new se.ComboNode(i,a,!1,t):new se.ComboNode(i,a)).setNames(n),g}return 1==r.length?r[0]:r},setMainObject:function(e){var t=null;if(e instanceof Array){for(i=0;i<e.length;i++)(r=e[i])instanceof se.Entity&&(t=function(e,t){if(e){var i=e.getBoundingBox(),r=t.getBoundingBox(),a=i.min,n=i.max,o=r.min,s=r.max;(n.x-a.x<s.x-o.x||n.z-a.z<s.z-o.z)&&(e=t)}else e=t;return e}(t,r));for(var i=0;i<e.length;i++){var r=e[i];r instanceof se.Entity&&(t!=r&&e[i].setParent(t))}}else t=e;return t&&t.setClient("main",!0),t},createCube:function(e){var t,i=e.width,r=e.height,a=e.depth,n=e.color,o=(e.position,e.rotation||[0,0,0]),s=e.rotationAnchor,l=e.topColor||n,h=e.repeatX||1,c=e.repeatY||1,u=e.image,f=e.frontImage,p=e.wrapMode;if(t=e.objectId?new se.Cube({id:e.objectId,width:i,height:r,depth:a}):new se.Cube(i,r,a),n&&t.s({"m.color":n,"m.ambient":n}),l&&t.s({"top.m.color":l,"top.m.ambient":l,"bottom.m.color":l,"bottom.m.ambient":l}),u&&t.s({"m.texture.image":u,"m.texture.repeat":new se.Vec2(h,c),"m.texture.anisotropy":15}),f&&t.setStyle("front.m.texture.image",f),p&&t.setWrapMode(p),s){var d,m;"left"===s&&(d=new se.Vec3(i/2,0,0),m=new se.Vec3(0,1,0)),"right"===s&&(d=new se.Vec3(-i/2,0,0),m=new se.Vec3(0,1,0)),t.rotateFromAxis(m.clone(),d.clone(),o[1])}else t.setRotation(o[0]/180*Math.PI,o[1]/180*Math.PI,o[2]/180*Math.PI);return kt.Default.setObject3dCSProps(t,e),t},createCylinder:function(e){var t=e.radius,i=e.topRadius||t,r=e.bottomRadius||t,a=e.height,n=e.color,o=e.image,s=new se.Cylinder(i,r,a);return s.s({"m.normalType":se.NormalTypeSmooth,"m.type":"phong","m.color":n,"m.ambient":n,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),o&&s.setStyle("m.texture.image",o),s},createSphere:function(e){var t=e.radius,i=e.color||"#F5F5F5",r=e.image,a=new se.Sphere(t);return a.s({"m.normalType":se.NormalTypeSmooth,"m.type":"phong","m.color":i,"m.ambient":i,"m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),r&&a.setStyle("m.texture.image",r),a},createPolygon:function(e){var t=e.radius||100,i=e.topRadius||t,r=e.bottomRadius||t,a=e.height||200,n=e.radialSegments||3,o=e.color||"#F5F5F5",s=e.topColor||o,l=e.smooth||!0,h=e.image,c=new se.Cylinder(i,r,a,n,l);return c.s({"m.normalType":se.NormalTypeSmooth,"m.type":"phong","m.color":o,"m.ambient":o,"top.m.color":s,"top.m.ambient":s,"bottom.m.color":s,"bottom.m.ambient":s,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),h&&c.setStyle("m.texture.image",h),c},createTorus:function(e){var t=e.radius||50,i=e.tube||30,r=e.tubularSegments||3,a=e.radialSegments||6,n=e.color||"#F5F5F5",o=e.image,s=new se.Torus(t,i,r,a);return s.s({"m.normalType":se.NormalTypeSmooth,"m.type":"phong","m.color":n,"m.ambient":n,"m.lightmap.image":this.getImagePath("outside_lightmap.jpg")}),o&&s.setStyle("m.texture.image",o),s},createBillboard:function(e){var t=e.position||[0,0,0],i=e.scale||[1,1,1],r=e.image||this.getImagePath("outside_lightmap.jpg"),a=new se.Billboard;return a.s({"m.texture.image":r,"m.alignment":se.BillboardAlignment.bottomCenter,"m.depthTest":!1}),a.setScale(i[0],i[1],i[2]),a.p(t[0],t[1],t[2]),a},createPathNodePath:function(e){var t;if(e[0]&&e[0]instanceof Array)for(r=0;r<e.length;r++){var i=e[r];t?"c"===i[0]?t.quadraticCurveTo(i[1],i[2],i[3],i[4],i[5],i[6]):t.lineTo(i[0],0,i[1]):(t=new se.Path).moveTo(i[0],0,i[1])}else for(var r=0;r<e.length;r+=2)t?t.lineTo(e[r],0,e[r+1]):(t=new se.Path).moveTo(e[r],0,e[r+1]);return t},createPathNode:function(e){var t,i=e.radius,r=e.pathImage,a=e.repeat||50,n=e.offset||new se.Vec2(0,0),o=e.startCap||"plain",s=e.endCap||"plain",l=e.pathWidth,h=e.pathHeight,c=l/2,u=h/2,f=[{x:c,y:-u},{x:c,y:u},{x:-c,y:u},{x:-c,y:-u}],p=this.createPathNodePath(e.data),d=p.getLength();return l&&h?t=new se.PathNode({path:p,shape:f,segments:10,segmentsR:5}):(p=se.PathNode.prototype.adjustPath(p,i,2),t=new se.PathNode({path:p,radius:i})),t.s({"m.texture.image":r,"m.texture.repeat":new se.Vec2(d/a,1),"m.texture.offset":n}),o&&t.setStartCap(o),s&&t.setEndCap(s),kt.Default.setObject3dCSProps(t,e),t},createShapeNodePath:function(e){var t;if(e[0]&&e[0]instanceof Array)for(r=0;r<e.length;r++){var i=e[r];t?"c"===i[0]?t.quadraticCurveTo(i[1],-i[2],0,i[3],-i[4],0):t.lineTo(i[0],-i[1],0):(t=new se.Path).moveTo(i[0],-i[1],0)}else for(var r=0;r<e.length;r+=2)t?t.lineTo(e[r],-e[r+1],0):(t=new se.Path).moveTo(e[r],-e[r+1],0);return t},createShapeNode:function(e){var i=e.repeat||100,r=e.amount||2,a=!0;null===e.vertical&&e.vertical==t||(a=e.vertical);var n,o=this.createShapeNodePath(e.data);return n=e.id?new se.ShapeNode({id:e.id,path:o}):new se.ShapeNode(o),e.curveSegments&&n.setCurveSegments(e.curveSegments),n.setAmount(r),n.setVertical(a),n.setRepeat(i),n},createPathCube:function(e){var t=e.width,i=e.height,r=e.data,a=e.insideColor,n=e.outsideColor,o=e.asideColor,s=e.zsideColor,l=e.topColor,h=e.bottomColor,c=e.insideImage||e.image,u=e.outsideImage||e.image,f=e.insideMap,p=e.outsideMap,d=e.repeat||e.height,m=e.closed,g=this.createShapeNodePath(r);m&&g.closePath();var v=new se.PathCube(g,t,i);return v.s({"outside.m.color":n,"inside.m.type":"basic","inside.m.color":a,"aside.m.color":o||n,"zside.m.color":s||n,"top.m.color":l,"top.m.ambient":l,"bottom.m.color":h||l,"inside.m.lightmap.image":f,"outside.m.lightmap.image":p,"aside.m.lightmap.image":p,"zside.m.lightmap.image":p,"inside.m.texture.image":c,"outside.m.texture.image":u}),v.setRepeat(d),v},getPicInfo:function(e,t){var i={};"string"==typeof t&&(t=[t]);for(var r=0;r<t.length;r++){var a=t[r],n=a.substring(0,a.indexOf(".")).toLowerCase();a=e+a,i[n]=a}return i},getRByD:function(e){return e*Math.PI/180},getDByR:function(e){return 180*e/Math.PI},getRsByDs:function(e){var t;if(e&&e.length>0){t=[];for(var i=0;i<e.length;i++)t.push(kt.Default.getRByD(e[i]))}return t},setObject3dCSProps:function(e,t){t.client&&e.c(t.client),t.style&&e.s(t.style)},setObject3dCommonProps:function(e,t){var i=kt.Default.getRsByDs(t.rotation)||[0,0,0],r=t.scale||[1,1,1],a=t.position||[0,0,0];e.setRotation(i[0],i[1],i[2]),e.setScale(r[0],r[1],r[2]),e.setPosition(a[0],0,a[2]),kt.Default.setPositionY(e,a[1]),kt.Default.setObject3dCSProps(e,t)},cloneObjElement:function(e,t){var i=kt.Default.getRsByDs(e.rotation)||[0,0,0],r=e.scale||[1,1,1],a=e.position||[0,0,0];a[1]=parseFloat(a[1])||0;var n=this._objObject[e.name],o=n.getBoundingBoxWithChildren(),s=(o.max.y-o.min.y)/2,l=e.singleton?n:n.clonePrefab();if(e._id&&(l._id=e._id),e.client)for(var h in e.client)l.setClient(h,e.client[h]);return e.style&&l.s(e.style),l.setClient("type",e.name),l.setClient("showShadow",e.showShadow),e.showShadow&&(null!=e.shadowType?(l.setClient("shadowType",e.shadowType),l.setClient("shadowWeight",1)):e.showShadowImage&&l.setClient("shadowImage",e.shadowImage)),"function"==typeof e.interepter&&e.interepter.call(this,l),l.setClient("json",e),l.setScale(r[0],r[1],r[2]),l.setPosition(a[0],a[1]+s*r[1],a[2]),l.setRotation(i[0],i[1],i[2]),t&&t(l),l},setDefaultEnvMap:function(e){var t=this.getEnvMap("envmap5");return e.setStyle("m.envmap.image",t),e.getDescendants().forEach(function(e){e.setStyle("m.envmap.image",t)}),e},setShadowImage:function(e,t){e.setClient("shadowImage",t),window.twaver.Util.registerImageByUrl(t,t)},createObj:function(e,t){var i=this;if(this._objObject[e.name]){var r=this.getOBjPath(e.path),a=e.shadowImage=r+e.name+"S.png";return this.cloneObjElement(e,t)}if(this._objMap[e.name]){if(e.showShadow){var r=this.getOBjPath(e.path),a=e.shadowImage=r+e.name+"S.png";null==e.shadowType&&window.twaver.Util.registerImageByUrl(a,a)}}else{this._objMap[e.name]=[];var n=(r=this.getOBjPath(e.path))+e.name+".obj",o=r+e.name+".mtl";e.scale;if(e.showShadow){a=e.shadowImage=r+e.name+"S.png";null==e.shadowType&&window.twaver.Util.registerImageByUrl(a,a)}(new se.OBJMTLLoader).load(n,o,null,function(t){if(e.merged)t=se.Utils.mergeElements(t.getDescendants());else if(e.envImages){var r=kt.Default.getEnvMap("envmap5");t.getDescendants().forEach(function(t){var i=t.getStyle("m.texture.image");i&&e.envImages.forEach(function(e){(i.indexOf(e)>=0||i instanceof Array&&i[0].indexOf(e)>=0)&&t.setStyle("m.envmap.image",r)})})}i._objObject[e.name]=t,i._objMap[e.name].forEach(function(e){return i.cloneObjElement(e.json,e.callback)})})}this._objMap[e.name].push({json:e,callback:t})},getTextSize:function(e,t){var i=document.createElement("canvas").getContext("2d"),r=e.split("\n"),a=0;i.font=t;for(var n=0;n<r.length;n++){var o=r[n],s=i.measureText(o).width;s>a&&(a=s)}return{w:a,h:i.measureText("e").width*r.length*3+4}},generateTextCanvas:function(e,t,i,r,a,n){var o=document.createElement("canvas"),i=i||"bold 80px 微软雅黑,sans-serif",s=o.getContext("2d"),l=e.split("\n"),h=kt.Default.getTextSize(e,i),c=h.w,u=h.h,f={width:c,height:u};o.height=se.Utils.nextPowerOfTwo(h.h),o.width=se.Utils.nextPowerOfTwo(h.w),r&&(s.save(),s.globalAlpha=1,s.fillStyle=a||"#FE642E",s.beginPath(),s.moveTo(0,0),s.lineTo(c,0),s.lineTo(c,u),s.lineTo(0,u),s.closePath(),s.fill()),s.restore(),s.fillStyle=t||"white",s.textBaseline="middle",s.textAlign="center",s.font=i,n||(s.shadowColor="#585858",s.shadowBlur=25,s.shadowOffsetX=10,s.shadowOffsetY=10);for(var p=2.5*s.measureText("o").width,d=0;d<l.length;d++){var m=c/2,g=p*d+p/2+(o.height-f.height);s.fillText(l[d],m,g)}return o.drawRect=f,o},generateShadowNode:function(e,t,i){var r=null,a=e.getDescendants();if(a&&a.length>0)for(var n=0;n<a.length;n++){var o=a[n];if(o instanceof se.Entity&&o.getClient("type")&&"floor"==o.getClient("type")){r=o;break}}if(r){var s=r.getBoundingBox(),l=(s.max.z,s.min.z,s.max.x,s.min.x,e.getRotation());e.setRotation(0,0,0);var h=kt.Default.createShadowImage(e,r,t,i);return r.setStyle("top.m.lightmap.image",h),r.invalidateTexture(),kt.Default.newcanvas=kt.Default.newcanvas||h,e.setRotation(l),r}},_getWorldRotation:function(e){var t=(new se.Mat4).extractRotation(e.worldMatrix),i=new se.Vec3;return i.setEulerFromRotationMatrix(t),i},createShadowImage:function(e,t,i,r){var a=r&&r.shadowColor||"#000",n=(r&&r.shadowWeight,t.getBoundingBox()),o=n.max.z-n.min.z,s=n.max.x-n.min.x,l=Math.max(s,o),h=l>4096?Math.ceil(l/4096):1,c=kt.Default.canvas||document.createElement("canvas"),u=s/(ce=s/h),f=o/(ue=o/h);c.width=ce,c.height=ue;var p=c.getContext("2d");p.clearRect(0,0,ce,ue),p.fillStyle="white",p.fillRect(0,0,ce,ue),p.beginPath();for(var d,m=e.getPosition(),g=e?e.getBoundingBox():null,v=-(g.max.x+g.min.x)/2-m.x,y=-(g.max.z+g.min.z)/2-m.z,A=e.getDescendants(),x=0;x<A.length;x++)if((w=A[x]).getClient&&"wallCombos"==w.getClient("id")){d=w;break}d&&(b=d.getClient("combos")).forEach(function(e){if(e.getClient&&!e.getClient("resetPos")){var t=e.getPosition();e.p(t.x+parseFloat(m.x),t.y+parseFloat(m.y),t.z+parseFloat(m.z)),e.setClient("resetPos",!0)}A.push(e)});for(var _,x=0;x<A.length;x++){var w=A[x];if(w.getClient&&"columnCombos"==w.getClient("id")){_=w;break}}if(_){var b=_.getClient("combos");b.forEach(function(e){if(e.getClient&&!e.getClient("resetPos")){var t=e.getPosition();e.p(t.x+parseFloat(m.x),t.y+parseFloat(m.y),t.z+parseFloat(m.z)),e.setClient("resetPos",!0)}A.push(e)})}A.push(e);for(var M=0;M<A.length;M++){var S=A[M],P=S.getWorldPosition(),C=ce/2+P.x/u,T=ue/2+P.z/f,E=kt.Default._getWorldRotation(S),z=S.getClient("type");if(0!=(W=S.getClient("showShadow"))&&(W=!0),W&&("wall"==z||"inner_wall"==z||"glass_wall"==z)){var D=S.getClient("data"),L=S.getClient("doorData"),R=.9*S.getClient("wallDepth");if(p.save(),p.translate(C,T),p.beginPath(),D[0]&&D[0]instanceof Array){for(N=0;N<D.length;N++)0==N?p.moveTo(D[N][0]/u+v/u,D[N][1]/f+y/f):p.lineTo(D[N][0]/u+v/u,D[N][1]/f+y/f);"wall"==z&&p.lineTo(D[0][0]/u+v/u,D[0][1]/f+y/f)}else{for(var N=0;N<D.length;N+=2)0==N?p.moveTo(D[N]/u+v/u,D[N+1]/f+y/f):p.lineTo(D[N]/u+v/u,D[N+1]/f+y/f);"wall"==z&&p.lineTo(D[0]/u+v/u,D[1]/f+y/f)}p.lineWidth=R/u,p.strokeStyle="#ccc",p.shadowColor=a;var B=Math.min(parseInt(s/15),300);p.shadowBlur=parseInt(B/u),"inner_wall"!=z&&"glass_wall"!=z||(p.lineWidth=R/u,p.shadowBlur=parseInt(B/u)),p.shadowOffsetX=0,p.shadowOffsetY=0;for(var I=0;I<3;I++)p.shadowBlur=l>=4e3?180+80*I:100+50*I,p.stroke(),0==I&&(p.shadowColor="#666",p.shadowBlur=l>=4e3?300:200,p.stroke(),p.shadowColor="#000",p.shadowBlur=10,p.stroke());if(L){p.save(),p.shadowBlur=100,p.shadowColor="#ffffff";for(x=0;x<L.length;x+=2){var F=(L[x][0]+v)/h,V=(L[x][1]+y)/h,U=(L[x+1][0]+v)/h,k=(L[x+1][1]+y)/h,O=50/h,X=200/h,G=p.createLinearGradient(F-O,V-X,F-O,V+X);F==U&&(G=p.createLinearGradient(F-X,V-O,F+X,V-O)),F==U?(V+=8/h,k-=8/h):V==k&&(F+=8/h,U-=8/h),G.addColorStop(0,"rgba(255,255,255,0)"),G.addColorStop(.5,"rgba(255,255,255,1)"),G.addColorStop(1,"rgba(255,255,255,0)"),p.fillStyle=G,p.beginPath(),F==U?(p.moveTo(F-X,V-O),p.lineTo(F,V),p.lineTo(F+X,V-O),p.lineTo(F+X,k+O),p.lineTo(U,k),p.lineTo(F-X,k+O)):V==k&&(p.moveTo(F-O,V-X),p.lineTo(U+O,V-X),p.lineTo(U,k),p.lineTo(U+O,k+X),p.lineTo(F-O,k+X),p.lineTo(F,V)),p.closePath(),p.fill()}p.restore()}p.restore()}var W=S.getClient("showShadow");i&&(W=W&&i(S));var Y=S.getClient("shadowImage"),j=S.getClient("shadowType")||0,H=S.getClient("shadowRatio")||.99,q=S.getClient("shadowWeight")||2;if(W){var Z,Q=S.getBoundingBox().size(),K=Q.x/u*H,R=Z=Q.z/f*H;if(E.y%(Math.PI/2)==0&&(K=Q.x/f*H,R=Z=Q.z/u*H),E.y%Math.PI==0&&(K=Q.x/u*H,R=Z=Q.z/f*H),1==j){var J=Math.min(Q.x,Q.z);K=J/u*H,R=Z=J/f*H,E.y%(Math.PI/2)==0&&(K=J/f*H,R=Z=J/u*H),E.y%Math.PI==0&&(K=J/u*H,R=Z=J/f*H)}if(Y){E=S.getRotation();var $=window.twaver.Util.getImageAsset(Y);if(!$)continue;p.save(),p.translate(C+v/u,T+y/f),p.rotate(-E.y);var ee,te,ie,re,ae=.3*Math.max(K,Z);E.y%(Math.PI/2)==0&&(ee=-K/2-ae/2,te=-Z/2-ae/2,ie=K+ae,re=Z+ae),E.y%Math.PI==0&&(ee=-K/2-ae/2,te=-Z/2-ae/2,ie=K+ae,re=Z+ae),p.drawImage($.getImage(),ee,te,ie,re),p.restore()}else if(0==j){p.save(),p.translate(C+v/u,T+y/f),p.rotate(-E.y),p.beginPath(),p.moveTo(-K/2,0),p.lineTo(K/2,0),p.lineWidth=R,p.strokeStyle="gray",p.shadowColor="#333";var ne=Math.min(K,Z);p.shadowBlur=2*ne,p.shadowOffsetX=0,p.shadowOffsetY=0,1==q?(p.shadowBlur=3*ne,p.stroke()):2==q&&(p.stroke(),p.stroke()),p.restore()}else if(1==j){var C=C+v/u,T=T+y/f,oe=S.getClient("shadowRadius");oe?oe/=f:oe=Math.sqrt(K*K+Z*Z)/2,p.save(),p.beginPath(),p.arc(C,T,oe,0,2*Math.PI,!1),p.fillStyle="gray",p.shadowColor=a,p.shadowBlur=2*oe,p.shadowOffsetX=0,p.shadowOffsetY=0,1==q?(p.shadowBlur=3*oe,p.fill()):2==q&&(p.fill(),p.fill()),p.restore()}}}kt.Default.canvas=kt.Default.canvas||c;var le=(l=Math.max(2048,Math.max(s/h,o/h)))/2048,he=kt.Default.newcanvas||document.createElement("canvas"),ce=se.Utils.nextPowerOfTwo(s/le),ue=se.Utils.nextPowerOfTwo(o/le);he.width=ce,he.height=ue,he.style.width=ce,he.style.height=ue;var fe=he.getContext("2d");return fe.clearRect(0,0,ce,ue),fe.fillStyle="white",fe.fillRect(0,0,ce,ue),fe.drawImage(c,0,0,s/h,o/h,0,0,ce,ue),he},getRelativePosition:function(e,t){var i,r;return i=(new se.Mat4).getInverse(e.worldMatrix.clone()),r=(new se.Mat4).multiplyMatrices(i,t.worldMatrix.clone()),(new se.Vec3).getPositionFromMatrix(r)},getPathBoundingBox:function(e){var t={},i={centerPoint:{x:0,y:0},min:{x:0,y:0},max:{x:0,y:0},size:{x:0,y:0}};if(0==e.length)return i;var r,a,n,o;if(e[0]instanceof Array){r=e[0][0],a=e[0][0],n=-e[0][1],o=-e[0][1];for(s=1;s<e.length;s++)r=Math.min(r,e[s][0]),a=Math.max(a,e[s][0]),n=Math.min(n,-e[s][1]),o=Math.max(o,-e[s][1])}else{if(e.length<2)return i;r=e[0],a=e[0],n=-e[1],o=-e[1];for(var s=2;s<e.length;s+=2)r=Math.min(r,e[s]),a=Math.max(a,e[s]),n=Math.min(n,-e[s+1]),o=Math.max(o,-e[s+1])}return t.centerPoint={x:(r+a)/2,y:(n+o)/2},t.min={x:r,y:n},t.max={x:a,y:o},t.size={x:a-r,y:o-n},t},setPositionY:function(e,t){if("number"==typeof t)e.setPositionY(t);else if(t==kt.Default.positionFloor){var i=e.getBoundingBox().size();e.setPositionY(i.y/2)}},playAnimation:function(e,t,i){var r=t.split(":");if("move"===r[0]){var a=r[1],n=r[2],o=parseInt(r[3])||1e3,s=parseInt(r[4]||0),l=r[5];this.animateMove(e,a,n,o,s,l,i)}if("rotation"===r[0]){var h=r[1],c=r[2],o=parseInt(r[3])||1e3,s=parseInt(r[4]),l=r[5];this.animateRotate(e,h,c,o,s,l,i)}},animateMove:function(e,t,i,r,a,n,o){n=n||"easeInStrong";var s=e.getBoundingBox().size().multiply(e.getScale()),i=i||.8,l=new se.Vec3(0,0,1),h=0;"right"===t&&(l=new se.Vec3(1,0,0),h=s.x),"left"===t&&(l=new se.Vec3(-1,0,0),h=s.x),"top"===t&&(l=new se.Vec3(0,1,0),h=s.y),"bottom"===t&&(l=new se.Vec3(0,-1,0),h=s.y),"front"===t&&(l=new se.Vec3(0,0,1),h=s.z),"back"===t&&(l=new se.Vec3(0,0,-1),h=s.z),h*=i,e.getClient("animated")&&(l=l.negate()),l=e.direction2(l);var c=e.getPosition().clone();e.setClient("animated",!e.getClient("animated")),new window.twaver.Animate({from:0,to:1,dur:r,easing:n,delay:a,onUpdate:function(t){e.setPosition(c.clone().add(l.clone().multiplyScalar(h*t)))},onDone:function(){o&&o()}}).play()},animateRotate:function(e,i,r,a,n,o,s){o=o||"easeInStrong";var l=e.getBoundingBox().size().multiply(e.getScale()),h=1;e.getClient("animated")&&(h=-1),e.setClient("animated",!e.getClient("animated"));var c;if("left"===i){c=new se.Vec3(-l.x/2,0,0);u=new se.Vec3(0,1,0)}if("right"===i){c=new se.Vec3(l.x/2,0,0);u=new se.Vec3(0,1,0)}if("center-z"===i){c=new se.Vec3(0,0,0);var u=new se.Vec3(0,0,1)}new window.twaver.Animate({from:0,to:h,dur:a,delay:n,easing:o,onUpdate:function(i){this.lastValue===t&&(this.lastValue=0),e.rotateFromAxis(u.clone(),c.clone(),Math.PI/180*-r*(i-this.lastValue)),this.lastValue=i},onDone:function(){delete this.lastValue,s&&s()}}).play()},animateCameraPosition:function(e,t,i,r){var a=e.getPosition(),n=new window.twaver.Animate({from:0,to:1,dur:i,easing:"easeBoth",onUpdate:function(i){var r=a.x+(t.x-a.x)*i,n=a.y+(t.y-a.y)*i,o=a.z+(t.z-a.z)*i,s=new se.Vec3(r,n,o);e.setPosition(s)}});return n.onDone=r,n},playCameraAnimation:function(e,t,i,r){var a=e.getTarget(),n=e.getPosition().sub(e.getTarget()),o=new window.twaver.Animate({from:0,to:1,dur:500,easing:"easeBoth",onUpdate:function(r){var o=a.x+(i.x-a.x)*r,s=a.y+(i.y-a.y)*r,l=a.z+(i.z-a.z)*r,h=new se.Vec3(o,s,l);e.lookAt(h),t.target=h;var c=(new se.Vec3).addVectors(n,h);e.setPosition(c)}});o.onDone=r,o.play()}};for(var vt in kt.Utils3D)kt.Default[vt]=kt.Utils3D[vt];kt.Default.register("twaver.cube",function(e,t){e.image&&e.image.indexOf("http")<0&&(e.image=kt.Default.path+e.image);var i=kt.Default.createCube(e);return 0==e.visible&&i.setStyle("m.visible",!1),kt.Default.setObject3dCommonProps(i,e),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"立方体",icon:"model/idc/icons/cube.png",description:"立方体是make里面提供的最基本的模型，可以用这种模型扩展出各种立方体形状的模型，比如箱子，柱子，盒子等。支持更改长，宽，高，贴图等基本参数",modelDefaultParameters:{width:{name:"宽",value:100,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},depth:{name:"深",value:100,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:kt.Default.PARAMETER_TYPE_COLOR,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:kt.Default.PARAMETER_TYPE_IMAGE,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),kt.Default.register("twaver.cylinder",function(e,t){var i=kt.Default.createCylinder(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),kt.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"圆柱体",icon:"model/idc/icons/cylinder.png",description:"圆柱体是make中提供的最基本模型，支持更改半径，高度的参数。可以更改这些参数扩展出各个圆柱体形状的模型，比如圆形柱子，桌子腿，瓶子，圆筒等",modelDefaultParameters:{topRadius:{name:"顶半径",value:60,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:60,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:kt.Default.PARAMETER_TYPE_COLOR,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:kt.Default.PARAMETER_TYPE_IMAGE,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),kt.Default.register("twaver.sphere",function(e,t){var i=kt.Default.createSphere(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),i.setClient("showShadow",!0),i.setClient("shadowType",1),i.setClient("shadowRatio",.3),kt.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"球体",icon:"model/idc/icons/sphere.png",description:"球体是make中提供的最基本模型，支持更改半径的参数。可以更改这些参数扩展出各个球体形状的模型，比如圆球等",modelDefaultParameters:{radius:{name:"半径",value:80,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"#F5F5F5",type:kt.Default.PARAMETER_TYPE_COLOR,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:kt.Default.PARAMETER_TYPE_IMAGE,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),kt.Default.register("twaver.polygon",function(e,t){var i=kt.Default.createPolygon(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),kt.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"多边形",icon:"model/idc/icons/polygon.png",description:"多边形是make中提供的最基本模型，支持更改半径，高度，边数的参数。可以更改这些参数扩展出各个多边形状的模型，比如多边形柱子，多边形箱子，各种支架等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:kt.Default.PARAMETER_TYPE_COLOR,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:kt.Default.PARAMETER_TYPE_IMAGE,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},topRadius:{name:"顶半径",value:100,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:100,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:200,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:3,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),kt.Default.register("twaver.torus",function(e,t){var i=kt.Default.createTorus(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),kt.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"圆环",icon:"model/idc/icons/torus.png",description:"圆环体是make中提供的最基本模型，支持更改半径，高度，扁平程度，管半径的参数。可以更改这些参数扩展出各个圆环体形状的模型，比如轮胎等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:kt.Default.PARAMETER_TYPE_COLOR,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:kt.Default.PARAMETER_TYPE_IMAGE,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},radius:{name:"半径",value:50,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},tube:{name:"内外径差",value:30,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},tubularSegments:{name:"扁平程度",value:3,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:6,type:kt.Default.PARAMETER_TYPE_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:kt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:kt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}});var Ot=0;kt.Default.register("twaver.combo",function(e,t){var i="pack_"+Ot++,r=e.data;if(r&&se.Utils.isArray(r)){for(var a=null,n=null,o=[],s=[],l=0;l<r.length;l++){if(n=kt.Default.load(r[l]),a){var h=n.getClient("type");"inner_wall"==h||"glass_wall"==h?(o.push(n),n.getChildren().size()>0&&n.getChildren().forEachReverse(function(e){e.setParent(a)})):"column"==h?s.push(n):n.setParent(a)}else a=n;n.setClient?n.setClient("pack",i):(n.client=n.client||{},n.client.pack=i)}if(o&&o.length>0&&((c=new se.ComboNode(o)).setClient("id","wallCombos"),c.setClient("combos",c.getCombos()),c.setParent(a)),s&&s.length>0){var c=new se.ComboNode(s);c.setClient("id","columnCombos"),c.setClient("combos",c.getCombos()),c.setParent(a)}return t&&t(a),a}},{icon:"model/idc/icons/combo.png",category:"基本模型",type:"mono.Element",name:"组合模型",description:"组合模型，可以把多个不同的模型组合在一块，组成一个新的模型，传如参数是一个数组"}),kt.Default.registerObj=function(e,t,i,r,a,n,o,s,l,h,c){(r=r||{}).async=!0;kt.Default.register(e,function(e,s){return e.name=t,e.path=i,e.showShadow=a,a&&(e.showShadowImage=!0),e.shadowType=n,e.merged=o,e.envImages=h,e.singleton=c,l&&(e.style=l),null==e.merged&&(e.merged=!0),e.interepter=r.interepter,kt.Default.createObj(e,s)},r)},kt.Default.register("twaver.loader",function(e,t){return kt.Default.load(e.data,t)}),kt.Utils3D.getRectOfPoints=function(e){if(!e||e.length/2<2)return null;var t=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=0,o=e.length,s=[],l=function(e,n){r=Math.min(r,e),a=Math.max(a,e),t=Math.min(t,n),i=Math.max(i,n),s.push({x:e,y:n})};if(o>0&&e[n]instanceof Array)for(;n<o;n++){var h=e[n];2==h.length?l(h[0],h[1]):5==h.length&&"c"==h[0]&&l(h[3],h[4])}else for(;n<o;n+=2)l(e[n],e[n+1]);return{min:{x:r,y:t},max:{x:a,y:i},center:function(){return{x:(r+a)/2,y:(t+i)/2}},width:a-r,height:i-t,points:s}}}(window);